"use strict";(self.webpackChunkcommonlands_web=self.webpackChunkcommonlands_web||[]).push([[186],{45028:function(e,t,n){n.d(t,{C:function(){return I},b:function(){return D}});var r,i,a,o,s,u,l,c,d,h,f=n(30168),p=n(22357),v=n(37081),g=n(33280),m=n(94951),y=n(14801),_=n(48655),T=n(16574),w=n(137),C=n(15226),S=n(26461),x=n(116),b=n(82552),O=n(95276),A=n(98634),R=n(64201),P=n(25920),E=n(4760);function D(e){var t=new R.kG,n=t.vertex,D=t.fragment,I=e.output===v.H.Depth,M=e.hasMultipassTerrain&&(e.output===v.H.Color||e.output===v.H.Alpha);return(0,b.Sv)(n,e),t.include(m.w,e),t.include(_.c,e),t.include(y.R,e),t.attributes.add(E.T.POSITION,"vec3"),t.varyings.add("vpos","vec3"),M&&t.varyings.add("depth","float"),I&&(t.include(T.F,e),(0,p.Zu)(t),(0,p.Lm)(t)),n.code.add((0,A.H)(r||(r=(0,f.Z)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      forwardObjectAndLayerIdColor();\n      ","\n      gl_Position = ","\n    }\n  "])),M?"depth = (view * vec4(vpos, 1.0)).z;":"",I?(0,A.H)(i||(i=(0,f.Z)(["transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);"]))):(0,A.H)(a||(a=(0,f.Z)(["transformPosition(proj, view, vpos);"]))))),t.include(g.f5,e),M&&t.include(C.l,e),D.include(x.Y),D.uniforms.add(new O.N("eColor",(function(e){return e.color}))),e.output===v.H.Highlight&&t.include(w.bA,e),D.code.add((0,A.H)(o||(o=(0,f.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n    vec4 fColor = ","\n\n    ","\n\n    if (fColor.a < ",") {\n      discard;\n    }\n\n    ","\n\n    ","\n    ",";\n    ",";\n    ","\n  }\n  "])),M?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasVertexColors?"vColor * eColor;":"eColor;",e.output===v.H.ObjectAndLayerIdColor?(0,A.H)(s||(s=(0,f.Z)(["fColor.a = 1.0;"]))):"",A.H.float(S.b),e.output===v.H.Alpha?(0,A.H)(u||(u=(0,f.Z)(["gl_FragColor = vec4(fColor.a);"]))):"",e.output===v.H.Color?(0,A.H)(l||(l=(0,f.Z)(["gl_FragColor = highlightSlice(fColor, vpos); ",""])),e.transparencyPassType===P.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"",e.output===v.H.Highlight?(0,A.H)(c||(c=(0,f.Z)(["outputHighlight();"]))):"",e.output===v.H.Depth?(0,A.H)(d||(d=(0,f.Z)(["outputDepth(linearDepth);"]))):"",e.output===v.H.ObjectAndLayerIdColor?(0,A.H)(h||(h=(0,f.Z)(["outputObjectAndLayerIdColor();"]))):"")),t}var I=Object.freeze(Object.defineProperty({__proto__:null,build:D},Symbol.toStringTag,{value:"Module"}))},18442:function(e,t,n){n.d(t,{H:function(){return re},b:function(){return K},c:function(){return te}});var r,i,a,o,s,u,l,c,d,h,f,p,v,g,m,y,_,T,w,C,S,x=n(30168),b=n(92026),O=n(88396),A=n(6394),R=n(67077),P=n(67794),E=n(37081),D=n(33280),I=n(14801),M=n(28156),Z=n(50600),L=n(50913),k=n(137),H=n(18607),N=n(26461),F=n(116),z=n(78980),U=n(62993),j=n(82999),V=n(95276),W=n(59150),G=n(58406),B=n(699),q=n(98634),J=n(64201),X=n(19253),Y=n(25920),$=n(4760),Q=n(65964);function K(e){var t=new J.kG,n=e.signedDistanceFieldEnabled;if(t.include(M.H),t.include(Z.R,e),t.include(D.f5,e),e.occlusionPass)return t.include(L.R,e),t;var K=t.vertex,re=t.fragment;t.include(U.cK),re.include(z.n),re.include(F.Y),t.include(H.k,e),t.include(I.R,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),K.uniforms.add([new V.N("viewport",(function(e,t){return t.camera.fullViewport})),new j.A("screenOffset",(function(e,t){return(0,O.s)(ne,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio)})),new j.A("anchorPosition",(function(e){return te(e)})),new V.N("materialColor",(function(e){return e.color})),new G.p("pixelRatio",(function(e,t){return t.camera.pixelRatio}))]),n&&(K.uniforms.add(new V.N("outlineColor",(function(e){return e.outlineColor}))),re.uniforms.add([new V.N("outlineColor",(function(e){return ee(e)?e.outlineColor:R.Z})),new G.p("outlineSize",(function(e){return ee(e)?e.outlineSize:0}))])),e.hasScreenSizePerspective&&((0,U.ww)(K),(0,U.m8)(K)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add($.T.UV0,"vec2"),t.attributes.add($.T.COLOR,"vec4"),t.attributes.add($.T.SIZE,"vec2"),t.attributes.add($.T.AUXPOS2,"vec4"),K.code.add((0,q.H)(r||(r=(0,x.Z)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      forwardObjectAndLayerIdColor();\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "])),e.hasScreenSizePerspective?(0,q.H)(i||(i=(0,x.Z)(["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):(0,q.H)(a||(a=(0,x.Z)(["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(auxpos2).xx;":"",e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":"",e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""));var ie=(0,q.H)(o||(o=(0,x.Z)(["vec2 uv01 = floor(uv0);\nvec2 uv = uv0 - uv01;\nquadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;"]))),ae=e.pixelSnappingEnabled?n?(0,q.H)(s||(s=(0,x.Z)(["posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):(0,q.H)(u||(u=(0,x.Z)(["posProj += quadOffset;\nif (inputSize.x == size.x) {\nposProj = alignToPixelOrigin(posProj, viewport.zw);\n}"]))):(0,q.H)(l||(l=(0,x.Z)(["posProj += quadOffset;"])));e.vvColor&&K.uniforms.add([new W.b("vvColorColors",(function(e){return e.vvColorColors}),Q.x),new B.O("vvColorValues",(function(e){return e.vvColorValues}),Q.x)]),K.uniforms.add(new j.A("textureCoordinateScaleFactor",(function(e){return(0,b.pC)(e.texture)&&(0,b.pC)(e.texture.descriptor.textureCoordinateScaleFactor)?e.texture.descriptor.textureCoordinateScaleFactor:A.O}))),K.code.add((0,q.H)(c||(c=(0,x.Z)(["\n    ","\n    ","\n    ","\n\n    ","\n\n    bool alphaDiscard = vcolor.a < ",";\n    ",'\n    if (alphaDiscard) {\n      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n      return;\n    } else {\n      ',"\n      gl_Position = posProj;\n    }\n\n    vtc = uv * textureCoordinateScaleFactor;\n\n    ","\n    vsize = inputSize;\n    ","\n  }\n  "])),e.occlusionTestEnabled?"if (visible) {":"",ie,e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;",e.output===E.H.ObjectAndLayerIdColor?(0,q.H)(d||(d=(0,x.Z)(["vcolor.a = 1.0;"]))):"",q.H.float(N.b),n?"alphaDiscard = alphaDiscard && outlineColor.a < ".concat(q.H.float(N.b),";"):"",ae,e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?(0,q.H)(h||(h=(0,x.Z)(["} else { vtc = vec2(0.0);\n      ",""])),e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),re.uniforms.add(new X.A("tex",(function(e){return e.texture})));var oe=e.debugDrawLabelBorder?(0,q.H)(f||(f=(0,x.Z)(["(isBorder > 0.0 ? 0.0 : ",")"])),q.H.float(N.F)):q.H.float(N.F),se=(0,q.H)(p||(p=(0,x.Z)(["\n    ","\n\n    ","\n\n    // Draw debug border with transparency, so that original texels along border are still partially visible\n    ","\n  "])),e.debugDrawLabelBorder?(0,q.H)(v||(v=(0,x.Z)(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",n?(0,q.H)(g||(g=(0,x.Z)(["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = ",";\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),q.H.float(P.Ph),oe,q.H.float(N.b),oe):(0,q.H)(m||(m=(0,x.Z)(["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "])),oe),e.debugDrawLabelBorder?(0,q.H)(y||(y=(0,x.Z)(["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);"]))):"");return e.output===E.H.Alpha&&re.code.add((0,q.H)(_||(_=(0,x.Z)(["\n      void main() {\n        ","\n        gl_FragColor = vec4(gl_FragColor.a);\n      }\n      "])),se)),e.output===E.H.ObjectAndLayerIdColor&&re.code.add((0,q.H)(T||(T=(0,x.Z)(["\n      void main() {\n        ","\n        outputObjectAndLayerIdColor();\n      }\n      "])),se)),e.output===E.H.Color&&re.code.add((0,q.H)(w||(w=(0,x.Z)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),se,e.transparencyPassType===Y.A.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":"")),e.output===E.H.Highlight&&(t.include(k.bA,e),re.code.add((0,q.H)(C||(C=(0,x.Z)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),se,e.binaryHighlightOcclusionEnabled?(0,q.H)(S||(S=(0,x.Z)(["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();"))),t}function ee(e){return e.outlineColor[3]>0&&e.outlineSize>0}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ne;return e.textureIsSignedDistanceField?function(e,t,n){(0,b.pC)(t)?(0,O.s)(n,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,O.s)(n,0,0)}(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,O.c)(t,e.anchorPosition),t}var ne=(0,A.a)(),re=Object.freeze(Object.defineProperty({__proto__:null,build:K,calculateAnchorPosForRendering:te},Symbol.toStringTag,{value:"Module"}))},99337:function(e,t,n){n.d(t,{N:function(){return E},b:function(){return P}});var r,i,a,o,s,u,l,c,d,h,f,p,v=n(30168),g=n(37081),m=n(33280),y=n(94951),_=n(48655),T=n(137),w=n(60300),C=n(26461),S=n(82552),x=n(95276),b=n(58406),O=n(98634),A=n(64201),R=n(4760);function P(e){var t=new A.kG,n=t.vertex,P=t.fragment;return t.include(y.w,e),t.include(_.c,e),t.include(w.q,e),(0,S.Sv)(n,e),e.stippleEnabled&&(t.attributes.add(R.T.UV0,"vec2"),t.attributes.add(R.T.AUXPOS1,"vec3"),n.uniforms.add(new x.N("viewport",(function(e,t){return t.camera.fullViewport})))),t.attributes.add(R.T.POSITION,"vec3"),t.varyings.add("vpos","vec3"),n.code.add((0,O.H)(r||(r=(0,v.Z)(["void main(void) {\nvpos = position;\nforwardNormalizedVertexColor();\ngl_Position = transformPosition(proj, view, vpos);"])))),e.stippleEnabled&&(n.code.add((0,O.H)(i||(i=(0,v.Z)(["vec4 vpos2 = transformPosition(proj, view, auxpos1);\nvec2 ndcToPixel = viewport.zw * 0.5;\nfloat lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);"])))),e.draped?n.uniforms.add(new b.p("worldToScreenRatio",(function(e,t){return 1/t.screenToPCSRatio}))):n.code.add((0,O.H)(a||(a=(0,v.Z)(["vec3 segmentCenter = (position + auxpos1) * 0.5;\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),n.code.add((0,O.H)(o||(o=(0,v.Z)(["float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);"])))),e.draped?n.code.add((0,O.H)(s||(s=(0,v.Z)(["float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);\nfloat segmentLengthPseudoScreen = lineSegmentPixelSize;"])))):n.code.add((0,O.H)(u||(u=(0,v.Z)(["float segmentLengthRender = length(position - auxpos1);\nfloat startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),n.uniforms.add(new b.p("stipplePatternPixelSize",(function(e){return(0,w.C)(e)}))),n.code.add((0,O.H)(l||(l=(0,v.Z)(["vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);\nvStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);\nvStippleDistance *= gl_Position.w;"]))))),n.code.add((0,O.H)(c||(c=(0,v.Z)(["}"])))),e.output===g.H.Highlight&&t.include(T.bA,e),t.include(m.f5,e),P.uniforms.add(new b.p("alphaCoverage",(function(e,t){return Math.min(1,e.width*t.camera.pixelRatio)}))),e.hasVertexColors||P.uniforms.add(new x.N("constantColor",(function(e){return e.color}))),P.code.add((0,O.H)(d||(d=(0,v.Z)(["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color = ",";\n\n    float stippleAlpha = getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\n\n    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);\n\n    ","\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),e.hasVertexColors?"vColor":"constantColor",e.output===g.H.ObjectAndLayerIdColor?(0,O.H)(h||(h=(0,v.Z)(["finalColor.a = 1.0;"]))):"",O.H.float(C.b),e.output===g.H.Color?(0,O.H)(f||(f=(0,v.Z)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===g.H.Highlight?(0,O.H)(p||(p=(0,v.Z)(["outputHighlight();"]))):"")),t}var E=Object.freeze(Object.defineProperty({__proto__:null,build:P},Symbol.toStringTag,{value:"Module"}))},98186:function(e,t,n){n.d(t,{R:function(){return _e},a:function(){return we},b:function(){return Te}});var r,i,a,o,s,u,l,c,d,h,f,p,v,g,m,y,_,T,w,C,S,x,b,O,A,R,P,E,D,I,M,Z,L,k,H,N,F,z,U,j,V,W,G,B,q,J=n(30168),X=n(92026),Y=n(22357),$=n(37081),Q=n(33280),K=n(14801),ee=n(48353),te=n(16574),ne=n(60300),re=n(40526),ie=n(15226),ae=n(85586),oe=n(26461),se=n(116),ue=n(82552),le=n(82999),ce=n(95276),de=n(58406),he=n(98634),fe=n(8654),pe=n(64201),ve=n(25920),ge=n(4760),me=n(33720),ye=n(737),_e=1;function Te(e){var t=new pe.kG,n=t.vertex,Te=t.fragment,we=e.hasMultipassTerrain&&(e.output===$.H.Color||e.output===$.H.Alpha);t.include(ae.e),t.include(ee.U,e),t.include(ne.q,e);var Ce=e.applyMarkerOffset&&!e.draped;Ce&&(n.uniforms.add(new de.p("markerScale",(function(e){return e.markerScale}))),t.include(re.Q,{space:me.I9.World})),e.output===$.H.Depth&&t.include(te.F,e),t.include(K.R,e),(0,ue.Sv)(n,e),n.uniforms.add([new fe.g("inverseProjectionMatrix",(function(e,t){return t.camera.inverseProjectionMatrix})),new le.A("nearFar",(function(e,t){return t.camera.nearFar})),new de.p("miterLimit",(function(e){return"miter"!==e.join?0:e.miterLimit})),new ce.N("viewport",(function(e,t){return t.camera.fullViewport}))]),n.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(ge.T.POSITION,"vec3"),t.attributes.add(ge.T.SUBDIVISIONFACTOR,"float"),t.attributes.add(ge.T.UV0,"vec2"),t.attributes.add(ge.T.AUXPOS1,"vec3"),t.attributes.add(ge.T.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),(0,Y.Lm)(t),we&&t.varyings.add("depth","float");var Se=e.capType===ye.R.ROUND,xe=e.stippleEnabled&&e.stippleScaleWithLineWidth||Se;xe&&t.varyings.add("vLineWidth","float");var be=e.stippleEnabled&&e.stippleScaleWithLineWidth;be&&t.varyings.add("vLineSizeInv","float");var Oe=e.innerColorEnabled||Se;Oe&&t.varyings.add("vLineDistance","float");var Ae=e.stippleEnabled&&Se,Re=e.falloffEnabled||Ae;Re&&t.varyings.add("vLineDistanceNorm","float"),Se&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),n.code.add((0,he.H)(r||(r=(0,J.Z)(["#define PERPENDICULAR(v) vec2(v.y, -v.x);\nfloat interp(float ncp, vec4 a, vec4 b) {\nreturn (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\nfloat s = sin(a);\nfloat c = cos(a);\nmat2 m = mat2(c, -s, s, c);\nreturn m * v;\n}"])))),n.code.add((0,he.H)(i||(i=(0,J.Z)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= viewport.zw / posNdc.w;\nreturn posNdc;\n}"])))),(0,Y.bA)(t),n.code.add((0,he.H)(a||(a=(0,J.Z)(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearFar[0] * 0.99;\n\n      if(pos.z > -nearFar[0]) {\n        //current pos behind ncp --\x3e we need to clip\n        if (!isStartVertex) {\n          if(prev.z < -nearFar[0]) {\n            //previous in front of ncp\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        } else {\n          if(next.z < -nearFar[0]) {\n            //next in front of ncp\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        if (prev.z > -nearFar[0]) {\n          //previous behind ncp\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        if (next.z > -nearFar[0]) {\n          //next behind ncp\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      ","\n      linearDepth = calculateLinearDepth(nearFar,pos.z);\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n  "])),we?"depth = pos.z;":"")),n.uniforms.add(new de.p("pixelRatio",(function(e,t){return t.camera.pixelRatio}))),n.code.add((0,he.H)(o||(o=(0,J.Z)(["\n  void main(void) {\n    // unpack values from uv0.y\n    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n\n    float coverage = 1.0;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isJoin = abs(uv0.y) < 3.0;\n\n      float lineSize = getSize();\n      float lineWidth = lineSize * pixelRatio;\n\n      ","\n      ","\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth = floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  = view * vec4(position.xyz, 1.0);\n      vec4 prev = view * vec4(auxpos1.xyz, 1.0);\n      vec4 next = view * vec4(auxpos2.xyz, 1.0);\n  "])),xe?(0,he.H)(s||(s=(0,J.Z)(["vLineWidth = lineWidth;"]))):"",be?(0,he.H)(u||(u=(0,J.Z)(["vLineSizeInv = 1.0 / lineSize;"]))):"")),Ce&&n.code.add((0,he.H)(l||(l=(0,J.Z)(["vec4 other = isStartVertex ? next : prev;\nbool markersHidden = areWorldMarkersHidden(pos, other);\nif(!isJoin && !markersHidden) {\npos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;\n}"])))),n.code.add((0,he.H)(c||(c=(0,J.Z)(["clipAndTransform(pos, prev, next, isStartVertex);\nvec2 left = (pos.xy - prev.xy);\nvec2 right = (next.xy - pos.xy);\nfloat leftLen = length(left);\nfloat rightLen = length(right);"])))),(e.stippleEnabled||Se)&&n.code.add((0,he.H)(d||(d=(0,J.Z)(["\n      float isEndVertex = float(!isStartVertex);\n      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);\n      vec2 segment = mix(right, left, isEndVertex);\n      ","\n    "])),Se?(0,he.H)(h||(h=(0,J.Z)(["vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);"]))):"")),n.code.add((0,he.H)(f||(f=(0,J.Z)(["left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\nright = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\nvec2 capDisplacementDir = vec2(0, 0);\nvec2 joinDisplacementDir = vec2(0, 0);\nfloat displacementLen = lineWidth;\nif (isJoin) {\nbool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;\njoinDisplacementDir = normalize(left + right);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\nif (leftLen > 0.001 && rightLen > 0.001) {\nfloat nDotSeg = dot(joinDisplacementDir, left);\ndisplacementLen /= length(nDotSeg * left - joinDisplacementDir);\nif (!isOutside) {\ndisplacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n}\n}\nif (isOutside && (displacementLen > miterLimit * lineWidth)) {"])))),e.roundJoins?n.code.add((0,he.H)(p||(p=(0,J.Z)(["\n        vec2 startDir = leftLen < 0.001 ? right : left;\n        startDir = PERPENDICULAR(startDir);\n\n        vec2 endDir = rightLen < 0.001 ? left : right;\n        endDir = PERPENDICULAR(endDir);\n\n        float factor = ",";\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);\n      "])),e.stippleEnabled?(0,he.H)(v||(v=(0,J.Z)(["min(1.0, subdivisionFactor * ",")"])),he.H.float((_e+2)/(_e+1))):(0,he.H)(g||(g=(0,J.Z)(["subdivisionFactor"]))))):n.code.add((0,he.H)(m||(m=(0,J.Z)(["if (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;\n}\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);"]))));var Pe=e.capType!==ye.R.BUTT;return n.code.add((0,he.H)(y||(y=(0,J.Z)(["\n        displacementLen = lineWidth;\n      }\n    } else {\n      // CAP handling ---------------------------------------------------\n      joinDisplacementDir = isStartVertex ? right : left;\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      ","\n    }\n  "])),Pe?(0,he.H)(_||(_=(0,J.Z)(["capDisplacementDir = isStartVertex ? -right : left;"]))):"")),n.code.add((0,he.H)(T||(T=(0,J.Z)(["\n    // Displacement (in pixels) caused by join/or cap\n    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n    ","\n\n    ","\n    ","\n\n    pos.xy += dpos;\n  "])),Re||Oe?(0,he.H)(w||(w=(0,J.Z)(["float lineDistNorm = sign(uv0.y) * pos.w;"]))):"",Oe?(0,he.H)(C||(C=(0,J.Z)(["vLineDistance = lineWidth * lineDistNorm;"]))):"",Re?(0,he.H)(S||(S=(0,J.Z)(["vLineDistanceNorm = lineDistNorm;"]))):"")),Se&&n.code.add((0,he.H)(x||(x=(0,J.Z)(["vec2 segmentDir = normalize(segment);\nvSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;\nvReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);"])))),e.stippleEnabled&&(e.draped?n.uniforms.add(new de.p("worldToScreenRatio",(function(e,t){return 1/t.screenToPCSRatio}))):n.code.add((0,he.H)(b||(b=(0,J.Z)(["vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),n.code.add((0,he.H)(O||(O=(0,J.Z)(["float segmentLengthScreenDouble = length(segment);\nfloat segmentLengthScreen = segmentLengthScreenDouble * 0.5;\nfloat discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);\nfloat segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));\nvStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;"])))),e.draped?n.code.add((0,he.H)(A||(A=(0,J.Z)(["float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;\nfloat startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);"])))):n.code.add((0,he.H)(R||(R=(0,J.Z)(["float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),n.uniforms.add(new de.p("stipplePatternPixelSize",(function(e){return(0,ne.C)(e)}))),n.code.add((0,he.H)(P||(P=(0,J.Z)(["\n      float patternLength = "," stipplePatternPixelSize;\n\n      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader\n      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);\n\n      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);\n\n      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)\n      if (segmentLengthScreenDouble >= 0.001) {\n        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the\n        // original vertex positions, and slightly outside of that range at the displaced positions\n        vec2 stippleDisplacement = pos.xy - segmentOrigin;\n        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);\n\n        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)\n        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);\n      }\n\n      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance\n      vStippleDistanceLimits *= pos.w;\n      vStippleDistance *= pos.w;\n\n      // Disable stipple distance limits on caps\n      vStippleDistanceLimits = isJoin ?\n                                 vStippleDistanceLimits :\n                                 isStartVertex ?\n                                  vec2(-1e038, vStippleDistanceLimits.y) :\n                                  vec2(vStippleDistanceLimits.x, 1e038);\n    "])),e.stippleScaleWithLineWidth?"lineSize * ":""))),n.code.add((0,he.H)(E||(E=(0,J.Z)(["\n      // Convert back into NDC\n      pos.xy = (pos.xy / viewport.zw) * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      ","\n\n      // transform final position to camera space for slicing\n      vpos = (inverseProjectionMatrix * pos).xyz;\n      gl_Position = pos;\n      forwardObjectAndLayerIdColor();\n    }\n  }\n  "])),e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":"")),we&&t.include(ie.l,e),t.include(Q.f5,e),Te.include(se.Y),Te.code.add((0,he.H)(D||(D=(0,J.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n  "])),we?"terrainDepthTest(gl_FragCoord, depth);":"")),e.wireframe?Te.code.add((0,he.H)(I||(I=(0,J.Z)(["vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);"])))):(Se&&Te.code.add((0,he.H)(M||(M=(0,J.Z)(["\n      float sdf = min(vSegmentSDF, vReverseSegmentSDF);\n      vec2 fragmentPosition = vec2(\n        min(sdf, 0.0),\n        vLineDistance\n      ) * gl_FragCoord.w;\n\n      float fragmentRadius = length(fragmentPosition);\n      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);\n\n      if (capCoverage < ",") {\n        discard;\n      }\n    "])),he.H.float(oe.b))),Ae?Te.code.add((0,he.H)(Z||(Z=(0,J.Z)(["\n      vec2 stipplePosition = vec2(\n        min(getStippleSDF() * 2.0 - 1.0, 0.0),\n        vLineDistanceNorm * gl_FragCoord.w\n      );\n      float stippleRadius = length(stipplePosition * vLineWidth);\n      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);\n      float stippleAlpha = step(",", stippleCoverage);\n      "])),he.H.float(oe.b))):Te.code.add((0,he.H)(L||(L=(0,J.Z)(["float stippleAlpha = getStippleAlpha();"])))),Te.uniforms.add(new ce.N("intrinsicColor",(function(e){return e.color}))),e.output!==$.H.ObjectAndLayerIdColor&&Te.code.add((0,he.H)(k||(k=(0,J.Z)(["discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);"])))),Te.code.add((0,he.H)(H||(H=(0,J.Z)(["vec4 color = intrinsicColor * vColor;"])))),e.innerColorEnabled&&(Te.uniforms.add(new ce.N("innerColor",(function(e){return(0,X.Pt)(e.innerColor,e.color)}))),Te.uniforms.add(new de.p("innerWidth",(function(e,t){return e.innerWidth*t.camera.pixelRatio}))),Te.code.add((0,he.H)(N||(N=(0,J.Z)(["float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\nfloat innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\nfloat innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\ncolor = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);"]))))),Te.code.add((0,he.H)(F||(F=(0,J.Z)(["vec4 finalColor = blendStipple(color, stippleAlpha);"])))),e.falloffEnabled&&(Te.uniforms.add(new de.p("falloff",(function(e){return e.falloff}))),Te.code.add((0,he.H)(z||(z=(0,J.Z)(["finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);"])))))),Te.code.add((0,he.H)(U||(U=(0,J.Z)(["\n    ","\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),e.output===$.H.ObjectAndLayerIdColor?(0,he.H)(j||(j=(0,J.Z)(["finalColor.a = 1.0;"]))):"",he.H.float(oe.b),e.output===$.H.Alpha?(0,he.H)(V||(V=(0,J.Z)(["gl_FragColor = vec4(finalColor.a);"]))):"",e.output===$.H.Color?(0,he.H)(W||(W=(0,J.Z)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===$.H.Color&&e.transparencyPassType===ve.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":"",e.output===$.H.Highlight?(0,he.H)(G||(G=(0,J.Z)(["gl_FragColor = vec4(1.0);"]))):"",e.output===$.H.Depth?(0,he.H)(B||(B=(0,J.Z)(["outputDepth(linearDepth);"]))):"",e.output===$.H.ObjectAndLayerIdColor?(0,he.H)(q||(q=(0,J.Z)(["outputObjectAndLayerIdColor();"]))):"")),t}var we=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:_e,build:Te},Symbol.toStringTag,{value:"Module"}))},49810:function(e,t,n){n.d(t,{W:function(){return H},b:function(){return k}});var r,i,a,o,s,u,l,c,d,h,f=n(30168),p=n(22357),v=n(37081),g=n(33280),m=n(94951),y=n(137),_=n(60750),T=n(92395),w=n(15226),C=n(8555),S=n(41481),x=n(58335),b=n(77652),O=n(79246),A=n(26461),R=n(116),P=n(82552),E=n(95276),D=n(58406),I=n(98634),M=n(64201),Z=n(25920),L=n(4760);function k(e){var t=new M.kG,n=t.vertex,k=t.fragment;(0,P.Sv)(n,e),t.include(m.w,e),t.attributes.add(L.T.POSITION,"vec3"),t.attributes.add(L.T.UV0,"vec2");var H=new E.N("waterColor",(function(e){return e.color}));if(e.output===v.H.Color&&e.isDraped)return t.varyings.add("vpos","vec3"),n.uniforms.add(H),n.code.add((0,I.H)(r||(r=(0,f.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),I.H.float(A.b))),k.uniforms.add(H),k.code.add((0,I.H)(i||(i=(0,f.Z)(["void main() {\ngl_FragColor = waterColor;\n}"])))),t;switch(e.output!==v.H.Color&&e.output!==v.H.Alpha||(t.include(C.n,e),t.include(p.qj,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),n.uniforms.add(H),n.code.add((0,I.H)(a||(a=(0,f.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ","\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n      }\n    "])),I.H.float(A.b),e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":"",e.output===v.H.Color?"forwardLinearDepth();":""))),t.include(w.l,e),e.output){case v.H.Alpha:t.include(g.f5,e),k.uniforms.add(H),k.code.add((0,I.H)(o||(o=(0,f.Z)(["\n        void main() {\n          discardBySlice(vpos);\n          ","\n\n          gl_FragColor = vec4(waterColor.a);\n        }\n      "])),e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""));break;case v.H.Color:t.include(T.kR,e),t.include(_._,{pbrMode:S.f7.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(O.M),t.include(g.f5,e),t.include(x.XE,e),t.include(b.B,e),k.uniforms.add([H,new D.p("timeElapsed",(function(e){return e.timeElapsed})),n.uniforms.get("view"),n.uniforms.get("localOrigin")]),(0,P.hY)(k,e),k.include(R.Y),(0,T.Pe)(k),(0,T.F1)(k),k.code.add((0,I.H)(s||(s=(0,f.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - cameraPosition);\n        float shadow = ",";\n        vec4 vPosView = view * vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n        ","\n      }\n    "])),e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":"",e.receiveShadows?(0,I.H)(u||(u=(0,f.Z)(["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0",e.transparencyPassType===Z.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""));break;case v.H.Normal:t.include(C.n,e),t.include(O.M,e),t.include(g.f5,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),n.uniforms.add(H),n.code.add((0,I.H)(l||(l=(0,f.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),I.H.float(A.b))),k.uniforms.add(new D.p("timeElapsed",(function(e){return e.timeElapsed}))),k.code.add((0,I.H)(c||(c=(0,f.Z)(["void main() {\ndiscardBySlice(vpos);\nvec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\ntangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\ngl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n}"]))));break;case v.H.Highlight:t.include(y.bA,e),t.varyings.add("vpos","vec3"),n.uniforms.add(H),n.code.add((0,I.H)(d||(d=(0,f.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),I.H.float(A.b))),t.include(g.f5,e),k.code.add((0,I.H)(h||(h=(0,f.Z)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))))}return t}var H=Object.freeze(Object.defineProperty({__proto__:null,build:k},Symbol.toStringTag,{value:"Module"}))},82218:function(e,t,n){n.d(t,{a:function(){return w},c:function(){return C},g:function(){return O},h:function(){return M},u:function(){return x}});var r=n(37762),i=n(43144),a=n(15671),o=(n(93169),n(32718)),s=n(16889),u=n(21530),l=n(14226),c=n(81949),d=n(11186),h=n(71353),f=n(14320),p=n(85981),v=n(55652),g=n(40885),m=n(40927),y=n(11185),_=o.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane"),T=(0,i.Z)((function e(){(0,a.Z)(this,e),this.plane=(0,v.Ue)(),this.origin=(0,h.c)(),this.basis1=(0,h.c)(),this.basis2=(0,h.c)()}));function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z;return{plane:(0,v.Ue)(e.plane),origin:(0,h.a)(e.origin),basis1:(0,h.a)(e.basis1),basis2:(0,h.a)(e.basis2)}}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w();return S(e.origin,e.basis1,e.basis2,t)}function S(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w();return(0,d.c)(r.origin,e),(0,d.c)(r.basis1,t),(0,d.c)(r.basis2,n),x(r),function(e,t){Math.abs((0,d.e)(e.basis1,e.basis2)/((0,d.l)(e.basis1)*(0,d.l)(e.basis2)))>1e-6&&_.warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,d.e)(e.basis1,L(e)))>1e-6&&_.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,d.e)(L(e),e.origin)-e.plane[3])>1e-6&&_.warn(t,"Plane offset is not consistent with plane origin")}(r,"fromValues()"),r}function x(e){(0,v.my)(e.basis2,e.basis1,e.origin,e.plane)}function b(e,t,n){e!==n&&C(e,n);var r=(0,d.g)(y.WM.get(),L(e),t);return(0,d.a)(n.origin,n.origin,r),n.plane[3]-=t,n}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w(),n=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return(0,d.s)(t.origin,e[0]+n,e[1]+r,0),(0,d.s)(t.basis1,n,0,0),(0,d.s)(t.basis2,0,r,0),(0,v.al)(0,0,1,0,t.plane),t}function A(e,t,n){return!!(0,v.BR)(e.plane,t,n)&&k(e,n)}function R(e,t,n){var i=U.get();F(e,t,i,U.get());var a,o=Number.POSITIVE_INFINITY,u=(0,r.Z)(G);try{for(u.s();!(a=u.n()).done;){var l=N(e,a.value,j.get()),c=y.WM.get();if((0,v.rx)(i,l,c)){var h=(0,d.r)(y.WM.get(),t.origin,c),f=Math.abs((0,s.ZF)((0,d.e)(t.direction,h)));f<o&&(o=f,(0,d.c)(n,c))}}}catch(p){u.e(p)}finally{u.f()}return o===Number.POSITIVE_INFINITY?P(e,t,n):n}function P(e,t,n){if(A(e,t,n))return n;var i=U.get(),a=U.get();F(e,t,i,a);var o,s=Number.POSITIVE_INFINITY,u=(0,r.Z)(G);try{for(u.s();!(o=u.n()).done;){var l=N(e,o.value,j.get()),c=y.WM.get();if((0,v.dZ)(i,l,c)){var h=(0,g.Jk)(t,c);if(!(0,v.Ac)(a,c))continue;h<s&&(s=h,(0,d.c)(n,c))}}}catch(f){u.e(f)}finally{u.f()}return I(e,t.origin)<s&&E(e,t.origin,n),n}function E(e,t,n){var r=(0,v.nF)(e.plane,t,y.WM.get()),i=(0,p.ct)(H(e,e.basis1),r,-1,1,y.WM.get()),a=(0,p.ct)(H(e,e.basis2),r,-1,1,y.WM.get());return(0,d.b)(n,(0,d.a)(y.WM.get(),i,a),e.origin),n}function D(e,t,n){var r=e.origin,i=e.basis1,a=e.basis2,o=(0,d.b)(y.WM.get(),t,r),s=(0,m.SR)(i,o),u=(0,m.SR)(a,o),l=(0,m.SR)(L(e),o);return(0,d.s)(n,s,u,l)}function I(e,t){var n=D(e,t,y.WM.get()),r=e.basis1,i=e.basis2,a=(0,d.l)(r),o=(0,d.l)(i),s=Math.max(Math.abs(n[0])-a,0),u=Math.max(Math.abs(n[1])-o,0),l=n[2];return s*s+u*u+l*l}function M(e,t){return Math.sqrt(I(e,t))}function Z(e,t){var n=-e.plane[3];return(0,m.SR)(L(e),t)-n}function L(e){return(0,v.mJ)(e.plane)}function k(e,t){var n=(0,d.b)(y.WM.get(),t,e.origin),r=(0,d.p)(e.basis1),i=(0,d.p)(e.basis2),a=(0,d.e)(e.basis1,n),o=(0,d.e)(e.basis2,n);return-a-r<0&&a-r<0&&-o-i<0&&o-i<0}function H(e,t){var n=j.get();return(0,d.c)(n.origin,e.origin),(0,d.c)(n.vector,t),n}function N(e,t,n){var r=e.basis1,i=e.basis2,a=e.origin,o=(0,d.g)(y.WM.get(),r,t.origin[0]),s=(0,d.g)(y.WM.get(),i,t.origin[1]);(0,d.a)(n.origin,o,s),(0,d.a)(n.origin,n.origin,a);var u=(0,d.g)(y.WM.get(),r,t.direction[0]),l=(0,d.g)(y.WM.get(),i,t.direction[1]);return(0,d.g)(n.vector,(0,d.a)(u,u,l),2),n}function F(e,t,n,r){var i=L(e);(0,v.my)(i,t.direction,t.origin,n),(0,v.my)((0,v.mJ)(n),i,t.origin,r)}var z={plane:(0,v.Ue)(),origin:(0,h.f)(0,0,0),basis1:(0,h.f)(1,0,0),basis2:(0,h.f)(0,1,0)},U=new u.x(v.Ue),j=new u.x(p.Ue),V=(0,h.c)(),W=new u.x((function(){return w()})),G=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],B=(0,c.c)(),q=(0,c.c)();Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:T,UP:z,altitudeAt:Z,axisAt:function(e,t,n,r){return function(e,t,n){switch(t){case f.R.X:(0,d.c)(n,e.basis1),(0,d.n)(n,n);break;case f.R.Y:(0,d.c)(n,e.basis2),(0,d.n)(n,n);break;case f.R.Z:(0,d.c)(n,L(e))}return n}(e,n,r)},closestPoint:P,closestPointOnSilhouette:R,copy:C,copyWithoutVerify:function(e,t){(0,d.c)(t.origin,e.origin),(0,d.c)(t.basis1,e.basis1),(0,d.c)(t.basis2,e.basis2),(0,v.JG)(t.plane,e.plane)},create:w,distance:M,distance2:I,distanceToSilhouette:function(e,t){var n,i=Number.NEGATIVE_INFINITY,a=(0,r.Z)(G);try{for(a.s();!(n=a.n()).done;){var o=N(e,n.value,j.get()),s=(0,p.Jk)(o,t);s>i&&(i=s)}}catch(u){a.e(u)}finally{a.f()}return Math.sqrt(i)},elevate:b,equals:function(e,t){return(0,d.k)(e.basis1,t.basis1)&&(0,d.k)(e.basis2,t.basis2)&&(0,d.k)(e.origin,t.origin)},extrusionContainsPoint:function(e,t){return(0,v.Ac)(e.plane,t)&&k(e,t)},fromAABoundingRect:O,fromValues:S,intersectRay:A,intersectRayClosestSilhouette:function(e,t,n){if(A(e,t,n))return n;var r=R(e,t,y.WM.get());return(0,d.a)(n,t.origin,(0,d.g)(y.WM.get(),t.direction,(0,d.i)(t.origin,r)/(0,d.l)(t.direction))),n},normal:L,projectPoint:E,projectPointLocal:D,rotate:function(e,t,n,r){return e!==r&&C(e,r),(0,l.d)(q,t,n),(0,d.m)(r.basis1,e.basis1,q),(0,d.m)(r.basis2,e.basis2,q),x(r),r},setAltitudeAt:function(e,t,n,r){var i=Z(e,t),a=(0,d.g)(V,L(e),n-i);return(0,d.a)(r,t,a),r},setExtent:function(e,t,n){return O(t,n),b(n,Z(e,e.origin),n),n},transform:function(e,t,n){return e!==n&&C(e,n),(0,l.a)(B,t),(0,l.t)(B,B),(0,d.m)(n.basis1,e.basis1,B),(0,d.m)(n.basis2,e.basis2,B),(0,d.m)((0,v.mJ)(n.plane),(0,v.mJ)(e.plane),B),(0,d.m)(n.origin,e.origin,t),(0,v.T5)(n.plane,n.plane,n.origin),n},updateUnboundedPlane:x,wrap:function(e,t,n){var r=W.get();return r.origin=e,r.basis1=t,r.basis2=n,r.plane=(0,v.re)(0,0,0,0),x(r),r}},Symbol.toStringTag,{value:"Module"}))},46228:function(e,t,n){n.d(t,{I:function(){return i},v:function(){return a}});var r=n(16889);function i(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=(0,r.uZ)(e,0,u),a=0;a<4;a++)t[n+a]=Math.floor(256*l(i*o[a]))}function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0,r=0;r<4;r++)n+=e[t+r]*s[r];return n}var o=[1,256,65536,16777216],s=[1/256,1/65536,1/16777216,1/4294967296],u=a(new Uint8ClampedArray([255,255,255,255]));function l(e){return e-Math.floor(e)}},35888:function(e,t,n){n.d(t,{d:function(){return a}});var r=n(16889),i=n(72838);function a(e,t,n){var a,c=Array.isArray(e),d=c?e.length/t:e.byteLength/(4*t),h=c?e:new Uint32Array(e,0,d*t),f=null!==(a=null===n||void 0===n?void 0:n.minReduction)&&void 0!==a?a:0,p=(null===n||void 0===n?void 0:n.originalIndices)||null,v=p?p.length:0,g=(null===n||void 0===n?void 0:n.componentOffsets)||null,m=0;if(g)for(var y=0;y<g.length-1;y++){var _=g[y+1]-g[y];_>m&&(m=_)}else m=d;var T=Math.floor(1.1*m)+1;(null==l||l.length<2*T)&&(l=new Uint32Array((0,r.Sf)(2*T)));for(var w=0;w<2*T;w++)l[w]=0;for(var C=0,S=!!g&&!!p,x=S?v:d,b=(0,i.$z)(d/3),O=new Uint32Array(v),A=1.96,R=0!==f?Math.ceil(4*A*A/(f*f)*f*(1-f)):x,P=1,E=g?g[1]:x,D=0;D<x;D++){if(D===R){var I=1-C/D;if(I+A*Math.sqrt(I*(1-I)/D)<f)return null;R*=2}if(D===E){for(var M=0;M<2*T;M++)l[M]=0;if(p)for(var Z=g[P-1];Z<g[P];Z++)O[Z]=b[p[Z]];E=g[++P]}for(var L=S?p[D]:D,k=L*t,H=u(h,k,t),N=H%T,F=C;0!==l[2*N+1];){if(l[2*N]===H){var z=l[2*N+1]-1;if(o(h,k,z*t,t)){F=b[z];break}}++N>=T&&(N-=T)}F===C&&(l[2*N]=H,l[2*N+1]=L+1,C++),b[L]=F}if(0!==f&&1-C/d<f)return null;if(S){for(var U=g[P-1];U<O.length;U++)O[U]=b[p[U]];b=(0,i.mi)(O)}var j=c?new Array(C):new Uint32Array(C*t);C=0;for(var V=0;V<x;V++)b[V]===C&&(s(h,(S?p[V]:V)*t,j,C*t,t),C++);if(p&&!S){for(var W=new Uint32Array(v),G=0;G<W.length;G++)W[G]=b[p[G]];b=(0,i.mi)(W)}return{buffer:Array.isArray(j)?j:j.buffer,indices:b,uniqueCount:C}}function o(e,t,n,r){for(var i=0;i<r;i++)if(e[t+i]!==e[n+i])return!1;return!0}function s(e,t,n,r,i){for(var a=0;a<i;a++)n[r+a]=e[t+a]}function u(e,t,n){for(var r=0,i=0;i<n;i++)r=(r=e[t+i]+r|0)+(r<<11)+(r>>>2)|0;return r>>>0}var l=null},91320:function(e,t,n){n.d(t,{Mk:function(){return c},ZI:function(){return r},bT:function(){return l}});var r,i=n(37762),a=n(79347),o=n(69662),s=n(35888),u=n(88699);function l(e){var t,n=c(e.rings,e.hasZ,r.CCW_IS_HOLE),o=new Array,l=0,d=0,h=(0,i.Z)(n.polygons);try{var f=function(){var e=t.value,r=e.count,i=e.index,s=(0,u.Rq)(n.position,3*i,3*r),c=e.holeIndices.map((function(e){return e-i})),h=new Uint32Array((0,a.e)(s,c,3));o.push({position:s,faces:h}),l+=s.length,d+=h.length};for(h.s();!(t=h.n()).done;)f()}catch(g){h.e(g)}finally{h.f()}var p=function(e,t,n){if(1===e.length)return e[0];var r,a=(0,u.bg)(t),o=new Uint32Array(n),s=0,l=0,c=0,d=(0,i.Z)(e);try{for(d.s();!(r=d.n()).done;){for(var h=r.value,f=0;f<h.position.length;f++)a[s++]=h.position[f];for(var p=0;p<h.faces.length;p++)o[l++]=h.faces[p]+c;c=s/3}}catch(g){d.e(g)}finally{d.f()}return{position:a,faces:o}}(o,l,d),v=Array.isArray(p.position)?(0,s.d)(p.position,3,{originalIndices:p.faces}):(0,s.d)(p.position.buffer,6,{originalIndices:p.faces});return p.position=new Float64Array(v.buffer),p.faces=v.indices,p}function c(e,t,n){for(var i=e.length,a=new Array(i),o=new Array(i),s=new Array(i),l=0,c=0,f=0,p=0,v=0;v<i;++v)p+=e[v].length;for(var g=(0,u.bg)(3*p),m=0,y=i-1;y>=0;y--){var _=e[y],T=n===r.CCW_IS_HOLE&&h(_);if(T&&1!==i)a[l++]=_;else{for(var w=_.length,C=0;C<l;++C)w+=a[C].length;var S={index:m,pathLengths:new Array(l+1),count:w,holeIndices:new Array(l)};S.pathLengths[0]=_.length,_.length>0&&(s[f++]={index:m,count:_.length}),m=T?d(_,_.length-1,-1,g,m,_.length,t):d(_,0,1,g,m,_.length,t);for(var x=0;x<l;++x){var b=a[x];S.holeIndices[x]=m,S.pathLengths[x+1]=b.length,b.length>0&&(s[f++]={index:m,count:b.length}),m=d(b,0,1,g,m,b.length,t)}l=0,S.count>0&&(o[c++]=S)}}for(var O=0;O<l;++O){var A=a[O];A.length>0&&(s[f++]={index:m,count:A.length}),m=d(A,0,1,g,m,A.length,t)}return o.length=c,s.length=f,{position:g,polygons:o,outlines:s}}function d(e,t,n,r,i,a,o){i*=3;for(var s=0;s<a;++s){var u=e[t];r[i++]=u[0],r[i++]=u[1],r[i++]=o?u[2]:0,t+=n}return i/3}function h(e){return!(0,o.bu)(e,!1,!1)}!function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(r||(r={}))},81020:function(e,t,n){function r(e){return"point"===e.type}n.d(t,{f:function(){return r}})},37818:function(e,t,n){n.d(t,{D:function(){return _},Ou:function(){return d},WG:function(){return y},kB:function(){return p},mW:function(){return f}});var r=n(37762),i=(n(59486),n(52639)),a=(n(93169),n(84652)),o=n(92026),s=n(18722),u=n(77981),l=n(65618),c=n(78952);function d(e){return"declaredClass"in e}function h(e){return"declaredClass"in e}function f(e,t){return e?function(e){return"declaredClass"in e}(e)?e:new i.Z({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,a.d9)(e.symbol),attributes:(0,a.d9)(e.attributes),geometry:p(e.geometry)}):null}function p(e){return(0,o.Wi)(e)?null:d(e)?e:(0,u.im)(function(e){var t=e.spatialReference,n=t.wkid,r=t.wkt,i=t.latestWkid,a={wkid:n,wkt:r,latestWkid:i};switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:a};case"polygon":var o=e.rings,s=e.hasZ,u=e.hasM;return{rings:v(o),hasZ:s,hasM:u,spatialReference:a};case"polyline":var l=e.paths,c=e.hasZ,d=e.hasM;return{paths:v(l),hasZ:c,hasM:d,spatialReference:a};case"extent":return{xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax,hasZ:e.hasZ,hasM:e.hasM,spatialReference:a};case"multipoint":var h=e.points,f=e.hasZ,p=e.hasM;return{points:m(h)?g(h):h,hasZ:f,hasM:p,spatialReference:a};default:return}}(e))}function v(e){return function(e){var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(0!==i.length)return m(i)}}catch(a){n.e(a)}finally{n.f()}return!1}(e)?e.map((function(e){return g(e)})):e}function g(e){return e.map((function(e){return Array.from(e)}))}function m(e){return e.length>0&&((0,s.xZ)(e[0])||(0,s.fS)(e[0]))}function y(e,t){if(!e)return null;var n;if(h(e)){if(null==t)return e.clone();if(h(t))return t.copy(e)}return null!=t?((n=t).x=e.x,n.y=e.y,n.spatialReference=e.spatialReference,e.hasZ?(n.z=e.z,n.hasZ=e.hasZ):(n.z=void 0,n.hasZ=!1),e.hasM?(n.m=e.m,n.hasM=!0):(n.m=void 0,n.hasM=!1)):(n=(0,l.Tx)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(n.m=e.m,n.hasM=!0)),n}function _(e){var t={wkid:e.wkid,wkt:e.wkt,latestWkid:e.latestWkid};return c.Z.fromJSON(t)}},91226:function(e,t,n){n.d(t,{co:function(){return i},ii:function(){return d}});var r,i,a,o=n(15671),s=n(43144),u=n(81949),l=n(71353),c=n(46208),d=function(){function e(){(0,o.Z)(this,e),this.readChannels=c.uz.RG,this.renderingStage=c.jL.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,l.c)(),this.isCameraPositionFinal=!0,this.parallax=new h,this.parallaxNew=new h,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:i.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:r.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:a.FINISHED,factor:-1}}return(0,s.Z)(e,[{key:"isFading",get:function(){return this.fadeInOut.stage===i.FADE_OUT||this.fadeInOut.stage===i.FADE_IN||this.fadeIn.stage===r.FADE_IN||this.fadeInOutHeight.stage!==a.FINISHED||this.renderingStage===c.jL.FADING_TEXTURE_CHANNELS}}]),e}();!function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"}(r||(r={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(i||(i={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(a||(a={}));var h=(0,s.Z)((function e(){(0,o.Z)(this,e),this.anchorPointClouds=(0,l.c)(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=(0,u.c)()}))},46208:function(e,t,n){var r,i;n.d(t,{jL:function(){return r},uz:function(){return i}}),function(e){e[e.RENDERING=0]="RENDERING",e[e.FINISHED_RENDERING=1]="FINISHED_RENDERING",e[e.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",e[e.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",e[e.FINISHED=4]="FINISHED"}(r||(r={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(i||(i={}))},78935:function(e,t,n){n.d(t,{o:function(){return u}});var r=n(15671),i=n(43144),a=n(92026),o=n(88152),s=n(8821),u=function(){function e(){(0,r.Z)(this,e),this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}return(0,i.Z)(e,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(e){this._unit=e,this._metersPerElevationInfoUnit=(0,o.Z7)(e)}},{key:"requiresSampledElevationInfo",get:function(){return"absolute-height"!==this.mode}},{key:"reset",value:function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}},{key:"offsetMeters",set:function(e){this._meterUnitOffset=e,this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}},{key:"addOffsetRenderUnits",value:function(e){this._renderUnitOffset+=e}},{key:"geometryZWithOffset",value:function(e,t){var n=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?n:e+n}},{key:"calculateOffsetRenderUnits",value:function(e){var t=this._meterUnitOffset,n=this.featureExpressionInfoContext;return null!=n&&(t+=(0,s.ht)(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}},{key:"setFromElevationInfo",value:function(e){this.mode=e.mode,this.unit=(0,o.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=(0,a.Pt)(e.offset,0)}},{key:"updateFeatureExpressionInfoContext",value:function(e,t,n){if((0,a.Wi)(e))this._featureExpressionInfoContext=null;else{var r=e&&e.arcade;r&&(0,a.pC)(t)&&(0,a.pC)(n)?(this._featureExpressionInfoContext=(0,s.d9)(e),(0,s.aO)(this._featureExpressionInfoContext,(0,s.Tz)(r.modules,t,n))):this._featureExpressionInfoContext=e}}}],[{key:"fromElevationInfo",value:function(t){var n=new e;return(0,a.pC)(t)&&n.setFromElevationInfo(t),n}}]),e}()},69691:function(e,t,n){n.d(t,{B5:function(){return y},GC:function(){return g},Lm:function(){return w},Xf:function(){return m},bD:function(){return _},lO:function(){return T},qZ:function(){return p},rR:function(){return f},w7:function(){return v}});var r=n(43144),i=n(15671),a=n(92026),o=n(14226),s=n(81949),u=n(71353),l=n(79803),c=n(81020),d=n(96387),h=n(77648);function f(e,t,n,r,i,a,o,s,u,c,d){var h,f,p=C[d.mode],v=0;if((0,l.CM)(e,t,n,r,u.spatialReference,i,s))return p.requiresAlignment(d)?(v=p.applyElevationAlignmentBuffer(r,i,a,o,s,u,c,d),h=a,f=o):(h=r,f=i),(0,l.CM)(h,u.spatialReference,f,a,c.spatialReference,o,s)?v:void 0}function p(e,t,n,r,i){var o=((0,c.f)(e)?e.z:(0,h.Fb)(e)?e.array[e.offset+2]:e[2])||0;switch(n.mode){case"on-the-ground":var s=(0,a.Pt)((0,h.KO)(t,e,"ground"),0);return i.verticalDistanceToGround=0,i.sampledElevation=s,void(i.z=s);case"relative-to-ground":var u=(0,a.Pt)((0,h.KO)(t,e,"ground"),0),l=n.geometryZWithOffset(o,r);return i.verticalDistanceToGround=l,i.sampledElevation=u,void(i.z=l+u);case"relative-to-scene":var d=(0,a.Pt)((0,h.KO)(t,e,"scene"),0),f=n.geometryZWithOffset(o,r);return i.verticalDistanceToGround=f,i.sampledElevation=d,void(i.z=f+d);case"absolute-height":var p=n.geometryZWithOffset(o,r),v=(0,a.Pt)((0,h.KO)(t,e,"ground"),0);return i.verticalDistanceToGround=p-v,i.sampledElevation=v,void(i.z=p);default:return void(i.z=0)}}function v(e,t,n,r){return p(e,t,n,r,x),x.z}function g(e,t,n){return null==t||null==n?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?T.UPDATE:e.onTheGroundChanged}function m(e){return"relative-to-ground"===e||"relative-to-scene"===e}function y(e){return"absolute-height"!==e}function _(e,t,n,r,i){p(t,n,i,r,x),(0,d.CV)(e,x.verticalDistanceToGround);var a=x.sampledElevation,s=(0,o.c)(S,e.transformation);return b[0]=t.x,b[1]=t.y,b[2]=x.z,(0,l.Bm)(t.spatialReference,b,s,r.spatialReference)?e.transformation=s:console.warn("Could not locate symbol object properly, it might be misplaced"),a}var T,w=(0,r.Z)((function e(){(0,i.Z)(this,e),this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}));!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(T||(T={}));var C={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,o,s){var u=s.calculateOffsetRenderUnits(o),l=s.featureExpressionInfoContext;t*=3,r*=3;for(var c=0;c<i;++c){var d=e[t+0],h=e[t+1],f=e[t+2];n[r+0]=d,n[r+1]=h,n[r+2]=null==l?f+u:u,t+=3,r+=3}return 0},requiresAlignment:function(e){var t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o){var s=0,u=o.spatialReference;t*=3,r*=3;for(var l=0;l<i;++l){var c=e[t+0],d=e[t+1],h=e[t+2],f=(0,a.Pt)(o.getElevation(c,d,h,u,"ground"),0);s+=f,n[r+0]=c,n[r+1]=d,n[r+2]=f,t+=3,r+=3}return s/i},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,s,u){var l=0,c=u.calculateOffsetRenderUnits(s),d=u.featureExpressionInfoContext,h=o.spatialReference;t*=3,r*=3;for(var f=0;f<i;++f){var p=e[t+0],v=e[t+1],g=e[t+2],m=(0,a.Pt)(o.getElevation(p,v,g,h,"ground"),0);l+=m,n[r+0]=p,n[r+1]=v,n[r+2]=null==d?g+m+c:m+c,t+=3,r+=3}return l/i},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,r,i,o,s,u){var l=0,c=u.calculateOffsetRenderUnits(s),d=u.featureExpressionInfoContext,h=o.spatialReference;t*=3,r*=3;for(var f=0;f<i;++f){var p=e[t+0],v=e[t+1],g=e[t+2],m=(0,a.Pt)(o.getElevation(p,v,g,h,"scene"),0);l+=m,n[r+0]=p,n[r+1]=v,n[r+2]=null==d?g+m+c:m+c,t+=3,r+=3}return l/i},requiresAlignment:function(){return!0}}},S=(0,s.c)(),x=new w,b=(0,u.c)()},8821:function(e,t,n){n.d(t,{O$:function(){return m},Tz:function(){return f},WI:function(){return g},aO:function(){return p},d9:function(){return c},ht:function(){return v},kr:function(){return d}});var r=n(74165),i=n(15861),a=n(32718),o=n(66978),s=n(37818),u=n(819),l=a.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function c(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function d(e,t,n,r){return h.apply(this,arguments)}function h(){return h=(0,i.Z)((0,r.Z)().mark((function e(t,n,i,a){var s,l,c,d,h;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof(s=t&&t.expression)){e.next=3;break}return e.abrupt("return",null);case 3:if(null==(l=_(s))){e.next=6;break}return e.abrupt("return",{cachedResult:l});case 6:return e.next=8,(0,u.LC)();case 8:return c=e.sent,(0,o.k_)(i),d=c.arcadeUtils,h=d.createSyntaxTree(s),e.abrupt("return",d.dependsOnView(h)?(null!=a&&a.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:d.createFunction(h),context:d.createExecContext(null,{sr:n}),modules:c}});case 12:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function f(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)}function p(e,t){if(null!=e&&!y(e)){if(!t||!e.arcade)return void l.errorOncePerTick("Arcade support required but not provided");var n=t;n._geometry&&(n._geometry=(0,s.kB)(n._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function v(e){if(null!=e){if(y(e))return e.cachedResult;var t=e.arcade,n=null===t||void 0===t?void 0:t.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0}function g(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e&&e.featureExpressionInfo,i=r&&r.expression;return n||"0"===i||(r=null),null!==(t=r)&&void 0!==t?t:null}var m={cachedResult:0};function y(e){return null!=e.cachedResult}function _(e){return"0"===e?0:null}},96387:function(e,t,n){n.d(t,{CV:function(){return S},Go:function(){return C},Si:function(){return P},Uu:function(){return x},ZL:function(){return A},_Z:function(){return R},bD:function(){return b},bh:function(){return O},zE:function(){return _}});var r=n(37762),i=n(92026),a=n(68860),o=n(14226),s=n(81949),u=n(71353),l=n(90045),c=n(67077),d=n(79803),h=n(41414),f=n(65156),p=n(4954),v=n(69662),g=n(65618),m=n(37818),y=n(4760);function _(e,t){if("point"===e.type)return w(e,t,!1);if((0,m.Ou)(e))switch(e.type){case"extent":return w(e.center,t,!1);case"polygon":return w(e.centroid,t,!1);case"polyline":return w(T(e),t,!0);case"mesh":return w(e.origin,t,!1)}else switch(e.type){case"extent":return w(function(e){return(0,g.Tx)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return w(function(e){var t=e.rings[0];if(!t||0===t.length)return null;var n=(0,p.a)(e.rings,!!e.hasZ);return(0,g.Tx)(n[0],n[1],n[2],e.spatialReference)}(e),t,!0);case"polyline":return w(T(e),t,!0)}}function T(e){var t=e.paths[0];if(!t||0===t.length)return null;var n=(0,v.n8)(t,(0,v.ok)(t)/2);return(0,g.Tx)(n[0],n[1],n[2],e.spatialReference)}function w(e,t,n){var r=n?e:(0,m.WG)(e);return t&&e?(0,d.nF)(e,r,t)?r:null:r}function C(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e){t||(t=(0,f.Ue)());var i=e,a=.5*i.width*(n-1),o=.5*i.height*(n-1);return i.width<1e-7*i.height?a+=o/20:i.height<1e-7*i.width&&(o+=a/20),(0,l.s)(t,i.xmin-a-r,i.ymin-o-r,i.xmax+a+r,i.ymax+o+r),t}return null}function S(e,t){for(var n=0;n<e.geometries.length;++n){var r=e.geometries[n].getMutableAttribute(y.T.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometries[n]))}}function x(e,t){var n=(0,c.d)(c.O);return(0,i.pC)(e)&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),(0,i.pC)(t)?n[3]=t:(0,i.pC)(e)&&e.length>3&&(n[3]=e[3]),n}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.O,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new Array(3);if((0,i.Wi)(t)||(0,i.Wi)(n))a[0]=1,a[1]=1,a[2]=1;else{for(var o,s=0,l=2;l>=0;l--){var c=e[l],d=void 0,h=null!=c,f=0===l&&!o&&!h,p=n[l];"symbol-value"===c||f?d=0!==p?t[l]/p:1:h&&"proportional"!==c&&isFinite(c)&&(d=0!==p?c/p:1),null!=d&&(a[l]=d,o=d,s=Math.max(s,Math.abs(d)))}for(var v=2;v>=0;v--)null==a[v]?a[v]=o:0===a[v]&&(a[v]=.001*s)}for(var g=2;g>=0;g--)a[g]/=r;return(0,u.d)(a)}function O(e){return A(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function A(e){if(Array.isArray(e)){var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){if(!A(t.value))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}return null==e||e>=0}function R(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,s.c)(),i=e||0,a=t||0,u=n||0;return 0!==i&&(0,o.o)(r,r,-i/180*Math.PI),0!==a&&(0,o.r)(r,r,a/180*Math.PI),0!==u&&(0,o.n)(r,r,u/180*Math.PI),r}function P(e,t,n){if(null!=n.minDemResolution)return n.minDemResolution;var r=(0,a.c9)(t),i=(0,h.bf)(e)*r,o=(0,h.Ye)(e)*r,s=(0,h.Cb)(e)*(t.isGeographic?1:r);return 0===i&&0===o&&0===s?n.minDemResolutionForPoints:.01*Math.max(i,o,s)}},26279:function(e,t,n){var r,i,a;n.d(t,{Lw:function(){return r},al:function(){return a},eZ:function(){return i}}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(r||(r={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(i||(i={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(a||(a={}))},77648:function(e,t,n){n.d(t,{Fb:function(){return u},KO:function(){return l},sb:function(){return s}});var r=n(43144),i=n(15671),a=n(92026),o=n(81020),s=(0,r.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,i.Z)(this,e),this.array=t,this.spatialReference=n,this.offset=r}));function u(e){return"array"in e}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,o.f)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,n);if(u(t)){var r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,(0,a.Pt)(t.spatialReference,e.spatialReference),n)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,n)}},50256:function(e,t,n){n.d(t,{K:function(){return a}});var r=n(8548),i=n(61109);function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.stride;return e.fieldNames.filter((function(t){var n=e.fields.get(t).optional;return!(n&&n.glPadding)})).map((function(r){var a=e.fields.get(r),s=a.constructor.ElementCount,u=o(a.constructor.ElementType),l=a.offset,c=!(!a.optional||!a.optional.glNormalized);return new i.G(r,s,u,l,n,c,t)}))}function o(e){var t=s[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}var s={u8:r.g.UNSIGNED_BYTE,u16:r.g.UNSIGNED_SHORT,u32:r.g.UNSIGNED_INT,i8:r.g.BYTE,i16:r.g.SHORT,i32:r.g.INT,f32:r.g.FLOAT}},79685:function(e,t,n){n.d(t,{Y:function(){return m},c:function(){return T}});var r=n(92026),i=n(88396),a=n(11186),o=n(71353),s=n(67077),u=n(83448),l=n(79803),c=n(50951),d=n(91526),h=n(79100),f=n(88699),p=n(73840),v=n(95774),g=n(4760);function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=[],m=[],T=t.mapPositions;!function(e,t,n){for(var r=e.attributeData.position,i=e.removeDuplicateStartEnd,a=function(e){var t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(r)&&i,o=r.length/3-(a?1:0),s=new Array(2*(o-1)),u=a?r.slice(0,r.length-3):r,l=0,c=0;c<o-1;c++)s[l++]=c,s[l++]=c+1;t.push([g.T.POSITION,new d.a(u,3,a)]),n.push([g.T.POSITION,s])}(t,m,o);var w=m[0][1].data,C=o[0][1].length,S=new Array(C).fill(0);return function(e,t,n,i){if((0,r.pC)(e.attributeData.colorFeature))return;var a=e.attributeData.color;t.push([g.T.COLOR,new d.a((0,r.Pt)(a,s.O),4)]),n.push([g.T.COLOR,i])}(t,m,o,S),function(e,t,n,i){if((0,r.pC)(e.attributeData.sizeFeature))return;var a=e.attributeData.size;t.push([g.T.SIZE,new d.a([(0,r.Pt)(a,1)],1,!0)]),n.push([g.T.SIZE,i])}(t,m,o,S),function(e,t,n,i){if(!(0,r.pC)(e.attributeData.normal))return;var a=e.attributeData.normal;t.push([g.T.NORMAL,new d.a(a,3)]),n.push([g.T.NORMAL,i])}(t,m,o,S),function(e,t,n,i){var a=e.attributeData.colorFeature;(0,r.Wi)(a)||(t.push([g.T.COLORFEATUREATTRIBUTE,new d.a([a],1,!0)]),n.push([g.T.COLOR,i]))}(t,m,o,S),function(e,t,n,i){var a=e.attributeData.sizeFeature;(0,r.Wi)(a)||(t.push([g.T.SIZEFEATUREATTRIBUTE,new d.a([a],1,!0)]),n.push([g.T.SIZEFEATUREATTRIBUTE,i]))}(t,m,o,S),function(e,t,n,i){var a=e.attributeData.opacityFeature;(0,r.Wi)(a)||(t.push([g.T.OPACITYFEATUREATTRIBUTE,new d.a([a],1,!0)]),n.push([g.T.OPACITYFEATUREATTRIBUTE,i]))}(t,m,o,S),function(e,t,n,o){if((0,r.Wi)(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==c.JY.Global||!e.overlayInfo.spatialReference.isGeographic)return;for(var s=(0,f.bg)(o.length),h=(0,u.Iu)(e.overlayInfo.spatialReference),v=0;v<s.length;v+=3)(0,l.gH)(o,v,s,v,h);var m=o.length/3,T=(0,p.xx)(m+1),w=y,C=_,S=0,x=0;(0,a.s)(w,s[x++],s[x++],s[x++]),T[0]=0;for(var b=1;b<m+1;++b){var O;b===m&&(x=0),(0,a.s)(C,s[x++],s[x++],s[x++]),S+=(0,i.p)(w,C),T[b]=S,w=(O=[C,w])[0],C=O[1]}t.push([g.T.DISTANCETOSTART,new d.a(T,1,!0)]),n.push([g.T.DISTANCETOSTART,n[0][1]])}(t,m,o,w),new v.Z(e,m,o,T,h.U.Line,n)}var y=(0,o.c)(),_=(0,o.c)();function T(e,t){if((0,r.Wi)(e)||0===e.length)return[];var n=[];return e.forEach((function(e){var r=e.length,i=(0,f.bg)(3*r);e.forEach((function(e,t){i[3*t+0]=e[0],i[3*t+1]=e[1],i[3*t+2]=e[2]}));var a={attributeData:{position:i,normal:t},removeDuplicateStartEnd:!1};n.push(a)})),n}},2522:function(e,t,n){n.d(t,{Ch:function(){return a},Hl:function(){return u},_Z:function(){return s},uM:function(){return l},vT:function(){return i}});var r=n(67794),i=64,a=i/2,o=a/5,s=i/o,u=.25;function l(e,t){return e.fromData("".concat(t,"-marker"),(function(){return(0,r.cU)(t,i,a,o)}))}},67794:function(e,t,n){n.d(t,{Ns:function(){return s},Ph:function(){return o},cU:function(){return u}});n(93169);var r=n(46228),i=n(76873),a=n(8548),o=128,s=.5;function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=l(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*s,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return new i.x(n,{mipmap:!1,wrap:{s:a.e8.CLAMP_TO_EDGE,t:a.e8.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(e){case"circle":default:return function(e,t){var n=e/2-.5;return p(e,h(n,n,t/2))}(t,n);case"square":return function(e,t){return c(e,t,!1)}(t,n);case"cross":return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return d(e,t,!1,n)}(t,n,r);case"x":return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return d(e,t,!0,n)}(t,n,r);case"kite":return function(e,t){return c(e,t,!0)}(t,n);case"triangle":return function(e,t){return p(e,f(e/2,t,t/2))}(t,n);case"arrow":return function(e,t){var n=t,r=t/2,i=e/2,a=.8*n,o=h(i,(e-t)/2-a,Math.sqrt(a*a+r*r)),s=f(i,n,r);return p(e,(function(e,t){return Math.max(s(e,t),-o(e,t))}))}(t,n)}}function c(e,t,n){return n&&(t/=Math.SQRT2),p(e,(function(r,i){var a=r-.5*e+.25,o=.5*e-i-.75;if(n){var s=(a+o)/Math.SQRT2;o=(o-a)/Math.SQRT2,a=s}return Math.max(Math.abs(a),Math.abs(o))-.5*t}))}function d(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t-=r,n&&(t*=Math.SQRT2);var i=.5*t;return p(e,(function(t,a){var o,s=t-.5*e,u=.5*e-a-1;if(n){var l=(s+u)/Math.SQRT2;u=(u-s)/Math.SQRT2,s=l}return o=(s=Math.abs(s))>(u=Math.abs(u))?s>i?Math.sqrt((s-i)*(s-i)+u*u):u:u>i?Math.sqrt(s*s+(u-i)*(u-i)):s,o-=r/2}))}function h(e,t,n){return function(r,i){var a=r-e,o=i-t;return Math.sqrt(a*a+o*o)-n}}function f(e,t,n){var r=Math.sqrt(t*t+n*n);return function(i,a){var o=Math.abs(i-e)-n,s=a-e+t/2+.75,u=(t*o+n*s)/r,l=-s;return Math.max(u,l)}}function p(e,t){for(var n=new Uint8Array(4*e*e),i=0;i<e;i++)for(var a=0;a<e;a++){var o=a+e*i,s=t(a,i);s=s/e+.5,(0,r.I)(s,n,4*o)}return n}},78081:function(e,t,n){n.d(t,{V:function(){return c},r:function(){return d}});var r=n(37762),i=n(92026),a=n(79803),o=n(91320),s=n(69691),u=n(1937),l=n(88699);function c(e,t,n,r){var i="polygon"===e.type?o.ZI.CCW_IS_HOLE:o.ZI.NONE,a="polygon"===e.type?e.rings:e.paths,u=(0,o.Mk)(a,!!e.hasZ,i),c=u.position,d=u.outlines,f=(0,l.bg)(c.length),p=(0,s.rR)(c,e.spatialReference,0,f,0,c,0,c.length/3,t,n,r),v=null!=p;return{lines:v?h(d,c,f):[],projectionSuccess:v,sampledElevation:p}}function d(e,t){for(var n="polygon"===e.type?o.ZI.CCW_IS_HOLE:o.ZI.NONE,r="polygon"===e.type?e.rings:e.paths,i=(0,o.Mk)(r,!1,n),s=i.position,l=i.outlines,c=(0,a.CM)(s,e.spatialReference,0,s,t,0,s.length/3),d=2;d<s.length;d+=3)s[d]=u.Rn;return{lines:c?h(l,s):[],projectionSuccess:c}}function h(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=new Array,s=(0,r.Z)(e);try{for(s.s();!(n=s.n()).done;){var u=n.value,c=u.index,d=u.count;if(!(d<=1)){var h=3*c,f=3*d;o.push({position:(0,l.Rq)(t,3*c,3*d),mapPositions:(0,i.pC)(a)?(0,l.Rq)(a,h,f):void 0})}}}catch(p){s.e(p)}finally{s.f()}return o}},1937:function(e,t,n){n.d(t,{Rn:function(){return yn}});var r,i,a,o,s,u,l,c=n(74165),d=n(15861),h=n(29439),f=n(37762),p=n(1413),v=n(15671),g=n(43144),m=n(60136),y=n(29388),_=n(27366),T=n(85015),w=n(91505),C=n(100),S=n(77427),x=n(92026),b=n(27546),O=n(94172),A=n(92377),R=n(49861),P=(n(25243),n(63780)),E=n(69912),D=n(14226),I=n(11186),M=n(71353),Z=n(50951),L=n(26279),k=n(94463);!function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(r||(r={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(i||(i={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(a||(a={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(o||(o={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(s||(s={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(u||(u={})),function(e){e[e.INSIDE=0]="INSIDE",e[e.INTERSECTS=1]="INTERSECTS",e[e.OUTSIDE=2]="OUTSIDE"}(l||(l={}));var H,N=n(65156),F=n(68401),z=n(61403);!function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded",e[e.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"}(H||(H={}));var U=function(){function e(t,n){(0,v.Z)(this,e),this.index=t,this.renderTargets=n,this._extent=(0,N.Ue)(),this.resolution=0,this.renderLocalOrigin=(0,z.a)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new j,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(n.renderTargets.length).fill(!1)}return(0,g.Z)(e,[{key:"extent",get:function(){return this._extent}},{key:"getValidTexture",value:function(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}},{key:"_needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}},{key:"getColorTexture",value:function(e){var t=e===H.ColorAndWater?this.renderTargets.getTarget(s.Color):e===H.Highlight?this.renderTargets.getTarget(s.Highlight):e===H.ObjectAndLayerIdColor?this.renderTargets.getTarget(s.ObjectAndLayerIdColor):this.renderTargets.getTarget(s.Occluded);return t?t.getTexture():null}},{key:"getColorTextureNoRasterImage",value:function(){return this._needsColorWithoutRasterImage?this.getValidTexture(s.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(s.Color):null}},{key:"getNormalTexture",value:function(e){var t=e===H.ColorAndWater?this.renderTargets.getTarget(s.Water):null;return t?t.getTexture():null}},{key:"draw",value:function(e,t){var n,r=this.computeRenderTargetValidityBitfield(),i=(0,f.Z)(this.renderTargets.renderTargets);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.type!==s.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[a.type]=e.drawTarget(this,a,t):this.validTargets[a.type]=!1}}catch(o){i.e(o)}finally{i.f()}return r^this.computeRenderTargetValidityBitfield()?F.Yg.CHANGED:F.Yg.UNCHANGED}},{key:"computeRenderTargetValidityBitfield",value:function(){var e=this.validTargets;return+e[s.Color]|+e[s.ColorNoRasterImage]<<1|+e[s.Highlight]<<2|+e[s.Water]<<3|+e[s.Occluded]<<4}},{key:"setupGeometryViewsCyclical",value:function(e){this.setupGeometryViewsDirect();var t=.001*e.range;if(this._extent[0]-t<=e.min){var n=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,N.cv)(this._extent,e.range,0,n)}if(this._extent[2]+t>=e.max){var r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,N.cv)(this._extent,-e.range,0,r)}}},{key:"setupGeometryViewsDirect",value:function(){this.canvasGeometries.numViews=1,(0,N.JG)(this.canvasGeometries.extents[0],this._extent)}},{key:"hasSomeSizedView",value:function(){for(var e=0;e<this.canvasGeometries.numViews;e++){var t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}},{key:"applyViewport",value:function(e){e.setViewport(this.index===r.INNER?0:this.resolution,0,this.resolution,this.resolution)}}]),e}(),j=(0,g.Z)((function e(){(0,v.Z)(this,e),this.extents=[(0,N.Ue)(),(0,N.Ue)(),(0,N.Ue)()],this.numViews=0})),V=n(15245),W=n(8548),G=n(53634),B=function(){function e(t,n){(0,v.Z)(this,e),this._size=(0,V.c)(),this._fbo=null,this._fbo=new G.X(t,{colorTarget:W.Lm.TEXTURE,depthStencilTarget:W.OU.NONE},{target:W.No.TEXTURE_2D,pixelFormat:W.VI.RGBA,dataType:W.Br.UNSIGNED_BYTE,wrapMode:W.e8.CLAMP_TO_EDGE,samplingMode:W.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:n,maxAnisotropy:8,width:0,height:0})}return(0,g.Z)(e,[{key:"dispose",value:function(){this._fbo=(0,x.M2)(this._fbo)}},{key:"getTexture",value:function(){return this._fbo?this._fbo.colorTexture:null}},{key:"isValid",value:function(){return null!==this._fbo}},{key:"resize",value:function(e,t){this._size[0]=e,this._size[1]=t,this._fbo.resize(this._size[0],this._size[1])}},{key:"bind",value:function(e){e.bindFramebuffer(this._fbo)}},{key:"generateMipMap",value:function(){var e=this._fbo.colorTexture;e.descriptor.hasMipmap&&e.generateMipmap()}},{key:"disposeRenderTargetMemory",value:function(){var e;null===(e=this._fbo)||void 0===e||e.resize(0,0)}},{key:"gpuMemoryUsage",get:function(){var e,t;return null!==(e=null===(t=this._fbo)||void 0===t?void 0:t.gpuMemoryUsage)&&void 0!==e?e:0}}]),e}(),q=n(93169),J=n(37081),X=(0,g.Z)((function e(t,n,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];(0,v.Z)(this,e),this.output=n,this.type=r,this.valid=!1,this.lastUsed=1/0,this.fbo=new B(t,i)})),Y=function(){function e(t){(0,v.Z)(this,e),this.renderTargets=[new X(t,J.H.Color,s.Color),new X(t,J.H.Color,s.ColorNoRasterImage),new X(t,J.H.Highlight,s.Highlight,!1),new X(t,J.H.Normal,s.Water),new X(t,J.H.Color,s.Occluded)],(0,q.Z)("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new X(t,J.H.ObjectAndLayerIdColor,s.ObjectAndLayerIdColor))}return(0,g.Z)(e,[{key:"getTarget",value:function(e){return this.renderTargets[e].fbo}},{key:"dispose",value:function(){var e,t=(0,f.Z)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.dispose()}}catch(n){t.e(n)}finally{t.f()}}},{key:"disposeRenderTargetMemory",value:function(){var e,t=(0,f.Z)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.disposeRenderTargetMemory()}}catch(n){t.e(n)}finally{t.f()}}},{key:"validateUsageForTarget",value:function(e,t,n){if(e)t.lastUsed=n;else if(n-t.lastUsed>$)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}},{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((function(e,t){return e+t.fbo.gpuMemoryUsage}),0)}}]),e}(),$=1e3,Q=n(61863),K=n(59447),ee=n(33559),te=function(){function e(t){(0,v.Z)(this,e),this._context=t,this._perConstructorInstances=new K.r,this._frameCounter=0,this._keepAliveFrameCount=re}return(0,g.Z)(e,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}},{key:"destroy",value:function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.destroy()}))})),this._perConstructorInstances.clear()}},{key:"acquire",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ie,r=n.key,i=this._perConstructorInstances.get(e,r);if((0,x.Wi)(i)){var a=new e(this._context,n,(function(){return t.release(a)}));i=new ne(a),this._perConstructorInstances.set(e,r,i)}return++i.refCount,i.technique}},{key:"releaseAndAcquire",value:function(e,t,n){if((0,x.pC)(n)){if(t.key===n.key)return n;this.release(n)}return this.acquire(e,t)}},{key:"release",value:function(e){if(!(0,x.Wi)(e)&&!this._perConstructorInstances.empty){var t=this._perConstructorInstances.get(e.constructor,e.key);(0,x.Wi)(t)||(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}}},{key:"frameUpdate",value:function(){var e=this;this._frameCounter++,this._keepAliveFrameCount!==re&&this._perConstructorInstances.forEach((function(t,n){t.forEach((function(t,r){0===t.refCount&&t.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(t.technique.destroy(),e._perConstructorInstances.delete(n,r))}))}))}},{key:"reloadAll",value:function(){var e=(0,d.Z)((0,c.Z)().mark((function e(){var t,n=this;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Array,this._perConstructorInstances.forEach((function(e,r){var i=function(){var e=(0,d.Z)((0,c.Z)().mark((function e(t,r){var i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.shader,e.t0=i,!e.t0){e.next=6;break}return e.next=5,i.reload();case 5:t.forEach((function(e){return e.technique.reload(n._context)}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();t.push(i(e,r))})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ne=(0,g.Z)((function e(t){(0,v.Z)(this,e),this.technique=t,this.refCount=0,this.refZeroFrame=0})),re=-1,ie=new ee.m,ae=n(86755),oe=n(32718),se=n(97731),ue=function(){function e(t,n,r,i){(0,v.Z)(this,e),this._textureRepository=t,this._techniqueRepository=n,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new K.r}return(0,g.Z)(e,[{key:"dispose",value:function(){this._textureRepository.destroy()}},{key:"acquire",value:function(e,t,n){if(this._ownMaterial(e),!e.requiresSlot(t,n))return null;var r=this._id2glMaterialRef.get(n,e.id);if((0,x.Wi)(r)){var i=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:n});r=new le(i),this._id2glMaterialRef.set(n,e.id,r)}return r.ref(),r.glMaterial}},{key:"release",value:function(e,t){var n=this._id2glMaterialRef.get(t,e.id);(0,x.pC)(n)&&(n.unref(),n.referenced||((0,x.M2)(n.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}},{key:"_ownMaterial",value:function(e){(0,x.pC)(e.repository)&&e.repository!==this&&oe.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}]),e}(),le=function(){function e(t){(0,v.Z)(this,e),this.glMaterial=t,this._refCnt=0}return(0,g.Z)(e,[{key:"ref",value:function(){++this._refCnt}},{key:"unref",value:function(){--this._refCnt,(0,se.hu)(this._refCnt>=0)}},{key:"referenced",get:function(){return this._refCnt>0}}]),e}(),ce=n(32534),de=n(87145),he=n(56529),fe=n(6394),pe=n(91226),ve=n(43565),ge=n(15226),me=n(40854),ye=n(93822),_e=n(25920),Te=n(48919),we=function(){function e(t,n,r){(0,v.Z)(this,e),this.shadowMap=t,this.ssaoHelper=n,this.slicePlane=r,this.slot=ye.r.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=_e.A.NONE,this._camera=new ae.V,this._inverseViewport=(0,fe.a)(),this.oldLighting=new Te.c,this.newLighting=new Te.c,this._fadedLighting=new Te.c,this._lighting=this.newLighting,this.ssr=new me.O,this.multipassTerrain=new ge.a,this.multipassGeometry=new ve._,this.overlays=[],this.cloudsFade=new pe.ii}return(0,g.Z)(e,[{key:"camera",get:function(){return this._camera},set:function(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}},{key:"inverseViewport",get:function(){return this._inverseViewport}},{key:"lighting",get:function(){return this._lighting}},{key:"weatherFading",get:function(){return this._lighting===this._fadedLighting}},{key:"fadeLighting",value:function(e){var t=this.oldLighting,n=this.newLighting;e>=1?this._lighting=n:(this._fadedLighting.lerpLighting(t,n,e),this._lighting=this._fadedLighting)}}]),e}(),Ce=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,v.Z)(this,e),this.rctx=t,this.sliceHelper=i,this.lastFrameCamera=new ae.V,this.output=J.H.Color,this.renderOccludedMask=Se,this.bindParameters=new we(n,r,(0,x.pC)(i)?i.plane:null)}return(0,g.Z)(e,[{key:"resetRenderOccludedMask",value:function(){this.renderOccludedMask=Se}}]),e}(),Se=he.yD.Occlude|he.yD.OccludeAndTransparent|he.yD.OccludeAndTransparentStencil,xe=n(16889),be=n(11873),Oe=n(81949),Ae=n(88396),Re=n(90045),Pe=n(67077),Ee=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.apply(this,arguments))._projectionMatrix=(0,Oe.c)(),e}return(0,g.Z)(n,[{key:"projectionMatrix",get:function(){return this._projectionMatrix}}]),n}(ae.V);(0,_._)([(0,R.Cb)()],Ee.prototype,"_projectionMatrix",void 0),(0,_._)([(0,R.Cb)({readOnly:!0})],Ee.prototype,"projectionMatrix",null),Ee=(0,_._)([(0,E.j)("esri.views.3d.webgl-engine.lib.CascadeCamera")],Ee);var De,Ie=n(51378),Me=n(3384);!function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"}(De||(De={}));for(var Ze=(0,g.Z)((function e(){(0,v.Z)(this,e),this.camera=new Ee,this.lightMat=(0,Oe.c)()})),Le=function(){function e(t,n){(0,v.Z)(this,e),this._rctx=t,this._viewingMode=n,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._projectionView=(0,Oe.c)(),this._projectionViewInverse=(0,Oe.c)(),this._modelViewLight=(0,Oe.c)(),this._splitSchemeLambda=0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,Pe.c)(),this._cascades=[new Ze,new Ze,new Ze,new Ze],this._lastOrigin=null,this._maxTextureSize=Math.min((0,q.Z)("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}return(0,g.Z)(e,[{key:"depthTexture",get:function(){return this._depthTexture}},{key:"textureSize",get:function(){return this._textureSize}},{key:"numCascades",get:function(){return this._numCascades}},{key:"cascadeDistances",get:function(){return(0,Re.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}},{key:"dispose",value:function(){this.enabled=!1,this.disposeOffscreenBuffers()}},{key:"disposeOffscreenBuffers",value:function(){this._discardDepthTexture(),this._discardAllSnapshots()}},{key:"maxCascades",get:function(){return this._maxNumCascades},set:function(e){this._maxNumCascades=(0,xe.uZ)(Math.floor(e),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}},{key:"ready",get:function(){return this._enabled&&(0,x.pC)(this._depthTexture)}},{key:"getSnapshot",value:function(e){return this.enabled?this._snapshots[e]:null}},{key:"cascades",get:function(){for(var e=0;e<this._numCascades;++e)Be[e]=this._cascades[e];return Be.length=this._numCascades,Be}},{key:"start",value:function(e,t,n){(0,se.hu)(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();var r=this._clampNearFar(n),i=r.near,a=r.far;this._computeCascadeDistances(a,i),this._setupMatrices(e,t);for(var o=e.viewMatrix,s=e.projectionMatrix,u=0;u<this._numCascades;++u)this._constructCascade(u,s,o,t);this._lastOrigin=null,this.clear()}},{key:"finish",value:function(e){(0,se.hu)(this.enabled),this._rctx.bindFramebuffer(e)}},{key:"getShadowMapMatrices",value:function(e){if(!this._lastOrigin||!(0,I.k)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,M.c)(),(0,I.c)(this._lastOrigin,e);for(var t=0;t<this._numCascades;++t){(0,D.w)(qe,this._cascades[t].lightMat,e);for(var n=0;n<16;++n)Je[16*t+n]=qe[n]}}return Je}},{key:"takeCascadeSnapshotTo",value:function(e,t){(0,se.hu)(this.enabled);var n=this._ensureSnapshot(t);this._bindFbo();var r=this._rctx,i=r.bindTexture(n,Ie.x.TEXTURE_UNIT_FOR_UPDATES);r.gl.copyTexSubImage2D(W.No.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),r.bindTexture(i,Ie.x.TEXTURE_UNIT_FOR_UPDATES)}},{key:"clear",value:function(){var e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(W.lk.COLOR_BUFFER_BIT|W.lk.DEPTH_BUFFER_BIT)}},{key:"_computeTextureSize",value:function(e,t){var n=.5*Math.log(e*e+t*t)*Math.LOG2E,r=Math.pow(2,Math.round(n+.35));return Math.min(this._maxTextureSize,2*r)}},{key:"_ensureDepthTexture",value:function(){if(!(0,x.pC)(this._depthTexture)||this._depthTexture.descriptor.width!==this._textureSize){this._discardDepthTexture();var e={target:W.No.TEXTURE_2D,pixelFormat:W.VI.RGBA,dataType:W.Br.UNSIGNED_BYTE,wrapMode:W.e8.CLAMP_TO_EDGE,samplingMode:W.cw.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new Ie.x(this._rctx,e),this._fbo=new G.X(this._rctx,{colorTarget:W.Lm.TEXTURE,depthStencilTarget:W.OU.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}}},{key:"_ensureSnapshot",value:function(e){var t=this._snapshots[e];if((0,x.pC)(t)&&t.descriptor.width===this._textureSize)return t;this._discardSnapshot(e);var n={target:W.No.TEXTURE_2D,pixelFormat:W.VI.RGBA,dataType:W.Br.UNSIGNED_BYTE,wrapMode:W.e8.CLAMP_TO_EDGE,samplingMode:W.cw.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return t=new Ie.x(this._rctx,n),this._snapshots[e]=t,t}},{key:"_discardDepthTexture",value:function(){this._fbo=(0,x.M2)(this._fbo),this._depthTexture=(0,x.M2)(this._depthTexture)}},{key:"_discardSnapshot",value:function(e){this._snapshots[e]=(0,x.M2)(this._snapshots[e])}},{key:"_discardAllSnapshots",value:function(){for(var e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}},{key:"_bindFbo",value:function(){var e=this._rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}},{key:"_constructCascade",value:function(e,t,n,r){var i=this._cascades[e],a=-this._cascadeDistances[e],o=-this._cascadeDistances[e+1],s=(t[10]*a+t[14])/Math.abs(t[11]*a+t[15]),u=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]);(0,se.hu)(s<u);for(var l=0;l<8;++l){(0,Re.s)(He,l%4==0||l%4==3?-1:1,l%4==0||l%4==1?-1:1,l<4?s:u,1);var c=Ne[l];(0,Re.t)(c,He,this._projectionViewInverse),c[0]/=c[3],c[1]/=c[3],c[2]/=c[3]}(0,I.o)(Ge,Ne[0]),i.camera.viewMatrix=(0,D.w)(ke,this._modelViewLight,Ge);for(var d=0;d<8;++d)(0,I.m)(Ne[d],Ne[d],i.camera.viewMatrix);for(var h=Ne[0][2],f=Ne[0][2],p=1;p<8;++p)h=Math.min(h,Ne[p][2]),f=Math.max(f,Ne[p][2]);h-=200,f+=200,i.camera.near=-f,i.camera.far=-h,function(e,t,n,r,i){var a=1/Ne[0][3],o=1/Ne[4][3];(0,se.hu)(a<o);var s=a+Math.sqrt(a*o),u=Math.sin((0,xe.ZF)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));s/=u,function(e,t,n,r,i,a,o,s){(0,Ae.s)(Xe,0,0);for(var u=0;u<4;++u)(0,Ae.j)(Xe,Xe,e[u]);(0,Ae.b)(Xe,Xe,.25),(0,Ae.s)(Ye,0,0);for(var l=4;l<8;++l)(0,Ae.j)(Ye,Ye,e[l]);(0,Ae.b)(Ye,Ye,.25),(0,Ae.l)($e[0],e[4],e[5],.5),(0,Ae.l)($e[1],e[5],e[6],.5),(0,Ae.l)($e[2],e[6],e[7],.5),(0,Ae.l)($e[3],e[7],e[4],.5);for(var c=0,d=(0,Ae.k)($e[0],Xe),h=1;h<4;++h){var f=(0,Ae.k)($e[h],Xe);f<d&&(d=f,c=h)}(0,Ae.a)(Qe,$e[c],e[c+4]);var p,v,g=Qe[0];Qe[0]=-Qe[1],Qe[1]=g,(0,Ae.a)(Ke,Ye,Xe),(0,Ae.h)(Ke,Qe)<0&&(0,Ae.n)(Qe,Qe),(0,Ae.l)(Qe,Qe,Ke,n),(0,Ae.f)(Qe,Qe),p=v=(0,Ae.h)((0,Ae.a)(et,e[0],Xe),Qe);for(var m=1;m<8;++m){var y=(0,Ae.h)((0,Ae.a)(et,e[m],Xe),Qe);y<p?p=y:y>v&&(v=y)}(0,Ae.c)(r,Xe),(0,Ae.b)(et,Qe,p-t),(0,Ae.j)(r,r,et);for(var _=-1,T=1,w=0,C=0,S=0;S<8;++S){(0,Ae.a)(tt,e[S],r),(0,Ae.f)(tt,tt);var x=Qe[0]*tt[1]-Qe[1]*tt[0];x>0?x>_&&(_=x,w=S):x<T&&(T=x,C=S)}(0,se.T)(_>0,"leftArea"),(0,se.T)(T<0,"rightArea"),(0,Ae.b)(nt,Qe,p),(0,Ae.j)(nt,nt,Xe),(0,Ae.b)(rt,Qe,v),(0,Ae.j)(rt,rt,Xe),it[0]=-Qe[1],it[1]=Qe[0];var b=(0,se.ep)(r,e[C],rt,(0,Ae.j)(et,rt,it),1,i),O=(0,se.ep)(r,e[w],rt,et,1,a),A=(0,se.ep)(r,e[w],nt,(0,Ae.j)(et,nt,it),1,o),R=(0,se.ep)(r,e[C],nt,et,1,s);(0,se.T)(b,"rayRay"),(0,se.T)(O,"rayRay"),(0,se.T)(A,"rayRay"),(0,se.T)(R,"rayRay")}(Ne,s,u,ze,Ue,je,Ve,We),function(e,t,n,r,i){(0,Ae.a)(ut,n,r),(0,Ae.b)(ut,ut,.5),lt[0]=ut[0],lt[1]=ut[1],lt[2]=0,lt[3]=ut[1],lt[4]=-ut[0],lt[5]=0,lt[6]=ut[0]*ut[0]+ut[1]*ut[1],lt[7]=ut[0]*ut[1]-ut[1]*ut[0],lt[8]=1,lt[at(0,2)]=-(0,Ae.h)(st(lt,0),e),lt[at(1,2)]=-(0,Ae.h)(st(lt,1),e);var a=(0,Ae.h)(st(lt,0),n)+lt[at(0,2)],o=(0,Ae.h)(st(lt,1),n)+lt[at(1,2)],s=(0,Ae.h)(st(lt,0),r)+lt[at(0,2)],u=(0,Ae.h)(st(lt,1),r)+lt[at(1,2)];a=-(a+s)/(o+u),lt[at(0,0)]+=lt[at(1,0)]*a,lt[at(0,1)]+=lt[at(1,1)]*a,lt[at(0,2)]+=lt[at(1,2)]*a,a=1/((0,Ae.h)(st(lt,0),n)+lt[at(0,2)]),o=1/((0,Ae.h)(st(lt,1),n)+lt[at(1,2)]),lt[at(0,0)]*=a,lt[at(0,1)]*=a,lt[at(0,2)]*=a,lt[at(1,0)]*=o,lt[at(1,1)]*=o,lt[at(1,2)]*=o,lt[at(2,0)]=lt[at(1,0)],lt[at(2,1)]=lt[at(1,1)],lt[at(2,2)]=lt[at(1,2)],lt[at(1,2)]+=1,a=(0,Ae.h)(st(lt,1),t)+lt[at(1,2)],o=(0,Ae.h)(st(lt,2),t)+lt[at(2,2)],s=(0,Ae.h)(st(lt,1),n)+lt[at(1,2)],u=(0,Ae.h)(st(lt,2),n)+lt[at(2,2)],a=-.5*(a/o+s/u),lt[at(1,0)]+=lt[at(2,0)]*a,lt[at(1,1)]+=lt[at(2,1)]*a,lt[at(1,2)]+=lt[at(2,2)]*a,a=(0,Ae.h)(st(lt,1),t)+lt[at(1,2)],o=(0,Ae.h)(st(lt,2),t)+lt[at(2,2)],s=-o/a,lt[at(1,0)]*=s,lt[at(1,1)]*=s,lt[at(1,2)]*=s,i[0]=lt[0],i[1]=lt[1],i[2]=0,i[3]=lt[2],i[4]=lt[3],i[5]=lt[4],i[6]=0,i[7]=lt[5],i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=lt[6],i[13]=lt[7],i[14]=0,i[15]=lt[8]}(ze,Ue,Ve,We,i.projectionMatrix),i.projectionMatrix[10]=2/(n-r),i.projectionMatrix[14]=-(n+r)/(n-r)}(n,r,h,f,i.camera),(0,D.m)(i.lightMat,i.camera.projectionMatrix,i.camera.viewMatrix);var v=this._textureSize/2;i.camera.viewport=[e%2==0?0:v,0===Math.floor(e/2)?0:v,v,v]}},{key:"_setupMatrices",value:function(e,t){(0,D.m)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,D.a)(this._projectionViewInverse,this._projectionView);var n=this._viewingMode===Z.JY.Global?e.eye:(0,I.s)(Ge,0,0,1);(0,D.u)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],n)}},{key:"_clampNearFar",value:function(e){var t=e.near,n=e.far;return t<2&&(t=2),n<2&&(n=2),t>=n&&(t=2,n=4),{near:t,far:n}}},{key:"_computeCascadeDistances",value:function(e,t){this._numCascades=Math.min(1+Math.floor((0,se.E6)(e/t,4)),this._maxNumCascades);for(var n=(e-t)/this._numCascades,r=Math.pow(e/t,1/this._numCascades),i=t,a=t,o=0;o<this._numCascades+1;++o)this._cascadeDistances[o]=(0,xe.t7)(i,a,this._splitSchemeLambda),i*=r,a+=n}},{key:"gpuMemoryUsage",get:function(){var e,t;return this._snapshots.reduce((function(e,t){return e+(0,Me.un)(t)}),null!==(e=null===(t=this._fbo)||void 0===t?void 0:t.gpuMemoryUsage)&&void 0!==e?e:0)}},{key:"test",get:function(){var e=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(t){e._splitSchemeLambda=t},get splitSchemeLambda(){return e._splitSchemeLambda}}}}]),e}(),ke=(0,Oe.c)(),He=(0,Pe.c)(),Ne=[],Fe=0;Fe<8;++Fe)Ne.push((0,Pe.c)());var ze=(0,fe.a)(),Ue=(0,fe.a)(),je=(0,fe.a)(),Ve=(0,fe.a)(),We=(0,fe.a)(),Ge=(0,M.c)(),Be=[],qe=(0,Oe.c)(),Je=new Float32Array(64),Xe=(0,fe.a)(),Ye=(0,fe.a)(),$e=[(0,fe.a)(),(0,fe.a)(),(0,fe.a)(),(0,fe.a)()],Qe=(0,fe.a)(),Ke=(0,fe.a)(),et=(0,fe.a)(),tt=(0,fe.a)(),nt=(0,fe.a)(),rt=(0,fe.a)(),it=(0,fe.a)();function at(e,t){return 3*t+e}var ot=(0,fe.a)();function st(e,t){return(0,Ae.s)(ot,e[t],e[t+3]),ot}var ut=(0,fe.a)(),lt=(0,be.c)();var ct=n(54463),dt=n(55848);n(22178);var ht=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this,e,r)).triangleNr=i,a}return(0,g.Z)(n)}(dt.Dx);var ft=function(){function e(){(0,v.Z)(this,e),this.adds=new b.Z,this.removes=new b.Z,this.updates=new b.Z({allocator:function(e){return e||new pt},deallocator:function(e){return e.renderGeometry=null,e}})}return(0,g.Z)(e,[{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.updates.clear()}},{key:"prune",value:function(){this.adds.prune(),this.removes.prune(),this.updates.prune()}},{key:"empty",get:function(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}]),e}(),pt=(0,g.Z)((function e(){(0,v.Z)(this,e)})),vt=(0,g.Z)((function e(){(0,v.Z)(this,e),this.adds=new Array,this.removes=new Array,this.updates=new Array})),gt=n(88153),mt=n(78289);function yt(e){return e.geometry.indexCount>=1}var _t=n(50256),Tt=n(44070),wt=function(){function e(t){(0,v.Z)(this,e),this._rctx=t,this._indexBuffer=this._createIndexbuffer(),this._program=this._createProgram()}return(0,g.Z)(e,[{key:"_createProgram",value:function(){return this._rctx.programCache.acquire("\n    void main(void) {\n      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }","\n    void main(void) {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    }",new Map([]))}},{key:"_createIndexbuffer",value:function(){return Tt.f.createIndex(this._rctx,W.l1.STATIC_DRAW,new Uint32Array([0]))}},{key:"resetIndicesType",value:function(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,W.w0.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(W.MX.POINTS,1,W.g.UNSIGNED_INT,0))}},{key:"dispose",value:function(){this._program.dispose(),this._indexBuffer.dispose()}}]),e}(),Ct=n(94425),St=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,M.c)();return(0,v.Z)(this,n),(e=t.call(this)).origin=r,e.slicePlaneLocalOrigin=e.origin,e}return(0,g.Z)(n)}(n(85380).Pf),xt=n(29674),bt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,v.Z)(this,e),this.from=t,this.to=n}return(0,g.Z)(e,[{key:"numElements",get:function(){return this.to-this.from}}]),e}();function Ot(e){var t=new Map;e.forAll((function(e){return t.set(e.from,e)}));for(var n=!0;n;)n=!1,e.forEach((function(r){var i=t.get(r.to);i&&(r.to=i.to,t.delete(i.from),e.removeUnordered(i),n=!0)}))}var At=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this,r,i)).geometry=e,a}return(0,g.Z)(n,[{key:"isVisible",get:function(){return this.geometry.visible}},{key:"hasHighlights",get:function(){return(0,x.pC)(this.geometry.highlights)&&this.isVisible}},{key:"hasOccludees",get:function(){return(0,x.pC)(this.geometry.occludees)}}]),n}(bt),Rt=(0,g.Z)((function e(){(0,v.Z)(this,e),this.first=0,this.count=0})),Pt=function(){function e(){(0,v.Z)(this,e),this._numElements=0,this._instances=new Map,this.holes=new b.Z({allocator:function(e){return e||new bt},deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=Et(),this.drawCommandsHighlight=Et(),this.drawCommandsOccludees=Et(),this.drawCommandsShadowHighlightRest=Et()}return(0,g.Z)(e,[{key:"numElements",get:function(){return this._numElements}},{key:"instances",get:function(){return this._instances}},{key:"addInstance",value:function(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}},{key:"deleteInstance",value:function(e){var t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}},{key:"updateInstance",value:function(e,t,n){var r=this._instances.get(e);r&&(this._numElements-=r.numElements,r.from=t,r.to=n,this._numElements+=r.numElements)}},{key:"updateDrawState",value:function(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}},{key:"updateDrawCommands",value:function(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0!==this._instances.size){if(!this.needsMultipleCommands()){var t=this.drawCommandsDefault.pushNew(),n=this.holes.front();return(0,x.pC)(this.vao)&&1===this.holes.length&&n.to===Math.floor(this.vao.size/e)?(t.first=0,void(t.count=n.from)):(t.first=1/0,t.count=0,this._instances.forEach((function(e){t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}var r,i=Array.from(this._instances.values()).sort((function(e,t){return e.from===t.from?e.to-t.to:e.from-t.from})),a=(0,f.Z)(i);try{for(a.s();!(r=a.n()).done;){var o=r.value;o.isVisible&&(Dt(o.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,o),Dt(o.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,o))}}catch(s){a.e(s)}finally{a.f()}}}},{key:"needsMultipleCommands",value:function(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}]),e}();function Et(){return new b.Z({allocator:function(e){return e||new Rt},deallocator:function(e){return e}})}function Dt(e,t){var n=e.back();if(null==n){var r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(n,t)){var i=t.from-n.first+t.numElements;n.count=i}else{var a=e.pushNew();a.first=t.from,a.count=t.numElements}}var It=function(){function e(t){(0,v.Z)(this,e),this.origin=t,this.buffers=new Array}return(0,g.Z)(e,[{key:"dispose",value:function(){this.buffers.forEach((function(e){return e.vao.dispose()})),this.buffers.length=0}},{key:"findBuffer",value:function(e){return this.buffers.find((function(t){return t.instances.has(e)}))}}]),e}(),Mt=n(18759),Zt=n(95439),Lt=n(80658),kt=Mt.an+1,Ht=function(){function e(t,n,r){(0,v.Z)(this,e),this._rctx=t,this._locations=n,this._layout=r,this._cache=t.newCache("VaoCache ".concat((0,Zt.D)()),Nt)}return(0,g.Z)(e,[{key:"dispose",value:function(){this._cache.destroy()}},{key:"newVao",value:function(e){var t=e.toString(),n=this._cache.pop(t);if((0,x.pC)(n)){var r=n.pop();return n.length>0&&this._cache.put(t,n,e*n.length,kt),r}var i=new Lt.U(this._rctx,this._locations,{geometry:this._layout},{geometry:Tt.f.createVertex(this._rctx,W.l1.STATIC_DRAW)});return i.vertexBuffers.geometry.setSize(e),i}},{key:"deleteVao",value:function(e){if((0,x.Wi)(e))return null;var t=e.size,n=t.toString(),r=this._cache.pop(n);return(0,x.pC)(r)?(r.push(e),this._cache.put(n,r,t*r.length,-1)):this._cache.put(n,[e],t,-1),null}}]),e}();function Nt(e,t){if(t!==Mt.lN.ALL){var n=e.pop(),r=e.length*n.size;return n.dispose(),r}e.forEach((function(e){return e.dispose()}))}var Ft=function(){function e(t,n,r){(0,v.Z)(this,e),this._rctx=t,this._materialRepository=n,this.material=r,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new Ct.p(this.material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._vaoCache=new Ht(t,r.vertexAttributeLocations,(0,_t.K)(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new wt(this._rctx))}return(0,g.Z)(e,[{key:"dispose",value:function(){var e;this._glMaterials.destroy(),this._dataByOrigin.forEach((function(e){return e.dispose()})),this._dataByOrigin.clear(),this._vaoCache.dispose(),null===(e=this._appleAmdDriverHelper)||void 0===e||e.dispose()}},{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&this.material instanceof xt.H}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&this.material.renderOccluded!==he.yD.Occlude}},{key:"numGeometries",get:function(){var e=0;return this._dataByOrigin.forEach((function(t){return e+=t.buffers.reduce((function(e,t){return e+t.instances.size}),0)})),e}},{key:"forEachGeometry",value:function(e){this._dataByOrigin.forEach((function(t){return t.buffers.forEach((function(t){return t.instances.forEach((function(t){return e(t.geometry)}))}))}))}},{key:"modify",value:function(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}},{key:"_updateGeometries",value:function(e){var t,n=this._bufferWriter,r=n.vertexBufferLayout.stride/4,i=(0,f.Z)(e);try{for(i.s();!(t=i.n()).done;){var a,o=t.value,s=o.renderGeometry,u=null===(a=this._dataByOrigin.get(s.localOrigin.id))||void 0===a?void 0:a.findBuffer(s.id);if((0,x.Wi)(u))return;var l=u.instances.get(s.id);if(o.updateType&(mt.$.GEOMETRY|mt.$.TRANSFORMATION)){var c=$t(n.elementCount(l.geometry.geometry)*r),d=n.vertexBufferLayout.createView(c.buffer);this._writeGeometry(s,d,0),u.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}o.updateType&(mt.$.HIGHLIGHT|mt.$.OCCLUDEE|mt.$.VISIBILITY)&&(u.drawCommandsDirty=!0)}}catch(h){i.e(h)}finally{i.f()}}},{key:"_computeDeltas",value:function(e,t){var n,r=new K.r,i=(0,f.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=a.localOrigin;if(!(0,x.Wi)(o)){var s=r.get(o.id,null);(0,x.Wi)(s)&&(s=new zt(o.vec3),r.set(o.id,null,s)),s.changes.push(a)}}}catch(g){i.e(g)}finally{i.f()}var u,l=(0,f.Z)(t);try{for(l.s();!(u=l.n()).done;){var c,d=u.value,h=d.localOrigin;if(!(0,x.Wi)(h)){var p=null===(c=this._dataByOrigin.get(h.id))||void 0===c?void 0:c.findBuffer(d.id);if(!(0,x.Wi)(p)){var v=r.get(h.id,p);(0,x.Wi)(v)&&(v=new zt(h.vec3),r.set(h.id,p,v)),v.changes.push(d)}}}}catch(g){l.e(g)}finally{l.f()}return r}},{key:"_addAndRemoveGeometries",value:function(e,t){var n=this,r=this._bufferWriter,i=this._dataByOrigin,a=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,t);o.forEach((function(e,t){var s=e.get(null),u=(0,x.pC)(s)?s.changes:[];o.delete(t,null);var l=i.get(t);if(e.forEach((function(e,s){if(o.delete(t,s),(0,x.Wi)(s))(0,se.hu)(!1,"No VAO for removed geometries");else{if(s.instances.size===e.changes.length)return n._vaoCache.deleteVao(s.vao),(0,P.e$)(l.buffers,s),void(0===l.buffers.length&&0===u.length&&i.delete(t));var c=s.numElements,d=s.vao.size/4,h=u.reduce((function(e,t){return e+r.elementCount(t.geometry)}),0),f=e.changes.reduce((function(e,t){return e+r.elementCount(t.geometry)}),0),p=Math.min((c+h-f)*a,Xt),v=p>d;p>Bt&&p<d/2?(e.changes.forEach((function(e){var t=e.id;return s.deleteInstance(t)})),s.instances.forEach((function(e){var t=e.geometry;return u.push(t)})),n._vaoCache.deleteVao(s.vao),(0,P.e$)(l.buffers,s)):v?n._applyAndRebuild(s,u,e):n._applyRemoves(s,e)}})),u.length>0)for((0,x.Wi)(l)&&(l=new It(s.origin),i.set(t,l)),l.buffers.forEach((function(e){return n._applyAdds(e,u)}));u.length>0;)l.buffers.push(n._applyAndRebuild(new Pt,u,null))}))}},{key:"_updateDrawCommands",value:function(){var e=this;this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((function(t){t.buffers.forEach((function(t){t.drawCommandsDirty&&(t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,(0,S.oE)(t.instances,(function(e){return t.updateDrawState(e),t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees})),t.updateDrawCommands(e._bufferWriter.vertexBufferLayout.stride)),e._hasHighlights=e._hasHighlights||t.hasHighlights,e._hasOccludees=e._hasOccludees||t.hasOccludees}))}))}},{key:"_applyAndRebuild",value:function(e,t,n){var r=this;if((0,x.pC)(n)){var i,a=(0,f.Z)(n.changes);try{for(a.s();!(i=a.n()).done;){var o=i.value;e.deleteInstance(o.id)}}catch(w){a.e(w)}finally{a.f()}}for(var s=this._bufferWriter,u=s.vertexBufferLayout.stride,l=u/4,c=Math.floor(Xt/l),d=e.numElements;t.length>0;){var h=t.pop(),p=s.elementCount(h.geometry);if(d+p>c&&d>0){t.push(h);break}d+=p;var v=new At(h,0,0);(0,se.hu)(null==e.instances.get(h.id)),e.addInstance(h.id,v)}var g=d*l,m=$t(g),y=s.vertexBufferLayout.createView(m.buffer),_=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((function(t,n){r._writeGeometry(t.geometry,y,_);var i=_;_+=s.elementCount(t.geometry.geometry),e.updateInstance(n,i,_),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Qt(g)),e.vao.vertexBuffers.geometry.setSubData(m,0,0,_*l),e.holes.clear();var T=e.holes.pushNew();return T.from=_,T.to=Math.floor(e.vao.size/u),e.updateDrawCommands(u),e}},{key:"_applyRemoves",value:function(e,t){if(0!==t.changes.length){var n,r=(0,f.Z)(t.changes);try{for(r.s();!(n=r.n()).done;){var i=n.value.id,a=e.instances.get(i);if(a){e.deleteInstance(i);var o=Gt.back();if(o){if(o.to===a.from){o.to=a.to;continue}if(o.from===a.to){o.from=a.from;continue}}var s=Gt.pushNew();s.from=a.from,s.to=a.to}}}catch(h){r.e(h)}finally{r.f()}Ot(Gt);var u=this._bufferWriter.vertexBufferLayout.stride/4,l=Gt.reduce((function(e,t){return Math.max(e,t.numElements)}),0)*u,c=$t(l);c.fill(0,0,l);var d=e.vao.vertexBuffers.geometry;Gt.forAll((function(e){return d.setSubData(c,e.from*u,0,e.numElements*u)})),e.holes.pushArray(Gt.data,Gt.length),Gt.forAll((function(e,t){return Gt.data[t]=null})),Gt.clear(),e.drawCommandsDirty=!0}}},{key:"_applyAdds",value:function(e,t){var n=this;if(0!==t.length)if(function(e){return(0,x.pC)(e.vao)}(e)){var r=this._bufferWriter,i=r.vertexBufferLayout.stride/4,a=e.numElements,o=t.reduce((function(e,t){return e+r.elementCount(t.geometry)}),0),s=Math.min((a+o)*i,Xt),u=4*s;if(e.vao.size<Qt(Xt-Bt)&&u>e.vao.size)this._applyAndRebuild(e,t,null);else{Ot(e.holes);var l,c=new Array,d=(0,f.Z)(t);try{for(d.s();!(l=d.n()).done;){var h=l.value,p=r.elementCount(h.geometry),v=Ut(e.holes,p);c.push(v)}}catch(S){d.e(S)}finally{d.f()}var g=e.vao.vertexBuffers.geometry,m=0,y=0,_=0,T=$t(s),w=r.vertexBufferLayout.createView(T.buffer);t.forEach((function(t,a){var o=c[a];if(!(0,x.Wi)(o)){if(_!==o){var s=_-y;s>0&&g.setSubData(T,y*i,0,s*i),y=o,m=0}var u=r.elementCount(t.geometry);n._writeGeometry(t,w,m),m+=u,_=o+u;var l=new At(t,o,o+u);(0,se.hu)(null==e.instances.get(t.id)),e.addInstance(t.id,l),e.drawCommandsDirty=!0}}));var C=_-y;C>0&&g.setSubData(T,y*i,0,C*i),(0,P.hv)(t,(function(e,t){return(0,x.Wi)(c[t])}))}}else this._applyAndRebuild(e,t,null)}},{key:"_writeGeometry",value:function(e,t,n){var r=e.localOrigin.vec3;(0,se.u_)(jt,-r[0],-r[1],-r[2]);var i=(0,D.m)(Vt,jt,e.transformation);(0,D.a)(Wt,i),(0,D.t)(Wt,Wt),this._bufferWriter.write(i,Wt,e.geometry,t,n)}},{key:"updateAnimation",value:function(e){return this.material.update(e)}},{key:"requiresSlot",value:function(e,t){return this.material.requiresSlot(e,t)}},{key:"render",value:function(e,t){var n,r=this;if(!this.requiresSlot(t.slot,e))return!1;var i=e===J.H.Highlight||e===J.H.ShadowHighlight;if(i&&!this._hasHighlights)return!1;var a,o=e===J.H.ShadowExcludeHighlight,s=!(i||o),u=this._rctx,l=function(){if((0,x.pC)(a))return a;var n=r._glMaterials.load(u,t.slot,e);return(0,x.Wi)(n)?null:(a=n.beginSlot(t),(0,x.Wi)(a)?null:(u.bindTechnique(a,r.material.parameters,t),a))};null===(n=this._appleAmdDriverHelper)||void 0===n||n.resetIndicesType();var c,d=(0,f.Z)(this._dataByOrigin.values());try{for(d.s();!(c=d.n()).done;){var h,p=c.value,v=(0,f.Z)(p.buffers);try{var g=function(){var e=h.value;if(i&&!e.hasHighlights)return"continue";var n=(i?e.drawCommandsHighlight:o&&e.needsMultipleCommands()?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,a=s&&e.drawCommandsOccludees||null;if(null!==n&&void 0!==n&&n.length||null!==a&&void 0!==a&&a.length){var c=l();if((0,x.Wi)(c))return{v:!1};c.program.bindDraw(new St(p.origin),t,r.material.parameters),c.ensureAttributeLocations(e.vao),u.bindVAO(e.vao),null!==n&&void 0!==n&&n.length&&(c.bindPipelineState(u,t.slot,!1),n.forAll((function(e){return u.drawArrays(c.primitiveType,e.first,e.count)}))),(null===a||void 0===a?void 0:a.length)&&(c.bindPipelineState(u,t.slot,!0),a.forAll((function(e){return u.drawArrays(c.primitiveType,e.first,e.count)})))}};for(v.s();!(h=v.n()).done;){var m=g();if("continue"!==m&&"object"===typeof m)return m.v}}catch(y){v.e(y)}finally{v.f()}}}catch(y){d.e(y)}finally{d.f()}return(0,x.pC)(a)}},{key:"test",get:function(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}]),e}(),zt=(0,g.Z)((function e(t){(0,v.Z)(this,e),this.origin=t,this.changes=new Array}));function Ut(e,t){var n;if(!e.some((function(e){return!(e.numElements<t)&&(n=e,!0)})))return null;var r=n.from;return n.from+=t,n.from>=n.to&&e.removeUnordered(n),r}var jt=(0,Oe.c)(),Vt=(0,Oe.c)(),Wt=(0,Oe.c)(),Gt=new b.Z({allocator:function(e){return e||new bt},deallocator:null}),Bt=65536,qt=4*Bt,Jt=16777216,Xt=Jt/4,Yt=new Float32Array(Bt);function $t(e){return Yt.length<e&&(Yt=new Float32Array(e)),Yt}function Qt(e){var t=4*e;return t<qt?qt:Math.max(Math.min(Math.ceil(1.5*t/qt)*qt,Jt),t)}var Kt=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this,e))._pending=new en,r._changes=new ft,r._materialRenderers=new Map,r._sortedMaterialRenderers=new b.Z,r._geometries=new Map,r._hasHighlights=!1,r._hasWater=!1,r}return(0,g.Z)(n,[{key:"destroy",value:function(){this._changes.prune(),this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}},{key:"updating",get:function(){return!this._pending.empty||this._changes.updates.length>0}},{key:"rctx",get:function(){return this.rendererContext.rctx}},{key:"_materialRepository",get:function(){return this.rendererContext.materialRepository}},{key:"_localOriginFactory",get:function(){return this.rendererContext.localOriginFactory}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return(0,S.oE)(this._materialRenderers,(function(e){return e.rendersOccluded}))}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}},{key:"commitChanges",value:function(){var e=this;if(!this.updating)return!1;this._processAddsRemoves();var t=function(e){var t=new Map,n=function(e){var n=t.get(e);return n||(n=new vt,t.set(e,n)),n};return e.removes.forAll((function(e){yt(e)&&n(e.material).removes.push(e)})),e.adds.forAll((function(e){yt(e)&&n(e.material).adds.push(e)})),e.updates.forAll((function(e){yt(e.renderGeometry)&&n(e.renderGeometry.material).updates.push(e)})),t}(this._changes),n=!1,r=!1,i=!1;return t.forEach((function(t,a){var o=e._materialRenderers.get(a);if(!o&&t.adds.length>0&&(o=new Ft(e.rctx,e._materialRepository,a),e._materialRenderers.set(a,o),n=!0,r=!0,i=!0),o){var s=r||o.hasHighlights,u=i||o.hasWater;o.modify(t),r=r||s!==o.hasHighlights,i=i||u!==o.hasWater,o.isEmpty&&(e._materialRenderers.delete(a),o.dispose(),n=!0)}})),this._changes.clear(),n&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=(0,S.oE)(this._materialRenderers,(function(e){return e.hasHighlights}))),i&&(this._hasWater=(0,S.oE)(this._materialRenderers,(function(e){return e.hasWater}))),this.notifyChange("updating"),!0}},{key:"addGeometries",value:function(e,t){if(0!==e.length){var n,r=this._validateRenderGeometries(e),i=(0,f.Z)(r);try{for(i.s();!(n=i.n()).done;){var a=n.value;this._geometries.set(a.id,a)}}catch(c){i.e(c)}finally{i.f()}var o,s=this._pending.empty,u=(0,f.Z)(r);try{for(u.s();!(o=u.n()).done;){var l=o.value;this._pending.adds.add(l)}}catch(c){u.e(c)}finally{u.f()}s&&this.notifyChange("updating"),t===mt.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}}},{key:"removeGeometries",value:function(e,t){var n,r=this._pending.empty,i=this._pending.adds,a=(0,f.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;i.has(o)?(this._pending.removed.add(o),i.delete(o)):this._pending.removed.has(o)||this._pending.removes.add(o),this._geometries.delete((0,x.Wg)(o.id))}}catch(s){a.e(s)}finally{a.f()}r&&!this._pending.empty&&this.notifyChange("updating"),t===mt.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}},{key:"modifyGeometries",value:function(e,t){var n,r=0===this._changes.updates.length,i=(0,f.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=this._changes.updates.pushNew();o.renderGeometry=this._validateRenderGeometry(a),o.updateType=t}}catch(s){i.e(s)}finally{i.f()}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case mt.$.TRANSFORMATION:case mt.$.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case mt.$.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}},{key:"updateAnimation",value:function(e){var t=!1;return this._sortedMaterialRenderers.forAll((function(n){return t=n.updateAnimation(e)||t})),t}},{key:"render",value:function(e){this._sortedMaterialRenderers.forAll((function(t){t.material.shouldRender(e)&&t.render(e.output,e.bindParameters)}))}},{key:"intersect",value:function(e,t,n,r,i){var a=this;return this._geometries.forEach((function(o){if(!r||r(o)){a._intersectRenderGeometry(o,n,t,0,e,i);var s=a.rendererContext.longitudeCyclical;s&&(o.boundingSphere[0]-o.boundingSphere[3]<s.min&&a._intersectRenderGeometry(o,n,t,s.range,e,i),o.boundingSphere[0]+o.boundingSphere[3]>s.max&&a._intersectRenderGeometry(o,n,t,-s.range,e,i)),i++}})),i}},{key:"_updateSortedMaterialRenderers",value:function(){var e=this;this._sortedMaterialRenderers.clear();var t=0;this._materialRenderers.forEach((function(n,r){r.insertOrder=t++,e._sortedMaterialRenderers.push(n)})),this._sortedMaterialRenderers.sort((function(e,t){var n=t.material.renderPriority-e.material.renderPriority;return 0!==n?n:e.material.insertOrder-t.material.insertOrder}))}},{key:"_processAddsRemoves",value:function(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(var e=0;e<this._changes.updates.length;){var t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}},{key:"_intersectRenderGeometry",value:function(e,t,n,r,i,a){if(e.visible){var o;r+=e.transformation[12],o=e.transformation[13],tn[0]=n[0]-r,tn[1]=n[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,i,tn,(function(n,r,o){!function(e,t,n,r,i,a,o){var s=new ht(a,o,t),u=function(t){t.set(ct.q7.OVERLAY,s,e.dist,e.normal,e.transformation,n,r)};if((null==i.results.min.drapedLayerOrder||n>=i.results.min.drapedLayerOrder)&&(null==i.results.min.dist||i.results.ground.dist<=i.results.min.dist)&&u(i.results.min),i.options.store!==ct.eC.MIN&&(null==i.results.max.drapedLayerOrder||n<i.results.max.drapedLayerOrder)&&(null==i.results.max.dist||i.results.ground.dist>i.results.max.dist)&&u(i.results.max),i.options.store===ct.eC.ALL){var l=(0,gt.LP)(i.ray);u(l),i.results.all.push(l)}}(t,o,e.material.renderPriority,a,i,e.layerUid,e.graphicUid)}),t)}}},{key:"_notifyGraphicGeometryChanged",value:function(e){if(!(0,x.Wi)(this.drapeSource.notifyGraphicGeometryChanged)){var t,n,r=(0,f.Z)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value.graphicUid;(0,x.pC)(i)&&i!==t&&(this.drapeSource.notifyGraphicGeometryChanged(i),t=i)}}catch(a){r.e(a)}finally{r.f()}}}},{key:"_notifyGraphicVisibilityChanged",value:function(e){if(!(0,x.Wi)(this.drapeSource.notifyGraphicVisibilityChanged)){var t,n,r=(0,f.Z)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value.graphicUid;(0,x.pC)(i)&&i!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(i),t=i)}}catch(a){r.e(a)}finally{r.f()}}}},{key:"_validateRenderGeometries",value:function(e){var t,n=(0,f.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._validateRenderGeometry(r)}}catch(i){n.e(i)}finally{n.f()}return e}},{key:"_validateRenderGeometry",value:function(e){return(0,x.Wi)(e.localOrigin)&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]),n}(T.Z);(0,_._)([(0,R.Cb)()],Kt.prototype,"drapeSource",void 0),(0,_._)([(0,R.Cb)()],Kt.prototype,"updating",null),(0,_._)([(0,R.Cb)()],Kt.prototype,"rctx",null),(0,_._)([(0,R.Cb)()],Kt.prototype,"rendererContext",void 0),(0,_._)([(0,R.Cb)()],Kt.prototype,"_materialRepository",null),(0,_._)([(0,R.Cb)()],Kt.prototype,"_localOriginFactory",null),(0,_._)([(0,R.Cb)({readOnly:!0})],Kt.prototype,"isEmpty",null),(0,_._)([(0,R.Cb)()],Kt.prototype,"_materialRenderers",void 0),(0,_._)([(0,R.Cb)()],Kt.prototype,"_geometries",void 0),Kt=(0,_._)([(0,E.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Kt);var en=function(){function e(){(0,v.Z)(this,e),this.adds=new Set,this.removes=new Set,this.removed=new Set}return(0,g.Z)(e,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}},{key:"has",value:function(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}},{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}]),e}();var tn=(0,fe.a)(),nn=n(71568),rn=n(82144),an=n(31132),on=n(7566),sn=n(27627),un=n(36207),ln=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,g.Z)(n,[{key:"initializeProgram",value:function(e){return new sn.$(e.rctx,n.shader.get().build(),on.i)}},{key:"initializePipeline",value:function(){return this.configuration.hasAlpha?(0,un.sm)({blending:(0,un.wK)(W.zi.SRC_ALPHA,W.zi.ONE,W.zi.ONE_MINUS_SRC_ALPHA,W.zi.ONE_MINUS_SRC_ALPHA),colorWrite:un.BK}):(0,un.sm)({colorWrite:un.BK})}}]),n}(an.A);ln.shader=new rn.J(Q.a,(function(){return n.e(7026).then(n.bind(n,77026))}));var cn=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.apply(this,arguments)).hasAlpha=!1,e}return(0,g.Z)(n)}(ee.m);(0,_._)([(0,ee.o)()],cn.prototype,"hasAlpha",void 0);var dn=n(78485),hn=n(11954),fn=n(82031),pn=n(78307),vn=function(e){(0,m.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this,e))._overlays=null,r._overlayRenderTarget=null,r._hasHighlights=!1,r._rendersOccluded=!1,r._hasWater=!1,r._handles=new C.Z,r._renderers=new Map,r._sortedDrapeSourceRenderersDirty=!1,r._sortedRenderers=new b.Z,r._passParameters=new Q.T,r._rctx=null,r._materialRepository=null,r._screenToWorldRatio=1,r._localOriginFactory=null,r._camera=new ae.V,r.worldToPCSRatio=1,r.events=new w.Z,r.longitudeCyclical=null,r}return(0,g.Z)(n,[{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},{key:"rctx",get:function(){return this._rctx}},{key:"materialRepository",get:function(){return this._materialRepository}},{key:"screenToWorldRatio",get:function(){return this._screenToWorldRatio}},{key:"localOriginFactory",get:function(){return this._localOriginFactory}},{key:"initialize",value:function(){var e=this,t=this.view._stage.renderView;this._rctx=t.renderingContext;var n=t.waterTextureRepository;this._stippleTextureRepository=new fn.h0(t.renderingContext),this._shaderTechniqueRepository=new te({rctx:this._rctx,viewingMode:Z.JY.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:n}),this._renderContext=new Ce(this._rctx,new Le(this._rctx,this.view.state.viewingMode),new nn.L(this.view,this._shaderTechniqueRepository,this._rctx,(function(){}))),this._handles.add([(0,O.YP)((function(){return n.updating}),(function(){return e.events.emit("content-changed")}),O.tX),(0,O.YP)((function(){return e.spatialReference}),(function(t){return e._localOriginFactory=new de.C(t)}),O.tX),(0,O.on)((function(){return e.view.allLayerViews}),"after-changes",(function(){return e._sortedDrapeSourceRenderersDirty=!0}))]),this._materialRepository=new ue(t.textureRepository,this._shaderTechniqueRepository,(function(t){(t.renderOccluded&_n)>0!==e._rendersOccluded&&e._updateRendersOccluded(),e.events.emit("content-changed"),e.notifyChange("updating"),e.notifyChange("isEmpty")}),(function(){return e.events.emit("content-changed")})),this._bindParameters.slot=ye.r.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=(0,ce.hf)(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=_e.A.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new hn.Mi((0,M.f)(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(pn.T8.STAGE,this))}},{key:"destroy",value:function(){this._handles.destroy(),this._renderers.forEach((function(e){return e.destroy()})),this._renderers.clear(),this._debugTextureTechnique=(0,x.RY)(this._debugTextureTechnique),this._passParameters.texture=(0,x.M2)(this._passParameters.texture),this._bindParameters.highlightDepthTexture=(0,x.M2)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=(0,x.SC)(this._shaderTechniqueRepository),this._temporaryFBO=(0,x.M2)(this._temporaryFBO),this._quadVAO=(0,x.M2)(this._quadVAO),this.disposeOverlays()}},{key:"updating",get:function(){return this._sortedDrapeSourceRenderersDirty||(0,S.oE)(this._renderers,(function(e){return e.updating}))}},{key:"hasOverlays",get:function(){return(0,x.pC)(this._overlays)&&(0,x.pC)(this._overlayRenderTarget)}},{key:"gpuMemoryUsage",get:function(){return(0,x.pC)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"createGeometryDrapeSourceRenderer",value:function(e){return this.createDrapeSourceRenderer(e,Kt)}},{key:"createDrapeSourceRenderer",value:function(e,t,n){var r=this,i=this._renderers.get(e);(0,x.pC)(i)&&i.destroy();var a=new t((0,p.Z)((0,p.Z)({},n),{},{rendererContext:this,drapeSource:e}));return this._renderers.set(e,a),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add((0,O.YP)((function(){return e.fullOpacity}),(function(){return r.events.emit("content-changed")})),e),a}},{key:"removeDrapeSourceRenderer",value:function(e){if(!(0,x.Wi)(e)){var t=this._renderers.get(e);(0,x.Wi)(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),t.destroy())}}},{key:"collectUnusedRenderTargetMemory",value:function(e){var t=!1;if((0,x.pC)(this._overlayRenderTarget)){var n,r=(0,f.Z)(this._overlayRenderTarget.renderTargets);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=(0,h.Z)(this.overlays,2),o=a[0],s=a[1],u=o.validTargets[i.type]||!s.validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(u,i,e)||t}}catch(l){r.e(l)}finally{r.f()}}return t}},{key:"overlays",get:function(){return(0,x.Pt)(this._overlays,[])}},{key:"ensureDrapeTargets",value:function(e){(0,x.pC)(this._overlays)&&this._overlays.forEach((function(t){return t.hasTargetWithoutRasterImage=(0,A.f)(e,(function(e){return e.drapeTargetType===L.al.WithoutRasterImage}))}))}},{key:"ensureDrapeSources",value:function(e){(0,x.pC)(this._overlays)&&this._overlays.forEach((function(t){t.hasDrapedFeatureSource=(0,A.f)(e,(function(e){return e.drapeSourceType===L.Lw.Features})),t.hasDrapedRasterSource=(0,A.f)(e,(function(e){return e.drapeSourceType===L.Lw.RasterImage}))}))}},{key:"ensureOverlays",value:function(e,t){(0,x.Wi)(this._overlays)&&(this._overlayRenderTarget=new Y(this._rctx),this._overlays=[new U(r.INNER,this._overlayRenderTarget),new U(r.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}},{key:"disposeOverlays",value:function(){this._overlays=null,this._overlayRenderTarget=(0,x.M2)(this._overlayRenderTarget),this.events.emit("textures-disposed")}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){this._processDrapeSources(e,(function(){return!0}))}},{key:"_processDrapeSources",value:function(e,t){var n,r=!1,i=(0,f.Z)(this._renderers);try{for(i.s();!(n=i.n()).done;){var a=(0,h.Z)(n.value,2),o=a[0],s=a[1];if(e.done)break;(o.destroyed||t(o))&&s.commitChanges()&&(r=!0,e.madeProgress())}}catch(u){i.e(u)}finally{i.f()}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&((0,x.pC)(this._overlays)&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}},{key:"processSyncDrapeSources",value:function(){this._processDrapeSources(pn.G5,(function(e){return e.updatePolicy===dn.j.SYNC}))}},{key:"isEmpty",get:function(){return!k.Z.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,S.oE)(this._renderers,(function(e){return!e.isEmpty}))}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"updateAnimation",value:function(e){var t=!1;return this._renderers.forEach((function(n){return t=n.updateAnimation(e)||t})),t}},{key:"updateDrapeSourceOrder",value:function(){this._sortedDrapeSourceRenderersDirty=!0}},{key:"drawTarget",value:function(e,t,n){var i=this,a=e.canvasGeometries;if(0===a.numViews)return!1;this._screenToWorldRatio=n*e.mapUnitsPerPixel;var o=t.output;if(this.isEmpty||o===J.H.Highlight&&!this.hasHighlights||o===J.H.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;var u=t.fbo;if(!u.isValid())return!1;var l=2*e.resolution,c=e.resolution;u.resize(l,c);var d=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*n,this._renderContext.output=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=o===J.H.Normal?ye.r.DRAPED_WATER:ye.r.DRAPED_MATERIAL,e.applyViewport(this._rctx),u.bind(d),e.index===r.INNER&&(d.setClearColor(0,0,0,0),d.clearSafe(W.lk.COLOR_BUFFER_BIT)),t.type===s.Occluded&&(this._renderContext.renderOccludedMask=_n),k.Z.OVERLAY_DRAW_DEBUG_TEXTURE&&t.type!==s.Occluded)for(var h=0;h<a.numViews;h++)this._setViewParameters(a.extents[h],e),this._drawDebugTexture(e.resolution,mn[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll((function(n){var r=n.drapeSource,h=n.renderer;if(t.type!==s.ColorNoRasterImage||r.drapeSourceType!==L.Lw.RasterImage){var f=r.fullOpacity,p=(0,x.pC)(f)&&f<1&&o===J.H.Color;p&&(i.bindTemporaryFramebuffer(i._rctx,l,c),d.clearSafe(W.lk.COLOR_BUFFER_BIT));for(var v=0;v<a.numViews;v++)i._setViewParameters(a.extents[v],e),h.render(i._renderContext);p&&(0,x.pC)(i._temporaryFBO)&&(u.bind(d),i.view._stage.renderView.compositingHelper.compositeOverlay(i._renderContext.bindParameters,i._temporaryFBO.getTexture(),f,e.index))}})),d.bindFramebuffer(null),u.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}},{key:"bindTemporaryFramebuffer",value:function(e,t,n){(0,x.Wi)(this._temporaryFBO)&&(this._temporaryFBO=new B(e,!1)),this._temporaryFBO.resize(t,n),this._temporaryFBO.bind(e)}},{key:"reloadShaders",value:function(){var e=(0,d.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._shaderTechniqueRepository.reloadAll();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyContentChanged",value:function(){this.events.emit("content-changed")}},{key:"intersect",value:function(e,t,n,r){var i,a=0,o=(0,f.Z)(this._renderers.values());try{for(o.s();!(i=o.n()).done;){var s,u,l=i.value;a=null!==(s=null===(u=l.intersect)||void 0===u?void 0:u.call(l,e,t,n,r,a))&&void 0!==s?s:a}}catch(c){o.e(c)}finally{o.f()}}},{key:"_updateSortedDrapeSourceRenderers",value:function(){var e=this;if(this._sortedRenderers.clear(),0!==this._renderers.size){var t=this.view.map.allLayers;this._renderers.forEach((function(n,r){var i,a=t.indexOf(r.layer),o=a>=0,s=e._renderers.size*(null!==(i=r.renderGroup)&&void 0!==i?i:o?L.eZ.MapLayer:L.eZ.ViewLayer)+(o?a:0);e._sortedRenderers.push(new gn(r,n,s))})),this._sortedRenderers.sort((function(e,t){return e.index-t.index}))}}},{key:"_setViewParameters",value:function(e,t){var n=this._camera;n.viewport=[0,0,t.resolution,t.resolution],(0,D.x)(n.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],n.near,n.far),(0,D.f)(n.viewMatrix,[-e[0],-e[1],0])}},{key:"_updateHasWater",value:function(){var e=(0,S.oE)(this._renderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}},{key:"_updateHasHighlights",value:function(){var e=(0,S.oE)(this._renderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}},{key:"_updateRendersOccluded",value:function(){var e=(0,S.oE)(this._renderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}},{key:"_drawDebugTexture",value:function(e,t){this._ensureDebugPatternResources(e,e,t);var n=this._rctx;n.bindTechnique(this._debugTextureTechnique,this._passParameters,null),n.bindVAO(this._quadVAO),n.drawArrays(W.MX.TRIANGLE_STRIP,0,(0,Me._V)(this._quadVAO,"geometry"))}},{key:"_ensureDebugPatternResources",value:function(e,t,n){if((0,I.s)(this._passParameters.color,n[0],n[1],n[2]),!this._passParameters.texture){for(var r=new Uint8Array(e*t*4),i=0,a=0;a<t;a++)for(var o=0;o<e;o++){var s=Math.floor(o/10),u=Math.floor(a/10);s<2||u<2||10*s>e-20||10*u>t-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&s&&1&u?1&o^1&a?0:255:1&s^1&u?0:128)}this._passParameters.texture=new Ie.x(this._rctx,{target:W.No.TEXTURE_2D,pixelFormat:W.VI.RGBA,dataType:W.Br.UNSIGNED_BYTE,samplingMode:W.cw.NEAREST,width:e,height:t},r);var l=new cn;l.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(ln,l),this._quadVAO=(0,ce.ow)(this._rctx)}}},{key:"test",get:function(){var e=this;return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:function(t){return e._renderers.get(t)}}}}]),n}(T.Z);(0,_._)([(0,R.Cb)()],vn.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,_._)([(0,R.Cb)({autoDestroy:!0})],vn.prototype,"_shaderTechniqueRepository",void 0),(0,_._)([(0,R.Cb)({autoDestroy:!0})],vn.prototype,"_stippleTextureRepository",void 0),(0,_._)([(0,R.Cb)({constructOnly:!0})],vn.prototype,"view",void 0),(0,_._)([(0,R.Cb)()],vn.prototype,"worldToPCSRatio",void 0),(0,_._)([(0,R.Cb)()],vn.prototype,"spatialReference",void 0),(0,_._)([(0,R.Cb)({type:Boolean,readOnly:!0})],vn.prototype,"updating",null),(0,_._)([(0,R.Cb)()],vn.prototype,"isEmpty",null),vn=(0,_._)([(0,E.j)("esri.views.3d.terrain.OverlayRenderer")],vn);var gn=(0,g.Z)((function e(t,n,r){(0,v.Z)(this,e),this.drapeSource=t,this.renderer=n,this.index=r})),mn=[[1,.5,.5],[.5,.5,1]],yn=-2,_n=he.yD.OccludeAndTransparent},48353:function(e,t,n){n.d(t,{U:function(){return y}});var r,i,a,o,s,u,l=n(30168),c=n(49450),d=n(59150),h=n(58406),f=n(699),p=n(98634),v=n(4760),g=n(65964),m=8;function y(e,t){var n=e.vertex;n.uniforms.add(new h.p("intrinsicWidth",(function(e){return e.width}))),t.vvSize?(e.attributes.add(v.T.SIZEFEATUREATTRIBUTE,"float"),n.uniforms.add(new c.J("vvSizeMinSize",(function(e){return e.vvSizeMinSize}))),n.uniforms.add(new c.J("vvSizeMaxSize",(function(e){return e.vvSizeMaxSize}))),n.uniforms.add(new c.J("vvSizeOffset",(function(e){return e.vvSizeOffset}))),n.uniforms.add(new c.J("vvSizeFactor",(function(e){return e.vvSizeFactor}))),n.code.add((0,p.H)(r||(r=(0,l.Z)(["float getSize() {\nreturn intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n}"]))))):(e.attributes.add(v.T.SIZE,"float"),n.code.add((0,p.H)(i||(i=(0,l.Z)(["float getSize(){\nreturn intrinsicWidth * size;\n}"]))))),t.vvOpacity?(e.attributes.add(v.T.OPACITYFEATUREATTRIBUTE,"float"),n.constants.add("vvOpacityNumber","int",8),n.uniforms.add([new f.O("vvOpacityValues",(function(e){return e.vvOpacityValues}),m),new f.O("vvOpacityOpacities",(function(e){return e.vvOpacityOpacities}),m)]),n.code.add((0,p.H)(a||(a=(0,l.Z)(["float interpolateOpacity( float value ){\nif (value <= vvOpacityValues[0]) {\nreturn vvOpacityOpacities[0];\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n}\n}\nreturn vvOpacityOpacities[vvOpacityNumber - 1];\n}\nvec4 applyOpacity( vec4 color ){\nreturn vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n}"]))))):n.code.add((0,p.H)(o||(o=(0,l.Z)(["vec4 applyOpacity( vec4 color ){\nreturn color;\n}"])))),t.vvColor?(e.attributes.add(v.T.COLORFEATUREATTRIBUTE,"float"),n.constants.add("vvColorNumber","int",g.x),n.uniforms.add(new f.O("vvColorValues",(function(e){return e.vvColorValues}),g.x)),n.uniforms.add(new d.b("vvColorColors",(function(e){return e.vvColorColors}),g.x)),n.code.add((0,p.H)(s||(s=(0,l.Z)(["vec4 interpolateColor( float value ) {\nif (value <= vvColorValues[0]) {\nreturn vvColorColors[0];\n}\nfor (int i = 1; i < vvColorNumber; ++i) {\nif (vvColorValues[i] >= value) {\nfloat f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\nreturn mix(vvColorColors[i-1], vvColorColors[i], f);\n}\n}\nreturn vvColorColors[vvColorNumber - 1];\n}\nvec4 getColor(){\nreturn applyOpacity(interpolateColor(colorFeatureAttribute));\n}"]))))):(e.attributes.add(v.T.COLOR,"vec4"),n.code.add((0,p.H)(u||(u=(0,l.Z)(["vec4 getColor(){\nreturn applyOpacity(color);\n}"])))))}},28156:function(e,t,n){n.d(t,{H:function(){return s}});var r,i,a=n(30168),o=n(98634);function s(e){var t=(0,o.H)(r||(r=(0,a.Z)(["vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"]))),n=(0,o.H)(i||(i=(0,a.Z)(["vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"])));e.vertex.code.add(t),e.vertex.code.add(n),e.fragment.code.add(t),e.fragment.code.add(n)}},50600:function(e,t,n){n.d(t,{R:function(){return w},d:function(){return f}});var r,i=n(30168),a=n(49223);!function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(r||(r={}));var o,s,u,l,c,d,h,f,p=n(62993),v=n(82552),g=n(95276),m=n(58406),y=n(98634),_=n(19253),T=n(4760);function w(e,t){e.include(p.cK),e.attributes.add(T.T.POSITION,"vec3"),e.attributes.add(T.T.NORMAL,"vec3"),e.attributes.add(T.T.AUXPOS1,"vec4");var n=e.vertex;(0,v.Sv)(n,t),(0,v.hY)(n,t),n.uniforms.add([new g.N("viewport",(function(e,t){return t.camera.fullViewport})),new m.p("polygonOffset",(function(e){return e.shaderPolygonOffset})),new m.p("cameraGroundRelative",(function(e,t){return t.camera.aboveGround?1:-1})),new m.p("renderTransparentlyOccludedHUD",(function(e,t){return t.renderTransparentlyOccludedHUD===r.Occluded?1:t.renderTransparentlyOccludedHUD===r.NotOccluded?0:.75})),new _.A("hudVisibilityTexture",(function(e,t){return t.hudVisibilityTexture}))]),t.hasVerticalOffset&&(0,a.V)(n),n.constants.add("smallOffsetAngle","float",.984807753012208),n.code.add((0,y.H)(o||(o=(0,i.Z)(["struct ProjectHUDAux {\nvec3 posModel;\nvec3 posView;\nvec3 vnormal;\nfloat distanceToCamera;\nfloat absCosAngle;\n};"])))),n.code.add((0,y.H)(s||(s=(0,i.Z)(["float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\nfloat pointGroundSign = sign(pointGroundDistance);\nif (pointGroundSign == 0.0) {\npointGroundSign = cameraGroundRelative;\n}\nfloat groundRelative = cameraGroundRelative * pointGroundSign;\nif (polygonOffset > .0) {\nfloat cosAlpha = clamp(absCosAngle, 0.01, 1.0);\nfloat tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\nfloat factor = (1.0 - tanAlpha / viewport[2]);\nif (groundRelative > 0.0) {\nposView *= factor;\n}\nelse {\nposView /= factor;\n}\n}\nreturn groundRelative;\n}"])))),t.isDraped&&!t.hasVerticalOffset||(0,v._8)(n),t.isDraped||(n.uniforms.add(new m.p("perDistancePixelRatio",(function(e,t){return Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)}))),n.code.add((0,y.H)(u||(u=(0,i.Z)(["void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\nfloat distanceToCamera = length(posView);\nfloat pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\nvec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\nvec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\nposModel += modelOffset;\nposView += viewOffset;\n}"]))))),t.screenCenterOffsetUnitsEnabled===f.Screen&&n.uniforms.add(new m.p("pixelRatio",(function(e,t){return t.camera.pixelRatio}))),t.hasScreenSizePerspective&&(0,p.m8)(n),n.code.add((0,y.H)(l||(l=(0,i.Z)(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n      ","\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);",t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===f.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.hasVerticalOffset?(0,y.H)(c||(c=(0,i.Z)(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",t.screenCenterOffsetUnitsEnabled!==f.Screen?(0,y.H)(d||(d=(0,i.Z)(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",t.screenCenterOffsetUnitsEnabled===f.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",t.screenCenterOffsetUnitsEnabled===f.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":"")),n.code.add((0,y.H)(h||(h=(0,i.Z)(["bool testVisibilityHUD(vec4 posProj) {\nvec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\nvec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\nif (renderTransparentlyOccludedHUD > 0.5) {\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;\n}\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n}"]))))}!function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"}(f||(f={}))},50913:function(e,t,n){n.d(t,{R:function(){return m}});var r,i,a,o,s=n(93433),u=n(30168),l=n(21002),c=n(43565),d=n(78980),h=n(75993),f=n(82999),p=n(98634),v=n(19253),g=n(97528);function m(e,t){var n=e.vertex,m=e.fragment;t.hasMultipassGeometry&&n.include(c.S),t.hasMultipassTerrain&&e.varyings.add("depth","float"),n.code.add((0,p.H)(r||(r=(0,u.Z)(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      ","\n\n      ","\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n\n    } else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])),t.hasMultipassGeometry?(0,p.H)(i||(i=(0,u.Z)(["\n        // Don't draw vertices behind geometry\n        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){\n          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n        }"]))):"",t.hasMultipassTerrain?"depth = projectAux.posView.z;":"")),t.hasMultipassTerrain&&m.include(l.S),t.hasMultipassTerrain&&m.uniforms.add([].concat((0,s.Z)((0,v.J)("terrainDepthTexture",(function(e,t){return t.multipassTerrain.linearDepthTexture}),t.hasWebGL2Context?g.D.None:g.D.InvSize)),[new f.A("nearFar",(function(e,t){return t.camera.nearFar}))])),m.include(d.n),m.code.add((0,p.H)(a||(a=(0,u.Z)(["\n  void main() {\n    gl_FragColor = vec4(1, 1, 1, 1);\n    ","\n  }\n  "])),t.hasMultipassTerrain?(0,p.H)(o||(o=(0,u.Z)(["\n          vec2 uv = gl_FragCoord.xy;\n\n          // Read the rgba data from the texture linear depth\n          vec4 terrainDepthData = ",";\n\n          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);\n\n          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)\n          // Mark the HUD vertex as occluded by transparent terrain\n          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){\n            gl_FragColor.g = 0.5;\n          }"])),(0,h.b6)(t,"terrainDepthTexture","uv")):""))}},7683:function(e,t,n){n.d(t,{E:function(){return u},K:function(){return s}});var r,i,a=n(30168),o=n(98634);function s(e){e.fragment.code.add((0,o.H)(r||(r=(0,a.Z)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function u(e){e.fragment.code.add((0,o.H)(i||(i=(0,a.Z)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},60300:function(e,t,n){n.d(t,{q:function(){return k},C:function(){return N}});var r=n(30168),i=n(92026),a=n(78980),o=n(82552),s=n(75993),u=n(95276),l=n(58406),c=n(98634),d=n(19253),h=n(97528),f=n(82031),p=n(90045),v=n(67077);function g(e){return(0,i.Wi)(e)?v.Z:4===e.length?e:(0,p.s)(L,e[0],e[1],e[2],1)}var m,y,_,T,w,C,S,x,b,O,A,R,P,E,D,I,M,Z,L=(0,v.c)();function k(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?H(e,t):function(e){e.fragment.code.add((0,c.H)(Z||(Z=(0,r.Z)(["float getStippleAlpha() { return 1.0; }\n#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n#define blendStipple(color, _stippleAlpha_) color"]))))}(e)}function H(e,t){var n=!(t.draped&&t.stipplePreferContinuous),p=e.vertex,v=e.fragment;v.include(a.n),t.draped||((0,o.hY)(p,t),p.uniforms.add(new l.p("worldToScreenPerDistanceRatio",(function(e,t){return 1/t.camera.perScreenPixelRatio}))),p.code.add((0,c.H)(m||(m=(0,r.Z)(["float computeWorldToScreenRatio(vec3 segmentCenter) {\nfloat segmentDistanceToCamera = length(segmentCenter - cameraPosition);\nreturn worldToScreenPerDistanceRatio / segmentDistanceToCamera;\n}"]))))),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),p.code.add((0,c.H)(y||(y=(0,r.Z)(["\n    float discretizeWorldToScreenRatio(float worldToScreenRatio) {\n      float step = ",";\n\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n      return discreteWorldToScreenRatio;\n    }\n  "])),F)),p.code.add((0,c.H)(_||(_=(0,r.Z)(["vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {"])))),p.code.add((0,c.H)(T||(T=(0,r.Z)(["\n    if (segmentLengthPseudoScreen >= ",") {\n  "])),n?"patternLength":"1e4")),p.uniforms.add(new l.p("pixelRatio",(function(e,t){return t.camera.pixelRatio}))),p.code.add((0,c.H)(w||(w=(0,r.Z)(["\n        // Round the screen length to get an integer number of pattern repetitions (minimum 1).\n        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);\n        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));\n        float segmentLengthScreenRounded = flooredRepetitions * patternLength;\n\n        ","\n\n        return vec2(0.0, segmentLengthScreenRounded);\n      }\n      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);\n    }\n  "])),t.stippleRequiresStretchMeasure?(0,c.H)(C||(C=(0,r.Z)(["\n              float stretch = repetitions / flooredRepetitions;\n\n              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.\n              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.\n              vStipplePatternStretch = max(0.75, stretch);"]))):"")),v.constants.add("stippleTexturePadding","float",f.it);var Z=t.hasWebGL2Context?h.D.None:h.D.Size;v.uniforms.add((0,d.J)("stipplePatternTexture",(function(e){return e.stippleTexture}),Z)),v.uniforms.add([new l.p("stipplePatternSDFNormalizer",(function(e){return function(e){return(0,i.pC)(e)?(Math.floor(.5*((0,f.kj)(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern)})),new l.p("stipplePatternPixelSizeInv",(function(e){return 1/N(e)}))]),v.code.add((0,c.H)(S||(S=(0,r.Z)(["\n    float padStippleTexture(float u) {\n      float paddedTextureSize = ",".x;\n      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;\n\n      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;\n    }\n  "])),(0,s.w_)(t,"stipplePatternTexture"))),v.code.add((0,c.H)(x||(x=(0,r.Z)(["\n    float getStippleSDF(out bool isClamped) {\n      ","\n\n      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;\n      ","\n      u = padStippleTexture(fract(u));\n\n      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));\n      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;\n\n      ","\n    }\n\n    float getStippleSDF() {\n      bool ignored;\n      return getStippleSDF(ignored);\n    }\n\n    float getStippleAlpha() {\n      bool isClamped;\n      float stippleSDF = getStippleSDF(isClamped);\n\n      float antiAliasedResult = ","\n\n      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;\n    }\n  "])),t.stippleRequiresClamp?(0,c.H)(b||(b=(0,r.Z)(["\n          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);\n          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;\n          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;"]))):(0,c.H)(O||(O=(0,r.Z)(["\n          float stippleDistanceClamped = vStippleDistance;\n          isClamped = false;"]))),t.stippleScaleWithLineWidth?(0,c.H)(A||(A=(0,r.Z)(["u *= vLineSizeInv;"]))):"",t.stippleRequiresStretchMeasure?(0,c.H)(R||(R=(0,r.Z)(["return (sdf - 0.5) * vStipplePatternStretch + 0.5;"]))):(0,c.H)(P||(P=(0,r.Z)(["return sdf;"]))),t.stippleScaleWithLineWidth?(0,c.H)(E||(E=(0,r.Z)(["clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);"]))):(0,c.H)(D||(D=(0,r.Z)(["clamp(stippleSDF + 0.5, 0.0, 1.0);"]))))),t.stippleOffColorEnabled?(v.uniforms.add(new u.N("stippleOffColor",(function(e){return g(e.stippleOffColor)}))),v.code.add((0,c.H)(I||(I=(0,r.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) {}\n#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)"]))))):v.code.add((0,c.H)(M||(M=(0,r.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)"]))))}function N(e){var t=e.stipplePattern;return(0,i.pC)(t)?(0,f.$A)(e.stipplePattern)/t.pixelRatio:1}var F=c.H.float(.4)},40526:function(e,t,n){n.d(t,{Q:function(){return d}});var r,i,a=n(30168),o=n(92026),s=n(2522),u=n(58406),l=n(98634),c=n(33720);function d(e,t){var n=e.vertex;e.constants.add("markerSizePerLineWidth","float",s._Z),n.uniforms.add(new u.p("pixelRatio",(function(e,t){return t.camera.pixelRatio}))),(0,o.Wi)(n.uniforms.get("markerScale"))&&n.constants.add("markerScale","float",1),n.code.add((0,l.H)(r||(r=(0,a.Z)(["float getLineWidth() {\nreturn max(getSize(), 1.0) * pixelRatio;\n}\nfloat getScreenMarkerSize() {\nreturn markerSizePerLineWidth * markerScale * getLineWidth();\n}"])))),t.space===c.I9.World&&(n.constants.add("maxSegmentLengthFraction","float",.45),n.uniforms.add(new u.p("perRenderPixelRatio",(function(e,t){return t.camera.perRenderPixelRatio}))),n.code.add((0,l.H)(i||(i=(0,a.Z)(["float getWorldMarkerSize(vec4 pos) {\nfloat distanceToCamera = length(pos.xyz);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nreturn getScreenMarkerSize() * screenToWorldRatio;\n}\nbool areWorldMarkersHidden(vec4 pos, vec4 other) {\nvec3 midPoint = mix(pos.xyz, other.xyz, 0.5);\nfloat distanceToCamera = length(midPoint);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nfloat worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;\nfloat segmentLen = length(pos.xyz - other.xyz);\nreturn worldMarkerSize > maxSegmentLengthFraction * segmentLen;\n}"])))))}},43565:function(e,t,n){n.d(t,{S:function(){return d},_:function(){return h}});var r,i=n(43144),a=n(15671),o=n(30168),s=n(21002),u=n(82999),l=n(98634),c=n(19253);function d(e){e.include(s.S),e.uniforms.add([new c.A("geometryDepthTexture",(function(e,t){return t.multipassGeometry.linearDepthTexture})),new u.A("nearFar",(function(e,t){return t.camera.nearFar}))]),e.code.add((0,l.H)(r||(r=(0,o.Z)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}var h=(0,i.Z)((function e(){(0,a.Z)(this,e),this.enabled=!1}))},8555:function(e,t,n){n.d(t,{n:function(){return l}});var r,i,a,o,s=n(30168),u=n(98634);function l(e,t){t.spherical?e.vertex.code.add((0,u.H)(r||(r=(0,s.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn normalize(pos + origin);\n}"])))):e.vertex.code.add((0,u.H)(i||(i=(0,s.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn vec3(0.0, 0.0, 1.0);\n}"])))),t.spherical?e.vertex.code.add((0,u.H)(a||(a=(0,s.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"])))):e.vertex.code.add((0,u.H)(o||(o=(0,s.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = vec3(1.0, 0.0, 0.0);\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"]))))}},40854:function(e,t,n){n.d(t,{O:function(){return v},P:function(){return p}});var r,i=n(43144),a=n(15671),o=n(30168),s=n(81949),u=n(21002),l=n(82999),c=n(58406),d=n(98634),h=n(8654),f=n(19253);function p(e,t){var n=e.fragment;n.include(u.S),n.uniforms.add(new l.A("nearFar",(function(e,t){return t.camera.nearFar}))),n.uniforms.add(new f.A("depthMap",(function(e,t){return t.linearDepthTexture}))),n.uniforms.add(new h.g("proj",(function(e,t){return t.ssr.camera.projectionMatrix}))),n.uniforms.add(new c.p("invResolutionHeight",(function(e,t){return 1/t.ssr.camera.height}))),n.uniforms.add(new h.g("reprojectionMatrix",(function(e,t){return t.ssr.reprojectionMatrix}))),n.code.add((0,d.H)(r||(r=(0,o.Z)(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy * 0.5 + 0.5;\n  }\n\n  const int maxSteps = ",";\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n        return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150":"75"))}var v=(0,i.Z)((function e(){(0,a.Z)(this,e),this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=(0,s.c)()}))},77652:function(e,t,n){n.d(t,{B:function(){return G}});var r,i=n(30168),a=n(7683),o=n(98634);function s(e){e.fragment.code.add((0,o.H)(r||(r=(0,i.Z)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}var u,l,c,d,h,f,p,v,g=n(2116),m=n(40854),y=n(16889),_=n(92026),T=n(22186),w=n(91226),C=n(46208),S=n(92395),x=n(13773),b=n(49450),O=n(58406),A=n(8654),R=n(43144),P=n(15671),E=n(60136),D=n(29388),I=n(61809),M=n(99340),Z=function(e){(0,E.Z)(n,e);var t=(0,D.Z)(n);function n(e,r){return(0,P.Z)(this,n),t.call(this,e,"samplerCube",M.P.Pass,(function(t,n,i){return t.bindTexture(e,r(n,i))}))}return(0,R.Z)(n)}(I.x);function L(e){var t=e.fragment;t.uniforms.add([new A.g("rotationMatrixClouds",(function(e,t){return t.cloudsFade.parallax.transform})),new A.g("rotationMatrixCloudsCrossFade",(function(e,t){return t.cloudsFade.parallaxNew.transform})),new b.J("anchorPosition",(function(e,t){return t.cloudsFade.parallax.anchorPointClouds})),new b.J("anchorPositionCrossFade",(function(e,t){return t.cloudsFade.parallaxNew.anchorPointClouds})),new O.p("cloudsHeight",(function(e,t){return t.cloudsFade.parallax.cloudsHeight})),new O.p("radiusCurvatureCorrectionFactor",(function(e,t){return t.cloudsFade.parallax.radiusCurvatureCorrectionFactor})),new O.p("totalFadeInOut",(function(e,t){return t.cloudsFade.fadeInOut.stage===w.co.FINISHED?t.cloudsFade.fadeInOutHeight.factor+1-t.cloudsFade.fadeIn.factor:t.cloudsFade.fadeInOutHeight.factor+1-t.cloudsFade.fadeInOut.factor})),new O.p("crossFadeAnchorFactor",(function(e,t){return(0,y.uZ)(t.cloudsFade.crossFade.factor,0,1)})),new Z("cubeMap",(function(e,t){return(0,_.pC)(t.cloudsFade.data)&&(0,_.pC)(t.cloudsFade.data.cubeMap)?t.cloudsFade.data.cubeMap.colorTexture:null})),new x.U("crossFade",(function(e,t){return t.cloudsFade.crossFade.enabled})),new x.U("readChannelsRG",(function(e,t){return t.cloudsFade.readChannels===C.uz.RG})),new x.U("fadeTextureChannels",(function(e,t){return t.cloudsFade.renderingStage===C.jL.FADING_TEXTURE_CHANNELS}))]),t.constants.add("planetRadius","float",T.sv.radius),t.code.add((0,o.H)(u||(u=(0,i.Z)(["vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)\n{\nfloat radiusClouds = planetRadius + cloudsHeight;\nfloat B = 2.0 * dot(cameraPosition, dir);\nfloat C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;\nfloat det = B * B - 4.0 * C;\nfloat pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));\nvec3 intersectionPont = cameraPosition + dir * pointIntDist;\nintersectionPont =  intersectionPont - spherePos;\nreturn intersectionPont;\n}"])))),t.code.add((0,o.H)(l||(l=(0,i.Z)(["vec3 correctForPlanetCurvature(vec3 dir)\n{\ndir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;\nreturn dir;\n}"])))),t.code.add((0,o.H)(c||(c=(0,i.Z)(["vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)\n{\nreturn (rotMat * vec4(inVec, 0.0)).xyz;\n}"])))),(0,S.Pe)(t),(0,S.F1)(t),t.code.add((0,o.H)(d||(d=(0,i.Z)(["const float SUNSET_TRANSITION_FACTOR = 0.3;\nconst vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);\nconst float RIM_SCATTERING_FACTOR = 140.0;\nconst float BACKLIGHT_FACTOR = 0.2;\nconst float BACKLIGHT_SCATTERING_FACTOR = 10.0;\nconst float BACKLIGHT_TRANSITION_FACTOR = 0.3;\nvec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)\n{\nfloat upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));\nfloat dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);\nfloat sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);\nvec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);\nvec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);\nvec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));\nvec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));\nfloat scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);\nfloat rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);\nvec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;\nfloat additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;\nreturn vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);\n}"])))),t.code.add((0,o.H)(h||(h=(0,i.Z)(["vec4 getCloudData(vec3 rayDir, bool readOtherChannel)\n{\nvec4 cloudData = textureCube(cubeMap, rayDir);\nfloat mu = dot(rayDir, vec3(0, 0, 1));\nbool readChannels = readChannelsRG ^^ readOtherChannel;\nif (readChannels) {\ncloudData = vec4(vec3(cloudData.r), cloudData.g);\n} else {\ncloudData = vec4(vec3(cloudData.b), cloudData.a);\n}\nif (length(cloudData) == 0.0) {\nreturn vec4(cloudData.rgb, 1.0);\n}\nreturn cloudData;\n}"])))),t.code.add((0,o.H)(f||(f=(0,i.Z)(["vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nfloat totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudData.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);\n}"])))),t.code.add((0,o.H)(p||(p=(0,i.Z)(["vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nvec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\nintersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);\nworldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));\nworldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\ncloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);\nvec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\ncloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);\nfloat totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudColor.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(cloudColor.rgb, totalTransmittance);\n}"])))),t.code.add((0,o.H)(v||(v=(0,i.Z)(["vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)\n{\nreturn crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);\n}"]))))}var k,H,N,F,z,U,j,V,W=n(19253);function G(e,t){e.include(g.g,t),e.include(s),e.include(a.E),t.hasCloudsReflections&&e.include(L,t),t.hasScreenSpaceReflections&&e.include(m.P,t);var n=e.fragment;n.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),n.code.add((0,o.H)(k||(k=(0,i.Z)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),n.uniforms.add([new O.p("lightingSpecularStrength",(function(e,t){return t.lighting.mainLight.specularStrength})),new O.p("lightingEnvironmentStrength",(function(e,t){return t.lighting.mainLight.environmentStrength}))]),n.code.add((0,o.H)(H||(H=(0,i.Z)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {\nfloat reflectionHit = 0.0;\nfloat reflectionHitDiffused = 0.0;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}\nfloat correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);\nvec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);\nvec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));"])))),t.hasCloudsReflections&&n.code.add((0,o.H)(N||(N=(0,i.Z)(["vec4 cloudsColor = renderClouds(reflectedWorld, position);\ncloudsColor.a = 1.0 - cloudsColor.a;\ncloudsColor = pow(cloudsColor, vec4(GAMMA));\ncloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);"])))),t.hasScreenSpaceReflections?(n.uniforms.add([new A.g("view",(function(e,t){return t.ssr.camera.viewMatrix})),new W.A("lastFrameColorTexture",(function(e,t){return t.ssr.lastFrameColorTexture})),new O.p("fadeFactor",(function(e,t){return t.ssr.fadeFactor}))]),n.code.add((0,o.H)(F||(F=(0,i.Z)(["vec3 viewDir = normalize(viewPosition);\nvec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = view * vec4(localUp, 0.0);\nvec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));\nvec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);\nreflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactor;\nreflectionHitDiffused = waterDiffusion * reflectionHit;\nreflectedColor = linearizeGamma(texture2D(lastFrameColorTexture, reprojectedCoordinate).xyz) *\nreflectionHitDiffused * fresnelModifier.y * ssrIntensity;\n}\nfloat seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);\nvec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +\nreflSea * seaColorMod + specular + foam);"]))))):n.code.add((0,o.H)(z||(z=(0,i.Z)(["vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);"])))),t.hasCloudsReflections?t.hasScreenSpaceReflections?n.code.add((0,o.H)(U||(U=(0,i.Z)(["return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;\n}"])))):n.code.add((0,o.H)(j||(j=(0,i.Z)(["return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;\n}"])))):n.code.add((0,o.H)(V||(V=(0,i.Z)(["return waterRenderedColor;\n}"]))))}},79246:function(e,t,n){n.d(t,{M:function(){return y},U:function(){return _}});var r,i=n(43144),a=n(15671),o=n(60136),s=n(29388),u=n(30168),l=n(88396),c=n(6394),d=n(90045),h=n(67077),f=n(7683),p=n(82999),v=n(95276),g=n(98634),m=n(19253);function y(e){e.fragment.uniforms.add(new m.A("texWaveNormal",(function(e){return e.waveNormal}))),e.fragment.uniforms.add(new m.A("texWavePerturbation",(function(e){return e.wavePertubation}))),e.fragment.uniforms.add([new v.N("waveParams",(function(e){return(0,d.s)(T,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)})),new p.A("waveDirection",(function(e){return(0,l.s)(w,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity)}))]),e.include(f.K),e.fragment.code.add((0,g.H)(r||(r=(0,u.Z)(["const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\nvec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rg - 1.0;\n}\nfloat sampleNoiseTexture(vec2 _uv) {\nreturn texture2D(texWavePerturbation, _uv).b;\n}\nvec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n}\nfloat computeProgress(vec2 uv, float time) {\nreturn fract(time);\n}\nfloat computeWeight(vec2 uv, float time) {\nfloat progress = computeProgress(uv, time);\nreturn 1.0 - abs(1.0 - 2.0 * progress);\n}\nvec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\nfloat flowStrength = waveParams[2];\nfloat flowOffset = waveParams[3];\nvec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\nfloat progress = computeProgress(uv, time + phaseOffset);\nfloat weight = computeWeight(uv, time + phaseOffset);\nvec2 result = uv;\nresult -= flowVector * (progress + flowOffset);\nresult += phaseOffset;\nresult += (time - progress) * FLOW_JUMP;\nreturn vec3(result, weight);\n}\nconst float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\nconst float TIME_NOISE_STRENGTH = 7.77;\nvec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\nfloat waveStrength = waveParams[0];\nvec2 waveMovement = time * -_waveDir;\nfloat timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\nvec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\nvec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\nvec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\nvec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\nvec3 mixNormal = normalize(normal_A + normal_B);\nmixNormal.xy *= waveStrength;\nmixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\nreturn mixNormal;\n}\nvec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\nfloat waveTextureRepeat = waveParams[1];\nvec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\nfloat foam  = normals2FoamIntensity(normal, waveParams[0]);\nreturn vec4(normal, foam);\n}"]))))}var _=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n)}(g.K),T=(0,h.c)(),w=(0,c.a)()},86755:function(e,t,n){n.d(t,{V:function(){return A}});var r,i=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(27366),l=n(85015),c=n(32718),d=n(16889),h=n(17842),f=n(49861),p=(n(25243),n(63780),n(69912)),v=n(14226),g=n(81949),m=n(88396),y=n(6394),_=n(11186),T=n(71353),w=n(90045),C=n(67077),S=n(95773),x=n(40885),b=n(40927),O=n(50951);var A=r=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.Z)(this,n),(e=t.call(this,r))._center=(0,T.c)(),e._up=(0,T.c)(),e._viewUp=(0,T.c)(),e._viewForward=(0,T.c)(),e._viewRight=(0,T.c)(),e._ray=(0,x.Ue)(),e._viewport=(0,C.f)(0,0,1,1),e._padding=(0,C.f)(0,0,0,0),e._fov=55/180*Math.PI,e._nearFar=(0,y.f)(1,1e3),e._viewDirty=!0,e._viewMatrix=(0,g.c)(),e._viewProjectionDirty=!0,e._viewProjectionMatrix=(0,g.c)(),e._viewInverseTransposeMatrixDirty=!0,e._viewInverseTransposeMatrix=(0,g.c)(),e._frustumDirty=!0,e._frustum=(0,S.Ue)(),e._fullViewport=(0,C.c)(),e._pixelRatio=1,e.relativeElevation=0,e}return(0,a.Z)(n,[{key:"pixelRatio",get:function(){return this._pixelRatio},set:function(e){this._pixelRatio=e>0?e:1}},{key:"eye",get:function(){return this._ray.origin},set:function(e){this._compareAndSetView(e,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center,"_center")}},{key:"ray",get:function(){return(0,_.b)(this._ray.direction,this.center,this.eye),this._ray}},{key:"up",get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up,"_up")}},{key:"viewMatrix",get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){(0,v.c)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"viewForward",get:function(){return this._ensureViewClean(),this._viewForward}},{key:"viewUp",get:function(){return this._ensureViewClean(),this._viewUp}},{key:"viewRight",get:function(){return this._ensureViewClean(),this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}},{key:"far",get:function(){return this._nearFar[1]},set:function(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}},{key:"viewport",get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}},{key:"screenViewport",get:function(){if(1===this.pixelRatio)return this._viewport;var e=(0,w.b)((0,C.c)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,w.h)(e,t)?t:e}},{key:"x",get:function(){return this._viewport[0]},set:function(e){e+=this._padding[R.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}},{key:"y",get:function(){return this._viewport[1]},set:function(e){e+=this._padding[R.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}},{key:"width",get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}},{key:"height",get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[R.RIGHT]+this._padding[R.LEFT]},set:function(e){this.width=e-(this._padding[R.RIGHT]+this._padding[R.LEFT])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[R.TOP]+this._padding[R.BOTTOM]},set:function(e){this.height=e-(this._padding[R.TOP]+this._padding[R.BOTTOM])}},{key:"fullViewport",get:function(){return this._fullViewport[0]=this._viewport[0]-this._padding[R.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[R.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}},{key:"_aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(e){(0,w.g)(this._padding,e)||(this._viewport[0]+=e[R.LEFT]-this._padding[R.LEFT],this._viewport[1]+=e[R.BOTTOM]-this._padding[R.BOTTOM],this._viewport[2]-=e[R.RIGHT]+e[R.LEFT]-(this._padding[R.RIGHT]+this._padding[R.LEFT]),this._viewport[3]-=e[R.TOP]+e[R.BOTTOM]-(this._padding[R.TOP]+this._padding[R.BOTTOM]),(0,w.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}},{key:"viewProjectionMatrix",get:function(){return this._viewProjectionDirty&&((0,v.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){var e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2),r=n*this._aspect,i=(0,v.q)((0,g.c)(),-r*(1+2*this._padding[R.LEFT]/e),r*(1+2*this._padding[R.RIGHT]/e),-n*(1+2*this._padding[R.BOTTOM]/t),n*(1+2*this._padding[R.TOP]/t),this.near,this.far),a=this._get("projectionMatrix");return a&&(0,v.h)(a,i)?a:i}},{key:"inverseProjectionMatrix",get:function(){return(0,v.a)((0,g.c)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,g.c)()}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovX",get:function(){return function(e,t,n){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+n*n))}(this._fov,this.width,this.height)},set:function(e){this._fov=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovY",get:function(){return function(e,t,n){return 2*Math.atan(n*Math.tan(.5*e)/Math.sqrt(t*t+n*n))}(this._fov,this.width,this.height)},set:function(e){this._fov=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/n)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"distance",get:function(){return(0,_.i)(this.center,this.eye)}},{key:"frustum",get:function(){return this._recomputeFrustum(),this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,v.a)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,v.t)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}},{key:"depthNDCToWorld",value:function(e){var t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return null!=this.relativeElevation&&this.relativeElevation>=0}},{key:"copyFrom",value:function(e){(0,_.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,w.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,w.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,m.c)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.relativeElevation=e.relativeElevation;var t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,v.c)(this._viewMatrix,e.viewMatrix),(0,_.c)(this._viewRight,e.viewRight),(0,_.c)(this._viewUp,e.viewUp),(0,_.c)(this._viewForward,e.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,S.JG)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,v.c)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,w.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}},{key:"copyViewFrom",value:function(e){this.eye=e.eye,this.center=e.center,this.up=e.up}},{key:"clone",value:function(){return(new r).copyFrom(this)}},{key:"equals",value:function(e){return(0,_.k)(this.eye,e.eye)&&(0,_.k)(this.center,e.center)&&(0,_.k)(this.up,e.up)&&(0,w.g)(this._viewport,e.viewport)&&(0,w.g)(this._padding,e.padding)&&(0,m.m)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}},{key:"almostEquals",value:function(e){if(Math.abs(e.fov-this._fov)>=.001||(0,w.i)(e.padding,this._padding)>=.5||(0,w.i)(this.screenViewport,e.screenViewport)>=.5)return!1;(0,_.w)(D,e.eye,e.center),(0,_.w)(I,this.eye,this.center);var t=(0,_.e)(D,I),n=(0,_.D)(D),r=(0,_.D)(I),i=5e-4;return t*t>=(1-1e-10)*n*r&&(0,_.E)(e.eye,this.eye)<Math.max(n,r)*i*i}},{key:"computeRenderPixelSizeAt",value:function(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}},{key:"computeRenderPixelSizeAtDist",value:function(e){return e*this.perRenderPixelRatio}},{key:"computeScreenPixelSizeAt",value:function(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}},{key:"_viewDirectionDistance",value:function(e){return Math.abs((0,b.SR)(this.viewForward,(0,_.b)(D,e,this.eye)))}},{key:"computeScreenPixelSizeAtDist",value:function(e){return e*this.perScreenPixelRatio}},{key:"computeDistanceFromRadius",value:function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}},{key:"getScreenCenter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.s1)();return e[0]=(this.padding[R.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[R.TOP]+this.height/2)/this.pixelRatio,e}},{key:"getRenderCenter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[R.LEFT]+this.width*t,e[1]=this.padding[R.BOTTOM]+this.height*n,e[2]=.5,e}},{key:"setGLViewport",value:function(e){var t=this.viewport,n=this.padding;e.setViewport(t[0]-n[3],t[1]-n[2],t[2]+n[1]+n[3],t[3]+n[0]+n[2])}},{key:"applyProjection",value:function(e,t){e!==P&&(0,_.c)(P,e),P[3]=1,(0,w.t)(P,P,this.projectionMatrix);var n=Math.abs(P[3]);(0,_.g)(P,P,1/n);var r=this.fullViewport;t[0]=(0,d.t7)(0,r[0]+r[2],.5+.5*P[0]),t[1]=(0,d.t7)(0,r[1]+r[3],.5+.5*P[1]),t[2]=.5*(P[2]+1),t[3]=n}},{key:"unapplyProjection",value:function(e,t){var n=this.fullViewport;P[0]=(e[0]/(n[0]+n[2])*2-1)*e[3],P[1]=(e[1]/(n[1]+n[3])*2-1)*e[3],P[2]=(2*e[2]-1)*e[3],P[3]=e[3],null!=this.inverseProjectionMatrix&&((0,w.t)(P,P,this.inverseProjectionMatrix),t[0]=P[0],t[1]=P[1],t[2]=P[2])}},{key:"projectToScreen",value:function(e,t){return this.projectToRenderScreen(e,M),this.renderToScreen(M,t),t}},{key:"projectToRenderScreen",value:function(e,t){if(P[0]=e[0],P[1]=e[1],P[2]=e[2],P[3]=1,(0,w.t)(P,P,this.viewProjectionMatrix),0===P[3])return null;(0,_.g)(P,P,1/Math.abs(P[3]));var n=this.fullViewport;return"x"in t?(t.x=(0,d.t7)(0,n[0]+n[2],.5+.5*P[0]),t.y=(0,d.t7)(0,n[1]+n[3],.5+.5*P[1])):(t[0]=(0,d.t7)(0,n[0]+n[2],.5+.5*P[0]),t[1]=(0,d.t7)(0,n[1]+n[3],.5+.5*P[1]),t.length>2&&(t[2]=.5*(P[2]+1))),t}},{key:"unprojectFromScreen",value:function(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,M),t)}},{key:"unprojectFromRenderScreen",value:function(e,t){if((0,v.m)(E,this.projectionMatrix,this.viewMatrix),!(0,v.a)(E,E))return null;var n=this.fullViewport;return P[0]=2*(e[0]-n[0])/n[2]-1,P[1]=2*(e[1]-n[1])/n[3]-1,P[2]=2*e[2]-1,P[3]=1,(0,w.t)(P,P,E),0===P[3]?null:(t[0]=P[0]/P[3],t[1]=P[1]/P[3],t[2]=P[2]/P[3],t)}},{key:"constrainWindowSize",value:function(e,t,n,r){var i=e*this.pixelRatio,a=t*this.pixelRatio,o=Math.max(i-n/2,0),s=Math.max(this.fullHeight-a-r/2,0),u=-Math.min(i-n/2,0),l=-Math.min(this.fullHeight-a-r/2,0);return[o,s,n-u- -Math.min(this.fullWidth-i-n/2,0),r-l- -Math.min(a-r/2,0)]}},{key:"computeUp",value:function(e){e===O.JY.Global?this._computeUpGlobal():this._computeUpLocal()}},{key:"screenToRender",value:function(e,t){var n=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=n,t[1]=r,t}},{key:"renderToScreen",value:function(e,t){var n=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=n,t[1]=r}},{key:"_computeUpGlobal",value:function(){(0,_.b)(D,this.center,this.eye);var e=(0,_.l)(this.center);e<1?((0,_.s)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,_.e)(D,this.center))>.9999*(0,_.l)(D)*e||((0,_.f)(this._up,D,this.center),(0,_.f)(this._up,this._up,D),(0,_.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}},{key:"_computeUpLocal",value:function(){(0,_.r)(D,this.eye,this.center),Math.abs(D[2])<=.9999&&((0,_.g)(D,D,D[2]),(0,_.s)(this._up,-D[0],-D[1],1-D[2]),(0,_.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}},{key:"_compareAndSetView",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,_.k)(e,t)||((0,_.c)(t,e),this._markViewDirty(),n.length&&this.notifyChange(n)):c.Z.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}},{key:"_markViewDirty",value:function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}},{key:"_recomputeFrustum",value:function(){this._frustumDirty&&((0,S.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}},{key:"_ensureViewClean",value:function(){this._viewDirty&&((0,v.u)(this._viewMatrix,this.eye,this.center,this.up),(0,_.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,_.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,_.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}]),n}(l.Z);(0,u._)([(0,f.Cb)()],A.prototype,"_center",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"_up",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"_viewport",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"_padding",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"_fov",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"_nearFar",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"_pixelRatio",void 0),(0,u._)([(0,f.Cb)()],A.prototype,"pixelRatio",null),(0,u._)([(0,f.Cb)()],A.prototype,"eye",null),(0,u._)([(0,f.Cb)()],A.prototype,"center",null),(0,u._)([(0,f.Cb)()],A.prototype,"up",null),(0,u._)([(0,f.Cb)({readOnly:!0})],A.prototype,"nearFar",null),(0,u._)([(0,f.Cb)()],A.prototype,"near",null),(0,u._)([(0,f.Cb)()],A.prototype,"far",null),(0,u._)([(0,f.Cb)()],A.prototype,"viewport",null),(0,u._)([(0,f.Cb)({readOnly:!0})],A.prototype,"screenViewport",null),(0,u._)([(0,f.Cb)()],A.prototype,"x",null),(0,u._)([(0,f.Cb)()],A.prototype,"y",null),(0,u._)([(0,f.Cb)()],A.prototype,"width",null),(0,u._)([(0,f.Cb)()],A.prototype,"height",null),(0,u._)([(0,f.Cb)()],A.prototype,"fullWidth",null),(0,u._)([(0,f.Cb)()],A.prototype,"fullHeight",null),(0,u._)([(0,f.Cb)({readOnly:!0})],A.prototype,"_aspect",null),(0,u._)([(0,f.Cb)()],A.prototype,"padding",null),(0,u._)([(0,f.Cb)({readOnly:!0})],A.prototype,"projectionMatrix",null),(0,u._)([(0,f.Cb)({readOnly:!0})],A.prototype,"inverseProjectionMatrix",null),(0,u._)([(0,f.Cb)()],A.prototype,"fov",null),(0,u._)([(0,f.Cb)()],A.prototype,"fovX",null),(0,u._)([(0,f.Cb)()],A.prototype,"fovY",null),A=r=(0,u._)([(0,p.j)("esri.views.3d.webgl-engine.lib.Camera")],A);var R,P=(0,C.c)(),E=(0,g.c)(),D=(0,T.c)(),I=(0,T.c)(),M=(0,h.J$)();!function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(R||(R={}))},88699:function(e,t,n){n.d(t,{QZ:function(){return a},Rq:function(){return o},bg:function(){return i}});var r=n(18722);function i(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=r.DB?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function a(e){return length<=r.DB?Array.from(e):new Float64Array(e)}function o(e,t,n){return Array.isArray(e)?e.slice(t,t+n):e.subarray(t,t+n)}},73840:function(e,t,n){n.d(t,{AA:function(){return o},XO:function(){return a},xx:function(){return i}});var r=n(18722);function i(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=r.DB?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function a(e){return length<=r.DB?Array.from(e):new Float32Array(e)}function o(e,t,n){return Array.isArray(e)?e.slice(t,t+n):e.subarray(t,t+n)}},94425:function(e,t,n){n.d(t,{p:function(){return s}});var r=n(15671),i=n(43144),a=n(92026),o=n(68401),s=function(){function e(t,n){(0,r.Z)(this,e),this._material=t,this._repository=n,this._map=new Map}return(0,i.Z)(e,[{key:"destroy",value:function(){var e=this;this._map.forEach((function(t,n){(0,a.pC)(t)&&e._repository.release(e._material,n)}))}},{key:"load",value:function(e,t,n){if(!this._material.requiresSlot(t,n))return null;this._map.has(n)||this._map.set(n,this._repository.acquire(this._material,t,n));var r=this._map.get(n);if((0,a.pC)(r)){if(r.ensureResources(e)===o.Rw.LOADED)return r;this._repository.requestRender()}return null}}]),e}()},70619:function(e,t,n){n.d(t,{Cr:function(){return oe},IG:function(){return R},QL:function(){return K},nb:function(){return ee},B2:function(){return M},DA:function(){return ie},x2:function(){return ne},dV:function(){return Y},mj:function(){return X},rh:function(){return re},PI:function(){return J},g7:function(){return Q},AW:function(){return q},PD:function(){return te},Ay:function(){return ue},mx:function(){return ae}});var r,i=n(92026),a=n(11186),o=n(8229),s=n(71353),u=n(55652),l=n(40885),c=n(91526);!function(e){e.length=function(e,t){var n=e[t],r=e[t+1],i=e[t+2];return Math.sqrt(n*n+r*r+i*i)},e.normalize=function(e,t){var n=e[t],r=e[t+1],i=e[t+2],a=1/Math.sqrt(n*n+r*r+i*i);e[t]*=a,e[t+1]*=a,e[t+2]*=a},e.scale=function(e,t,n){e[t]*=n,e[t+1]*=n,e[t+2]*=n},e.add=function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(i=i||e)[a]=e[t]+n[r],i[a+1]=e[t+1]+n[r+1],i[a+2]=e[t+2]+n[r+2]},e.subtract=function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(i=i||e)[a]=e[t]-n[r],i[a+1]=e[t+1]-n[r+1],i[a+2]=e[t+2]-n[r+2]}}(r||(r={}));for(var d=n(79100),h=n(88699),f=n(73840),p=n(95774),v=n(72838),g=n(97731),m=n(4760),y=r,_=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],T=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],w=[0,0,1,0,1,1,0,1],C=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],S=new Array(36),x=0;x<6;x++)for(var b=0;b<6;b++)S[6*x+b]=x;for(var O=new Array(36),A=0;A<6;A++)O[6*A+0]=0,O[6*A+1]=1,O[6*A+2]=2,O[6*A+3]=2,O[6*A+4]=3,O[6*A+5]=0;function R(e,t){Array.isArray(t)||(t=[t,t,t]);for(var n=new Array(24),r=0;r<8;r++)n[3*r]=_[r][0]*t[0],n[3*r+1]=_[r][1]*t[1],n[3*r+2]=_[r][2]*t[2];return new p.Z(e,[[m.T.POSITION,new c.a(n,3,!0)],[m.T.NORMAL,new c.a(T,3)],[m.T.UV0,new c.a(w,2)]],[[m.T.POSITION,C],[m.T.NORMAL,S],[m.T.UV0,O]])}var P=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],E=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],D=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],I=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function M(e,t){Array.isArray(t)||(t=[t,t,t]);for(var n=new Array(18),r=0;r<6;r++)n[3*r]=P[r][0]*t[0],n[3*r+1]=P[r][1]*t[1],n[3*r+2]=P[r][2]*t[2];return new p.Z(e,[[m.T.POSITION,new c.a(n,3,!0)],[m.T.NORMAL,new c.a(E,3)]],[[m.T.POSITION,D],[m.T.NORMAL,I]])}var Z=(0,o.f)(-.5,0,-.5),L=(0,o.f)(.5,0,-.5),k=(0,o.f)(0,0,.5),H=(0,o.f)(0,.5,0),N=(0,o.c)(),F=(0,o.c)(),z=(0,o.c)(),U=(0,o.c)(),j=(0,o.c)();(0,a.b)(N,Z,H),(0,a.b)(F,Z,L),(0,a.f)(z,N,F),(0,a.n)(z,z),(0,a.b)(N,L,H),(0,a.b)(F,L,k),(0,a.f)(U,N,F),(0,a.n)(U,U),(0,a.b)(N,k,H),(0,a.b)(F,k,Z),(0,a.f)(j,N,F),(0,a.n)(j,j);var V=[Z,L,k,H],W=[0,-1,0,z[0],z[1],z[2],U[0],U[1],U[2],j[0],j[1],j[2]],G=[0,1,2,3,1,0,3,2,1,3,0,2],B=[0,0,0,1,1,1,2,2,2,3,3,3];function q(e,t){Array.isArray(t)||(t=[t,t,t]);for(var n=new Array(12),r=0;r<4;r++)n[3*r]=V[r][0]*t[0],n[3*r+1]=V[r][1]*t[1],n[3*r+2]=V[r][2]*t[2];return new p.Z(e,[[m.T.POSITION,new c.a(n,3,!0)],[m.T.NORMAL,new c.a(W,3)]],[[m.T.POSITION,G],[m.T.NORMAL,B]])}function J(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{uv:!0},a=-Math.PI,o=2*Math.PI,s=-Math.PI/2,u=Math.PI,l=Math.max(3,Math.floor(n)),d=Math.max(2,Math.floor(r)),h=(l+1)*(d+1),v=(0,f.xx)(3*h),g=(0,f.xx)(3*h),y=(0,f.xx)(2*h),_=[],T=0,w=0;w<=d;w++){for(var C=[],S=w/d,x=s+S*u,b=Math.cos(x),O=0;O<=l;O++){var A=O/l,R=a+A*o,P=Math.cos(R)*b,E=Math.sin(x),D=-Math.sin(R)*b;v[3*T]=P*t,v[3*T+1]=E*t,v[3*T+2]=D*t,g[3*T]=P,g[3*T+1]=E,g[3*T+2]=D,y[2*T]=A,y[2*T+1]=S,C.push(T),++T}_.push(C)}for(var I=new Array,M=0;M<d;M++)for(var Z=0;Z<l;Z++){var L=_[M][Z],k=_[M][Z+1],H=_[M+1][Z+1],N=_[M+1][Z];0===M?(I.push(L),I.push(H),I.push(N)):M===d-1?(I.push(L),I.push(k),I.push(H)):(I.push(L),I.push(k),I.push(H),I.push(H),I.push(N),I.push(L))}var F=[[m.T.POSITION,I],[m.T.NORMAL,I]],z=[[m.T.POSITION,new c.a(v,3,!0)],[m.T.NORMAL,new c.a(g,3,!0)]];return i.uv&&(z.push([m.T.UV0,new c.a(y,2,!0)]),F.push([m.T.UV0,I])),i.offset&&(F[0][0]=m.T.OFFSET,z[0][0]=m.T.OFFSET,F.push([m.T.POSITION,new Array(I.length).fill(0)]),z.push([m.T.POSITION,new c.a(Float64Array.from(i.offset),3,!0)])),new p.Z(e,z,F)}function X(e,t,n,r){var i=function(e,t,n){var r,i,a=e;if(n)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],i=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{var o=a*(1+Math.sqrt(5))/2;r=[-a,o,0,a,o,0,-a,-o,0,a,-o,0,0,-a,o,0,a,o,0,-a,-o,0,a,-o,o,0,-a,o,0,a,-o,0,-a,-o,0,a],i=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(var s=0;s<r.length;s+=3)y.scale(r,s,e/y.length(r,s));var u={};function l(t,n){var i;t>n&&(t=(i=[n,t])[0],n=i[1]);var a=t.toString()+"."+n.toString();if(u[a])return u[a];var o=r.length;return r.length+=3,y.add(r,3*t,r,3*n,r,o),y.scale(r,o,e/y.length(r,o)),o/=3,u[a]=o,o}for(var d=0;d<t;d++){for(var h=i.length,p=new Array(4*h),v=0;v<h;v+=3){var g=i[v],_=i[v+1],T=i[v+2],w=l(g,_),C=l(_,T),S=l(T,g),x=4*v;p[x]=g,p[x+1]=w,p[x+2]=S,p[x+3]=_,p[x+4]=C,p[x+5]=w,p[x+6]=T,p[x+7]=S,p[x+8]=C,p[x+9]=w,p[x+10]=C,p[x+11]=S}i=p,u={}}for(var b=(0,f.XO)(r),O=0;O<b.length;O+=3)y.normalize(b,O);var A=[[m.T.POSITION,i],[m.T.NORMAL,i]];return{vertexAttributes:[[m.T.POSITION,new c.a((0,f.XO)(r),3,!0)],[m.T.NORMAL,new c.a(b,3,!0)]],indices:A}}(t,n,r),a=i.vertexAttributes,o=i.indices;return new p.Z(e,a,o)}function Y(e,t,n,r,a,o,s,u){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=n?[n[0],n[1],n[2]]:[0,0,0],f=t?[t[0],t[1],t[2]]:[0,0,1];s=s||[0,0];var v=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],g=(0,i.pC)(a)&&2===a.length?a:[1,1],y=[[m.T.POSITION,new c.a(h,3,!0)],[m.T.NORMAL,new c.a(f,3,!0)],[m.T.UV0,new c.a(s,s.length)],[m.T.COLOR,new c.a(v,4,!0)],[m.T.SIZE,new c.a(g,2)]];if(null!=o){var _=[o[0],o[1],o[2],o[3]];y.push([m.T.AUXPOS1,new c.a(_,4)])}if(null!=u){var T=[u[0],u[1],u[2],u[3]];y.push([m.T.AUXPOS2,new c.a(T,4)])}return new p.Z(e,y,null,null,d.U.Point,l)}var $=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function Q(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$,n=new Array(12),r=0;r<4;r++)for(var i=0;i<3;i++)n[3*r+i]=t[r][i];var a=[0,1,2,2,3,0],o=[0,0,0,0,0,0],s=[[m.T.POSITION,a],[m.T.NORMAL,o],[m.T.UV0,a],[m.T.COLOR,o]],u=[[m.T.POSITION,new c.a(n,3,!0)],[m.T.NORMAL,new c.a([0,0,1],3,!0)],[m.T.UV0,new c.a([0,0,1,0,1,1,0,1],2,!0)],[m.T.COLOR,new c.a([255,255,255,255],4,!0)]];return new p.Z(e,u,s)}function K(e,t,n,r,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=0,l=n,d=t,h=(0,o.f)(0,u,0),v=(0,o.f)(0,u+d,0),g=(0,o.f)(0,-1,0),y=(0,o.f)(0,1,0);i&&(u=d,v=(0,o.f)(0,0,0),h=(0,o.f)(0,u,0),g=(0,o.f)(0,1,0),y=(0,o.f)(0,-1,0));var _=[v,h],T=[g,y],w=r+2,C=Math.sqrt(d*d+l*l);if(i)for(var S=r-1;S>=0;S--){var x=S*(2*Math.PI/r),b=(0,o.f)(Math.cos(x)*l,u,Math.sin(x)*l);_.push(b);var O=(0,o.f)(d*Math.cos(x)/C,-l/C,d*Math.sin(x)/C);T.push(O)}else for(var A=0;A<r;A++){var R=A*(2*Math.PI/r),P=(0,o.f)(Math.cos(R)*l,u,Math.sin(R)*l);_.push(P);var E=(0,o.f)(d*Math.cos(R)/C,l/C,d*Math.sin(R)/C);T.push(E)}var D=new Array,I=new Array;if(a){for(var M=3;M<_.length;M++)D.push(1),D.push(M-1),D.push(M),I.push(0),I.push(0),I.push(0);D.push(_.length-1),D.push(2),D.push(1),I.push(0),I.push(0),I.push(0)}if(s){for(var Z=3;Z<_.length;Z++)D.push(Z),D.push(Z-1),D.push(0),I.push(Z),I.push(Z-1),I.push(1);D.push(0),D.push(2),D.push(_.length-1),I.push(1),I.push(2),I.push(T.length-1)}for(var L=(0,f.xx)(3*w),k=0;k<w;k++)L[3*k]=_[k][0],L[3*k+1]=_[k][1],L[3*k+2]=_[k][2];for(var H=(0,f.xx)(3*w),N=0;N<w;N++)H[3*N]=T[N][0],H[3*N+1]=T[N][1],H[3*N+2]=T[N][2];var F=[[m.T.POSITION,D],[m.T.NORMAL,I]],z=[[m.T.POSITION,new c.a(L,3,!0)],[m.T.NORMAL,new c.a(H,3,!0)]];return new p.Z(e,z,F)}function ee(e,t,n,r,i,s,u){var l,d=i?(0,o.b)(i):(0,o.f)(1,0,0),h=s?(0,o.b)(s):(0,o.f)(0,0,0);u=null===(l=u)||void 0===l||l;var v=(0,o.c)();(0,a.n)(v,d);var g=(0,o.c)();(0,a.g)(g,v,Math.abs(t));var y=(0,o.c)();(0,a.g)(y,g,-.5),(0,a.a)(y,y,h);var _=(0,o.f)(0,1,0);Math.abs(1-(0,a.e)(v,_))<.2&&(0,a.s)(_,0,0,1);var T=(0,o.c)();(0,a.f)(T,v,_),(0,a.n)(T,T),(0,a.f)(_,T,v);var w=2*r+(u?2:0),C=r+(u?2:0),S=(0,f.xx)(3*w),x=(0,f.xx)(3*C),b=(0,f.xx)(2*w),O=new Array(3*r*(u?4:2)),A=new Array(3*r*(u?4:2));u&&(S[3*(w-2)+0]=y[0],S[3*(w-2)+1]=y[1],S[3*(w-2)+2]=y[2],b[2*(w-2)]=0,b[2*(w-2)+1]=0,S[3*(w-1)+0]=S[3*(w-2)+0]+g[0],S[3*(w-1)+1]=S[3*(w-2)+1]+g[1],S[3*(w-1)+2]=S[3*(w-2)+2]+g[2],b[2*(w-1)]=1,b[2*(w-1)+1]=1,x[3*(C-2)+0]=-v[0],x[3*(C-2)+1]=-v[1],x[3*(C-2)+2]=-v[2],x[3*(C-1)+0]=v[0],x[3*(C-1)+1]=v[1],x[3*(C-1)+2]=v[2]);for(var R=function(e,t,n){O[e]=t,A[e]=n},P=0,E=(0,o.c)(),D=(0,o.c)(),I=0;I<r;I++){var M=I*(2*Math.PI/r);(0,a.g)(E,_,Math.sin(M)),(0,a.g)(D,T,Math.cos(M)),(0,a.a)(E,E,D),x[3*I+0]=E[0],x[3*I+1]=E[1],x[3*I+2]=E[2],(0,a.g)(E,E,n),(0,a.a)(E,E,y),S[3*I+0]=E[0],S[3*I+1]=E[1],S[3*I+2]=E[2],b[2*I+0]=I/r,b[2*I+1]=0,S[3*(I+r)+0]=S[3*I+0]+g[0],S[3*(I+r)+1]=S[3*I+1]+g[1],S[3*(I+r)+2]=S[3*I+2]+g[2],b[2*(I+r)+0]=I/r,b[2*I+1]=1;var Z=(I+1)%r;R(P++,I,I),R(P++,I+r,I),R(P++,Z,Z),R(P++,Z,Z),R(P++,I+r,I),R(P++,Z+r,Z)}if(u){for(var L=0;L<r;L++){var k=(L+1)%r;R(P++,w-2,C-2),R(P++,L,C-2),R(P++,k,C-2)}for(var H=0;H<r;H++){var N=(H+1)%r;R(P++,H+r,C-1),R(P++,w-1,C-1),R(P++,N+r,C-1)}}var F=[[m.T.POSITION,O],[m.T.NORMAL,A],[m.T.UV0,O]],z=[[m.T.POSITION,new c.a(S,3,!0)],[m.T.NORMAL,new c.a(x,3,!0)],[m.T.UV0,new c.a(b,2,!0)]];return new p.Z(e,z,F)}function te(e,t,n,r,i,a){r=r||10,i=null==i||i,(0,g.hu)(t.length>1);for(var o=[],s=[],u=0;u<r;u++){o.push([0,-u-1,-(u+1)%r-1]);var l=u/r*2*Math.PI;s.push([Math.cos(l)*n,Math.sin(l)*n])}return ne(e,s,t,[[0,0,0]],o,i,a)}function ne(e,t,n,r,i,d){var h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,o.f)(0,0,0),v=t.length,g=(0,f.xx)(n.length*v*3+(6*r.length||0)),y=(0,f.xx)(n.length*v*3+(r?6:0)),_=new Array,T=new Array,w=0,C=0,S=(0,o.c)(),x=(0,o.c)(),b=(0,o.c)(),O=(0,o.c)(),A=(0,o.c)(),R=(0,o.c)(),P=(0,o.c)(),E=(0,s.c)(),D=(0,o.c)(),I=(0,o.c)(),M=(0,o.c)(),Z=(0,o.c)(),L=(0,o.c)(),k=(0,u.Ue)();(0,a.s)(D,0,1,0),(0,a.b)(x,n[1],n[0]),(0,a.n)(x,x),d?((0,a.a)(E,n[0],h),(0,a.n)(b,E)):(0,a.s)(b,0,0,1),ue(x,b,D,D,A,b,le),(0,a.c)(O,b),(0,a.c)(Z,A);for(var H=0;H<r.length;H++)(0,a.g)(R,A,r[H][0]),(0,a.g)(E,b,r[H][2]),(0,a.a)(R,R,E),(0,a.a)(R,R,n[0]),g[w++]=R[0],g[w++]=R[1],g[w++]=R[2];y[C++]=-x[0],y[C++]=-x[1],y[C++]=-x[2];for(var N=0;N<i.length;N++)_.push(i[N][0]>0?i[N][0]:-i[N][0]-1+r.length),_.push(i[N][1]>0?i[N][1]:-i[N][1]-1+r.length),_.push(i[N][2]>0?i[N][2]:-i[N][2]-1+r.length),T.push(0),T.push(0),T.push(0);for(var F=r.length,z=r.length-1,U=0;U<n.length;U++){var j=!1;U>0&&((0,a.c)(S,x),U<n.length-1?((0,a.b)(x,n[U+1],n[U]),(0,a.n)(x,x)):j=!0,(0,a.a)(I,S,x),(0,a.n)(I,I),(0,a.a)(M,n[U-1],O),(0,u.Yq)(n[U],I,k),(0,u.BR)(k,(0,l.re)(M,S),E)?((0,a.b)(E,E,n[U]),(0,a.n)(b,E),(0,a.f)(A,I,b),(0,a.n)(A,A)):ue(I,O,Z,D,A,b,le),(0,a.c)(O,b),(0,a.c)(Z,A)),d&&((0,a.a)(E,n[U],h),(0,a.n)(L,E));for(var V=0;V<v;V++)if((0,a.g)(R,A,t[V][0]),(0,a.g)(E,b,t[V][1]),(0,a.a)(R,R,E),(0,a.n)(P,R),y[C++]=P[0],y[C++]=P[1],y[C++]=P[2],(0,a.a)(R,R,n[U]),g[w++]=R[0],g[w++]=R[1],g[w++]=R[2],!j){var W=(V+1)%v;_.push(F+V),_.push(F+v+V),_.push(F+W),_.push(F+W),_.push(F+v+V),_.push(F+v+W);for(var G=0;G<6;G++){var B=_.length-6;T.push(_[B+G]-z)}}F+=v}for(var q=n[n.length-1],J=0;J<r.length;J++)(0,a.g)(R,A,r[J][0]),(0,a.g)(E,b,r[J][1]),(0,a.a)(R,R,E),(0,a.a)(R,R,q),g[w++]=R[0],g[w++]=R[1],g[w++]=R[2];var X=C/3;y[C++]=x[0],y[C++]=x[1],y[C++]=x[2];for(var Y=F-v,$=0;$<i.length;$++)_.push(i[$][0]>=0?F+i[$][0]:-i[$][0]-1+Y),_.push(i[$][2]>=0?F+i[$][2]:-i[$][2]-1+Y),_.push(i[$][1]>=0?F+i[$][1]:-i[$][1]-1+Y),T.push(X),T.push(X),T.push(X);var Q=[[m.T.POSITION,_],[m.T.NORMAL,T]],K=[[m.T.POSITION,new c.a(g,3,!0)],[m.T.NORMAL,new c.a(y,3,!0)]];return new p.Z(e,K,Q)}function re(e,t,n,r){(0,g.hu)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,g.hu)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,g.hu)(null==n||n.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,g.hu)(null==n||3===n[0].length,"createPolylineGeometry(): malformed normal");for(var i=(0,h.bg)(3*t.length),a=new Array(2*(t.length-1)),o=0,s=0,u=0;u<t.length;u++){for(var l=0;l<3;l++)i[o++]=t[u][l];u>0&&(a[s++]=u-1,a[s++]=u)}var y=[],_=[];if(y.push([m.T.POSITION,a]),_.push([m.T.POSITION,new c.a(i,3,!0)]),n){for(var T=(0,f.xx)(3*n.length),w=0,C=0;C<t.length;C++)for(var S=0;S<3;S++)T[w++]=n[C][S];y.push([m.T.NORMAL,a]),_.push([m.T.NORMAL,new c.a(T,3,!0)])}return r&&(_.push([m.T.COLOR,new c.a(r,4)]),y.push([m.T.COLOR,(0,v.p)(r.length/4)])),new p.Z(e,_,y,null,d.U.Line)}function ie(e,t,n,r,i){for(var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=new Array(18),s=[[-n,a,i/2],[r,a,i/2],[0,t+a,i/2],[-n,a,-i/2],[r,a,-i/2],[0,t+a,-i/2]],u=0;u<6;u++)o[3*u]=s[u][0],o[3*u+1]=s[u][1],o[3*u+2]=s[u][2];return new p.Z(e,[[m.T.POSITION,new c.a(o,3,!0)]],[[m.T.POSITION,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]]])}function ae(e,t){for(var n=e.getMutableAttribute(m.T.POSITION).data,r=0;r<n.length;r+=3){var i=n[r],o=n[r+1],s=n[r+2];(0,a.s)(ce,i,o,s),(0,a.m)(ce,ce,t),n[r]=ce[0],n[r+1]=ce[1],n[r+2]=ce[2]}}function oe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=e.vertexAttributes,r=n.get(m.T.POSITION).data,i=n.get(m.T.NORMAL).data;if(i)for(var a=t.getMutableAttribute(m.T.NORMAL).data,o=0;o<i.length;o+=3){var s=i[o+1];a[o+1]=-i[o+2],a[o+2]=s}if(r)for(var u=t.getMutableAttribute(m.T.POSITION).data,l=0;l<r.length;l+=3){var c=r[l+1];u[l+1]=-r[l+2],u[l+2]=c}}function se(e,t,n,r,i){return!(Math.abs((0,a.e)(t,e))>i)&&((0,a.f)(n,e,t),(0,a.n)(n,n),(0,a.f)(r,n,e),(0,a.n)(r,r),!0)}function ue(e,t,n,r,i,a,o){return se(e,t,i,a,o)||se(e,n,i,a,o)||se(e,r,i,a,o)}var le=.99619469809,ce=(0,o.c)()},87145:function(e,t,n){n.d(t,{C:function(){return w}});var r=n(93433),i=n(15671),a=n(43144),o=n(92026),s=n(95439),u=n(11186),l=n(71353),c=n(67077),d=n(79803),h=n(91526),f=n(79100),p=n(95774),v=n(61403),g=n(66327),m=null,y=n(4760),_=n(97882),T=n(58901),w=function(){function e(t){(0,i.Z)(this,e),this._originSR=t,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+(0,s.D)()}return(0,a.Z)(e,[{key:"getOrigin",value:function(e){var t=this._origins.get(this._rootOriginId);if(null==t){var n=m;if((0,o.pC)(n))return this._origins.set(this._rootOriginId,(0,v.a)(n[0],n[1],n[2],this._rootOriginId)),this.getOrigin(e);var i=(0,v.a)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,i),i}var a=this._gridSize,s=Math.round(e[0]/a),l=Math.round(e[1]/a),c=Math.round(e[2]/a),d="".concat(s,"/").concat(l,"/").concat(c),h=this._origins.get(d),f=.5*a;if((0,u.b)(C,e,t.vec3),C[0]=Math.abs(C[0]),C[1]=Math.abs(C[1]),C[2]=Math.abs(C[2]),C[0]<f&&C[1]<f&&C[2]<f){if(h){var p=Math.max.apply(Math,(0,r.Z)(C));if((0,u.b)(C,e,h.vec3),C[0]=Math.abs(C[0]),C[1]=Math.abs(C[1]),C[2]=Math.abs(C[2]),Math.max.apply(Math,(0,r.Z)(C))<p)return h}return t}return h||(h=(0,v.a)(s*a,l*a,c*a,d),this._origins.set(d,h)),h}},{key:"_drawOriginBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,c.f)(1,1,0,1),n=window.view,r=n._stage,i=t.toString();if(!this._objects.has(i)){this._material=new T.U({width:2,color:t}),r.add(this._material);var a=new _.F({pickable:!1}),o=new g.T({castShadow:!1});r.add(o),a.add(o),r.add(a),this._objects.set(i,o)}for(var s=this._objects.get(i),u=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=u.length,v=new Array(3*l),m=new Array,w=.5*this._gridSize,C=0;C<l;C++)v[3*C+0]=e[0]+(1&u[C]?w:-w),v[3*C+1]=e[1]+(2&u[C]?w:-w),v[3*C+2]=e[2]+(4&u[C]?w:-w),C>0&&m.push(C-1,C);(0,d.CM)(v,this._originSR,0,v,n.renderSpatialReference,0,l);var S=new p.Z(this._material,[[y.T.POSITION,new h.a(v,3,!0)]],[[y.T.POSITION,m]],null,f.U.Line);r.add(S),s.addGeometry(S)}},{key:"test",get:function(){var e=this;return{set gridSize(t){e._gridSize=t}}}}]),e}(),C=(0,l.c)()},88153:function(e,t,n){n.d(t,{LP:function(){return A},Z8:function(){return S}});var r=n(60136),i=n(29388),a=n(37762),o=n(15671),s=n(43144),u=n(92026),l=n(14226),c=n(81949),d=n(11186),h=n(71353),f=n(90045),p=n(67077),v=n(40885),g=n(50951),m=n(54463),y=n(55848),_=n(22178),T=n(76783),w=1e-5,C=function(){function e(t){(0,o.Z)(this,e),this.options=new m.om,this._results=new x,this.transform=new T.yn,this.tolerance=w,this.verticalOffset=null,this._ray=(0,v.Ue)(),this._rayEnd=(0,h.c)(),this._rayBeginTransformed=(0,h.c)(),this._rayEndTransformed=(0,h.c)(),this.viewingMode=null!==t&&void 0!==t?t:g.JY.Global}return(0,s.Z)(e,[{key:"results",get:function(){return this._results}},{key:"ray",get:function(){return this._ray}},{key:"rayBegin",get:function(){return this._ray.origin}},{key:"rayEnd",get:function(){return this._rayEnd}},{key:"reset",value:function(e,t,n){this.resetWithRay((0,v.zk)(e,t,this._ray),n)}},{key:"resetWithRay",value:function(e,t){this.camera=t,e!==this._ray&&(0,v.JG)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===g.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,d.a)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}},{key:"intersect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;this.point=n,this.filterPredicate=i,this.tolerance=null!==r&&void 0!==r?r:w;var s=(0,T.W9)(this.verticalOffset);if((0,u.pC)(t)&&t.length>0){var l,c=o?function(t){o(t)&&e.intersectObject(t)}:function(t){e.intersectObject(t)},d=(0,a.Z)(t);try{for(d.s();!(l=d.n()).done;){var h=l.value,f=h.getSpatialQueryAccelerator&&h.getSpatialQueryAccelerator();(0,u.pC)(f)?((0,u.pC)(s)?f.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,c,s):f.forEachAlongRay(this._ray.origin,this._ray.direction,c),this.options.selectionMode&&this.options.hud&&f.forEachDegenerateObject(c)):h.objects.forAll((function(e){return c(e)}))}}catch(p){d.e(p)}finally{d.f()}}this.sortResults()}},{key:"intersectObject",value:function(e){var t=this,n=e.geometries;if(n){var r,i=e.transformation,o=(0,T.W9)(this.verticalOffset),s=(0,a.Z)(n);try{var l=function(){var n=r.value;if(!n.visible)return"continue";var a=n.material,s=n.id;t.transform.setAndInvalidateLazyTransforms(i,n.shaderTransformation),(0,d.m)(t._rayBeginTransformed,t.rayBegin,t.transform.inverse),(0,d.m)(t._rayEndTransformed,t.rayEnd,t.transform.inverse);var l=t.transform.transform;(0,u.pC)(o)&&(o.objectTransform=t.transform),a.intersect(n,t.transform.transform,t,t._rayBeginTransformed,t._rayEndTransformed,(function(n,r,i,a,o,d){if(n>=0){if((0,u.pC)(t.filterPredicate)&&!t.filterPredicate(t._ray.origin,t._rayEnd,n))return;var h=a?t._results.hud:t._results,f=a?function(t){var a=new y.RA(e,s,i,d);t.set(m.q7.HUD,a,n,r,c.I,o)}:function(t){return t.set(m.q7.OBJECT,{object:e,geometryId:s,triangleNr:i},n,r,l,o)};if((null==h.min.drapedLayerOrder||o>=h.min.drapedLayerOrder)&&(null==h.min.dist||n<h.min.dist)&&f(h.min),t.options.store!==m.eC.MIN&&(null==h.max.drapedLayerOrder||o<h.max.drapedLayerOrder)&&(null==h.max.dist||n>h.max.dist)&&f(h.max),t.options.store===m.eC.ALL)if(a){var p=new O(t._ray);f(p),t._results.hud.all.push(p)}else{var v=new b(t._ray);f(v),t._results.all.push(v)}}}))};for(s.s();!(r=s.n()).done;)l()}catch(h){s.e(h)}finally{s.f()}}}},{key:"sortResults",value:function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._results.all).sort((function(e,t){return e.dist!==t.dist?(0,u.Pt)(e.dist,0)-(0,u.Pt)(t.dist,0):e.drapedLayerOrder!==t.drapedLayerOrder?(0,u.Pt)(e.drapedLayerOrder,Number.MAX_VALUE)-(0,u.Pt)(t.drapedLayerOrder,Number.MAX_VALUE):(0,u.Pt)(t.drapedLayerGraphicOrder,Number.MIN_VALUE)-(0,u.Pt)(e.drapedLayerGraphicOrder,Number.MIN_VALUE)}))}}]),e}();function S(e){return new C(e)}var x=function(){function e(){(0,o.Z)(this,e),this.min=new b((0,v.Ue)()),this.max=new b((0,v.Ue)()),this.hud={min:new O((0,v.Ue)()),max:new O((0,v.Ue)()),all:new Array},this.ground=new b((0,v.Ue)()),this.all=[]}return(0,s.Z)(e,[{key:"init",value:function(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}]),e}(),b=function(){function e(t){(0,o.Z)(this,e),this.intersector=m.q7.OBJECT,this.normal=(0,h.c)(),this.transformation=(0,c.c)(),this._ray=(0,v.Ue)(),this.init(t)}return(0,s.Z)(e,[{key:"ray",get:function(){return this._ray}},{key:"distanceInRenderSpace",get:function(){return(0,u.pC)(this.dist)?((0,d.g)(R,this.ray.direction,this.dist),(0,d.l)(R)):null}},{key:"getIntersectionPoint",value:function(e){return!!(0,_.nn)(this)&&((0,d.g)(R,this.ray.direction,this.dist),(0,d.a)(e,this.ray.origin,R),!0)}},{key:"getTransformedNormal",value:function(e){return(0,d.c)(P,this.normal),P[3]=0,(0,f.t)(P,P,this.transformation),(0,d.c)(e,P),(0,d.n)(e,e)}},{key:"init",value:function(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=m.q7.OBJECT,(0,v.JG)(e,this._ray)}},{key:"set",value:function(e,t,n,r,i,a,o){this.intersector=e,this.dist=n,(0,d.c)(this.normal,(0,u.Pt)(r,h.U)),(0,l.c)(this.transformation,(0,u.Pt)(i,c.I)),this.target=t,this.drapedLayerOrder=a,this.drapedLayerGraphicOrder=o}},{key:"copy",value:function(e){(0,v.JG)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,d.c)(this.normal,e.normal),(0,l.c)(this.transformation,e.transformation)}}]),e}(),O=function(e){(0,r.Z)(n,e);var t=(0,i.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).intersector=m.q7.HUD,e}return(0,s.Z)(n)}(b);function A(e){return new b(e)}var R=(0,h.c)(),P=(0,p.c)()},54463:function(e,t,n){n.d(t,{eC:function(){return i},om:function(){return s},q7:function(){return r}});var r,i,a=n(43144),o=n(15671);!function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"}(r||(r={}));var s=(0,a.Z)((function e(){(0,o.Z)(this,e),this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=i.ALL}));!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(i||(i={}))},55848:function(e,t,n){n.d(t,{Dx:function(){return c},RA:function(){return l}});var r=n(60136),i=n(29388),a=n(43144),o=n(15671),s=n(92026),u=n(71353),l=function(e){(0,r.Z)(n,e);var t=(0,i.Z)(n);function n(e,r,i,a){var l;return(0,o.Z)(this,n),(l=t.call(this,e,r,i)).center=(0,s.pC)(a)?(0,u.a)(a):null,l}return(0,a.Z)(n)}((0,a.Z)((function e(t,n,r){(0,o.Z)(this,e),this.object=t,this.geometryId=n,this.triangleNr=r}))),c=function(e){(0,r.Z)(n,e);var t=(0,i.Z)(n);function n(e,r){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).graphicUid=r,i}return(0,a.Z)(n)}((0,a.Z)((function e(t){(0,o.Z)(this,e),this.layerUid=t})))},61403:function(e,t,n){n.d(t,{a:function(){return s}});var r=n(43144),i=n(15671),a=n(71353),o=(0,r.Z)((function e(t,n){(0,i.Z)(this,e),this.vec3=t,this.id=n}));function s(e,t,n,r){return new o((0,a.f)(e,t,n),r)}},78289:function(e,t,n){var r,i;n.d(t,{$:function(){return i},T:function(){return r}}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(i||(i={}))},66327:function(e,t,n){n.d(t,{T:function(){return w}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(92026),l=n(14226),c=n(81949),d=n(11186),h=n(71353),f=n(23470),p=n(80064),v=n(68401),g=n(1395),m=n(79100),y=n(47669),_=n(97731),T=n(32683),w=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.Z)(this,n),(e=t.call(this)).type=m.U.Object,e._geometries=new Array,e._transformation=(0,c.c)(),e._bvObjectSpace=new S,e._bvWorldSpace=new S,e._bvDirty=!0,e._hasVolatileTransformation=!1,e._visible=!0,e.castShadow=null==r.castShadow||r.castShadow,e.metadata=r.metadata,e.metadata&&e.metadata.isElevationSource&&(e.metadata.lastValidElevationBB=new C);var a=r.geometries;return(0,u.pC)(a)&&(e._geometries=Array.from(a)),e}return(0,a.Z)(n,[{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._transformation},set:function(e){(0,l.c)(this._transformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}},{key:"dispose",value:function(){this._geometries.length=0}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(e){(0,_.hu)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}},{key:"addGeometry",value:function(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}},{key:"removeGeometry",value:function(e){var t=this._geometries.splice(e,1)[0];t&&(this._emit("objectGeometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}},{key:"removeAllGeometries",value:function(){for(;this._geometries.length>0;)this.removeGeometry(0)}},{key:"geometryVertexAttrsUpdated",value:function(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}},{key:"visible",get:function(){return this._visible},set:function(e){if(this._visible!==e){this._visible=e;var t,n=(0,r.Z)(this._geometries);try{for(n.s();!(t=n.n()).done;){t.value.visible=this._visible}}catch(i){n.e(i)}finally{n.f()}this._emit("visibilityChanged",this)}}},{key:"maskOccludee",value:function(){var e,t=new y.O(v.V_.MaskOccludee),n=(0,r.Z)(this._geometries);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.occludees=(0,T.lr)(i.occludees,t)}}catch(a){n.e(a)}finally{n.f()}return this._emit("occlusionChanged",this),t}},{key:"removeOcclude",value:function(e){var t,n=(0,r.Z)(this._geometries);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.occludees=(0,T.U_)(i.occludees,e)}}catch(a){n.e(a)}finally{n.f()}this._emit("occlusionChanged",this)}},{key:"highlight",value:function(){var e,t=new y.O(v.V_.Highlight),n=(0,r.Z)(this._geometries);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.highlights=(0,T.lr)(i.highlights,t)}}catch(a){n.e(a)}finally{n.f()}return this._emit("highlightChanged",this),t}},{key:"removeHighlight",value:function(e){var t,n=(0,r.Z)(this._geometries);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.highlights=(0,T.U_)(i.highlights,e)}}catch(a){n.e(a)}finally{n.f()}this._emit("highlightChanged",this)}},{key:"getCombinedStaticTransformation",value:function(e,t){return(0,l.m)(t,this.transformation,e.transformation)}},{key:"_getCombinedShaderTransformation",value:function(e){return(0,l.m)((0,c.c)(),this.transformation,e.shaderTransformation)}},{key:"hasVolativeTransformation",value:function(){return this._hasVolatileTransformation}},{key:"boundingVolumeWorldSpace",get:function(){return this._validateBoundingVolume(),this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){return this._validateBoundingVolume(),this._bvObjectSpace}},{key:"_validateBoundingVolume",value:function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();var e,t=(0,r.Z)(this._geometries);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=n.boundingInfo;(0,u.pC)(i)&&(x(i,this._bvObjectSpace,n.shaderTransformation),x(i,this._bvWorldSpace,this._getCombinedShaderTransformation(n)))}}catch(C){t.e(C)}finally{t.f()}(0,d.h)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),(0,d.h)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);var a,o=(0,h.c)(),s=(0,h.c)(),l=(0,p.u1)(this.transformation),c=(0,r.Z)(this._geometries);try{for(c.s();!(a=c.n()).done;){var f=a.value,v=f.boundingInfo;if(!(0,u.Wi)(v)){var g=f.shaderTransformation,m=(0,p.u1)(g);(0,d.m)(o,v.center,g);var y=(0,d.i)(o,this._bvObjectSpace.bounds),_=v.radius*m;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],y+_),(0,d.m)(s,o,this.transformation);var T=(0,d.i)(s,this._bvWorldSpace.bounds),w=_*l;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],T+w)}}}catch(C){c.e(C)}finally{c.f()}this._bvDirty=!1}}},{key:"_invalidateBoundingVolume",value:function(){this._bvDirty=!0,(0,u.pC)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}},{key:"_emit",value:function(e,t){(0,u.pC)(this._parentLayer)&&this._parentLayer.events.emit(e,t)}},{key:"test",get:function(){var e=this;return{hasGeometry:function(t){return e._geometries.includes(t)},getGeometryIndex:function(t){return e._geometries.indexOf(t)}}}}]),n}(g.c),C=function(){function e(){(0,i.Z)(this,e),this.min=(0,h.f)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,h.f)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return(0,a.Z)(e,[{key:"isEmpty",value:function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}]),e}(),S=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).bounds=(0,f.c)(),e}return(0,a.Z)(n,[{key:"init",value:function(){(0,d.s)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),(0,d.s)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),(0,f.l)(this.bounds)}}]),n}(C);function x(e,t,n){var r=e.bbMin,i=e.bbMax;if((0,l.y)(n)){var a=(0,d.s)(b,n[12],n[13],n[14]);(0,d.a)(O,r,a),(0,d.a)(A,i,a);for(var o=0;o<3;++o)t.min[o]=Math.min(t.min[o],O[o]),t.max[o]=Math.max(t.max[o],A[o])}else if((0,d.m)(O,r,n),(0,d.k)(r,i))for(var s=0;s<3;++s)t.min[s]=Math.min(t.min[s],O[s]),t.max[s]=Math.max(t.max[s],O[s]);else{(0,d.m)(A,i,n);for(var u=0;u<3;++u)t.min[u]=Math.min(t.min[u],O[u],A[u]),t.max[u]=Math.max(t.max[u],O[u],A[u]);for(var c=0;c<3;++c){(0,d.c)(O,r),(0,d.c)(A,i),O[c]=i[c],A[c]=r[c],(0,d.m)(O,O,n),(0,d.m)(A,A,n);for(var h=0;h<3;++h)t.min[h]=Math.min(t.min[h],O[h],A[h]),t.max[h]=Math.max(t.max[h],O[h],A[h])}}}var b=(0,h.c)(),O=(0,h.c)(),A=(0,h.c)()},39077:function(e,t,n){n.d(t,{z:function(){return h}});var r=n(15671),i=n(43144),a=n(92026),o=n(95439),s=n(14226),u=n(81949),l=n(11186),c=n(67077),d=n(80064),h=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,r.Z)(this,e),this.geometry=t,this.boundingSphere=(0,c.c)(),this.screenToWorldRatio=1,this._transformation=(0,u.c)(),this._shaderTransformationDirty=!0,this.id=(0,o.D)(),this.layerUid=n.layerUid,this.graphicUid=n.graphicUid,this.boundingInfo=n.boundingInfo,this.shaderTransformer=n.shaderTransformer,this.castShadow=!!n.castShadow&&n.castShadow}return(0,i.Z)(e,[{key:"transformation",get:function(){return this._transformation}},{key:"updateTransformation",value:function(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}},{key:"shaderTransformationChanged",value:function(){this._shaderTransformationDirty=!0}},{key:"computeBoundingSphere",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,d.u1)(e);(0,a.Wi)(this.boundingInfo)||((0,l.m)(t,this.boundingInfo.center,e),t[3]=this.boundingInfo.radius*n)}},{key:"hasShaderTransformation",get:function(){return(0,a.pC)(this.shaderTransformer)}},{key:"material",get:function(){return this.geometry.material}},{key:"type",get:function(){return this.geometry.type}},{key:"shaderTransformation",get:function(){return(0,a.Wi)(this.shaderTransformer)?this.transformation:(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=(0,u.c)()),(0,s.c)(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1),this._shaderTransformation)}},{key:"indices",get:function(){return this.geometry.indices}},{key:"vertexAttributes",get:function(){return this.geometry.vertexAttributes}},{key:"highlights",get:function(){return this.geometry.highlights}},{key:"occludees",get:function(){return this.geometry.occludees}},{key:"visible",get:function(){return this.geometry.visible},set:function(e){this.geometry.visible=e}}]),e}()},78485:function(e,t,n){var r;n.d(t,{j:function(){return r}}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(r||(r={}))},97882:function(e,t,n){n.d(t,{F:function(){return m}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(91505),l=n(100),c=n(92026),d=n(27546),h=n(1395),f=n(79100),p=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"],v=n(78329),g=n(78485),m=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r,a,o,s,c,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,i.Z)(this,n),(c=t.call(this)).apiLayerUid=h,c.type=f.U.Layer,c.events=new u.Z,c.sliceable=!1,c._objects=new d.Z,c._objectsAdded=new d.Z,c._stageHandles=new l.Z,c.apiLayerUid=h,c.visible=null===(r=null===e||void 0===e?void 0:e.visible)||void 0===r||r,c.pickable=null===(a=null===e||void 0===e?void 0:e.pickable)||void 0===a||a,c.updatePolicy=null!==(o=null===e||void 0===e?void 0:e.updatePolicy)&&void 0!==o?o:g.j.ASYNC,c._disableOctree=null!==(s=null===e||void 0===e?void 0:e.disableOctree)&&void 0!==s&&s,c}return(0,a.Z)(n,[{key:"objects",get:function(){return this._objects}},{key:"destroy",value:function(){this.detachStage(),this._stage=null}},{key:"attachStage",value:function(e){var t=this;this.detachStage(),this._stage=e;var n,i=(0,r.Z)(p);try{var a=function(){var r=n.value;t._stageHandles.add(t.events.on(r,(function(t){return e.handleEvent(r,t)})))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}}},{key:"detachStage",value:function(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}},{key:"add",value:function(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),(0,c.pC)(this._octree)&&this._objectsAdded.push(e)}},{key:"remove",value:function(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),(0,c.pC)(this._octree)&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}},{key:"addMany",value:function(e){this._objects.pushArray(e);var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){t.value.parentLayer=this}}catch(i){n.e(i)}finally{n.f()}this.events.emit("layerObjectsAdded",{layer:this,objects:e}),(0,c.pC)(this._octree)&&this._objectsAdded.pushArray(e)}},{key:"removeMany",value:function(e){var t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){var n,i=(0,r.Z)(t);try{for(i.s();!(n=i.n()).done;){n.value.parentLayer=null}}catch(o){i.e(o)}finally{i.f()}if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),(0,c.pC)(this._octree)){for(var a=0;a<t.length;)this._objectsAdded.removeUnordered(t[a])?(t[a]=t[t.length-1],t.length-=1):++a;this._octree.remove(t)}}}},{key:"sync",value:function(){(0,c.pC)(this._stage)&&this.updatePolicy!==g.j.SYNC&&this._stage.syncLayer(this.id)}},{key:"notifyObjectBBChanged",value:function(e,t){(0,c.pC)(this._octree)&&!this._objectsAdded.includes(e)&&this._octree.update(e,t)}},{key:"getSpatialQueryAccelerator",value:function(){return(0,c.Wi)(this._octree)&&this._objects.length>50&&!this._disableOctree?(this._octree=new v.Z((function(e){return e.boundingVolumeWorldSpace.bounds})),this._octree.add(this._objects.data,this._objects.length)):(0,c.pC)(this._octree)&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}},{key:"shaderTransformationChanged",value:function(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}},{key:"invalidateSpatialQueryAccelerator",value:function(){this._octree=(0,c.SC)(this._octree),this._objectsAdded.clear()}}]),n}(h.c)},22178:function(e,t,n){n.d(t,{nn:function(){return a}});var r=n(92026),i=(n(11186),n(71353));n(82218),n(54463);function a(e){return(0,r.pC)(e)&&(0,r.pC)(e.dist)}(0,i.c)()},66832:function(e,t,n){n.d(t,{E:function(){return Z}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(93169),u=n(67077),l=n(37081),c=n(68401),d=n(23620),h=n(56529),f=n(78041),p=n(93822),v=n(12594),g=n(64642),m=n(11983),y=n(11752),_=n(61120),T=n(82144),w=n(31132),C=n(7566),S=n(27627),x=n(50411),b=n(25920),O=n(45028),A=n(49800),R=n(36207),P=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"initializeConfiguration",value:function(e,t){t.hasWebGL2Context=e.rctx.type===A.zO.WEBGL2}},{key:"initializeProgram",value:function(e){return new S.$(e.rctx,n.shader.get().build(this.configuration),C.i)}},{key:"_createPipeline",value:function(e,t){var n=this.configuration,r=e===b.A.NONE,i=e===b.A.FrontFace;return(0,R.sm)({blending:n.output!==l.H.Color&&n.output!==l.H.Alpha||!n.transparent?null:r?f.wu:(0,f.j7)(e),culling:(0,R.zp)(n.cullFace),depthTest:{func:(0,f.Bh)(e)},depthWrite:(r||i)&&n.writeDepth?R.LZ:null,colorWrite:R.BK,stencilWrite:n.hasOccludees?x.s3:null,stencilTest:n.hasOccludees?t?x.eD:x.RY:null,polygonOffset:r||i?n.polygonOffset?E:null:(0,f.je)(n.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,y.Z)((0,_.Z)(n.prototype),"getPipelineState",this).call(this,e,t)}}]),n}(w.A);P.shader=new T.J(O.C,(function(){return n.e(3173).then(n.bind(n,23173))}));var E={factor:1,units:1},D=n(27366),I=n(33559),M=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).output=l.H.Color,e.cullFace=c.Vr.None,e.hasSlicePlane=!1,e.hasVertexColors=!1,e.transparent=!1,e.polygonOffset=!1,e.enableOffset=!0,e.writeDepth=!0,e.hasOccludees=!1,e.transparencyPassType=b.A.NONE,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e.objectAndLayerIdColorInstanced=!1,e}return(0,i.Z)(n)}(n(8883).W);(0,D._)([(0,I.o)({count:l.H.COUNT})],M.prototype,"output",void 0),(0,D._)([(0,I.o)({count:c.Vr.COUNT})],M.prototype,"cullFace",void 0),(0,D._)([(0,I.o)()],M.prototype,"hasSlicePlane",void 0),(0,D._)([(0,I.o)()],M.prototype,"hasVertexColors",void 0),(0,D._)([(0,I.o)()],M.prototype,"transparent",void 0),(0,D._)([(0,I.o)()],M.prototype,"polygonOffset",void 0),(0,D._)([(0,I.o)()],M.prototype,"enableOffset",void 0),(0,D._)([(0,I.o)()],M.prototype,"writeDepth",void 0),(0,D._)([(0,I.o)()],M.prototype,"hasOccludees",void 0),(0,D._)([(0,I.o)({count:b.A.COUNT})],M.prototype,"transparencyPassType",void 0),(0,D._)([(0,I.o)()],M.prototype,"hasMultipassTerrain",void 0),(0,D._)([(0,I.o)()],M.prototype,"cullAboveGround",void 0),(0,D._)([(0,I.o)()],M.prototype,"objectAndLayerIdColorInstanced",void 0);var Z=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e,new k)).supportsEdges=!0,i._configuration=new M,i}return(0,i.Z)(n,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<f.ve,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}},{key:"requiresSlot",value:function(e,t){return!!(t===l.H.Color||t===l.H.Alpha||t===l.H.Highlight||t===l.H.Depth&&this.parameters.writeLinearDepth||t===l.H.ObjectAndLayerIdColor)&&(e===p.r.DRAPED_MATERIAL||(t===l.H.Highlight?e===p.r.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?p.r.TRANSPARENT_MATERIAL:p.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:p.r.OPAQUE_MATERIAL)))}},{key:"createGLMaterial",value:function(e){return new L(e)}},{key:"createBufferWriter",value:function(){return new v.G((0,s.Z)("enable-feature:objectAndLayerId-rendering")?g.ck:g.IM)}}]),n}(m.c),L=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return this._output!==l.H.Color&&this._output!==l.H.Alpha||this._updateOccludeeState(e),this.ensureTechnique(P,e)}}]),n}(d.Z),k=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).color=u.Z,e.transparent=!1,e.writeDepth=!0,e.writeLinearDepth=!1,e.hasVertexColors=!1,e.polygonOffset=!1,e.hasSlicePlane=!1,e.cullFace=c.Vr.None,e.hasOccludees=!1,e}return(0,i.Z)(n)}(h.Mt)},64642:function(e,t,n){n.d(t,{IM:function(){return s},W1:function(){return o},ck:function(){return u},wp:function(){return a}});var r=n(55158),i=n(4760),a=(0,r.U$)().vec3f(i.T.POSITION),o=(0,r.U$)().vec3f(i.T.POSITION).vec2f(i.T.UV0),s=(0,r.U$)().vec3f(i.T.POSITION).vec4u8(i.T.COLOR),u=((0,r.U$)().vec3f(i.T.POSITION).vec4u8(i.T.OBJECTANDLAYERIDCOLOR),(0,r.U$)().vec3f(i.T.POSITION).vec2f(i.T.UV0).vec4u8(i.T.OBJECTANDLAYERIDCOLOR),(0,r.U$)().vec3f(i.T.POSITION).vec4u8(i.T.COLOR).vec4u8(i.T.OBJECTANDLAYERIDCOLOR))},48800:function(e,t,n){n.d(t,{A:function(){return ee}});var r=n(1413),i=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(93169),l=n(16889),c=n(92026),d=n(22753),h=n(11873),f=n(14226),p=n(81949),v=n(88396),g=n(6394),m=n(11186),y=n(71353),_=n(67077);function T(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var w=n(65156),C=n(25158),S=n(94463),x=n(55158),b=n(37081),O=n(50600),A=n(17363),R=n(56529),P=n(93822),E=n(65216),D=n(97731),I=n(4760),M=(0,a.Z)((function e(){(0,i.Z)(this,e),this.factor=new Z,this.factorAlignment=new Z})),Z=(0,a.Z)((function e(){(0,i.Z)(this,e),this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0})),L=n(33236),k=n(22909),H=n(18442),N=n(50951),F=n(82144),z=n(31132),U=n(7566),j=n(78041),V=n(27627),W=n(25920),G=n(49800),B=n(8548),q=n(36207),J=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"initializeConfiguration",value:function(e,t){t.hasWebGL2Context=e.rctx.type===G.zO.WEBGL2,t.spherical=e.viewingMode===N.JY.Global}},{key:"initializeProgram",value:function(e){return new V.$(e.rctx,n.shader.get().build(this.configuration),U.i)}},{key:"_setPipelineState",value:function(e){var t=this.configuration,n=e===W.A.NONE,r=e===W.A.FrontFace,i=this.configuration.hasPolygonOffset?X:null,a=(n||r)&&t.output!==b.H.Highlight&&(t.depthEnabled||t.occlusionPass)?q.LZ:null;return(0,q.sm)({blending:t.output===b.H.Color||t.output===b.H.Alpha||t.output===b.H.Highlight?n?Y:(0,j.j7)(e):null,depthTest:{func:B.wb.LEQUAL},depthWrite:a,colorWrite:q.BK,polygonOffset:i})}},{key:"initializePipeline",value:function(){return this._setPipelineState(this.configuration.transparencyPassType)}},{key:"primitiveType",get:function(){return this.configuration.occlusionPass?B.MX.POINTS:B.MX.TRIANGLES}}]),n}(z.A);J.shader=new F.J(H.H,(function(){return n.e(6823).then(n.bind(n,16823))}));var X={factor:0,units:-4},Y=(0,q.if)(B.zi.ONE,B.zi.ONE_MINUS_SRC_ALPHA),$=n(27366),Q=n(33559),K=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).output=b.H.Color,e.screenCenterOffsetUnitsEnabled=O.d.World,e.transparencyPassType=W.A.NONE,e.spherical=!1,e.occlusionTestEnabled=!0,e.signedDistanceFieldEnabled=!1,e.vvSize=!1,e.vvColor=!1,e.hasVerticalOffset=!1,e.hasScreenSizePerspective=!1,e.debugDrawLabelBorder=!1,e.binaryHighlightOcclusionEnabled=!0,e.hasSlicePlane=!1,e.hasPolygonOffset=!1,e.depthEnabled=!0,e.pixelSnappingEnabled=!0,e.isDraped=!1,e.hasMultipassGeometry=!1,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e.occlusionPass=!1,e.objectAndLayerIdColorInstanced=!1,e}return(0,a.Z)(n)}(n(8883).W);(0,$._)([(0,Q.o)({count:b.H.COUNT})],K.prototype,"output",void 0),(0,$._)([(0,Q.o)({count:O.d.COUNT})],K.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,$._)([(0,Q.o)({count:W.A.COUNT})],K.prototype,"transparencyPassType",void 0),(0,$._)([(0,Q.o)()],K.prototype,"spherical",void 0),(0,$._)([(0,Q.o)()],K.prototype,"occlusionTestEnabled",void 0),(0,$._)([(0,Q.o)()],K.prototype,"signedDistanceFieldEnabled",void 0),(0,$._)([(0,Q.o)()],K.prototype,"vvSize",void 0),(0,$._)([(0,Q.o)()],K.prototype,"vvColor",void 0),(0,$._)([(0,Q.o)()],K.prototype,"hasVerticalOffset",void 0),(0,$._)([(0,Q.o)()],K.prototype,"hasScreenSizePerspective",void 0),(0,$._)([(0,Q.o)()],K.prototype,"debugDrawLabelBorder",void 0),(0,$._)([(0,Q.o)()],K.prototype,"binaryHighlightOcclusionEnabled",void 0),(0,$._)([(0,Q.o)()],K.prototype,"hasSlicePlane",void 0),(0,$._)([(0,Q.o)()],K.prototype,"hasPolygonOffset",void 0),(0,$._)([(0,Q.o)()],K.prototype,"depthEnabled",void 0),(0,$._)([(0,Q.o)()],K.prototype,"pixelSnappingEnabled",void 0),(0,$._)([(0,Q.o)()],K.prototype,"isDraped",void 0),(0,$._)([(0,Q.o)()],K.prototype,"hasMultipassGeometry",void 0),(0,$._)([(0,Q.o)()],K.prototype,"hasMultipassTerrain",void 0),(0,$._)([(0,Q.o)()],K.prototype,"cullAboveGround",void 0),(0,$._)([(0,Q.o)()],K.prototype,"occlusionPass",void 0),(0,$._)([(0,Q.o)()],K.prototype,"objectAndLayerIdColorInstanced",void 0),(0,$._)([(0,Q.o)({constValue:!0})],K.prototype,"hasSliceInVertexProgram",void 0),(0,$._)([(0,Q.o)({constValue:!1})],K.prototype,"hasVvInstancing",void 0);var ee=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e,new Te))._configuration=new K,r}return(0,a.Z)(n,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?O.d.Screen:O.d.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=t.slot===P.r.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===b.H.Color||e===b.H.Alpha),e===b.H.Color&&(this._configuration.debugDrawLabelBorder=!!S.Z.LABELS_SHOW_BORDER),e===b.H.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassGeometry=t.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}},{key:"intersect",value:function(e,t,n,r,i,a){if(n.options.selectionMode&&n.options.hud&&e.visible){var o=this.parameters,s=1,u=1;if((0,d.f)(ce,t),(0,c.pC)(e.shaderTransformer)){var l=e.shaderTransformer(ve);s=l[0],u=l[5],function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=1/Math.sqrt(t*t+n*n+r*r),d=1/Math.sqrt(i*i+a*a+o*o),h=1/Math.sqrt(s*s+u*u+l*l);e[0]=t*c,e[1]=n*c,e[2]=r*c,e[3]=i*d,e[4]=a*d,e[5]=o*d,e[6]=s*h,e[7]=u*h,e[8]=l*h}(ce)}var h=e.vertexAttributes.get(I.T.POSITION),p=e.vertexAttributes.get(I.T.SIZE),v=e.vertexAttributes.get(I.T.NORMAL),g=e.vertexAttributes.get(I.T.AUXPOS1);(0,D.hu)(h.size>=3);var _=n.point,T=n.camera,w=(0,H.c)(o);s*=T.pixelRatio,u*=T.pixelRatio;for(var C="screen"===this.parameters.centerOffsetUnits,S=0;S<h.data.length/h.size;S++){var x=S*h.size;(0,m.s)(ae,h.data[x],h.data[x+1],h.data[x+2]),(0,m.m)(ae,ae,t);var b=S*p.size;ye[0]=p.data[b]*s,ye[1]=p.data[b+1]*u,(0,m.m)(ae,ae,T.viewMatrix);var O=S*g.size;if((0,m.s)(fe,g.data[O+0],g.data[O+1],g.data[O+2]),!C&&(ae[0]+=fe[0],ae[1]+=fe[1],0!==fe[2])){var A=fe[2];(0,m.n)(fe,ae),(0,m.b)(ae,ae,(0,m.g)(fe,fe,A))}var R=S*v.size;if((0,m.s)(oe,v.data[R],v.data[R+1],v.data[R+2]),this._normalAndViewAngle(oe,ce,T,pe),this._applyVerticalOffsetTransformationView(ae,pe,T,re),T.applyProjection(ae,se),se[0]>-1){se[0]=Math.floor(se[0]),se[1]=Math.floor(se[1]),C&&(fe[0]||fe[1])&&(se[0]+=fe[0],0!==fe[1]&&(se[1]+=(0,E.sX)(fe[1],re.factorAlignment)),T.unapplyProjection(se,ae)),se[0]+=this.parameters.screenOffset[0],se[1]+=this.parameters.screenOffset[1],(0,E.TU)(ye,re.factor,ye);var P=ge*T.pixelRatio,M=0;if(o.textureIsSignedDistanceField&&(M=o.outlineSize*T.pixelRatio/2),_&&ne(_,se[0],se[1],ye,P,M,o,w)){var Z=n.ray;if((0,m.m)(le,ae,(0,f.a)(he,T.viewMatrix)),se[0]=_[0],se[1]=_[1],T.unprojectFromRenderScreen(se,ae)){var L=(0,y.c)();(0,m.c)(L,Z.direction);var k=1/(0,m.l)(L);(0,m.g)(L,L,k),a((0,m.i)(Z.origin,ae)*k,L,-1,!0,1,le)}}}}}}},{key:"intersectDraped",value:function(e,t,n,r,i,a){var o=e.vertexAttributes.get(I.T.POSITION),s=e.vertexAttributes.get(I.T.SIZE),u=this.parameters,l=(0,H.c)(u),d=1,h=1;if((0,c.pC)(e.shaderTransformer)){var f=e.shaderTransformer(ve);d=f[0],h=f[5]}d*=e.screenToWorldRatio,h*=e.screenToWorldRatio;for(var p=me*e.screenToWorldRatio,v=0;v<o.data.length/o.size;v++){var g=v*o.size,m=o.data[g],y=o.data[g+1],_=v*s.size;ye[0]=s.data[_]*d,ye[1]=s.data[_+1]*h;var T=0;u.textureIsSignedDistanceField&&(T=u.outlineSize*e.screenToWorldRatio/2),ne(r,m,y,ye,p,T,u,l)&&i(a.dist,a.normal,-1,!1)}}},{key:"createBufferWriter",value:function(){return new Se(this)}},{key:"_normalAndViewAngle",value:function(e,t,n,r){return T(t)&&(t=(0,d.f)(de,t)),(0,m.t)(r.normal,e,t),(0,m.m)(r.normal,r.normal,n.viewInverseTransposeMatrix),r.cosAngle=(0,m.e)(ue,_e),r}},{key:"_updateScaleInfo",value:function(e,t,n){var r=this.parameters;(0,c.pC)(r.screenSizePerspective)?(0,E.PV)(n,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),(0,c.pC)(r.screenSizePerspectiveAlignment)?(0,E.PV)(n,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}},{key:"applyShaderOffsetsView",value:function(e,t,n,r,i,a,o){var s=this._normalAndViewAngle(t,n,i,pe);return this._applyVerticalGroundOffsetView(e,s,i,o),this._applyVerticalOffsetTransformationView(o,s,i,a),this._applyPolygonOffsetView(o,s,r[3],i,o),this._applyCenterOffsetView(o,r,o),o}},{key:"applyShaderOffsetsNDC",value:function(e,t,n,r,i){return this._applyCenterOffsetNDC(e,t,n,r),(0,c.pC)(i)&&(0,m.c)(i,r),this._applyPolygonOffsetNDC(r,t,n,r),r}},{key:"_applyPolygonOffsetView",value:function(e,t,n,r,i){var a=r.aboveGround?1:-1,o=Math.sign(n);0===o&&(o=a);var s=a*o;if(this.parameters.shaderPolygonOffset<=0)return(0,m.c)(i,e);var u=(0,l.uZ)(Math.abs(t.cosAngle),.01,1),c=1-Math.sqrt(1-u*u)/u/r.viewport[2];return(0,m.g)(i,e,s>0?c:1/c),i}},{key:"_applyVerticalGroundOffsetView",value:function(e,t,n,r){var i=(0,m.l)(e),a=n.aboveGround?1:-1,o=.5*n.computeRenderPixelSizeAtDist(i),s=(0,m.g)(ae,t.normal,a*o);return(0,m.a)(r,e,s),r}},{key:"_applyVerticalOffsetTransformationView",value:function(e,t,n,r){var i=this.parameters;if(!i.verticalOffset||!i.verticalOffset.screenLength){if(i.screenSizePerspective||i.screenSizePerspectiveAlignment){var a=(0,m.l)(e);this._updateScaleInfo(r,a,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}var o=(0,m.l)(e),s=(0,c.Pt)(i.screenSizePerspectiveAlignment,i.screenSizePerspective),u=(0,k.Hx)(n,o,i.verticalOffset,t.cosAngle,s);return this._updateScaleInfo(r,o,t.cosAngle),(0,m.g)(t.normal,t.normal,u),(0,m.a)(e,e,t.normal)}},{key:"_applyCenterOffsetView",value:function(e,t,n){var r="screen"!==this.parameters.centerOffsetUnits;return n!==e&&(0,m.c)(n,e),r&&(n[0]+=t[0],n[1]+=t[1],t[2]&&((0,m.n)(oe,n),(0,m.a)(n,n,(0,m.g)(oe,oe,t[2])))),n}},{key:"_applyCenterOffsetNDC",value:function(e,t,n,r){var i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,m.c)(r,e),i||(r[0]+=t[0]/n.fullWidth*2,r[1]+=t[1]/n.fullHeight*2),r}},{key:"_applyPolygonOffsetNDC",value:function(e,t,n,r){var i=this.parameters.shaderPolygonOffset;if(e!==r&&(0,m.c)(r,e),i){var a=n.aboveGround?1:-1,o=a*Math.sign(t[3]);r[2]-=(o||a)*i}return r}},{key:"requiresSlot",value:function(e,t){if(t===b.H.Color||t===b.H.Alpha||t===b.H.Highlight||t===b.H.ObjectAndLayerIdColor){if(e===P.r.DRAPED_MATERIAL)return!0;var n=this.parameters,r=n.drawInSecondSlot,i=n.occlusionTest;return e===(r?P.r.LABEL_MATERIAL:P.r.HUD_MATERIAL)||i&&e===P.r.OCCLUSION_PIXELS}return!1}},{key:"createGLMaterial",value:function(e){return new te(e)}},{key:"calculateRelativeScreenBounds",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,w.Ue)();return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ie;(0,v.c)(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*n,r[1]+=e.screenOffset[1]*n}(this.parameters,e,t,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n}}]),n}(R.F5),te=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,(0,r.Z)((0,r.Z)({},e),e.material.parameters))}return(0,a.Z)(n,[{key:"selectProgram",value:function(e){return this.ensureTechnique(J,e)}},{key:"beginSlot",value:function(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}]),n}(A.F);function ne(e,t,n,r,i,a,o,s){var u=t-i-(s[0]>0?r[0]*s[0]:0),l=u+r[0]+2*i,d=n-i-(s[1]>0?r[1]*s[1]:0),h=d+r[1]+2*i,f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&(0,c.pC)(f)&&(u+=r[0]*f[0],d+=r[1]*f[1],l-=r[0]*(1-f[2]),h-=r[1]*(1-f[3]),u-=a,l+=a,d-=a,h+=a),e[0]>u&&e[0]<l&&e[1]>d&&e[1]<h}var re=new M,ie=(0,g.a)(),ae=(0,y.c)(),oe=(0,y.c)(),se=(0,_.c)(),ue=(0,y.c)(),le=(0,y.c)(),ce=(0,h.c)(),de=(0,h.c)(),he=(0,p.c)(),fe=(0,y.c)(),pe={normal:ue,cosAngle:0},ve=(0,p.c)(),ge=1,me=2,ye=[0,0],_e=(0,y.f)(0,0,1),Te=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).renderOccluded=R.yD.Occlude,e.color=(0,_.f)(1,1,1,1),e.texCoordScale=[1,1],e.polygonOffset=!1,e.anchorPosition=(0,g.f)(.5,.5),e.screenOffset=[0,0],e.shaderPolygonOffset=1e-5,e.textureIsSignedDistanceField=!1,e.outlineColor=(0,_.f)(1,1,1,1),e.outlineSize=0,e.vvSizeEnabled=!1,e.vvSizeMinSize=[1,1,1],e.vvSizeMaxSize=[100,100,100],e.vvSizeOffset=[0,0,0],e.vvSizeFactor=[1,1,1],e.vvColorEnabled=!1,e.vvColorValues=[0,0,0,0,0,0,0,0],e.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],e.hasSlicePlane=!1,e.pixelSnappingEnabled=!0,e.occlusionTest=!0,e.binaryHighlightOcclusion=!0,e.centerOffsetUnits="world",e.drawInSecondSlot=!1,e.depthEnabled=!0,e.isDraped=!1,e}return(0,a.Z)(n)}(A.E),we=(0,x.U$)().vec3f(I.T.POSITION).vec3f(I.T.NORMAL).vec2f(I.T.UV0).vec4u8(I.T.COLOR).vec2f(I.T.SIZE).vec4f(I.T.AUXPOS1).vec4f(I.T.AUXPOS2),Ce=we.clone().vec4u8(I.T.OBJECTANDLAYERIDCOLOR),Se=function(){function e(t){(0,i.Z)(this,e),this._material=t,this.vertexBufferLayout=(0,u.Z)("enable-feature:objectAndLayerId-rendering")?Ce:we}return(0,a.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 6*e.indices.get(I.T.POSITION).length}},{key:"write",value:function(e,t,n,r,i){(0,L.ho)(n.indices.get(I.T.POSITION),n.vertexAttributes.get(I.T.POSITION).data,e,r.position,i,6),(0,L.s5)(n.indices.get(I.T.NORMAL),n.vertexAttributes.get(I.T.NORMAL).data,t,r.normal,i,6);var a,o,s,u,l=n.vertexAttributes.get(I.T.UV0).data;if(null==l||l.length<4){var d=this._material.parameters;a=0,o=0,s=d.texCoordScale[0],u=d.texCoordScale[1]}else a=l[0],o=l[1],s=l[2],u=l[3];s=Math.min(1.99999,s+1),u=Math.min(1.99999,u+1);for(var h=n.indices.get(I.T.POSITION).length,f=i,p=r.uv0,v=0;v<h;++v)p.set(f,0,a),p.set(f,1,o),f+=1,p.set(f,0,s),p.set(f,1,o),f+=1,p.set(f,0,s),p.set(f,1,u),f+=1,p.set(f,0,s),p.set(f,1,u),f+=1,p.set(f,0,a),p.set(f,1,u),f+=1,p.set(f,0,a),p.set(f,1,o),f+=1;(0,L.Vs)(n.indices.get(I.T.COLOR),n.vertexAttributes.get(I.T.COLOR).data,4,r.color,i,6);var g=n.indices.get(I.T.SIZE),m=n.vertexAttributes.get(I.T.SIZE).data;h=g.length;var y=r.size;f=i;for(var _=0;_<h;++_)for(var T=m[2*g[_]],w=m[2*g[_]+1],S=0;S<6;++S)y.set(f,0,T),y.set(f,1,w),f+=1;if(n.indices.get(I.T.AUXPOS1)&&n.vertexAttributes.get(I.T.AUXPOS1)?(0,L.SW)(n.indices.get(I.T.AUXPOS1),n.vertexAttributes.get(I.T.AUXPOS1).data,r.auxpos1,i,6):(0,L.h)(r.auxpos1,i,6*h),n.indices.get(I.T.AUXPOS2)&&n.vertexAttributes.get(I.T.AUXPOS2)?(0,L.SW)(n.indices.get(I.T.AUXPOS2),n.vertexAttributes.get(I.T.AUXPOS2).data,r.auxpos2,i,6):(0,L.h)(r.auxpos2,i,6*h),(0,c.pC)(n.objectAndLayerIdColor)&&n.indices.get(I.T.POSITION)){var x=n.indices.get(I.T.POSITION).length,b=r.getField(I.T.OBJECTANDLAYERIDCOLOR,C.mc);(0,L.xP)(n.objectAndLayerIdColor,b,x,i,6)}}}]),e}()},24231:function(e,t,n){n.d(t,{Y:function(){return W}});var r=n(11752),i=n(61120),a=n(15671),o=n(43144),s=n(60136),u=n(29388),l=n(32718),c=n(16889),d=n(92026),h=n(17842),f=n(88396),p=n(11186),v=n(71353),g=n(67077),m=n(95773),y=n(85981),_=n(55652),T=n(25158),w=n(37081),C=n(23620),S=n(56529),x=n(93822),b=n(97731),O=n(4760),A=n(12594),R=n(64642),P=n(33236),E=n(82144),D=n(31132),I=n(7566),M=n(27627),Z=n(50411),L=n(99337),k=n(49800),H=n(8548),N=n(36207),F=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"_stippleEnabled",get:function(){return this.configuration.stippleEnabled&&this.configuration.output!==w.H.Highlight}},{key:"initializeConfiguration",value:function(e,t){t.hasWebGL2Context=e.rctx.type===k.zO.WEBGL2}},{key:"initializeProgram",value:function(e){return new M.$(e.rctx,n.shader.get().build(this.configuration),I.i)}},{key:"initializePipeline",value:function(){var e=this.configuration,t=(0,N.wK)(H.zi.SRC_ALPHA,H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA,H.zi.ONE_MINUS_SRC_ALPHA),n=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,N.sm)({blending:n,depthTest:Z.JN,depthWrite:r,colorWrite:N.BK,stencilWrite:e.hasOccludees?Z.s3:null,stencilTest:e.hasOccludees?t?Z.eD:Z.RY:null})};return e.output===w.H.Color?(this._occludeePipelineState=n(!0,e.transparent||this._stippleEnabled?t:null,N.LZ),n(!1,e.transparent||this._stippleEnabled?t:null,N.LZ)):n(!1)}},{key:"primitiveType",get:function(){return H.MX.LINES}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,r.Z)((0,i.Z)(n.prototype),"getPipelineState",this).call(this,e,t)}}]),n}(D.A);F.shader=new E.J(L.N,(function(){return n.e(8569).then(n.bind(n,78569))}));var z,U=n(27366),j=n(33559),V=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).output=w.H.Color,e.hasSlicePlane=!1,e.hasVertexColors=!1,e.transparent=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stipplePreferContinuous=!0,e.hasOccludees=!1,e}return(0,o.Z)(n)}(n(8883).W);(0,U._)([(0,j.o)({count:w.H.COUNT})],V.prototype,"output",void 0),(0,U._)([(0,j.o)()],V.prototype,"hasSlicePlane",void 0),(0,U._)([(0,j.o)()],V.prototype,"hasVertexColors",void 0),(0,U._)([(0,j.o)()],V.prototype,"transparent",void 0),(0,U._)([(0,j.o)()],V.prototype,"draped",void 0),(0,U._)([(0,j.o)()],V.prototype,"stippleEnabled",void 0),(0,U._)([(0,j.o)()],V.prototype,"stippleOffColorEnabled",void 0),(0,U._)([(0,j.o)()],V.prototype,"stipplePreferContinuous",void 0),(0,U._)([(0,j.o)()],V.prototype,"hasOccludees",void 0),(0,U._)([(0,j.o)({constValue:!1})],V.prototype,"stippleRequiresClamp",void 0),(0,U._)([(0,j.o)({constValue:!1})],V.prototype,"stippleScaleWithLineWidth",void 0),(0,U._)([(0,j.o)({constValue:!1})],V.prototype,"stippleRequiresStretchMeasure",void 0),function(e){e[e.START=0]="START",e[e.END=1]="END"}(z||(z={}));var W=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this,e,new q))._configuration=new V,r}return(0,o.Z)(n,[{key:"getConfiguration",value:function(e,t){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=t.slot===x.r.DRAPED_MATERIAL;var n=(0,d.pC)(this.parameters.stipplePattern);return this._configuration.stippleEnabled=n,this._configuration.stippleOffColorEnabled=n&&(0,d.pC)(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}},{key:"intersect",value:function(e,t,n,r,i,a){if(n.options.selectionMode&&e.visible)if((0,b.kG)(t)){var o=e.vertexAttributes.get(O.T.POSITION).data,s=n.camera,u=ie;(0,f.c)(u,n.point);(0,p.s)(ae[0],u[0]-2,u[1]+2,0),(0,p.s)(ae[1],u[0]+2,u[1]+2,0),(0,p.s)(ae[2],u[0]+2,u[1]-2,0),(0,p.s)(ae[3],u[0]-2,u[1]-2,0);for(var c=0;c<4;c++)if(!s.unprojectFromRenderScreen(ae[c],oe[c]))return;(0,_.zk)(s.eye,oe[0],oe[1],se),(0,_.zk)(s.eye,oe[1],oe[2],ue),(0,_.zk)(s.eye,oe[2],oe[3],le),(0,_.zk)(s.eye,oe[3],oe[0],ce);for(var d=Number.MAX_VALUE,h=0,v=0;v<o.length-5;v+=3)if(J[0]=o[v]+t[12],J[1]=o[v+1]+t[13],J[2]=o[v+2]+t[14],X[0]=o[v+3]+t[12],X[1]=o[v+4]+t[13],X[2]=o[v+5]+t[14],!((0,_.jH)(se,J)<0&&(0,_.jH)(se,X)<0||(0,_.jH)(ue,J)<0&&(0,_.jH)(ue,X)<0||(0,_.jH)(le,J)<0&&(0,_.jH)(le,X)<0||(0,_.jH)(ce,J)<0&&(0,_.jH)(ce,X)<0)){if(s.projectToRenderScreen(J,Q),s.projectToRenderScreen(X,K),Q[2]<0&&K[2]>0){(0,p.b)(Y,J,X);var g=s.frustum,T=-(0,_.jH)(g[m.Nu.NEAR],J)/(0,p.e)(Y,(0,_.mJ)(g[m.Nu.NEAR]));(0,p.g)(Y,Y,T),(0,p.a)(J,J,Y),s.projectToRenderScreen(J,Q)}else if(Q[2]>0&&K[2]<0){(0,p.b)(Y,X,J);var w=s.frustum,C=-(0,_.jH)(w[m.Nu.NEAR],X)/(0,p.e)(Y,(0,_.mJ)(w[m.Nu.NEAR]));(0,p.g)(Y,Y,C),(0,p.a)(X,X,Y),s.projectToRenderScreen(X,K)}else if(Q[2]<0&&K[2]<0)continue;Q[2]=0,K[2]=0;var S=(0,y.Jk)((0,y.zk)(Q,K,ne),u);S<d&&(d=S,(0,p.c)(ee,J),(0,p.c)(te,X),h=v/3)}var x=n.rayBegin,A=n.rayEnd;if(d<4){var R=Number.MAX_VALUE;if((0,y.AR)((0,y.zk)(ee,te,ne),(0,y.zk)(x,A,re),$)){(0,p.b)($,$,x);var P=(0,p.l)($);(0,p.g)($,$,1/P),R=P/(0,p.i)(x,A)}a(R,$,h,!1)}}else l.Z.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")}},{key:"intersectDraped",value:function(e,t,n,r,i,a){if(n.options.selectionMode){for(var o=e.vertexAttributes.get(O.T.POSITION).data,s=e.vertexAttributes.get(O.T.SIZE),u=s?s.data[0]:0,l=r[0],d=r[1],h=((u+1)/2+4)*e.screenToWorldRatio,f=Number.MAX_VALUE,p=0,v=0;v<o.length-5;v+=3){var g=o[v],m=o[v+1],y=l-g,_=d-m,T=o[v+3]-g,w=o[v+4]-m,C=(0,c.uZ)((T*y+w*_)/(T*T+w*w),0,1),S=T*C-y,x=w*C-_,b=S*S+x*x;b<f&&(f=b,p=v/3)}f<h*h&&i(a.dist,a.normal,p,!1)}}},{key:"requiresSlot",value:function(e,t){return!(t!==w.H.Color&&t!==w.H.Highlight&&t!==w.H.ObjectAndLayerIdColor||e!==x.r.OPAQUE_MATERIAL&&e!==x.r.DRAPED_MATERIAL)}},{key:"createGLMaterial",value:function(e){return new G(e)}},{key:"createBufferWriter",value:function(){var e=this.parameters.hasVertexColors?R.IM:R.wp;return(0,d.Wi)(this.parameters.stipplePattern)?new A.G(e):new B(e.clone().vec3f(O.T.AUXPOS1).vec2f(O.T.UV0))}}]),n}(S.F5),G=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments))._stipplePattern=null,e}return(0,o.Z)(n,[{key:"dispose",value:function(){(0,r.Z)((0,i.Z)(n.prototype),"dispose",this).call(this),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){this._output===w.H.Color&&this._updateOccludeeState(e);var t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,t)),this._stipplePattern=t),this.ensureTechnique(F,e)}}]),n}(C.Z),B=function(){function e(t){(0,a.Z)(this,e),this.vertexBufferLayout=t}return(0,o.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get(O.T.POSITION).length}},{key:"write",value:function(e,t,n,r,i){(0,P.NK)(n,this.vertexBufferLayout,e,t,r,i),this._writeAuxpos1(e,n,r,i),this._writeUV0(e,n,r,i)}},{key:"_writeAuxpos1",value:function(e,t,n,r){var i=n.getField(O.T.AUXPOS1,T.ct),a=t.indices.get(O.T.POSITION),o=t.vertexAttributes.get(O.T.POSITION).data,s=e,u=i.typedBufferStride,l=i.typedBuffer;r*=u;for(var c=0;c<a.length-1;c+=2)for(var d=0,h=[1,0];d<h.length;d++){var f=3*a[c+h[d]],p=o[f],v=o[f+1],g=o[f+2],m=s[0]*p+s[4]*v+s[8]*g+s[12],y=s[1]*p+s[5]*v+s[9]*g+s[13],_=s[2]*p+s[6]*v+s[10]*g+s[14];l[r]=m,l[r+1]=y,l[r+2]=_,r+=u}}},{key:"_writeUV0",value:function(e,t,n,r){var i,a=n.getField(O.T.UV0,T.Eu),o=t.indices.get(O.T.POSITION),s=t.vertexAttributes.get(O.T.POSITION).data,u=null===(i=t.vertexAttributes.get(O.T.DISTANCETOSTART))||void 0===i?void 0:i.data,l=a.typedBufferStride,c=a.typedBuffer,d=0;c[r*=l]=z.START,c[r+1]=d,r+=l;var h=3*o[0],f=(0,p.s)(J,s[h],s[h+1],s[h+2]);e&&(0,p.m)(f,f,e);for(var v=X,g=o.length-1,m=1,y=u?function(e,t,n){return d=u[n]}:function(e,t,n){return d+=(0,p.i)(e,t)},_=1;_<g;_+=2){var w=3*o[_];(0,p.s)(v,s[w],s[w+1],s[w+2]),e&&(0,p.m)(v,v,e),y(f,v,m++);for(var C=0;C<2;++C)c[r]=1-C,c[r+1]=d,r+=l;(0,p.c)(f,v)}var S=3*o[g];(0,p.s)(v,s[S],s[S+1],s[S+2]),e&&(0,p.m)(v,v,e),y(f,v,m),c[r]=z.END,c[r+1]=d}}]),e}(),q=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).color=g.O,e.hasVertexColors=!1,e.hasSlicePlane=!1,e.width=1,e.stipplePreferContinuous=!0,e.hasOccludees=!1,e.stippleTexture=null,e}return(0,o.Z)(n)}(S.Mt),J=(0,v.c)(),X=(0,v.c)(),Y=(0,v.c)(),$=(0,v.c)(),Q=(0,h.J$)(),K=(0,h.J$)(),ee=(0,v.c)(),te=(0,v.c)(),ne=(0,y.Ue)(),re=(0,y.Ue)(),ie=(0,v.c)(),ae=[(0,h.J$)(),(0,h.J$)(),(0,h.J$)(),(0,h.J$)()],oe=[(0,v.c)(),(0,v.c)(),(0,v.c)(),(0,v.c)()],se=(0,_.Ue)(),ue=(0,_.Ue)(),le=(0,_.Ue)(),ce=(0,_.Ue)()},58901:function(e,t,n){n.d(t,{U:function(){return W}});var r=n(11752),i=n(61120),a=n(15671),o=n(43144),s=n(60136),u=n(29388),l=n(93169),c=n(32718),d=n(16889),h=n(92026),f=n(17842),p=n(88396),v=n(11186),g=n(71353),m=n(67077),y=n(95773),_=n(85981),T=n(55652),w=n(55158),C=n(37081),S=n(23620),x=n(56529),b=n(93822),O=n(97731),A=n(4760),R=n(65964),P=n(33720),E=n(98186),D=n(82144),I=n(31132),M=n(78041),Z=n(27627),L=n(50411),k=n(25920),H=n(8548),N=n(36207),F=new Map([[A.T.POSITION,0],[A.T.SUBDIVISIONFACTOR,1],[A.T.UV0,2],[A.T.AUXPOS1,3],[A.T.AUXPOS2,4],[A.T.COLOR,5],[A.T.COLORFEATUREATTRIBUTE,5],[A.T.SIZE,6],[A.T.SIZEFEATUREATTRIBUTE,6],[A.T.OPACITYFEATUREATTRIBUTE,7],[A.T.OBJECTANDLAYERIDCOLOR,8]]),z=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"initializeProgram",value:function(e){return new Z.$(e.rctx,n.shader.get().build(this.configuration),F)}},{key:"_makePipelineState",value:function(e,t){var n=this.configuration,r=e===k.A.NONE,i=e===k.A.FrontFace;return(0,N.sm)({blending:n.output===C.H.Color||n.output===C.H.Alpha?r?M.wu:(0,M.j7)(e):null,depthTest:{func:(0,M.Bh)(e)},depthWrite:r?n.writeDepth?N.LZ:null:(0,M.K5)(e),colorWrite:N.BK,stencilWrite:n.hasOccludees?L.s3:null,stencilTest:n.hasOccludees?t?L.eD:L.RY:null,polygonOffset:r||i?n.hasPolygonOffset?j:null:M.E0})}},{key:"initializePipeline",value:function(){var e=this.configuration;if(e.occluder){var t=e.hasPolygonOffset?j:null;this._occluderPipelineTransparent=(0,N.sm)({blending:M.wu,polygonOffset:t,depthTest:L.zV,depthWrite:null,colorWrite:N.BK,stencilWrite:null,stencilTest:L.YD}),this._occluderPipelineOpaque=(0,N.sm)({blending:M.wu,polygonOffset:t,depthTest:L.zV,depthWrite:null,colorWrite:N.BK,stencilWrite:L.P7,stencilTest:L.ii}),this._occluderPipelineMaskWrite=(0,N.sm)({blending:null,polygonOffset:t,depthTest:L.JN,depthWrite:null,colorWrite:null,stencilWrite:L.s3,stencilTest:L.eD})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}},{key:"primitiveType",get:function(){return this.configuration.wireframe?H.MX.LINES:H.MX.TRIANGLE_STRIP}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===b.r.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===b.r.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:(0,r.Z)((0,i.Z)(n.prototype),"getPipelineState",this).call(this,e,t)}}]),n}(I.A);z.shader=new D.J(E.a,(function(){return n.e(6279).then(n.bind(n,56279))}));var U,j={factor:0,units:-4},V=n(737);!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"}(U||(U={}));var W=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this,e,new B))._configuration=new V.G,r._vertexAttributeLocations=F,r._layout=r.createLayout(),r}return(0,o.Z)(n,[{key:"isClosed",value:function(e,t){return Y(this.parameters,e,t)}},{key:"getConfiguration",value:function(e,t){this._configuration.output=e,this._configuration.draped=t.slot===b.r.DRAPED_MATERIAL;var n=(0,h.pC)(this.parameters.stipplePattern)&&e!==C.H.Highlight;return this._configuration.stippleEnabled=n,this._configuration.stippleOffColorEnabled=n&&(0,h.pC)(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=n&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=n&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!(0,h.pC)(this.parameters.markerParameters)&&function(e){return e.anchor===P.i5.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&(0,h.pC)(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===x.yD.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}},{key:"intersectDraped",value:function(e,t,n,r,i,a){if(n.options.selectionMode){var o=e.vertexAttributes.get(A.T.POSITION).data,s=e.vertexAttributes.get(A.T.SIZE),u=this.parameters.width;if(this.parameters.vvSizeEnabled){var l=e.vertexAttributes.get(A.T.SIZEFEATUREATTRIBUTE).data[0];u*=(0,d.uZ)(this.parameters.vvSizeOffset[0]+l*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else s&&(u*=s.data[0]);for(var c=r[0],h=r[1],f=(u/2+4)*e.screenToWorldRatio,p=Number.MAX_VALUE,v=0,g=0;g<o.length-5;g+=3){var m=o[g],y=o[g+1],_=c-m,T=h-y,w=o[g+3]-m,C=o[g+4]-y,S=(0,d.uZ)((w*_+C*T)/(w*w+C*C),0,1),x=w*S-_,b=C*S-T,O=x*x+b*b;O<p&&(p=O,v=g/3)}p<f*f&&i(a.dist,a.normal,v,!1)}}},{key:"intersect",value:function(e,t,n,r,i,a){if(n.options.selectionMode&&e.visible)if((0,O.kG)(t)){var o=e.vertexAttributes,s=o.get(A.T.POSITION).data,u=this.parameters.width;if(this.parameters.vvSizeEnabled){var l=o.get(A.T.SIZEFEATUREATTRIBUTE).data[0];u*=(0,d.uZ)(this.parameters.vvSizeOffset[0]+l*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(A.T.SIZE)&&(u*=o.get(A.T.SIZE).data[0]);var h=n.camera,f=te;(0,p.c)(f,n.point);var g=u*h.pixelRatio/2+4*h.pixelRatio;(0,v.s)(de[0],f[0]-g,f[1]+g,0),(0,v.s)(de[1],f[0]+g,f[1]+g,0),(0,v.s)(de[2],f[0]+g,f[1]-g,0),(0,v.s)(de[3],f[0]-g,f[1]-g,0);for(var m=0;m<4;m++)if(!h.unprojectFromRenderScreen(de[m],he[m]))return;(0,T.zk)(h.eye,he[0],he[1],fe),(0,T.zk)(h.eye,he[1],he[2],pe),(0,T.zk)(h.eye,he[2],he[3],ve),(0,T.zk)(h.eye,he[3],he[0],ge);for(var w=Number.MAX_VALUE,C=0,S=X(this.parameters,o,e.indices)?s.length-2:s.length-5,x=0;x<S;x+=3){$[0]=s[x]+t[12],$[1]=s[x+1]+t[13],$[2]=s[x+2]+t[14];var b=(x+3)%s.length;if(Q[0]=s[b]+t[12],Q[1]=s[b+1]+t[13],Q[2]=s[b+2]+t[14],!((0,T.jH)(fe,$)<0&&(0,T.jH)(fe,Q)<0||(0,T.jH)(pe,$)<0&&(0,T.jH)(pe,Q)<0||(0,T.jH)(ve,$)<0&&(0,T.jH)(ve,Q)<0||(0,T.jH)(ge,$)<0&&(0,T.jH)(ge,Q)<0)){if(h.projectToRenderScreen($,ne),h.projectToRenderScreen(Q,re),ne[2]<0&&re[2]>0){(0,v.b)(K,$,Q);var R=h.frustum,P=-(0,T.jH)(R[y.Nu.NEAR],$)/(0,v.e)(K,(0,T.mJ)(R[y.Nu.NEAR]));(0,v.g)(K,K,P),(0,v.a)($,$,K),h.projectToRenderScreen($,ne)}else if(ne[2]>0&&re[2]<0){(0,v.b)(K,Q,$);var E=h.frustum,D=-(0,T.jH)(E[y.Nu.NEAR],Q)/(0,v.e)(K,(0,T.mJ)(E[y.Nu.NEAR]));(0,v.g)(K,K,D),(0,v.a)(Q,Q,K),h.projectToRenderScreen(Q,re)}else if(ne[2]<0&&re[2]<0)continue;ne[2]=0,re[2]=0;var I=(0,_.Jk)((0,_.zk)(ne,re,oe),f);I<w&&(w=I,(0,v.c)(ie,$),(0,v.c)(ae,Q),C=x/3)}}var M=n.rayBegin,Z=n.rayEnd;if(w<g*g){var L=Number.MAX_VALUE;if((0,_.AR)((0,_.zk)(ie,ae,oe),(0,_.zk)(M,Z,se),ee)){(0,v.b)(ee,ee,M);var k=(0,v.l)(ee);(0,v.g)(ee,ee,1/k),L=k/(0,v.i)(M,Z)}a(L,ee,C,!1)}}else c.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix")}},{key:"createLayout",value:function(){var e=(0,w.U$)().vec3f(A.T.POSITION).f32(A.T.SUBDIVISIONFACTOR).vec2f(A.T.UV0).vec3f(A.T.AUXPOS1).vec3f(A.T.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(A.T.SIZEFEATUREATTRIBUTE):e.f32(A.T.SIZE),this.parameters.vvColorEnabled?e.f32(A.T.COLORFEATUREATTRIBUTE):e.vec4f(A.T.COLOR),this.parameters.vvOpacityEnabled&&e.f32(A.T.OPACITYFEATUREATTRIBUTE),(0,l.Z)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(A.T.OBJECTANDLAYERIDCOLOR),e}},{key:"createBufferWriter",value:function(){return new q(this._layout,this.parameters)}},{key:"requiresSlot",value:function(e,t){return(t===C.H.Color||t===C.H.Alpha||t===C.H.Highlight||t===C.H.Depth||t===C.H.ObjectAndLayerIdColor)&&(e===b.r.DRAPED_MATERIAL||(this.parameters.renderOccluded===x.yD.OccludeAndTransparentStencil?e===b.r.OPAQUE_MATERIAL||e===b.r.OCCLUDER_MATERIAL||e===b.r.TRANSPARENT_OCCLUDER_MATERIAL:t===C.H.Color||t===C.H.Alpha?e===(this.parameters.writeDepth?b.r.TRANSPARENT_MATERIAL:b.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===b.r.OPAQUE_MATERIAL))}},{key:"createGLMaterial",value:function(e){return new G(e)}},{key:"validateParameters",value:function(e){"miter"!==e.join&&(e.miterLimit=0),(0,h.pC)(e.markerParameters)&&(e.markerScale=e.markerParameters.width/e.width)}}]),n}(x.F5),G=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments))._stipplePattern=null,e}return(0,o.Z)(n,[{key:"dispose",value:function(){(0,r.Z)((0,i.Z)(n.prototype),"dispose",this).call(this),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){this._output!==C.H.Color&&this._output!==C.H.Alpha||this._updateOccludeeState(e);var t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,t)),this._stipplePattern=t),this.ensureTechnique(z,e)}}]),n}(S.Z),B=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).width=0,e.color=m.O,e.join="miter",e.cap=V.R.BUTT,e.miterLimit=5,e.writeDepth=!0,e.hasPolygonOffset=!1,e.stippleTexture=null,e.stippleScaleWithLineWidth=!1,e.stipplePreferContinuous=!0,e.markerParameters=null,e.markerScale=1,e.hasSlicePlane=!1,e.vvFastUpdate=!1,e.isClosed=!1,e.falloff=0,e.innerWidth=0,e.hasOccludees=!1,e.wireframe=!1,e}return(0,o.Z)(n)}(R.n),q=function(){function e(t,n){(0,a.Z)(this,e),this._parameters=n,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;var r=n.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=E.R+r}}return(0,o.Z)(e,[{key:"_isClosed",value:function(e){return X(this._parameters,e.vertexAttributes,e.indices)}},{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){var t=e.indices.get(A.T.POSITION).length/2+1,n=this._isClosed(e),r=n?2:4;return r+=((n?t:t-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),r+=2,this._parameters.wireframe&&(r=2+4*(r-2)),r}},{key:"write",value:function(e,t,n,r,i){var a,o=this,s=ue,u=le,c=ce,d=n.vertexAttributes.get(A.T.POSITION).data,f=n.indices&&n.indices.get(A.T.POSITION),p=null===(a=n.vertexAttributes.get(A.T.DISTANCETOSTART))||void 0===a?void 0:a.data;f&&f.length!==2*(d.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var g=1,m=0;this._parameters.vvSizeEnabled?m=n.vertexAttributes.get(A.T.SIZEFEATUREATTRIBUTE).data[0]:n.vertexAttributes.has(A.T.SIZE)&&(g=n.vertexAttributes.get(A.T.SIZE).data[0]);var y=[1,1,1,1],_=0;this._parameters.vvColorEnabled?_=n.vertexAttributes.get(A.T.COLORFEATUREATTRIBUTE).data[0]:n.vertexAttributes.has(A.T.COLOR)&&(y=n.vertexAttributes.get(A.T.COLOR).data);var T=(0,l.Z)("enable-feature:objectAndLayerId-rendering")?n.objectAndLayerIdColor:null,w=0;this._parameters.vvOpacityEnabled&&(w=n.vertexAttributes.get(A.T.OPACITYFEATUREATTRIBUTE).data[0]);var C=d.length/3,S=new Float32Array(r.buffer),x=(0,l.Z)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(r.buffer):null,b=this.vertexBufferLayout.stride/4,O=i*b,R=O,P=0,E=p?function(e,t,n){return P=p[n]}:function(e,t,n){return P+=(0,v.i)(e,t)},D=(0,l.Z)("enable-feature:objectAndLayerId-rendering"),I=function(e,t,n,r,i,a,s){if(S[O++]=t[0],S[O++]=t[1],S[O++]=t[2],S[O++]=r,S[O++]=s,S[O++]=i,S[O++]=e[0],S[O++]=e[1],S[O++]=e[2],S[O++]=n[0],S[O++]=n[1],S[O++]=n[2],o._parameters.vvSizeEnabled?S[O++]=m:S[O++]=g,o._parameters.vvColorEnabled)S[O++]=_;else{var u=Math.min(4*a,y.length-4);S[O++]=y[u],S[O++]=y[u+1],S[O++]=y[u+2],S[O++]=y[u+3]}o._parameters.vvOpacityEnabled&&(S[O++]=w),D&&((0,h.pC)(T)&&(x[4*O]=T[0],x[4*O+1]=T[1],x[4*O+2]=T[2],x[4*O+3]=T[3]),O++)};O+=b,(0,v.s)(u,d[0],d[1],d[2]),e&&(0,v.m)(u,u,e);var M=this._isClosed(n);if(M){var Z=d.length-3;(0,v.s)(s,d[Z],d[Z+1],d[Z+2]),e&&(0,v.m)(s,s,e)}else(0,v.s)(c,d[3],d[4],d[5]),e&&(0,v.m)(c,c,e),I(u,u,c,1,U.LEFT_CAP_START,0,0),I(u,u,c,1,U.RIGHT_CAP_START,0,0),(0,v.c)(s,u),(0,v.c)(u,c);for(var L=M?0:1,k=M?C:C-1,H=L;H<k;H++){var N=(H+1)%C*3;(0,v.s)(c,d[N],d[N+1],d[N+2]),e&&(0,v.m)(c,c,e),E(s,u,H),I(s,u,c,0,U.LEFT_JOIN_END,H,P),I(s,u,c,0,U.RIGHT_JOIN_END,H,P);for(var F=this.numJoinSubdivisions,z=0;z<F;++z){var j=(z+1)/(F+1);I(s,u,c,j,U.LEFT_JOIN_END,H,P),I(s,u,c,j,U.RIGHT_JOIN_END,H,P)}I(s,u,c,1,U.LEFT_JOIN_START,H,P),I(s,u,c,1,U.RIGHT_JOIN_START,H,P),(0,v.c)(s,u),(0,v.c)(u,c)}M?((0,v.s)(c,d[3],d[4],d[5]),e&&(0,v.m)(c,c,e),P=E(s,u,k),I(s,u,c,0,U.LEFT_JOIN_END,L,P),I(s,u,c,0,U.RIGHT_JOIN_END,L,P)):(P=E(s,u,k),I(s,u,u,0,U.LEFT_CAP_END,k,P),I(s,u,u,0,U.RIGHT_CAP_END,k,P)),J(S,R+b,S,R,b),O=J(S,O-b,S,O,b),this._parameters.wireframe&&this._addWireframeVertices(r,R,O,b)}},{key:"_addWireframeVertices",value:function(e,t,n,r){for(var i=new Float32Array(e.buffer,n*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,n-t),o=0,s=function(e){return o=J(a,e,i,o,r)},u=0;u<a.length-1;u+=2*r)s(u),s(u+2*r),s(u+1*r),s(u+2*r),s(u+1*r),s(u+3*r)}}]),e}();function J(e,t,n,r,i){for(var a=0;a<i;a++)n[r++]=e[t++];return r}function X(e,t,n){return Y(e,t.get(A.T.POSITION).data,n?n.get(A.T.POSITION):null)}function Y(e,t,n){return!!e.isClosed&&(n?n.length>2:t.length>6)}var $=(0,g.c)(),Q=(0,g.c)(),K=(0,g.c)(),ee=(0,g.c)(),te=(0,g.c)(),ne=(0,f.J$)(),re=(0,f.J$)(),ie=(0,g.c)(),ae=(0,g.c)(),oe=(0,_.Ue)(),se=(0,_.Ue)(),ue=(0,g.c)(),le=(0,g.c)(),ce=(0,g.c)(),de=[(0,f.J$)(),(0,f.J$)(),(0,f.J$)(),(0,f.J$)()],he=[(0,g.c)(),(0,g.c)(),(0,g.c)(),(0,g.c)()],fe=(0,T.Ue)(),pe=(0,T.Ue)(),ve=(0,T.Ue)(),ge=(0,T.Ue)()},82031:function(e,t,n){n.d(t,{$A:function(){return y},h0:function(){return p},it:function(){return T},kj:function(){return _}});var r=n(93433),i=n(37762),a=n(60136),o=n(29388),s=n(15671),u=n(43144),l=n(46228),c=n(92026),d=n(98634),h=n(8548),f=n(51378),p=function(){function e(t){(0,s.Z)(this,e),this._rctx=t,this._cache=new Map}return(0,u.Z)(e,[{key:"destroy",value:function(){this._cache.forEach((function(e){return(0,c.M2)(e.stippleTexture)})),this._cache.clear()}},{key:"_acquire",value:function(e){if((0,c.Wi)(e))return null;var t=this._patternId(e),n=this._cache.get(t);if(n)return n.refCount++,n;var r=g(e),i=r.encodedData,a=r.paddedPixels,o=new v(new f.x(this._rctx,{width:a,height:1,internalFormat:h.VI.RGBA,pixelFormat:h.VI.RGBA,dataType:h.Br.UNSIGNED_BYTE,wrapMode:h.e8.CLAMP_TO_EDGE},i));return this._cache.set(t,o),o}},{key:"release",value:function(e){if(!(0,c.Wi)(e)){var t=this._patternId(e),n=this._cache.get(t);n&&(n.refCount--,0===n.refCount&&((0,c.pC)(n.stippleTexture)&&n.stippleTexture.dispose(),this._cache.delete(t)))}}},{key:"swap",value:function(e,t){var n=this._acquire(t);return this.release(e),n}},{key:"_patternId",value:function(e){return"".concat(e.pattern.join(","),"-r").concat(e.pixelRatio)}}]),e}(),v=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this)).stippleTexture=e,r.refCount=1,r}return(0,u.Z)(n)}(d.K);function g(e){var t,n=m(e),a=1/e.pixelRatio,o=y(e),s=_(e),u=(Math.floor(.5*(s-1))+.5)*a,c=[],d=1,h=(0,i.Z)(n);try{for(h.s();!(t=h.n()).done;){for(var f=t.value,p=0;p<f;p++){var v=d*(Math.min(p,f-1-p)+.5)*a/u*.5+.5;c.push(v)}d=-d}}catch(R){h.e(R)}finally{h.f()}var g,w=Math.round(n[0]/2),C=[].concat((0,r.Z)(c.slice(w)),(0,r.Z)(c.slice(0,w))),S=o+T,x=new Uint8Array(4*S),b=4,O=(0,i.Z)(C);try{for(O.s();!(g=O.n()).done;){var A=g.value;(0,l.I)(A,x,b),b+=4}}catch(R){O.e(R)}finally{O.f()}return x.copyWithin(0,b-4,b),x.copyWithin(b,4,8),{encodedData:x,paddedPixels:S}}function m(e){return e.pattern.map((function(t){return Math.round(t*e.pixelRatio)}))}function y(e){if((0,c.Wi)(e))return 1;var t=m(e);return Math.floor(t.reduce((function(e,t){return e+t})))}function _(e){return m(e).reduce((function(e,t){return Math.max(e,t)}))}var T=2},11983:function(e,t,n){n.d(t,{c:function(){return l}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(56529),u=n(22909),l=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"intersect",value:function(e,t,n,r,i,a){return(0,u.Bw)(e,n,r,i,void 0,a)}}]),n}(s.F5)},29674:function(e,t,n){n.d(t,{H:function(){return H},m:function(){return N}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(38499),u=n(6394),l=n(67077),c=n(37081),d=n(96856),h=n(56529),f=n(78041),p=n(93822),v=n(12594),g=n(64642),m=n(11983),y=n(92026),_=n(23620),T=n(27366),w=n(50951),C=n(41481),S=n(79246),x=n(82144),b=n(31132),O=n(33559),A=n(7566),R=n(27627),P=n(25920),E=n(8883),D=n(49810),I=n(49800),M=n(36207),Z=(S.U,function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"initializeConfiguration",value:function(e,t){t.hasWebGL2Context=e.rctx.type===I.zO.WEBGL2,t.spherical=e.viewingMode===w.JY.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}},{key:"initializeProgram",value:function(e){return new R.$(e.rctx,n.shader.get().build(this.configuration),A.i)}},{key:"_setPipelineState",value:function(e){var t=this.configuration,n=e===P.A.NONE,r=e===P.A.FrontFace;return(0,M.sm)({blending:t.output!==c.H.Normal&&t.output!==c.H.Highlight&&t.transparent?n?f.wu:(0,f.j7)(e):null,depthTest:{func:(0,f.Bh)(e)},depthWrite:n?t.writeDepth?M.LZ:null:(0,f.K5)(e),colorWrite:M.BK,polygonOffset:n||r?null:(0,f.je)(t.enableOffset)})}},{key:"initializePipeline",value:function(){return this._setPipelineState(this.configuration.transparencyPassType)}}]),n}(b.A));Z.shader=new x.J(D.W,(function(){return n.e(9106).then(n.bind(n,19106))}));var L=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).output=c.H.Color,e.transparencyPassType=P.A.NONE,e.spherical=!1,e.receiveShadows=!1,e.hasSlicePlane=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!1,e.hasScreenSpaceReflections=!1,e.doublePrecisionRequiresObfuscation=!1,e.hasCloudsReflections=!1,e.isDraped=!1,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e}return(0,i.Z)(n)}(E.W);(0,T._)([(0,O.o)({count:c.H.COUNT})],L.prototype,"output",void 0),(0,T._)([(0,O.o)({count:P.A.COUNT})],L.prototype,"transparencyPassType",void 0),(0,T._)([(0,O.o)()],L.prototype,"spherical",void 0),(0,T._)([(0,O.o)()],L.prototype,"receiveShadows",void 0),(0,T._)([(0,O.o)()],L.prototype,"hasSlicePlane",void 0),(0,T._)([(0,O.o)()],L.prototype,"transparent",void 0),(0,T._)([(0,O.o)()],L.prototype,"enableOffset",void 0),(0,T._)([(0,O.o)()],L.prototype,"writeDepth",void 0),(0,T._)([(0,O.o)()],L.prototype,"hasScreenSpaceReflections",void 0),(0,T._)([(0,O.o)()],L.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,T._)([(0,O.o)()],L.prototype,"hasCloudsReflections",void 0),(0,T._)([(0,O.o)()],L.prototype,"isDraped",void 0),(0,T._)([(0,O.o)()],L.prototype,"hasMultipassTerrain",void 0),(0,T._)([(0,O.o)()],L.prototype,"cullAboveGround",void 0),(0,T._)([(0,O.o)({constValue:C.f7.Water})],L.prototype,"pbrMode",void 0),(0,T._)([(0,O.o)({constValue:!0})],L.prototype,"useCustomDTRExponentForWater",void 0),(0,T._)([(0,O.o)({constValue:!0})],L.prototype,"highStepCount",void 0),(0,T._)([(0,O.o)({constValue:!1})],L.prototype,"useFillLights",void 0);var k=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"_updateShadowState",value:function(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}},{key:"_updateSSRState",value:function(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}},{key:"_updateCloudsReflectionState",value:function(e){var t=(0,y.pC)(e.cloudsFade.data);t!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:t})}},{key:"ensureResources",value:function(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}},{key:"beginSlot",value:function(e){return this._output===c.H.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(Z,e)}}]),n}(_.Z),H=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e,new N))._configuration=new L,i.animation=new d.d,i}return(0,i.Z)(n,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<f.ve,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}},{key:"update",value:function(e){var t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<F;var n=this.animation.advance(e);return this.setParameters({timeElapsed:(0,s.D9)(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&n}},{key:"requiresSlot",value:function(e,t){switch(t){case c.H.Normal:return e===p.r.DRAPED_WATER;case c.H.Color:if(this.parameters.isDraped)return e===p.r.DRAPED_MATERIAL;break;case c.H.Alpha:break;case c.H.Highlight:return e===p.r.OPAQUE_MATERIAL||e===p.r.DRAPED_MATERIAL;default:return!1}var n=p.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(n=this.parameters.writeDepth?p.r.TRANSPARENT_MATERIAL:p.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===n}},{key:"createGLMaterial",value:function(e){return new k(e)}},{key:"createBufferWriter",value:function(){return new v.G(g.W1)}}]),n}(m.c),N=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).waveStrength=.06,e.waveTextureRepeat=32,e.waveDirection=(0,u.f)(1,0),e.waveVelocity=.05,e.flowStrength=.015,e.flowOffset=-.5,e.animationSpeed=.35,e.timeElapsed=0,e.color=(0,l.f)(0,0,0,0),e.transparent=!0,e.writeDepth=!0,e.hasSlicePlane=!1,e.isDraped=!1,e.receiveShadows=!0,e.hasScreenSpaceReflections=!1,e.hasCloudsReflections=!1,e}return(0,i.Z)(n)}(h.Mt),F=35e3},86700:function(e,t,n){n.d(t,{Dp:function(){return l},z5:function(){return u}});var r=n(93433),i=n(92026),a={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},o={dash:a.dash,"dash-dot":[].concat((0,r.Z)(a.dash),(0,r.Z)(a.dot)),dot:a.dot,"long-dash":a["long-dash"],"long-dash-dot":[].concat((0,r.Z)(a["long-dash"]),(0,r.Z)(a.dot)),"long-dash-dot-dot":[].concat((0,r.Z)(a["long-dash"]),(0,r.Z)(a.dot),(0,r.Z)(a.dot)),none:null,"short-dash":a["short-dash"],"short-dash-dot":[].concat((0,r.Z)(a["short-dash"]),(0,r.Z)(a["short-dot"])),"short-dash-dot-dot":[].concat((0,r.Z)(a["short-dash"]),(0,r.Z)(a["short-dot"]),(0,r.Z)(a["short-dot"])),"short-dot":a["short-dot"],solid:null},s=8;function u(e){return{pattern:[e,e],pixelRatio:arguments.length>1&&void 0!==arguments[1]?arguments[1]:2}}function l(e){return(0,i.pC)(e)&&"style"===e.type?function(e){return(0,i.pC)(e)?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return(0,i.Wi)(e)?e:{pattern:e.slice(),pixelRatio:t}}(o[e],s):null}(e.style):null}},33720:function(e,t,n){n.d(t,{I9:function(){return r},PI:function(){return p},i5:function(){return i}});var r,i,a=n(43144),o=n(15671),s=n(60136),u=n(29388),l=n(27366),c=n(37081),d=n(33559),h=n(25920),f=n(8883);!function(e){e[e.Draped=0]="Draped",e[e.Screen=1]="Screen",e[e.World=2]="World",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(i||(i={}));var p=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).output=c.H.Color,e.transparencyPassType=h.A.NONE,e.occluder=!1,e.hasSlicePlane=!1,e.writeDepth=!1,e.space=r.Screen,e.hideOnShortSegments=!1,e.hasCap=!1,e.anchor=i.Center,e.hasTip=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.hasOccludees=!1,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e}return(0,a.Z)(n)}(f.W);(0,l._)([(0,d.o)({count:c.H.COUNT})],p.prototype,"output",void 0),(0,l._)([(0,d.o)({count:h.A.COUNT})],p.prototype,"transparencyPassType",void 0),(0,l._)([(0,d.o)()],p.prototype,"occluder",void 0),(0,l._)([(0,d.o)()],p.prototype,"hasSlicePlane",void 0),(0,l._)([(0,d.o)()],p.prototype,"writeDepth",void 0),(0,l._)([(0,d.o)({count:r.COUNT})],p.prototype,"space",void 0),(0,l._)([(0,d.o)()],p.prototype,"hideOnShortSegments",void 0),(0,l._)([(0,d.o)()],p.prototype,"hasCap",void 0),(0,l._)([(0,d.o)({count:i.COUNT})],p.prototype,"anchor",void 0),(0,l._)([(0,d.o)()],p.prototype,"hasTip",void 0),(0,l._)([(0,d.o)()],p.prototype,"vvSize",void 0),(0,l._)([(0,d.o)()],p.prototype,"vvColor",void 0),(0,l._)([(0,d.o)()],p.prototype,"vvOpacity",void 0),(0,l._)([(0,d.o)()],p.prototype,"hasOccludees",void 0),(0,l._)([(0,d.o)()],p.prototype,"hasMultipassTerrain",void 0),(0,l._)([(0,d.o)()],p.prototype,"cullAboveGround",void 0),(0,l._)([(0,d.o)({constValue:!0})],p.prototype,"hasVvInstancing",void 0),(0,l._)([(0,d.o)({constValue:!0})],p.prototype,"hasSliceTranslatedView",void 0)},737:function(e,t,n){n.d(t,{G:function(){return f},R:function(){return r}});var r,i=n(43144),a=n(15671),o=n(60136),s=n(29388),u=n(27366),l=n(37081),c=n(33559),d=n(25920),h=n(8883);!function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"}(r||(r={}));var f=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).output=l.H.Color,e.capType=r.BUTT,e.transparencyPassType=d.A.NONE,e.occluder=!1,e.hasSlicePlane=!1,e.hasPolygonOffset=!1,e.writeDepth=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stippleScaleWithLineWidth=!1,e.stipplePreferContinuous=!0,e.roundJoins=!1,e.applyMarkerOffset=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.falloffEnabled=!1,e.innerColorEnabled=!1,e.hasOccludees=!1,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e.wireframe=!1,e.objectAndLayerIdColorInstanced=!1,e}return(0,i.Z)(n)}(h.W);(0,u._)([(0,c.o)({count:l.H.COUNT})],f.prototype,"output",void 0),(0,u._)([(0,c.o)({count:r.COUNT})],f.prototype,"capType",void 0),(0,u._)([(0,c.o)({count:d.A.COUNT})],f.prototype,"transparencyPassType",void 0),(0,u._)([(0,c.o)()],f.prototype,"occluder",void 0),(0,u._)([(0,c.o)()],f.prototype,"hasSlicePlane",void 0),(0,u._)([(0,c.o)()],f.prototype,"hasPolygonOffset",void 0),(0,u._)([(0,c.o)()],f.prototype,"writeDepth",void 0),(0,u._)([(0,c.o)()],f.prototype,"draped",void 0),(0,u._)([(0,c.o)()],f.prototype,"stippleEnabled",void 0),(0,u._)([(0,c.o)()],f.prototype,"stippleOffColorEnabled",void 0),(0,u._)([(0,c.o)()],f.prototype,"stippleScaleWithLineWidth",void 0),(0,u._)([(0,c.o)()],f.prototype,"stipplePreferContinuous",void 0),(0,u._)([(0,c.o)()],f.prototype,"roundJoins",void 0),(0,u._)([(0,c.o)()],f.prototype,"applyMarkerOffset",void 0),(0,u._)([(0,c.o)()],f.prototype,"vvSize",void 0),(0,u._)([(0,c.o)()],f.prototype,"vvColor",void 0),(0,u._)([(0,c.o)()],f.prototype,"vvOpacity",void 0),(0,u._)([(0,c.o)()],f.prototype,"falloffEnabled",void 0),(0,u._)([(0,c.o)()],f.prototype,"innerColorEnabled",void 0),(0,u._)([(0,c.o)()],f.prototype,"hasOccludees",void 0),(0,u._)([(0,c.o)()],f.prototype,"hasMultipassTerrain",void 0),(0,u._)([(0,c.o)()],f.prototype,"cullAboveGround",void 0),(0,u._)([(0,c.o)()],f.prototype,"wireframe",void 0),(0,u._)([(0,c.o)({constValue:!0})],f.prototype,"stippleRequiresClamp",void 0),(0,u._)([(0,c.o)({constValue:!0})],f.prototype,"stippleRequiresStretchMeasure",void 0),(0,u._)([(0,c.o)({constValue:!0})],f.prototype,"hasVvInstancing",void 0),(0,u._)([(0,c.o)({constValue:!0})],f.prototype,"hasSliceTranslatedView",void 0),(0,u._)([(0,c.o)()],f.prototype,"objectAndLayerIdColorInstanced",void 0)}}]);
//# sourceMappingURL=186.fc5dbd07.chunk.js.map