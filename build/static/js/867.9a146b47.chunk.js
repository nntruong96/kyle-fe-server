"use strict";(self.webpackChunkcommonlands_web=self.webpackChunkcommonlands_web||[]).push([[867],{82218:function(e,t,n){n.d(t,{a:function(){return k},c:function(){return w},g:function(){return T},h:function(){return A},u:function(){return P}});var i=n(37762),a=n(43144),r=n(15671),o=(n(93169),n(32718)),s=n(16889),l=n(21530),c=n(14226),u=n(81949),h=n(11186),p=n(71353),d=n(14320),v=n(85981),f=n(55652),_=n(40885),g=n(40927),y=n(11185),m=o.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane"),b=(0,a.Z)((function e(){(0,r.Z)(this,e),this.plane=(0,f.Ue)(),this.origin=(0,p.c)(),this.basis1=(0,p.c)(),this.basis2=(0,p.c)()}));function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;return{plane:(0,f.Ue)(e.plane),origin:(0,p.a)(e.origin),basis1:(0,p.a)(e.basis1),basis2:(0,p.a)(e.basis2)}}function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k();return M(e.origin,e.basis1,e.basis2,t)}function M(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k();return(0,h.c)(i.origin,e),(0,h.c)(i.basis1,t),(0,h.c)(i.basis2,n),P(i),function(e,t){Math.abs((0,h.e)(e.basis1,e.basis2)/((0,h.l)(e.basis1)*(0,h.l)(e.basis2)))>1e-6&&m.warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,h.e)(e.basis1,L(e)))>1e-6&&m.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,h.e)(L(e),e.origin)-e.plane[3])>1e-6&&m.warn(t,"Plane offset is not consistent with plane origin")}(i,"fromValues()"),i}function P(e){(0,f.my)(e.basis2,e.basis1,e.origin,e.plane)}function S(e,t,n){e!==n&&w(e,n);var i=(0,h.g)(y.WM.get(),L(e),t);return(0,h.a)(n.origin,n.origin,i),n.plane[3]-=t,n}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k(),n=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return(0,h.s)(t.origin,e[0]+n,e[1]+i,0),(0,h.s)(t.basis1,n,0,0),(0,h.s)(t.basis2,0,i,0),(0,f.al)(0,0,1,0,t.plane),t}function Z(e,t,n){return!!(0,f.BR)(e.plane,t,n)&&W(e,n)}function E(e,t,n){var a=H.get();D(e,t,a,H.get());var r,o=Number.POSITIVE_INFINITY,l=(0,i.Z)(j);try{for(l.s();!(r=l.n()).done;){var c=U(e,r.value,z.get()),u=y.WM.get();if((0,f.rx)(a,c,u)){var p=(0,h.r)(y.WM.get(),t.origin,u),d=Math.abs((0,s.ZF)((0,h.e)(t.direction,p)));d<o&&(o=d,(0,h.c)(n,u))}}}catch(v){l.e(v)}finally{l.f()}return o===Number.POSITIVE_INFINITY?G(e,t,n):n}function G(e,t,n){if(Z(e,t,n))return n;var a=H.get(),r=H.get();D(e,t,a,r);var o,s=Number.POSITIVE_INFINITY,l=(0,i.Z)(j);try{for(l.s();!(o=l.n()).done;){var c=U(e,o.value,z.get()),u=y.WM.get();if((0,f.dZ)(a,c,u)){var p=(0,_.Jk)(t,u);if(!(0,f.Ac)(r,u))continue;p<s&&(s=p,(0,h.c)(n,u))}}}catch(d){l.e(d)}finally{l.f()}return x(e,t.origin)<s&&R(e,t.origin,n),n}function R(e,t,n){var i=(0,f.nF)(e.plane,t,y.WM.get()),a=(0,v.ct)(V(e,e.basis1),i,-1,1,y.WM.get()),r=(0,v.ct)(V(e,e.basis2),i,-1,1,y.WM.get());return(0,h.b)(n,(0,h.a)(y.WM.get(),a,r),e.origin),n}function C(e,t,n){var i=e.origin,a=e.basis1,r=e.basis2,o=(0,h.b)(y.WM.get(),t,i),s=(0,g.SR)(a,o),l=(0,g.SR)(r,o),c=(0,g.SR)(L(e),o);return(0,h.s)(n,s,l,c)}function x(e,t){var n=C(e,t,y.WM.get()),i=e.basis1,a=e.basis2,r=(0,h.l)(i),o=(0,h.l)(a),s=Math.max(Math.abs(n[0])-r,0),l=Math.max(Math.abs(n[1])-o,0),c=n[2];return s*s+l*l+c*c}function A(e,t){return Math.sqrt(x(e,t))}function O(e,t){var n=-e.plane[3];return(0,g.SR)(L(e),t)-n}function L(e){return(0,f.mJ)(e.plane)}function W(e,t){var n=(0,h.b)(y.WM.get(),t,e.origin),i=(0,h.p)(e.basis1),a=(0,h.p)(e.basis2),r=(0,h.e)(e.basis1,n),o=(0,h.e)(e.basis2,n);return-r-i<0&&r-i<0&&-o-a<0&&o-a<0}function V(e,t){var n=z.get();return(0,h.c)(n.origin,e.origin),(0,h.c)(n.vector,t),n}function U(e,t,n){var i=e.basis1,a=e.basis2,r=e.origin,o=(0,h.g)(y.WM.get(),i,t.origin[0]),s=(0,h.g)(y.WM.get(),a,t.origin[1]);(0,h.a)(n.origin,o,s),(0,h.a)(n.origin,n.origin,r);var l=(0,h.g)(y.WM.get(),i,t.direction[0]),c=(0,h.g)(y.WM.get(),a,t.direction[1]);return(0,h.g)(n.vector,(0,h.a)(l,l,c),2),n}function D(e,t,n,i){var a=L(e);(0,f.my)(a,t.direction,t.origin,n),(0,f.my)((0,f.mJ)(n),a,t.origin,i)}var I={plane:(0,f.Ue)(),origin:(0,p.f)(0,0,0),basis1:(0,p.f)(1,0,0),basis2:(0,p.f)(0,1,0)},H=new l.x(f.Ue),z=new l.x(v.Ue),N=(0,p.c)(),B=new l.x((function(){return k()})),j=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Y=(0,u.c)(),F=(0,u.c)();Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:b,UP:I,altitudeAt:O,axisAt:function(e,t,n,i){return function(e,t,n){switch(t){case d.R.X:(0,h.c)(n,e.basis1),(0,h.n)(n,n);break;case d.R.Y:(0,h.c)(n,e.basis2),(0,h.n)(n,n);break;case d.R.Z:(0,h.c)(n,L(e))}return n}(e,n,i)},closestPoint:G,closestPointOnSilhouette:E,copy:w,copyWithoutVerify:function(e,t){(0,h.c)(t.origin,e.origin),(0,h.c)(t.basis1,e.basis1),(0,h.c)(t.basis2,e.basis2),(0,f.JG)(t.plane,e.plane)},create:k,distance:A,distance2:x,distanceToSilhouette:function(e,t){var n,a=Number.NEGATIVE_INFINITY,r=(0,i.Z)(j);try{for(r.s();!(n=r.n()).done;){var o=U(e,n.value,z.get()),s=(0,v.Jk)(o,t);s>a&&(a=s)}}catch(l){r.e(l)}finally{r.f()}return Math.sqrt(a)},elevate:S,equals:function(e,t){return(0,h.k)(e.basis1,t.basis1)&&(0,h.k)(e.basis2,t.basis2)&&(0,h.k)(e.origin,t.origin)},extrusionContainsPoint:function(e,t){return(0,f.Ac)(e.plane,t)&&W(e,t)},fromAABoundingRect:T,fromValues:M,intersectRay:Z,intersectRayClosestSilhouette:function(e,t,n){if(Z(e,t,n))return n;var i=E(e,t,y.WM.get());return(0,h.a)(n,t.origin,(0,h.g)(y.WM.get(),t.direction,(0,h.i)(t.origin,i)/(0,h.l)(t.direction))),n},normal:L,projectPoint:R,projectPointLocal:C,rotate:function(e,t,n,i){return e!==i&&w(e,i),(0,c.d)(F,t,n),(0,h.m)(i.basis1,e.basis1,F),(0,h.m)(i.basis2,e.basis2,F),P(i),i},setAltitudeAt:function(e,t,n,i){var a=O(e,t),r=(0,h.g)(N,L(e),n-a);return(0,h.a)(i,t,r),i},setExtent:function(e,t,n){return T(t,n),S(n,O(e,e.origin),n),n},transform:function(e,t,n){return e!==n&&w(e,n),(0,c.a)(Y,t),(0,c.t)(Y,Y),(0,h.m)(n.basis1,e.basis1,Y),(0,h.m)(n.basis2,e.basis2,Y),(0,h.m)((0,f.mJ)(n.plane),(0,f.mJ)(e.plane),Y),(0,h.m)(n.origin,e.origin,t),(0,f.T5)(n.plane,n.plane,n.origin),n},updateUnboundedPlane:P,wrap:function(e,t,n){var i=B.get();return i.origin=e,i.basis1=t,i.basis2=n,i.plane=(0,f.re)(0,0,0,0),P(i),i}},Symbol.toStringTag,{value:"Module"}))},48976:function(e,t,n){n.d(t,{c:function(){return v},g:function(){return u},i:function(){return d},j:function(){return G},k:function(){return _},m:function(){return h},r:function(){return C},s:function(){return c}});var i=n(11873),a=n(98131),r=n(71353),o=n(26277),s=n(11186),l=n(90045);function c(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function u(e,t){var n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>(0,o.g)()?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n}function h(e,t,n){var i=t[0],a=t[1],r=t[2],o=t[3],s=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+o*s+a*c-r*l,e[1]=a*u+o*l+r*s-i*c,e[2]=r*u+o*c+i*l-a*s,e[3]=o*u-i*s-a*l-r*c,e}function p(e,t,n,i){var a,r,s,l,c,u=t[0],h=t[1],p=t[2],d=t[3],v=n[0],f=n[1],_=n[2],g=n[3];return(r=u*v+h*f+p*_+d*g)<0&&(r=-r,v=-v,f=-f,_=-_,g=-g),1-r>(0,o.g)()?(a=Math.acos(r),s=Math.sin(a),l=Math.sin((1-i)*a)/s,c=Math.sin(i*a)/s):(l=1-i,c=i),e[0]=l*u+c*v,e[1]=l*h+c*f,e[2]=l*p+c*_,e[3]=l*d+c*g,e}function d(e,t){var n=t[0],i=t[1],a=t[2],r=t[3],o=n*n+i*i+a*a+r*r,s=o?1/o:0;return e[0]=-n*s,e[1]=-i*s,e[2]=-a*s,e[3]=r*s,e}function v(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function f(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var r=(a+1)%3,o=(a+2)%3;n=Math.sqrt(t[3*a+a]-t[3*r+r]-t[3*o+o]+1),e[a]=.5*n,n=.5/n,e[3]=(t[3*r+o]-t[3*o+r])*n,e[r]=(t[3*r+a]+t[3*a+r])*n,e[o]=(t[3*o+a]+t[3*a+o])*n}return e}function _(e,t,n,i){var a=.5*Math.PI/180;t*=a,n*=a,i*=a;var r=Math.sin(t),o=Math.cos(t),s=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return e[0]=r*l*u-o*s*c,e[1]=o*s*u+r*l*c,e[2]=o*l*c-r*s*u,e[3]=o*l*u+r*s*c,e}var g=l.c,y=l.s,m=l.a,b=h,k=l.b,w=l.d,M=l.l,P=l.e,S=P,T=l.f,Z=T,E=l.n,G=l.g,R=l.h;function C(e,t,n){var i=(0,s.e)(t,n);return i<-.999999?((0,s.f)(x,A,t),(0,s.u)(x)<1e-6&&(0,s.f)(x,O,t),(0,s.n)(x,x),c(e,x,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):((0,s.f)(x,t,n),e[0]=x[0],e[1]=x[1],e[2]=x[2],e[3]=1+i,E(e,e))}var x=(0,r.c)(),A=(0,r.f)(1,0,0),O=(0,r.f)(0,1,0);var L=(0,a.a)(),W=(0,a.a)();var V=(0,i.c)();Object.freeze(Object.defineProperty({__proto__:null,add:m,calculateW:function(e,t){var n=t[0],i=t[1],a=t[2];return e[0]=n,e[1]=i,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-a*a)),e},conjugate:v,copy:g,dot:w,equals:R,exactEquals:G,fromEuler:_,fromMat3:f,getAxisAngle:u,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},invert:d,len:S,length:P,lerp:M,mul:b,multiply:h,normalize:E,random:function(e){var t=o.R,n=t(),i=t(),a=t(),r=Math.sqrt(1-n),s=Math.sqrt(n);return e[0]=r*Math.sin(2*Math.PI*i),e[1]=r*Math.cos(2*Math.PI*i),e[2]=s*Math.sin(2*Math.PI*a),e[3]=s*Math.cos(2*Math.PI*a),e},rotateX:function(e,t,n){n*=.5;var i=t[0],a=t[1],r=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*s,e[1]=a*l+r*s,e[2]=r*l-a*s,e[3]=o*l-i*s,e},rotateY:function(e,t,n){n*=.5;var i=t[0],a=t[1],r=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l-r*s,e[1]=a*l+o*s,e[2]=r*l+i*s,e[3]=o*l-a*s,e},rotateZ:function(e,t,n){n*=.5;var i=t[0],a=t[1],r=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+a*s,e[1]=a*l-i*s,e[2]=r*l+o*s,e[3]=o*l-r*s,e},rotationTo:C,scale:k,set:y,setAxes:function(e,t,n,i){var a=V;return a[0]=n[0],a[3]=n[1],a[6]=n[2],a[1]=i[0],a[4]=i[1],a[7]=i[2],a[2]=-t[0],a[5]=-t[1],a[8]=-t[2],E(e,f(e,a))},setAxisAngle:c,slerp:p,sqlerp:function(e,t,n,i,a,r){return p(L,t,a,r),p(W,n,i,r),p(e,L,W,2*r*(1-r)),e},sqrLen:Z,squaredLength:T,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}},Symbol.toStringTag,{value:"Module"}))},37818:function(e,t,n){n.d(t,{D:function(){return m},Ou:function(){return h},WG:function(){return y},kB:function(){return v},mW:function(){return d}});var i=n(37762),a=(n(59486),n(52639)),r=(n(93169),n(84652)),o=n(92026),s=n(18722),l=n(77981),c=n(65618),u=n(78952);function h(e){return"declaredClass"in e}function p(e){return"declaredClass"in e}function d(e,t){return e?"declaredClass"in e?e:new a.Z({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,r.d9)(e.symbol),attributes:(0,r.d9)(e.attributes),geometry:v(e.geometry)}):null}function v(e){return(0,o.Wi)(e)?null:h(e)?e:(0,l.im)(function(e){var t=e.spatialReference,n=t.wkid,i=t.wkt,a=t.latestWkid,r={wkid:n,wkt:i,latestWkid:a};switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:r};case"polygon":var o=e.rings,s=e.hasZ,l=e.hasM;return{rings:f(o),hasZ:s,hasM:l,spatialReference:r};case"polyline":var c=e.paths,u=e.hasZ,h=e.hasM;return{paths:f(c),hasZ:u,hasM:h,spatialReference:r};case"extent":return{xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax,hasZ:e.hasZ,hasM:e.hasM,spatialReference:r};case"multipoint":var p=e.points,d=e.hasZ,v=e.hasM;return{points:g(p)?_(p):p,hasZ:d,hasM:v,spatialReference:r};default:return}}(e))}function f(e){return function(e){var t,n=(0,i.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(0!==a.length)return g(a)}}catch(r){n.e(r)}finally{n.f()}return!1}(e)?e.map((function(e){return _(e)})):e}function _(e){return e.map((function(e){return Array.from(e)}))}function g(e){return e.length>0&&((0,s.xZ)(e[0])||(0,s.fS)(e[0]))}function y(e,t){if(!e)return null;var n;if(p(e)){if(null==t)return e.clone();if(p(t))return t.copy(e)}return null!=t?((n=t).x=e.x,n.y=e.y,n.spatialReference=e.spatialReference,e.hasZ?(n.z=e.z,n.hasZ=e.hasZ):(n.z=void 0,n.hasZ=!1),e.hasM?(n.m=e.m,n.hasM=!0):(n.m=void 0,n.hasM=!1)):(n=(0,c.Tx)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(n.m=e.m,n.hasM=!0)),n}function m(e){var t={wkid:e.wkid,wkt:e.wkt,latestWkid:e.latestWkid};return u.Z.fromJSON(t)}},5465:function(e,t,n){n.r(t),n.d(t,{ControlPointsTransformTool:function(){return ce},DrawGraphicTool2D:function(){return T},MediaTransformToolsWrapper:function(){return qe},TransformTool:function(){return Be}});var i=n(29439),a=n(1413),r=n(15671),o=n(43144),s=n(60136),l=n(29388),c=n(27366),u=(n(59486),n(52639)),h=n(42537),p=n(92026),d=n(49861),v=(n(25243),n(63780),n(69912)),f=n(85577),_=(n(51508),n(75021)),g=n(16072),y=new _.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),m=new g.Z({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),b=new g.Z({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}}),k=n(73982),w=n(71719),M=n(46640),P=n(585),S=n(77577),T=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._visualElementGraphics={outline:null,regularVertices:null,activeVertex:null},i.activeFillSymbol=null,i.type="draw-2d",i._visualElementSymbols={outline:(0,p.Pt)(e.activeLineSymbol,y),regularVertices:(0,p.Pt)(e.regularVerticesSymbol,m),activeVertex:(0,p.Pt)(e.activeVertexSymbol,b),fill:(0,p.Wg)(e.activeFillSymbol)},i}return(0,o.Z)(n,[{key:"normalizeCtorArgs",value:function(e){var t=(0,a.Z)({},e);return delete t.activeFillSymbol,delete t.activeVertexSymbol,delete t.regularVerticesSymbol,delete t.activeLineSymbol,t}},{key:"initializeGraphic",value:function(e){return(0,p.pC)(this._visualElementSymbols.fill)&&(e.symbol=this._visualElementSymbols.fill),null}},{key:"makeDrawOperation",value:function(){var e=this.defaultZ,t=this.hasZ,n=this.view;return new w.w({view:n,manipulators:this.manipulators,geometryType:(0,k.I)(this.geometryType),drawingMode:this.mode,hasZ:t,defaultZ:e,snapToSceneEnabled:this.snapToScene,drawSurface:new M.hP(n,t,e),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new f.r(this.internalGraphicsLayer),tooltipOptions:this.tooltipOptions})}},{key:"onActiveVertexChanged",value:function(e){var t=this;if("point"===this.geometryType)return null;var n=(0,i.Z)(e,2),a=n[0],r=n[1],o=new P.Z({x:a,y:r,spatialReference:this.view.spatialReference});return(0,p.pC)(this._visualElementGraphics.activeVertex)?(this._visualElementGraphics.activeVertex.geometry=o,null):(this._visualElementGraphics.activeVertex=new u.Z({geometry:o,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(Z),(0,h.kB)((function(){(0,p.pC)(t._visualElementGraphics.activeVertex)&&(t.internalGraphicsLayer.remove(t._visualElementGraphics.activeVertex),t._visualElementGraphics.activeVertex=(0,p.SC)(t._visualElementGraphics.activeVertex))})))}},{key:"onOutlineChanged",value:function(e){var t=this,n=e.clone();if("polyline"===n.type){var i=n.paths[n.paths.length-1];i.splice(0,i.length-2)}return(0,p.pC)(this._visualElementGraphics.outline)?(this._visualElementGraphics.outline.geometry=n,null):(this._visualElementGraphics.outline=new u.Z({geometry:n,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.outline),this.internalGraphicsLayer.graphics.sort(Z),(0,h.kB)((function(){(0,p.pC)(t._visualElementGraphics.outline)&&(t.internalGraphicsLayer.remove(t._visualElementGraphics.outline),t._visualElementGraphics.outline=(0,p.SC)(t._visualElementGraphics.outline))})))}},{key:"onRegularVerticesChanged",value:function(e){var t=this,n=new S.Z({points:e,spatialReference:this.view.spatialReference});return(0,p.pC)(this._visualElementGraphics.regularVertices)?(this._visualElementGraphics.regularVertices.geometry=n,null):(this._visualElementGraphics.regularVertices=new u.Z({geometry:n,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(Z),(0,h.kB)((function(){(0,p.pC)(t._visualElementGraphics.regularVertices)&&(t.internalGraphicsLayer.remove(t._visualElementGraphics.regularVertices),t._visualElementGraphics.regularVertices=(0,p.SC)(t._visualElementGraphics.regularVertices))})))}}]),n}(k.T);function Z(e,t){var n,i,a,r;return(null!==(n=null===(i=e.attributes)||void 0===i?void 0:i.displayOrder)&&void 0!==n?n:-1/0)-(null!==(a=null===(r=t.attributes)||void 0===r?void 0:r.displayOrder)&&void 0!==a?a:-1/0)}(0,c._)([(0,d.Cb)()],T.prototype,"activeFillSymbol",void 0),(0,c._)([(0,d.Cb)({readOnly:!0})],T.prototype,"type",void 0),(0,c._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],T.prototype,"view",void 0),T=(0,c._)([(0,v.j)("esri.views.2d.interactive.draw.DrawGraphicTool2D")],T);var E=n(37762),G=n(93433),R=n(74165),C=n(15861),x=n(51995),A=n(42265),O=n(28357);function L(e,t){var n=e.a*t;return(0,O.EX)(e)>225?new x.Z([0,0,0,n]):new x.Z([255,255,255,n])}function W(e,t){var n=new x.Z(e);return n.a*=t,n}function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return W(A.Z.analysisTheme.accentColor,e)}function U(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return L(V(),e)}var D,I=n(94172),H=n(79803),z=n(92975),N=n(93655),B=n(49729),j=n(50951),Y=function(){function e(){(0,r.Z)(this,e)}return(0,o.Z)(e,[{key:"hovering",get:function(){return this.someManipulator((function(e){return e.hovering}))}},{key:"grabbing",get:function(){return this.someManipulator((function(e){return e.grabbing}))}},{key:"dragging",get:function(){return this.someManipulator((function(e){return e.dragging}))}},{key:"hasManipulator",value:function(e){return this.someManipulator((function(t){return t===e}))}},{key:"someManipulator",value:function(e){var t=!1;return this.forEachManipulator((function(n){!t&&e(n)&&(t=!0)})),t}}]),e}();!function(e){e[e.TRANSLATE_XY=0]="TRANSLATE_XY",e[e.SCALE=1]="SCALE",e[e.ROTATE=2]="ROTATE"}(D||(D={}));var F=n(74229),q=n(2346),X=n(153),J=n(90297),K=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this))._view=e.view,i._tool=e.tool,i._graphic=e.graphic,i._manipulator=i._createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return(0,o.Z)(n,[{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,D.TRANSLATE_XY)}},{key:"createDragPipeline",value:function(e,t){var n=this,i=null,a=null,r=0,o=0,s=0,l=(0,J.i)((0,p.Wg)(this._graphic.symbol)),c=l.offsetX,u=l.offsetY,h=l.size;return(0,F.Xd)(this._manipulator,(function(l,p){p.next((function(t){if("start"===t.action){var n=e();i=n.editGeometryOperations,a=n.constraints}return t})).next((0,F.Cf)(n._view)).next((function(e){var n=e.mapEnd,l=n.x,p=n.y,d=n.z;if(a&&(l+c<a.xmin||p+u-h<a.ymin||l+c>a.xmax||p+u-h>a.ymax))return e;"start"===e.action&&(r=e.mapStart.x,o=e.mapStart.y,s=e.mapStart.z);var v=l-r,f=p-o,_=d-s;r=l,o=p,s=d;var g,y=[],m=(0,E.Z)(i.data.components);try{for(m.s();!(g=m.n()).done;){var b=g.value;y.push.apply(y,(0,G.Z)(b.vertices))}}catch(M){m.e(M)}finally{m.f()}var k="start"===e.action?X.O.NEW_STEP:X.O.ACCUMULATE_STEPS,w=i.moveVertices(y,v,f,_,k);return t(e,w),e}))}))}},{key:"_createManipulator",value:function(){var e=this._view,t=this._graphic;return new q.L({view:e,graphic:t,selectable:!0,cursor:"move"})}}]),n}(Y),Q=n(67750),$=n(29919),ee=n(87268),te="ArrowUp",ne="ArrowDown",ie="ArrowLeft",ae="ArrowRight",re="t",oe="Shift",se=Q.CK,le=new x.Z("#009AF2"),ce=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._isOpacityToggled=!1,i._isModifierActive=!1,i._factor=1,i._initialControlPoints=null,i._graphicsLayer=new N.Z({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),i._undoStack=[],i._redoStack=[],i._sharedUndoStack=[],i._sharedRedoStack=[],i._highlightHandle=null,i.activeHandle=0,i}return(0,o.Z)(n,[{key:"initialize",value:function(){this._initialize()}},{key:"destroy",value:function(){var e=this.view.map;this._controlPointManipulations.forEach((function(e){return e.destroy()})),this._controlPointEditGeometryOperations.forEach((function(e){return e.destroy()})),e.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,p.SC)(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}},{key:"_hasValidSpatialReference",get:function(){return(0,z.JY)(this.view.spatialReference)}},{key:"onActivate",value:function(){this.visible=!0}},{key:"onDeactivate",value:function(){this.visible=!1}},{key:"onShow",value:function(){this._graphicsLayer.visible=!0}},{key:"onHide",value:function(){this._graphicsLayer.visible=!1}},{key:"canUndo",value:function(){var e=this._undoStack[this._undoStack.length-1];return null!=e&&this._controlPointEditGeometryOperations[e].canUndo}},{key:"canRedo",value:function(){var e=this._redoStack[this._redoStack.length-1];return null!=e&&this._controlPointEditGeometryOperations[e].canRedo}},{key:"undo",value:function(){if(this._undoStack.length>0){var e=this._undoStack.pop();this._controlPointEditGeometryOperations[e].undo(),this.updateGraphics(),this._redoStack.push(e)}}},{key:"redo",value:function(){if(this._redoStack.length>0){var e=this._redoStack.pop();this._controlPointEditGeometryOperations[e].redo(),this.updateGraphics(),this._undoStack.push(e)}}},{key:"refresh",value:function(){var e=this,t=this.mediaElement;if(!(0,p.Wi)(t.georeference)){var n=t.georeference;"control-points"!==n.type||(0,p.Wi)(n.coords)||(this._georeference=n,(0,p.Wg)(this._georeference.controlPoints).forEach((function(t,n){var i=t.mapPoint,a=e._controlPointEditGeometryOperations[n],r=a.data.components[0].vertices[0];a.setVertexPosition(r,a.data.coordinateHelper.pointToVector(i))})),this.updateGraphics())}}},{key:"reset",value:function(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}},{key:"updateGraphics",value:function(){var e=this,t=this._georeference,n=(0,p.Wg)(t.controlPoints),i=(0,p.Wg)(n[0].mapPoint).spatialReference,a=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map((function(r,o){var s=r.data.geometry;return e._controlPointGraphics[o].geometry=s,{mapPoint:(0,H.iV)(s,i),sourcePoint:a?(0,p.Wg)(n[o]).sourcePoint:t.toSource(s)}}))}},{key:"updateActiveHandle",value:function(e){if(this.activeHandle!==e){var t=(0,p.Wg)(this._controlPointGraphics[this.activeHandle].symbol).clone();(0,B.ZB)(t,V()),this._controlPointGraphics[this.activeHandle].symbol=t;var n=(0,p.Wg)(this._controlPointGraphics[e].symbol).clone();(0,B.ZB)(n,le),this._controlPointGraphics[e].symbol=n,this.activeHandle=e,this.view.surface===document.activeElement&&this.highlightActiveHandle()}}},{key:"highlightActiveHandle",value:function(){var e=(0,C.Z)((0,R.Z)().mark((function e(){var t;return(0,R.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.removeHighlightActiveHandle(),e.next=3,this.view.whenLayerView(this._graphicsLayer);case 3:t=e.sent,this._highlightHandle=t.highlight(this._controlPointGraphics[this.activeHandle]);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeHighlightActiveHandle",value:function(){this._highlightHandle&&this._highlightHandle.remove()}},{key:"setSharedUndoStack",value:function(e){this._sharedUndoStack=e}},{key:"setSharedRedoStack",value:function(e){this._sharedRedoStack=e}},{key:"_initialize",value:function(){var e=(0,C.Z)((0,R.Z)().mark((function e(){var t,n,i,a=this;return(0,R.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.view,n=this.mediaElement,!(0,p.Wi)(n.georeference)){e.next=3;break}return e.abrupt("return");case 3:if(i=n.georeference,e.t0="control-points"!==i.type||(0,p.Wi)(i.coords),e.t0){e.next=21;break}return this._georeference=i,this._initialControlPoints=(0,p.Wg)(this._georeference.controlPoints),t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),e.next=14,this._loadProjectionEngine();case 14:this._controlPointEditGeometryOperations=(0,p.Wg)(this._georeference.controlPoints).map((function(e){var n=e.mapPoint;return ee.c.fromGeometry((0,H.iV)(n,t.spatialReference),j.JY.Local)})),this._controlPointGraphics=this._controlPointEditGeometryOperations.map((function(e,t){return new u.Z({symbol:new _.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t===a.activeHandle?le.toArray():V().toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:e.data.geometry})})),this._graphicsLayer.graphics.addMany((0,G.Z)(this._controlPointGraphics)),this._controlPointManipulations=this._controlPointGraphics.map((function(e){return new K({tool:a,view:t,graphic:e})})),this.addHandles([].concat((0,G.Z)(this._controlPointManipulations.map((function(e,t){return e.createDragPipeline(a._getInfo.bind(a,t),(function(e,n){"start"===e.action&&(a._undoStack.push(t),a._redoStack=[],a._sharedUndoStack.push({tool:a,operation:n}),a._sharedRedoStack.length=0),a.updateGraphics()}))}))),[(0,I.YP)((function(){return a.view.scale}),(function(){return a.active?a.updateGraphics():null}))])),this._controlPointManipulations.forEach((function(e,t){e.forEachManipulator((function(e){a.addHandles([e.events.on(["click","grab-changed"],(function(e){return a.updateActiveHandle(t)}))])}))})),this.addHandles([t.on("key-down",(function(e){t.activeTool===a&&(e.key!==oe||e.repeat||(a._isModifierActive=!0,e.stopPropagation()),e.key!==re||e.repeat||(n.opacity*=a._isOpacityToggled?2:.5,a._isOpacityToggled=!a._isOpacityToggled,e.stopPropagation()),e.key!==se||e.repeat||(a._factor=10,e.stopPropagation()),a._isModifierActive&&(e.key===te&&(a._move(0,a._factor),e.stopPropagation()),e.key===ne&&(a._move(0,-a._factor),e.stopPropagation()),e.key===ie&&(a._move(-a._factor,0),e.stopPropagation()),e.key===ae&&(a._move(a._factor,0),e.stopPropagation())))})),t.on("key-up",(function(e){t.activeTool===a&&(e.key===oe&&(a._isModifierActive=!1,e.stopPropagation()),e.key===se&&(a._factor=1,e.stopPropagation()))}))]);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_loadProjectionEngine",value:function(){var e=(0,C.Z)((0,R.Z)().mark((function e(){var t;return(0,R.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,p.Wg)((0,p.Wg)(this._georeference.controlPoints)[0].mapPoint),e.abrupt("return",(0,H.iQ)(t.spatialReference,this.view.spatialReference));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getInfo",value:function(e){return{editGeometryOperations:this._controlPointEditGeometryOperations[e],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}},{key:"_move",value:function(e,t){var n,i=this._controlPointEditGeometryOperations[this.activeHandle],a=[],r=(0,E.Z)(i.data.components);try{for(r.s();!(n=r.n()).done;){var o=n.value;a.push.apply(a,(0,G.Z)(o.vertices))}}catch(l){r.e(l)}finally{r.f()}var s=i.moveVertices(a,e*this.view.resolution,t*this.view.resolution,0,X.O.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:s}),this._sharedRedoStack.length=0,this.updateGraphics()}}]),n}($.m);(0,c._)([(0,d.Cb)()],ce.prototype,"_hasValidSpatialReference",null),(0,c._)([(0,d.Cb)()],ce.prototype,"activeHandle",void 0),(0,c._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],ce.prototype,"mediaElement",void 0),(0,c._)([(0,d.Cb)({constructOnly:!0})],ce.prototype,"view",void 0),ce=(0,c._)([(0,v.j)("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],ce);var ue=n(68860),he=n(88396),pe=n(6394),de=n(11186),ve=n(71353),fe=n(82218),_e=n(100),ge=n(16889);function ye(e,t){"start"===e.action?t.cursor="grabbing":t.cursor="grab"}var me=function(){function e(){(0,r.Z)(this,e),this._lastDragEvent=null,this.next=new F.hM,this._enabled=!1}return(0,o.Z)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(0,p.pC)(this._lastDragEvent)){var t=(0,a.Z)((0,a.Z)({},this._lastDragEvent),{},{action:"update"});e&&this._adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}},{key:"createDragEventPipelineStep",value:function(){var e=this;return this._lastDragEvent=null,function(t){return e._lastDragEvent="end"!==t.action?(0,a.Z)({},t):null,e._enabled&&e._adjustScaleFactors(t),t}}},{key:"_adjustScaleFactors",value:function(e){var t=0!==e.direction[0]&&0!==e.direction[1]?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}}]),e}(),be=function(){function e(){(0,r.Z)(this,e),this._lastDragEvent=null,this.next=new F.hM,this._enabled=!1}return(0,o.Z)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(0,p.pC)(this._lastDragEvent)){var t=(0,a.Z)((0,a.Z)({},this._lastDragEvent),{},{action:"update"});e&&this._adjustRotateAngle(t),this.next.execute(t)}this._enabled=e}},{key:"createDragEventPipelineStep",value:function(){var e=this;return this._lastDragEvent=null,function(t){return e._lastDragEvent="end"!==t.action?(0,a.Z)({},t):null,e._enabled&&e._adjustRotateAngle(t),t}}},{key:"_adjustRotateAngle",value:function(e){var t=(0,ge.BV)(e.rotateAngle);e.rotateAngle=(0,ge.Vl)(5*Math.round(t/5))}}]),e}(),ke=n(20008),we=n(34778),Me=n(92583),Pe=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this))._handles=new _e.Z,i._originCache=(0,ve.c)(),i._view=e.view,i._tool=e.tool,i._graphic=e.graphic,i._snapRotation=e.snapRotation,i._manipulator=i._createManipulator(),i._handles.add([i._manipulator.events.on("grab-changed",(function(e){return ye(e,i._manipulator)}))]),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return(0,o.Z)(n,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,D.ROTATE)}},{key:"createDragPipeline",value:function(e,t){var n=this,i=null,r=null;return(0,F.Xd)(this._manipulator,(function(o,s){s.next((function(t){if("start"===t.action){o.cursor="grabbing";var n=e();i=n.plane,r=n.editGeometryOperations}return t})).next((0,F.Cf)(n._view)).next((function(e){return(0,a.Z)((0,a.Z)({},e),{},{rotateAngle:(0,ke.cM)(e.mapStart,e.mapEnd,{x:i.origin[0],y:i.origin[1]},!0)})})).next(n._snapRotation.createDragEventPipelineStep(),n._snapRotation.next).next((function(e){var a,o=(0,de.c)(n._originCache,i.origin),s=[],l=(0,E.Z)(r.data.components);try{for(l.s();!(a=l.n()).done;){var c=a.value;s.push.apply(s,(0,G.Z)(c.vertices))}}catch(p){l.e(p)}finally{l.f()}var u="start"===e.action?X.O.NEW_STEP:X.O.ACCUMULATE_STEPS,h=r.rotateVertices(s,o,e.rotateAngle,u,we.w.REPLACE);return(0,Me.nn)(h,i),t(e,h),e})).next((function(e){return"end"===e.action&&(o.cursor="grab"),e}))}))}},{key:"_createManipulator",value:function(){var e=this._view,t=this._graphic;return new q.L({view:e,graphic:t,selectable:!0,cursor:"grab"})}}]),n}(Y),Se=1e-6,Te=.3;function Ze(e){var t=(0,de.l)(e.basis1),n=(0,de.l)(e.basis2);return Te*Math.min(t,n)}var Ee=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this))._handles=new _e.Z,i._planeStart=(0,fe.a)(),i._displayPlaneStart=(0,fe.a)(),i._originCache=(0,ve.c)(),i._axisCache=(0,pe.a)(),i._renderStartCache=(0,ve.c)(),i._renderEndCache=(0,ve.c)(),i._resizeOriginCache=(0,ve.c)(),i._view=e.view,i._tool=e.tool,i._graphic=e.graphic,i._direction=e.direction,i._preserveAspectRatio=e.preserveAspectRatio,i._manipulator=i._createManipulator(),i._handles.add([i._manipulator.events.on("grab-changed",(function(e){return ye(e,i._manipulator)}))]),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return(0,o.Z)(n,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,D.SCALE)}},{key:"createDragPipeline",value:function(e,t){var n=this,i=null,r=null,o=null,s=0,l=null,c=null,u=this._planeStart,h=this._displayPlaneStart,p=this._direction;return(0,F.Xd)(this._manipulator,(function(d,v){v.next((function(t){if("start"===t.action){d.cursor="grabbing";var a=e();i=a.plane,r=a.displayPlane,o=a.editGeometryOperations,s=10*n._view.resolution,(0,fe.c)(i,u),(0,fe.c)(r,h);var c=(0,z.C5)(o.data.spatialReference);l=c?c.valid[1]-c.valid[0]-30*n._view.resolution:null}return t})).next((0,F.Cf)(n._view)).next((function(e){var t=(0,de.c)(n._renderStartCache,[e.mapStart.x,e.mapStart.y,0]),i=(0,de.c)(n._renderEndCache,[e.mapEnd.x,e.mapEnd.y,0]),o=(0,de.c)(n._resizeOriginCache,h.origin);(0,de.z)(o,o,h.basis1,-p[0]),(0,de.z)(o,o,h.basis2,-p[1]),(0,de.b)(i,i,o),(0,de.b)(t,t,o);var l=0!==p[0]&&0!==p[1],c=Ze(h),u=Ze(r)/c,d=function(e,a){if(0===e)return 1;var r=(0,de.l)(a),o=.5*e*(0,de.e)(a,i)/r,c=o<0?-1:1;l&&(o+=(r-.5*e*(0,de.e)(a,t)/r)*c*u);var h=r<1.5*s?1:Se;return r=Math.max(r-s,Se),c>0&&(o-=10*n._view.resolution),c*Math.max(c*(o/r),h)},v=d(p[0],h.basis1),f=d(p[1],h.basis2);return(0,a.Z)((0,a.Z)({},e),{},{direction:p,factor1:v,factor2:f})})).next(n._preserveAspectRatio.createDragEventPipelineStep(),n._preserveAspectRatio.next).next((function(e){var a=(0,de.c)(n._originCache,u.origin);(0,de.z)(a,a,u.basis1,-p[0]),(0,de.z)(a,a,u.basis2,-p[1]);var r=(0,he.s)(n._axisCache,u.basis1[0],u.basis1[1]);(0,he.f)(r,r);var s,h=[],d=(0,E.Z)(o.data.components);try{for(d.s();!(s=d.n()).done;){var v=s.value;h.push.apply(h,(0,G.Z)(v.vertices))}}catch(g){d.e(g)}finally{d.f()}var f="start"===e.action?X.O.NEW_STEP:X.O.ACCUMULATE_STEPS,_=o.scaleVertices(h,a,r,e.factor1,e.factor2,f,we.w.REPLACE);return l&&l<o.data.geometry.extent.width&&c?o.updateVertices(h,c):((0,fe.c)(u,i),(0,Me.nn)(_,i),c=_.operation,t(e,_)),e})).next((function(e){return"end"===e.action&&(d.cursor="grab"),e}))}))}},{key:"_createManipulator",value:function(){return new q.L({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}]),n}(Y),Ge=n(84954),Re=n(74923),Ce=n(72612),xe=n(80885),Ae=n(61459),Oe="ArrowUp",Le="ArrowDown",We="ArrowLeft",Ve="ArrowRight",Ue="+",De="-",Ie="t",He="Shift",ze=Q.CK,Ne=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]],Be=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._initialControlPoints=null,i._initialGeometry=null,i._graphic=null,i._planeCache=(0,fe.a)(),i._displayPlaneCache=(0,fe.a)(),i._mainAxisCache=(0,pe.a)(),i._rotationHandleCache=(0,ve.c)(),i._cornerA=(0,ve.c)(),i._cornerB=(0,ve.c)(),i._cornerC=(0,ve.c)(),i._cornerD=(0,ve.c)(),i._avgAB=(0,ve.c)(),i._avgBC=(0,ve.c)(),i._avgCD=(0,ve.c)(),i._avgDA=(0,ve.c)(),i._preserveAspectRatio=new me,i._snapRotation=new be,i._graphicsLayer=new N.Z({internal:!0,listMode:"hide",visible:!1}),i._sharedUndoStack=[],i._sharedRedoStack=[],i._isOpacityToggled=!1,i._isModifierActive=!1,i._factor=1,i.preserveAspectRatio=null,i.snapRotation=null,i}return(0,o.Z)(n,[{key:"initialize",value:function(){this._initialize()}},{key:"destroy",value:function(){var e=this.view.map;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach((function(e){return e.destroy()})),this._editGeometryOperations.destroy(),e.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,p.SC)(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}},{key:"_plane",get:function(){var e=this._graphic.geometry;if(!(0,p.pC)(e))return null;var t=this._editGeometryOperations.data,n=t.components[0].edges[0],i=(0,he.a)(this._mainAxisCache,n.leftVertex.pos,n.rightVertex.pos);(0,he.f)(i,i);var a=80*this.view.resolution,r=this.view.spatialReference;return(0,z.fS)(r,e.spatialReference)&&(a*=(0,ue.c9)(r)/(0,ue.c9)(e.spatialReference)),(0,Me.lv)(i,t,a,this._planeCache)}},{key:"_displayPlane",get:function(){var e=this._plane;if(!e)return null;var t=this._displayPlaneCache;(0,fe.c)(e,t);var n=10*this.view.resolution;return(0,de.g)(t.basis1,t.basis1,1+n/(0,de.l)(t.basis1)),(0,de.g)(t.basis2,t.basis2,1+n/(0,de.l)(t.basis2)),t}},{key:"_backgroundGraphicGeometry",get:function(){var e=this._displayPlane;if(!e)return null;var t=this.view.spatialReference;return this._updateDisplayPlaneConrers(e),new xe.Z({spatialReference:t,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}},{key:"_rotateGraphicGeometry",get:function(){var e=this._plane;if(!e)return null;var t=this._rotationHandleCache;return(0,de.n)(t,e.basis1),(0,de.g)(t,t,30*this.view.resolution),(0,de.a)(t,t,e.origin),(0,de.a)(t,t,e.basis1),new P.Z({x:t[0],y:t[1],spatialReference:this.view.spatialReference})}},{key:"_scaleGraphicGeometries",get:function(){var e=this._displayPlane;if(!e)return[];var t=this.view.spatialReference;this._updateDisplayPlaneConrers(e);var n=this._cornerA,i=this._cornerB,a=this._cornerC,r=this._cornerD,o=(0,de.h)(this._avgAB,n,i,.5),s=(0,de.h)(this._avgBC,i,a,.5),l=(0,de.h)(this._avgCD,a,r,.5),c=(0,de.h)(this._avgDA,r,n,.5);return[new P.Z({x:n[0],y:n[1],spatialReference:t}),new P.Z({x:i[0],y:i[1],spatialReference:t}),new P.Z({x:a[0],y:a[1],spatialReference:t}),new P.Z({x:r[0],y:r[1],spatialReference:t}),new P.Z({x:o[0],y:o[1],spatialReference:t}),new P.Z({x:s[0],y:s[1],spatialReference:t}),new P.Z({x:l[0],y:l[1],spatialReference:t}),new P.Z({x:c[0],y:c[1],spatialReference:t})]}},{key:"onActivate",value:function(){this.visible=!0}},{key:"onDeactivate",value:function(){this.visible=!1}},{key:"onShow",value:function(){this._graphicsLayer.visible=!0}},{key:"onHide",value:function(){this._graphicsLayer.visible=!1}},{key:"canUndo",value:function(){return this._editGeometryOperations.canUndo}},{key:"canRedo",value:function(){return this._editGeometryOperations.canRedo}},{key:"undo",value:function(){this._editGeometryOperations.undo(),this.updateGraphics()}},{key:"redo",value:function(){this._editGeometryOperations.redo(),this.updateGraphics()}},{key:"refresh",value:function(){var e=this.view,t=this.target,n="georeference"in t?(0,p.Wg)((0,p.Wg)(t.georeference).coords):t.geometry,i=this._editGeometryOperations,a=i.data.components[0].vertices,r=Ge.XE.fromGeometry((0,H.iV)(n,e.spatialReference),j.JY.Local).components[0].vertices;a.forEach((function(e,t){i.setVertexPosition(e,r[t].pos)})),this.updateGraphics()}},{key:"reset",value:function(){var e=this.target;if("georeference"in e){var t=(0,p.Wg)(e.georeference);"control-points"===t.type&&(t.controlPoints=this._initialControlPoints)}else e.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}},{key:"updateGraphics",value:function(){var e=this,t=this._editGeometryOperations.data.geometry;"georeference"in this.target&&((0,p.Wg)(this.target.georeference).coords=t),this._graphic.geometry=t,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach((function(t,n){e._scaleGraphics[n].geometry=t}))}},{key:"setSharedUndoStack",value:function(e){this._sharedUndoStack=e}},{key:"setSharedRedoStack",value:function(e){this._sharedRedoStack=e}},{key:"_initialize",value:function(){var e=(0,C.Z)((0,R.Z)().mark((function e(){var t,n,i,a,r=this;return(0,R.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.view,"georeference"in(n=this.target)?(i=(0,p.Wg)(n.georeference),this._graphic=new u.Z({geometry:(0,p.Wg)(i.coords)}),this._initialControlPoints="control-points"===i.type?i.controlPoints:null):(this._graphic=n,this._initialGeometry=(0,p.Wg)(n.geometry)),t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),e.next=8,this._loadProjectionEngine();case 8:this._editGeometryOperations=ee.c.fromGeometry((0,H.iV)(this._graphic.geometry,t.spatialReference),j.JY.Local),this._backgroundGraphic=new u.Z({symbol:new Ae.Z({color:"transparent",outline:{type:"simple-line",color:V(),width:2}}),geometry:this._backgroundGraphicGeometry}),this._rotateGraphic=new u.Z({symbol:new g.Z({color:U(),outline:{type:"simple-line",color:V(),width:1}}),geometry:this._rotateGraphicGeometry}),this._scaleGraphics=this._scaleGraphicGeometries.map((function(e){return new u.Z({symbol:new g.Z({size:6,style:"square",color:U(),outline:{type:"simple-line",color:V(),width:1}}),geometry:e})})),this._graphicsLayer.graphics.addMany([this._backgroundGraphic,this._rotateGraphic].concat((0,G.Z)(this._scaleGraphics))),this._dragManipulation=new K({tool:this,view:t,graphic:this._graphic}),this._rotateManipulation=new Pe({tool:this,view:t,graphic:this._rotateGraphic,snapRotation:this._snapRotation}),this._scaleManipulations=this._scaleGraphics.map((function(e,n){return new Ee({tool:r,view:t,graphic:e,direction:Ne[n],preserveAspectRatio:r._preserveAspectRatio})})),this.addHandles([this._dragManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),this._rotateManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this))].concat((0,G.Z)(this._scaleManipulations.map((function(e){return e.createDragPipeline(r._getInfo.bind(r),r._updateGraphics.bind(r))}))),[(0,I.YP)((function(){return r.view.scale}),(function(){return r.active?r.updateGraphics():null})),t.on("click",function(){var e=(0,C.Z)((0,R.Z)().mark((function e(i){var a,o,s,l,c,u,h,d;return(0,R.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t.activeTool||t.activeTool===r){e.next=2;break}return e.abrupt("return");case 2:return a=(0,Ce.vT)(i),o=[],t.map.allLayers.forEach((function(e){"vector-tile"!==e.type&&"imagery"!==e.type||o.push(e)})),e.next=6,r.view.hitTest(a,{exclude:o});case 6:s=e.sent,0===(l=s.results).length?t.activeTool=null:(c=(0,Re.qm)(s.results),u="georeference"in n,h=l.map((function(e){return"media"===e.type?e.element:null})).filter(Boolean),d=[].concat((0,G.Z)(r._graphicsLayer.graphics),[u?null:n]).filter(Boolean),u&&h.includes(n)||(0,p.pC)(c)&&d.includes(c.graphic)?null==t.activeTool&&(t.activeTool=r):t.activeTool=null);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())])),a=function(e){r.addHandles(e.events.on("grab-changed",(function(e){"georeference"in n&&("start"===e.action?n.opacity*=.5:"end"===e.action&&(n.opacity*=2))})))},this._dragManipulation.forEachManipulator(a),this._rotateManipulation.forEachManipulator(a),this._scaleManipulations.forEach((function(e){return e.forEachManipulator(a)})),this.addHandles([t.on("key-down",(function(e){t.activeTool===r&&(e.key!==He||e.repeat||(null==r.preserveAspectRatio&&(r._preserveAspectRatio.enabled=!r._preserveAspectRatio.enabled),null==r.snapRotation&&(r._snapRotation.enabled=!r._snapRotation.enabled),r._isModifierActive=!0,e.stopPropagation()),e.key!==Ie||e.repeat||("georeference"in n&&(n.opacity*=r._isOpacityToggled?2:.5,r._isOpacityToggled=!r._isOpacityToggled),e.stopPropagation()),e.key!==ze||e.repeat||(r._factor=10,e.stopPropagation()),r._isModifierActive&&(e.key===Ue&&(r._scale(r._factor),e.stopPropagation()),e.key===De&&(r._scale(-r._factor),e.stopPropagation()),e.key===Oe&&(r._move(0,r._factor),e.stopPropagation()),e.key===Le&&(r._move(0,-r._factor),e.stopPropagation()),e.key===We&&(r._move(-r._factor,0),e.stopPropagation()),e.key===Ve&&(r._move(r._factor,0),e.stopPropagation())))})),t.on("key-up",(function(e){t.activeTool===r&&(e.key===He&&(null==r.preserveAspectRatio&&(r._preserveAspectRatio.enabled=!r._preserveAspectRatio.enabled),null==r.snapRotation&&(r._snapRotation.enabled=!r._snapRotation.enabled),r._isModifierActive=!1,e.stopPropagation()),e.key===ze&&(r._factor=1,e.stopPropagation()))}))]);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_loadProjectionEngine",value:function(){var e=(0,C.Z)((0,R.Z)().mark((function e(){var t;return(0,R.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,p.Wg)(this._graphic.geometry),e.abrupt("return",(0,H.iQ)(t.spatialReference,this.view.spatialReference));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_updateDisplayPlaneConrers",value:function(e){var t=e.basis1,n=e.basis2,i=e.origin,a=this._cornerA;(0,de.a)(a,i,t),(0,de.a)(a,a,n);var r=this._cornerB;(0,de.a)(r,i,t),(0,de.b)(r,r,n);var o=this._cornerC;(0,de.b)(o,i,t),(0,de.b)(o,o,n);var s=this._cornerD;(0,de.b)(s,i,t),(0,de.a)(s,s,n)}},{key:"_getInfo",value:function(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}},{key:"_updateGraphics",value:function(e,t){"start"===e.action&&(this._sharedUndoStack.push({tool:this,operation:t}),this._sharedRedoStack.length=0),this.updateGraphics()}},{key:"_scale",value:function(e){var t,n,i=this._editGeometryOperations,a=[],r=(0,E.Z)(i.data.components);try{for(r.s();!(n=r.n()).done;){var o=n.value;a.push.apply(a,(0,G.Z)(o.vertices))}}catch(u){r.e(u)}finally{r.f()}var s=null===(t=i.data.geometry.extent)||void 0===t?void 0:t.width,l=(s+e*this.view.resolution)/s,c=i.scaleVertices(a,this._plane.origin,pe.U,l,l,X.O.NEW_STEP,we.w.REPLACE);this._sharedUndoStack.push({tool:this,operation:c}),this._sharedRedoStack.length=0,this.updateGraphics()}},{key:"_move",value:function(e,t){var n,i=this._editGeometryOperations,a=[],r=(0,E.Z)(i.data.components);try{for(r.s();!(n=r.n()).done;){var o=n.value;a.push.apply(a,(0,G.Z)(o.vertices))}}catch(l){r.e(l)}finally{r.f()}var s=i.moveVertices(a,e*this.view.resolution,t*this.view.resolution,0,X.O.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:s}),this._sharedRedoStack.length=0,this.updateGraphics()}}]),n}($.m);(0,c._)([(0,d.Cb)()],Be.prototype,"_plane",null),(0,c._)([(0,d.Cb)()],Be.prototype,"_backgroundGraphicGeometry",null),(0,c._)([(0,d.Cb)()],Be.prototype,"_rotateGraphicGeometry",null),(0,c._)([(0,d.Cb)()],Be.prototype,"_scaleGraphicGeometries",null),(0,c._)([(0,d.Cb)()],Be.prototype,"preserveAspectRatio",void 0),(0,c._)([(0,d.Cb)()],Be.prototype,"snapRotation",void 0),(0,c._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],Be.prototype,"target",void 0),(0,c._)([(0,d.Cb)({constructOnly:!0})],Be.prototype,"view",void 0),Be=(0,c._)([(0,v.j)("esri.views.2d.interactive.editingTools.TransformTool")],Be);var je=n(85015),Ye="r",Fe="z",qe=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._transformTool=null,i._controlPointsTransformTool=null,i._advancedModeTransformTool=null,i._activeTool=null,i._sharedUndoStack=[],i._sharedRedoStack=[],i._originalOpacity=null,i.activeHandle=0,i}return(0,o.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.view,n=this.mediaElement,i=this.preserveAspectRatio,a=this.snapRotation,r=this.advancedMode;this._originalOpacity=n.opacity,this._transformTool=new Be({target:n,view:t,preserveAspectRatio:i,snapRotation:a}),this._controlPointsTransformTool=new ce({mediaElement:n,view:t}),this._advancedModeTransformTool=new ce({mediaElement:r.mediaElement,view:r.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);var o=(0,p.Wg)(n.georeference),s=(0,p.Wg)(r.mediaElement.georeference);r.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in s&&"controlPoints"in o&&this.addHandles([r.view.on("key-down",(function(t){t.key===Fe&&e.canUndo()&&(e.undo(),t.stopPropagation()),t.key===Ye&&e.canRedo()&&(e.redo(),t.stopPropagation())})),r.view.on("focus",function(){var t=(0,C.Z)((0,R.Z)().mark((function t(n){return(0,R.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e._controlPointsTransformTool.removeHighlightActiveHandle(),e._advancedModeTransformTool.highlightActiveHandle();case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,I.YP)((function(){return s.controlPoints}),(function(t){var n;o.controlPoints=(0,p.Wg)(t).map((function(e,t){return{sourcePoint:e.sourcePoint,mapPoint:(0,p.Wg)(o.controlPoints)[t].mapPoint}})),null===(n=e._activeTool)||void 0===n||n.refresh()})),(0,I.YP)((function(){return e._controlPointsTransformTool.activeHandle}),(function(t){e._advancedModeTransformTool.updateActiveHandle(t),e.activeHandle=t})),(0,I.YP)((function(){return e._advancedModeTransformTool.activeHandle}),(function(t){e._controlPointsTransformTool.updateActiveHandle(t),e.activeHandle=t}))]),this.addHandles([t.on("key-down",(function(t){t.key===Fe&&e.canUndo()&&(e.undo(),t.stopPropagation()),t.key===Ye&&e.canRedo()&&(e.redo(),t.stopPropagation())})),t.on("focus",function(){var t=(0,C.Z)((0,R.Z)().mark((function t(n){return(0,R.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e._advancedModeTransformTool.removeHighlightActiveHandle(),e._controlPointsTransformTool.highlightActiveHandle();case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())]),t.tools.addMany([this._transformTool,this._controlPointsTransformTool]),t.activeTool=this._transformTool,this._activeTool=this._transformTool,t.focus()}},{key:"destroy",value:function(){var e,t;null!==(e=this._transformTool)&&void 0!==e&&e.destroy(),null!==(t=this._controlPointsTransformTool)&&void 0!==t&&t.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}},{key:"canUndo",value:function(){return this._sharedUndoStack.length>0}},{key:"canRedo",value:function(){return this._sharedRedoStack.length>0}},{key:"undo",value:function(){if(this._sharedUndoStack.length>0){var e,t=this._sharedUndoStack.pop(),n=t.tool,i=t.operation;n!==this._activeTool&&n.refresh(),i.undo(),n.updateGraphics(),this._sharedRedoStack.push({tool:n,operation:i}),this._activeTool!==n&&(null===(e=this._activeTool)||void 0===e||e.refresh())}}},{key:"redo",value:function(){if(this._sharedRedoStack.length>0){var e,t=this._sharedRedoStack.pop(),n=t.tool,i=t.operation;n!==this._activeTool&&n.refresh(),i.apply(),n.updateGraphics(),this._sharedUndoStack.push({tool:n,operation:i}),this._activeTool!==n&&(null===(e=this._activeTool)||void 0===e||e.refresh())}}},{key:"refresh",value:function(){this._activeTool.refresh()}},{key:"reset",value:function(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}},{key:"enableAdvancedMode",value:function(){var e=(0,C.Z)((0,R.Z)().mark((function e(){return(0,R.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.view.activeTool=this._controlPointsTransformTool,this._activeTool=this._controlPointsTransformTool,this._activeTool.refresh(),e.next=5,this.advancedMode.view.when();case 5:this.advancedMode.view.activeTool=this._advancedModeTransformTool,this._originalOpacity=this._controlPointsTransformTool.mediaElement.opacity,this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"disableAdvancedMode",value:function(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}}]),n}(je.Z);(0,c._)([(0,d.Cb)()],qe.prototype,"activeHandle",void 0),(0,c._)([(0,d.Cb)({constructOnly:!0})],qe.prototype,"advancedMode",void 0),(0,c._)([(0,d.Cb)()],qe.prototype,"preserveAspectRatio",void 0),(0,c._)([(0,d.Cb)()],qe.prototype,"snapRotation",void 0),(0,c._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],qe.prototype,"mediaElement",void 0),(0,c._)([(0,d.Cb)({constructOnly:!0})],qe.prototype,"view",void 0),qe=(0,c._)([(0,v.j)("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],qe)},28357:function(e,t,n){n.d(t,{EX:function(){return r}});var i=n(51995);function a(e){var t=e.r,n=e.g,a=e.b,r=e.a;return r<1&&(t=Math.round(r*t+255*(1-r)),n=Math.round(r*n+255*(1-r)),a=Math.round(r*a+255*(1-r))),new i.Z({r:t,g:n,b:a})}function r(e){var t=a(e);return.2126*t.r+.7152*t.g+.0722*t.b}}}]);
//# sourceMappingURL=867.9a146b47.chunk.js.map