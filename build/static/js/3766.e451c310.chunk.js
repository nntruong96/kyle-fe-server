"use strict";(self.webpackChunkcommonlands_web=self.webpackChunkcommonlands_web||[]).push([[3766],{73982:function(e,t,n){n.d(t,{T:function(){return de},I:function(){return ye}});var i=n(1413),r=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(27366),u=n(52639),p=n(91505),c=n(41691),h=n(42537),d=n(92026),v=n(47898),f=n(94172),y=n(68860),g=n(49861),m=(n(25243),n(63780)),_=n(69912),b=n(93655),C=n(74509),x=(n(59486),n(84652)),w=n(11186),k=n(71353),Z=n(42137),M=n(2170),S=n(69662),T=n(92975),O=n(22018),P=n(89494),E=n(48976),I=n(98131),V=n(14320),W=n(585);function R(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,d.pC)(n)?[e,t,n]:[e,t]}function z(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,d.pC)(n)?{x:e,y:t,z:n}:{x:e,y:t}}var G=function(){function e(t){(0,r.Z)(this,e),this.spatialReference=t}return(0,a.Z)(e,[{key:"mapToLocalMultiple",value:function(e){var t=this;return(0,d.lV)(e.map((function(e){return t.mapToLocal(e)})))}},{key:"doUnnormalization",get:function(){return!1}}]),e}(),D=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,r.Z)(this,n),(a=t.call(this,i))._defaultZ=o,a.transform=(0,P.c)(),a.transformInv=(0,P.c)(),a.transform=(0,P.a)(e),(0,O.c)(a.transformInv,a.transform),a}return(0,a.Z)(n,[{key:"makeMapPoint",value:function(e,t){return R(e,t,this._defaultZ)}},{key:"mapToLocal",value:function(e){return z(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}},{key:"localToMap",value:function(e){return R(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}}]),n}(G),A=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,i){var a;(0,r.Z)(this,n),(a=t.call(this,e.spatialReference)).view=e,a.defaultZ=null,a.pWS=(0,k.c)(),a.tangentFrameUpWS=(0,k.c)(),a.tangentFrameRightWS=(0,k.c)(),a.tangentFrameForwardWS=(0,k.c)(),a.localFrameRightWS=(0,k.c)(),a.localFrameUpWS=(0,k.c)(),a.worldToLocalTransform=(0,I.a)(),a.localToWorldTransform=(0,I.a)(),a.scale=1,a.scale=e.resolution,a.referenceMapPoint=i,a.defaultZ=i.hasZ?i.z:null;var o=e.state.camera.viewRight;a.view.renderCoordsHelper.toRenderCoords(a.referenceMapPoint,a.pWS),a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,V.R.X,a.tangentFrameRightWS),a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,V.R.Y,a.tangentFrameUpWS),a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,V.R.Z,a.tangentFrameForwardWS);var s=(0,k.c)();return(0,w.g)(s,a.tangentFrameForwardWS,(0,w.e)(o,a.tangentFrameForwardWS)),(0,w.b)(a.localFrameRightWS,o,s),(0,w.n)(a.localFrameRightWS,a.localFrameRightWS),(0,w.f)(a.localFrameUpWS,a.tangentFrameForwardWS,a.localFrameRightWS),(0,E.r)(a.worldToLocalTransform,a.localFrameRightWS,a.tangentFrameRightWS),(0,E.i)(a.localToWorldTransform,a.worldToLocalTransform),a}return(0,a.Z)(n,[{key:"doUnnormalization",get:function(){return"global"===this.view.viewingMode}},{key:"makeMapPoint",value:function(e,t){return R(e,t,this.defaultZ)}},{key:"mapToLocal",value:function(e){var t=(0,k.c)();this.view.renderCoordsHelper.toRenderCoords(new W.Z({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),(0,w.q)(t,t,this.worldToLocalTransform);var n=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return(0,d.pC)(n)?z(n.x/this.scale,n.y/this.scale):null}},{key:"localToMap",value:function(e){var t=(0,k.c)();this.view.renderCoordsHelper.toRenderCoords(new W.Z({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),(0,w.q)(t,t,this.localToWorldTransform);var n=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return(0,d.pC)(n)?R(n.x,n.y,this.defaultZ):null}}]),n}(G);function F(e,t){if("2d"===e.type)return new D(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){var n=t.length>2?new W.Z({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new W.Z({x:t[0],y:t[1],spatialReference:e.spatialReference});return new A(e,n)}return null}var H=n(77577),U=n(29909),L=n(80885);function N(e,t){var n=new W.Z({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(n.z=e[2]),n}function q(e,t,n){var i=new U.Z({paths:e,spatialReference:t});return n&&(0,S.nc)(i),i}function Y(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=(0,x.d9)(e);r.forEach((function(e){var t=e[0],n=e[e.length-1];(0,m.fS)(t,n)&&1!==e.length||e.push(e[0])}));var a=new L.Z({rings:r,spatialReference:t});return a.rings.forEach((function(e){(0,S.bu)(e,!1,!1)||e.reverse()})),n&&(0,S.nc)(a),i&&a.isSelfIntersecting&&(0,T.JY)(t)&&(a=(0,M.simplify)(a)),a}function X(e,t,n){var i=t.mapToLocalMultiple(e),r=[],a={x:i[0].x,y:i[0].y},o=i[1].x,s=i[1].y,l=Math.round(o-a.x),u=Math.round(s-a.y),p=Math.max(Math.abs(l),Math.abs(u));if(n){var c={x:a.x+p,y:a.y+p},h={x:a.x-p,y:a.y-p};r.push(z(c.x,h.y),z(h.x,h.y),z(h.x,c.y),z(c.x,c.y))}else{var v={x:l>0?a.x+p:a.x-p,y:u>0?a.y+p:a.y-p};r.push(z(a.x,a.y),z(v.x,a.y),z(v.x,v.y),z(a.x,v.y))}return Q(Y([(0,d.lV)(r.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0),r,t)}function Q(e,t,n){var i=j(t[3],t[2],n),r=j(t[1],t[2],n),a=j(t[0],t[1],n),o=j(t[0],t[3],n);return{geometry:e,midpoints:(0,d.pC)(i)&&(0,d.pC)(r)&&(0,d.pC)(a)&&(0,d.pC)(o)?{top:i,right:r,bottom:a,left:o}:null}}function j(e,t,n){J[0]=e.x,J[1]=e.y,J[2]=0,K[0]=t.x,K[1]=t.y,K[2]=0,(0,w.h)(J,J,K,.5),B.x=J[0],B.y=K[1],B.z=K[2];var i=n.localToMap(B);return(0,d.pC)(i)?N(i,n.spatialReference):null}var B=z(0,0,0),J=(0,k.c)(),K=(0,k.c)();function $(e,t,n,i){var r=t.mapToLocalMultiple(e),a=null,o=null;if(n)a=r[0],o=r[1];else{var s=r[0],l=r[1],u=Math.round(l.x-s.x),p=Math.round(l.y-s.y),c=Math.max(Math.abs(u),Math.abs(p));a=z(u>0?s.x+c/2:s.x-c/2,p>0?s.y+c/2:s.y-c/2),o=z(Math.abs(u)>Math.abs(p)?a.x-c/2:a.x,Math.abs(u)>Math.abs(p)?a.y:a.y-c/2)}var h=t.localToMap(a),v=t.localToMap(o);if((0,d.Wi)(h)||(0,d.Wi)(v))return null;t.doUnnormalization&&(0,S.Sq)([[h,v]],t.spatialReference);var f=N(h,t.spatialReference),g=N(v,t.spatialReference),m=(0,y.c9)(t.spatialReference),_=0;if((0,T.JY)(t.spatialReference))_=m*(0,M.distance)(f,g,null);else{var b=a.x-o.x,C=a.y-o.y;_=m*Math.sqrt(b*b+C*C)*(i||1)}var x=new Z.Z({center:f,radius:_,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:Y(x.rings,x.spatialReference,!1),center:f,edge:g}}function ee(e,t){switch(e){case"point":case"multipoint":return"point";case"polyline":return((0,d.pC)(t)&&"polyline"===t.type&&t.paths.length?t.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex";case"polygon":var n=(0,d.pC)(t)&&"polygon"===t.type&&t.rings.length?t.rings[0].length:0;return n<3?"polylineZeroVertices":n<4?"polygonOneVertex":"polygonTwoVertices";default:return}}var te=n(29919),ne=n(52349),ie=n(77560),re=n(4943),ae=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).type="draw-point",i.helpMessage=void 0,i}return(0,a.Z)(n)}(re.h);(0,l._)([(0,g.Cb)()],ae.prototype,"type",void 0),(0,l._)([(0,g.Cb)()],ae.prototype,"elevation",void 0),(0,l._)([(0,g.Cb)()],ae.prototype,"viewType",void 0),(0,l._)([(0,g.Cb)()],ae.prototype,"helpMessage",void 0),ae=(0,l._)([(0,_.j)("esri.views.interactive.tooltip.DrawPointTooltipInfo")],ae);var oe=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).type="draw-polyline",i.totalLength=v.yP,i.helpMessage=void 0,i}return(0,a.Z)(n)}(re.h);(0,l._)([(0,g.Cb)()],oe.prototype,"type",void 0),(0,l._)([(0,g.Cb)()],oe.prototype,"elevation",void 0),(0,l._)([(0,g.Cb)()],oe.prototype,"totalLength",void 0),(0,l._)([(0,g.Cb)()],oe.prototype,"viewType",void 0),(0,l._)([(0,g.Cb)()],oe.prototype,"helpMessage",void 0),oe=(0,l._)([(0,_.j)("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],oe);var se=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).type="draw-polygon",i.area=v.MQ,i.helpMessage=void 0,i}return(0,a.Z)(n)}(re.h);(0,l._)([(0,g.Cb)()],se.prototype,"type",void 0),(0,l._)([(0,g.Cb)()],se.prototype,"elevation",void 0),(0,l._)([(0,g.Cb)()],se.prototype,"area",void 0),(0,l._)([(0,g.Cb)()],se.prototype,"viewType",void 0),(0,l._)([(0,g.Cb)()],se.prototype,"helpMessage",void 0),se=(0,l._)([(0,_.j)("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],se);var le=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).type="draw-rectangle",i.xSize=v.yP,i.ySize=v.yP,i.area=v.MQ,i}return(0,a.Z)(n)}(re.h);(0,l._)([(0,g.Cb)()],le.prototype,"type",void 0),(0,l._)([(0,g.Cb)()],le.prototype,"xSize",void 0),(0,l._)([(0,g.Cb)()],le.prototype,"ySize",void 0),(0,l._)([(0,g.Cb)()],le.prototype,"area",void 0),le=(0,l._)([(0,_.j)("esri.views.interactive.tooltip.DrawRectangleTooltipInfo")],le);var ue=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).type="draw-circle",i.radius=null,i.xSize=null,i.ySize=null,i.area=v.MQ,i}return(0,a.Z)(n)}(re.h);(0,l._)([(0,g.Cb)()],ue.prototype,"type",void 0),(0,l._)([(0,g.Cb)()],ue.prototype,"radius",void 0),(0,l._)([(0,g.Cb)()],ue.prototype,"xSize",void 0),(0,l._)([(0,g.Cb)()],ue.prototype,"ySize",void 0),(0,l._)([(0,g.Cb)()],ue.prototype,"area",void 0),ue=(0,l._)([(0,_.j)("esri.views.interactive.tooltip.DrawCircleTooltipInfo")],ue);var pe=n(12494),ce=n(9856),he=n(59418),de=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._graphic=null,i._createOperationGeometry=null,i.defaultZ=0,i.geometryType=null,i.hasZ=!0,i.labelOptions=new ne.Z,i.mode=null,i.snappingManager=null,i.snapToScene=!1,i.tooltip=null,i.tooltipOptions=new ie.Z,i}return(0,a.Z)(n,[{key:"initialize",value:function(){var e=this;this.internalGraphicsLayer=new b.Z({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",(function(t){return e.onVertexAdd(t)})),this.drawOperation.on("vertex-remove",(function(t){return e.onVertexRemove(t)})),this.drawOperation.on("vertex-update",(function(t){return e.onVertexUpdate(t)})),this.drawOperation.on("cursor-update",(function(t){return e.onCursorUpdate(t)})),this.drawOperation.on("complete",(function(t){return e.onComplete(t)})),(0,f.YP)((function(){return e.tooltipOptions.enabled}),(function(t){e.tooltip=t?new pe.u({view:e.view,info:e._tooltipInfo}):(0,d.SC)(e.tooltip)}),f.tX),(0,f.YP)((function(){return e._tooltipInfo}),(function(t){(0,d.pC)(e.tooltip)&&(e.tooltip.info=t)}),f.tX)]),this.finishToolCreation()}},{key:"destroy",value:function(){this.drawOperation=(0,d.SC)(this.drawOperation),this.tooltip=(0,d.SC)(this.tooltip),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,d.SC)(this.internalGraphicsLayer),this._set("view",null)}},{key:"_defaultElevation",get:function(){return(0,v.yG)(this.defaultZ,"meters")}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},{key:"centered",set:function(e){this._set("centered",e),this._updateGraphic()}},{key:"enabled",set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)}},{key:"forceUniformSize",set:function(e){this._set("forceUniformSize",e),this._updateGraphic()}},{key:"graphic",get:function(){return this._graphic}},{key:"graphicSymbol",set:function(e){this._set("graphicSymbol",e),(0,d.pC)(this._graphic)&&(this._graphic.symbol=e)}},{key:"updating",get:function(){var e,t;return null!==(e=null===(t=this.drawOperation)||void 0===t?void 0:t.updating)&&void 0!==e&&e}},{key:"completeCreateOperation",value:function(){this.drawOperation.complete()}},{key:"onInputEvent",value:function(e){this.drawOperation.onInputEvent(e)}},{key:"redo",value:function(){this.drawOperation.redo()}},{key:"reset",value:function(){}},{key:"undo",value:function(){this.drawOperation.undo()}},{key:"_createGraphic",value:function(e){var t=this;this._graphic=new u.Z((0,i.Z)((0,i.Z)({},this.graphicProperties),{},{geometry:e,symbol:this.graphicSymbol})),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add((0,h.kB)((function(){(0,d.pC)(t._graphic)&&(t.internalGraphicsLayer.remove(t._graphic),t._graphic=(0,d.SC)(t._graphic))})),ve)}},{key:"_destroyAllVisualisations",value:function(){this.handles.remove(fe.outline),this.handles.remove(fe.regularVertices),this.handles.remove(fe.activeVertex),this.handles.remove(ve)}},{key:"_getCreateOperationGeometry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{operationComplete:!1};if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;var t=this.drawOperation.stagedVertex,n=this.drawOperation.committedVertices,i=n.slice();(0,d.pC)(t)&&i.push(this.drawOperation.coordinateHelper.pointToArray(t));var r=(0,d.pC)(t)?this.drawOperation.coordinateHelper.pointToArray(t):n.splice(-1)[0],a={regularVertices:null,activeVertex:null,full:null,outline:null,circle:null,rectangle:null},o=i.length,s=this.view.spatialReference,l="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":a.regularVertices=n,a.activeVertex=r,a.full=this.drawOperation.coordinateHelper.arrayToPoint(i[0]);break;case"multipoint":a.regularVertices=n,a.activeVertex=r,o>0&&(a.full=function(e,t){return new H.Z({points:e,spatialReference:t})}(i,s));break;case"polyline":a.regularVertices=n,a.activeVertex=r,o>0&&(a.full=q([i],s,l));break;case"polygon":a.regularVertices=n,a.activeVertex=r,o>0&&(a.full=Y([i],s,l,!0));break;case"circle":if(o>0){var u=F(this.view,i[0]);if(1===o&&e.operationComplete){var p=i[0],c=u.makeMapPoint(p[0]+ge*this.view.resolution,p[1]);a.circle=$([p,c],u,!0),a.full=(0,d.pC)(a.circle)?a.circle.geometry:null}else 2===o&&(this.forceUniformSize?(a.circle=$(i,u,this.centered),a.full=(0,d.pC)(a.circle)?a.circle.geometry:null):(a.rectangle=function(e,t,n){var i=t.mapToLocalMultiple(e),r=i[0],a=i[1],o=Math.round(a.x-r.x),s=Math.round(a.y-r.y),l=z(n?r.x:r.x+o/2,n?r.y:r.y+s/2),u=n?o:o/2,p=n?s:s/2,c=[],h=2*Math.PI/60;function v(e){var t=Math.cos(e),n=Math.sin(e);return z(u*t+l.x,p*n+l.y)}for(var f=0;f<60;f++)c.push(v(f*h));c.push(c[0]);var y=t.spatialReference,g=t.doUnnormalization,m=Y([(0,d.lV)(c.map((function(e){return t.localToMap(e)})))],y,g,!1),_=t.localToMap(v(Math.PI/2)),b=t.localToMap(v(0)),C=t.localToMap(v(-Math.PI/2)),x=t.localToMap(v(Math.PI));return{geometry:m,midpoints:(0,d.pC)(_)&&(0,d.pC)(b)&&(0,d.pC)(C)&&(0,d.pC)(x)?{top:N(_,y),right:N(b,y),bottom:N(C,y),left:N(x,y)}:null}}(i,u,this.centered),a.full=a.rectangle.geometry))}break;case"rectangle":if(o>0){var h=F(this.view,i[0]);if(1===o&&e.operationComplete){var v=i[0],f=h.makeMapPoint(v[0]+ge*this.view.resolution,v[1]);a.rectangle=X([v,f],h,!0),a.full=a.rectangle.geometry}else 2===o&&(a.rectangle=this.forceUniformSize?X(i,h,this.centered):function(e,t,n){var i=t.mapToLocalMultiple(e);if(1===i.length){var r=48,a=i[0];i=[z(a.x-r,a.y+r),z(a.x+r,a.y-r),z(a.x+r,a.y-r),z(a.x-r,a.y+r)]}var o=[],s={x:i[0].x,y:i[0].y},l={x:i[1].x,y:i[1].y};if(n){var u=Math.round(l.x-s.x),p=Math.round(l.y-s.y);o.push(z(s.x-u,s.y-p),z(l.x,s.y-p),z(l.x,l.y),z(s.x-u,l.y))}else o.push(z(s.x,s.y),z(l.x,s.y),z(l.x,l.y),z(s.x,l.y));return Q(Y([(0,d.lV)(o.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0),o,t)}(i,h,this.centered),a.full=a.rectangle.geometry)}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":o>1&&(a.outline=q([i],s,l));break;case"circle":case"rectangle":(0,d.pC)(a.full)&&"polygon"===a.full.type&&(a.outline=Y(a.full.rings,s,l))}return a}},{key:"initializeGraphic",value:function(e){return null}},{key:"onComplete",value:function(e){this._updateGraphic();var t=null;if(this.drawOperation.isCompleted){var n=this._getCreateOperationGeometry({operationComplete:!0});(0,d.pC)(n)&&((0,d.Wi)(this._graphic)?this._createGraphic(n.full):this._graphic.geometry=n.full,t=(0,d.Wg)(this._graphic).clone())}this._createOperationGeometry=null,this.emit("complete",(0,i.Z)({graphic:t},e))}},{key:"onCursorUpdate",value:function(e){this._updateGraphic(),this.emit("cursor-update",e)}},{key:"onDeactivate",value:function(){this.drawOperation.isCompleted||this.drawOperation.cancel()}},{key:"onVertexAdd",value:function(e){this._updateGraphic(),this.emit("vertex-add",e)}},{key:"onVertexRemove",value:function(e){this._updateGraphic(),this.emit("vertex-remove",e)}},{key:"onVertexUpdate",value:function(e){this._updateGraphic(),this.emit("vertex-update",e)}},{key:"_updateGraphic",value:function(){var e=this._getCreateOperationGeometry();this._createOperationGeometry=e,(0,d.Wi)(e)?this._destroyAllVisualisations():((0,d.pC)(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),fe.outline):this.handles.remove(fe.outline),(0,d.pC)(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),fe.regularVertices):this.handles.remove(fe.regularVertices),(0,d.pC)(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),fe.activeVertex):this.handles.remove(fe.activeVertex),(0,d.pC)(e.full)?(0,d.Wi)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(ve))}},{key:"_tooltipInfo",get:function(){if(!this.drawOperation)return null;switch(this.geometryType){case"point":return this._drawPointTooltipInfo;case"polyline":return this._drawPolylineTooltipInfo;case"polygon":return this._drawPolygonTooltipInfo;case"rectangle":return this._drawRectangleTooltipInfo;case"circle":return this._drawCircleTooltipInfo;default:return null}}},{key:"_drawPointTooltipInfo",get:function(){var e=(0,d.yw)(this.graphic,(function(e){return e.geometry}));return(0,d.Wi)(e)||"point"!==e.type||"2d"===this.view.type&&0===this.defaultZ?null:new ae({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,viewType:this.view.type,helpMessage:ee("point",e)})}},{key:"_drawPolylineTooltipInfo",get:function(){var e=this._createOperationGeometry,t=(0,d.pC)(e)?e.full:null;if((0,d.Wi)(t)||"polyline"!==t.type)return null;var n=(0,he.Ul)(t,this._elevationMode);return new oe({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,totalLength:(0,d.Pt)(n,v.yP),viewType:this.view.type,helpMessage:ee("polyline",t)})}},{key:"_drawPolygonTooltipInfo",get:function(){var e=this._createOperationGeometry,t=(0,d.pC)(e)?e.full:null;if((0,d.Wi)(t)||"polygon"!==t.type)return null;var n=(0,ce.k)(t,this._elevationMode);return new se({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,area:(0,d.Pt)(n,v.MQ),viewType:this.view.type,helpMessage:ee("polygon",t)})}},{key:"_drawRectangleTooltipInfo",get:function(){return(0,d.Wi)(this.drawOperation)?null:new le({tooltipOptions:this.tooltipOptions,xSize:(0,d.Pt)(this._xSize,v.yP),ySize:(0,d.Pt)(this._ySize,v.yP),area:(0,d.Pt)(this._fullGeometryArea,v.MQ)})}},{key:"_drawCircleTooltipInfo",get:function(){if((0,d.Wi)(this.drawOperation))return null;var e=this.forceUniformSize;return new ue({tooltipOptions:this.tooltipOptions,radius:e?(0,d.Pt)(this._circleRadius,v.yP):null,xSize:e?null:(0,d.Pt)(this._xSize,v.yP),ySize:e?null:(0,d.Pt)(this._ySize,v.yP),area:(0,d.Pt)(this._fullGeometryArea,v.MQ)})}},{key:"_circleRadius",get:function(){var e=this._createOperationGeometry;return(0,d.pC)(e)&&(0,d.pC)(e.circle)&&(0,d.pC)(e.circle.center)&&(0,d.pC)(e.circle.edge)?(0,he.GQ)(e.circle.center,e.circle.edge,this._elevationMode):null}},{key:"_xSize",get:function(){var e=this._createOperationGeometry;if((0,d.Wi)(e)||(0,d.Wi)(e.rectangle))return null;var t=e.rectangle.midpoints;return(0,d.pC)(t)?(0,he.GQ)(t.left,t.right,this._elevationMode):null}},{key:"_ySize",get:function(){var e=this._createOperationGeometry;if((0,d.Wi)(e)||(0,d.Wi)(e.rectangle))return null;var t=e.rectangle.midpoints;return(0,d.pC)(t)?(0,he.GQ)(t.top,t.bottom,this._elevationMode):null}},{key:"_fullGeometryArea",get:function(){var e=this._createOperationGeometry,t=(0,d.pC)(e)?e.full:null;return(0,d.Wi)(t)||"polygon"!==t.type?null:(0,ce.k)(t,this._elevationMode)}},{key:"_elevationTooltipDetail",get:function(){return(0,i.Z)({mode:this.drawOperation.elevationInfo.mode},this._vertexTooltipElevation)}},{key:"_vertexTooltipElevation",get:function(){var e,t,n=this.tooltipOptions,i=this.view,r=this.drawOperation;if((0,d.Wi)(r))return this._defaultElevation;var a=null!==(e=r.stagedVertex)&&void 0!==e?e:r.lastVertex;if((0,d.Wi)(a)||"2d"===i.type)return this._defaultElevation;var o={mode:n.elevation.mode,offset:0},s=(null!==(t=(0,C.vQ)(i,a,r.elevationInfo,o))&&void 0!==t?t:0)*(0,y._R)(a.spatialReference);return(0,v.yG)(s,"meters")}},{key:"_elevationMode",get:function(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}}]),n}((0,c.p)(p.Z.EventedMixin(te.m)));(0,l._)([(0,g.Cb)()],de.prototype,"_createOperationGeometry",void 0),(0,l._)([(0,g.Cb)()],de.prototype,"_defaultElevation",null),(0,l._)([(0,g.Cb)({value:!0})],de.prototype,"centered",null),(0,l._)([(0,g.Cb)({nonNullable:!0})],de.prototype,"defaultZ",void 0),(0,l._)([(0,g.Cb)()],de.prototype,"drawOperation",void 0),(0,l._)([(0,g.Cb)({value:!0})],de.prototype,"enabled",null),(0,l._)([(0,g.Cb)({value:!0})],de.prototype,"forceUniformSize",null),(0,l._)([(0,g.Cb)({constructOnly:!0})],de.prototype,"geometryType",void 0),(0,l._)([(0,g.Cb)()],de.prototype,"graphic",null),(0,l._)([(0,g.Cb)({constructOnly:!0})],de.prototype,"graphicProperties",void 0),(0,l._)([(0,g.Cb)()],de.prototype,"graphicSymbol",null),(0,l._)([(0,g.Cb)({constructOnly:!0})],de.prototype,"hasZ",void 0),(0,l._)([(0,g.Cb)({constructOnly:!0,type:ne.Z})],de.prototype,"labelOptions",void 0),(0,l._)([(0,g.Cb)({constructOnly:!0})],de.prototype,"mode",void 0),(0,l._)([(0,g.Cb)()],de.prototype,"snappingManager",void 0),(0,l._)([(0,g.Cb)()],de.prototype,"snapToScene",void 0),(0,l._)([(0,g.Cb)()],de.prototype,"tooltip",void 0),(0,l._)([(0,g.Cb)({constructOnly:!0,type:ie.Z})],de.prototype,"tooltipOptions",void 0),(0,l._)([(0,g.Cb)({readOnly:!0})],de.prototype,"type",void 0),(0,l._)([(0,g.Cb)({readOnly:!0})],de.prototype,"updating",null),(0,l._)([(0,g.Cb)({constructOnly:!0,nonNullable:!0})],de.prototype,"view",void 0),(0,l._)([(0,g.Cb)()],de.prototype,"_tooltipInfo",null),(0,l._)([(0,g.Cb)()],de.prototype,"_drawPointTooltipInfo",null),(0,l._)([(0,g.Cb)()],de.prototype,"_drawPolylineTooltipInfo",null),(0,l._)([(0,g.Cb)()],de.prototype,"_drawPolygonTooltipInfo",null),(0,l._)([(0,g.Cb)()],de.prototype,"_drawRectangleTooltipInfo",null),(0,l._)([(0,g.Cb)()],de.prototype,"_drawCircleTooltipInfo",null),(0,l._)([(0,g.Cb)()],de.prototype,"_circleRadius",null),(0,l._)([(0,g.Cb)()],de.prototype,"_xSize",null),(0,l._)([(0,g.Cb)()],de.prototype,"_ySize",null),(0,l._)([(0,g.Cb)()],de.prototype,"_fullGeometryArea",null),(0,l._)([(0,g.Cb)()],de.prototype,"_elevationTooltipDetail",null),(0,l._)([(0,g.Cb)()],de.prototype,"_vertexTooltipElevation",null),(0,l._)([(0,g.Cb)()],de.prototype,"_elevationMode",null),de=(0,l._)([(0,_.j)("esri.views.draw.DrawGraphicTool")],de);var ve="create-operation-graphic",fe={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function ye(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment"}}var ge=48},71719:function(e,t,n){n.d(t,{w:function(){return D}});var i=n(93433),r=n(1413),a=n(15671),o=n(43144),s=n(60136),l=n(29388),u=n(27366),p=n(91505),c=n(41691),h=n(84652),d=n(92026),v=n(66978),f=n(94172),y=n(17842),g=n(49861),m=(n(25243),n(69912)),_=n(70178),b=n(74509),C=n(50951),x="click",w=function(){function e(t){var n=t.grabbableForEvent;(0,a.Z)(this,e),this.events=new p.Z,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=n}return(0,o.Z)(e,[{key:"intersectionDistance",value:function(e,t){return 0}},{key:"attach",value:function(){}},{key:"detach",value:function(){}},{key:"onElevationChange",value:function(){}},{key:"onViewChange",value:function(){}}]),e}(),k=n(14813),Z=n(74229),M=n(84954),S=n(87268),T=n(52349),O=n(77560),P=n(34019),E=n(80151),I=n(74165),V=n(15861),W=n(85015),R=(n(63780),n(78307)),z=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).constrainResult=function(e){return e},i._snapPoints=null,i._frameTask=null,i._abortController=null,i._stagedPoint=null,i._snap=(0,v.Ds)(function(){var e=(0,V.Z)((0,I.Z)().mark((function e(t,n,a,o){var s,l;return(0,I.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=i._frameTask,!(0,d.Wi)(s)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,s.schedule((function(){return n.snap((0,r.Z)((0,r.Z)({},t),{},{context:a,signal:o}))}),o);case 5:if(l=e.sent,e.t0=l.valid,!e.t0){e.next=10;break}return e.next=10,s.schedule((function(){i.stagedPoint=l.apply(),t!==i._snapPoints&&(0,d.pC)(i._snapPoints)&&(i.stagedPoint=n.update((0,r.Z)((0,r.Z)({},i._snapPoints),{},{context:a})))}),o);case 10:case"end":return e.stop()}}),e)})));return function(t,n,i,r){return e.apply(this,arguments)}}()),i}return(0,o.Z)(n,[{key:"stagedPoint",get:function(){return this._stagedPoint},set:function(e){this._stagedPoint=this.constrainResult(e)}},{key:"initialize",value:function(){var e,t,n="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(t=e.resourceController)||void 0===t?void 0:t.scheduler:null;this._frameTask=(0,d.pC)(n)?n.registerTask(R.T8.SNAPPING):R.sq}},{key:"destroy",value:function(){this._abortController=(0,d.IM)(this._abortController),this._frameTask=(0,d.hw)(this._frameTask)}},{key:"update",value:function(e,t,n){this._snapPoints=e;var i=e.point,r=e.scenePoint,a=t.update({point:i,scenePoint:r,context:n});return this.stagedPoint=a,a}},{key:"snap",value:function(){var e=(0,V.Z)((0,I.Z)().mark((function e(t,n,i){var r,a;return(0,I.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.point,a=t.scenePoint,e.abrupt("return",(this.stagedPoint=n.update({point:r,scenePoint:a,context:i}),this._snapPoints=t,(0,d.Wi)(this._abortController)&&(this._abortController=new AbortController),this._snap(t,n,i,this._abortController.signal)));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"resnap",value:function(){var e=(0,V.Z)((0,I.Z)().mark((function e(t,n){return(0,I.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=(0,d.Wi)(this._snapPoints),e.t0){e.next=4;break}return e.next=4,this.snap(this._snapPoints,t,n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"abort",value:function(){this._abortController=(0,d.IM)(this._abortController),this._snapPoints=null}}]),n}(W.Z);(0,u._)([(0,g.Cb)({constructOnly:!0})],z.prototype,"view",void 0),(0,u._)([(0,g.Cb)()],z.prototype,"stagedPoint",null),(0,u._)([(0,g.Cb)()],z.prototype,"constrainResult",void 0),(0,u._)([(0,g.Cb)()],z.prototype,"_stagedPoint",void 0),z=(0,u._)([(0,m.j)("esri.views.interactive.snapping.SnappingOperation")],z);var G=n(64674),D=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e))._createOperationCompleted=!1,i._pointerDownStates=new Set,i.isDraped=!0,i.labelOptions=new T.Z,i.tooltipOptions=new O.Z,i.snapToSceneEnabled=null,i.lastVertex=null,(0,d.Wi)(e.elevationInfo)&&(i.elevationInfo=(0,b.mF)(!!e.hasZ)),i}return(0,o.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.geometryType,n=this.view,i=n.spatialReference,a="viewingMode"in n.state?n.state.viewingMode:C.JY.Local,o="segment"===t||"multipoint"===t?"polyline":t;this.coordinateHelper=(0,k.Y6)(this.hasZ,this.hasM,i),this._editGeometryOperations=new S.c(new M.XE(o,this.coordinateHelper)),this._snappingOperation=new z({view:n,constrainResult:function(t){var n;return(0,d.Wi)(t)?t:null===(n=e._getEffectiveDrawSurface())||void 0===n?void 0:n.constrainZ(t)}}),this.handles.add((0,f.YP)((function(){return e.stagedVertex}),(function(t){(0,d.Wi)(t)||e.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:e._activeComponent.vertices.length,coordinates:e.coordinateHelper.pointToArray(t)}],operation:"apply",type:"vertex-update"})}),{sync:!0,equals:function(e,t){return(0,d._W)(e,t,_.k)}})),this._activeComponent=new M.wA(i,a),this._editGeometryOperations.data.components.push(this._activeComponent);var s=this.segmentLabels;(0,d.pC)(s)&&(s.context={view:n,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.handles.add([(0,f.YP)((function(){return e.labelOptions.enabled}),(function(e){s.visible=e}),f.tX),this.on("cursor-update",(function(){var t=e.stagedVertex;s.stagedVertex=(0,d.pC)(t)?e.coordinateHelper.pointToVector(t):null}))])),this.handles.add(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(function(t){var n=t.vertices.map((function(t){return{componentIndex:0,vertexIndex:t.index,coordinates:e.coordinateHelper.vectorToArray(t.pos)}})),i=n.map((function(e){return e.coordinates}));switch(t.type){case"vertex-add":e.emit(t.type,(0,r.Z)((0,r.Z)({},t),{},{added:i,vertices:n}));break;case"vertex-update":e.emit(t.type,(0,r.Z)((0,r.Z)({},t),{},{updated:i,vertices:n}));break;case"vertex-remove":e.emit(t.type,(0,r.Z)((0,r.Z)({},t),{},{removed:i,vertices:n}))}var a=e._activeComponent.getLastVertex(),o=(0,d.pC)(a)?e.coordinateHelper.vectorToDehydratedPoint(a.pos):null;((0,d.Wi)(o)||(0,d.Wi)(e.lastVertex)||!(0,_.k)(e.lastVertex,o))&&(e.lastVertex=o)}))),this._manipulator=new w({grabbableForEvent:function(t){return"click"!==e.drawingMode||"touch"===t.pointerType&&e._snappingEnabled&&1===e._pointerDownStates.size}}),this.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==t,this.handles.add([this._createManipulatorDragPipeline(this._manipulator),this._manipulator.events.on("immediate-click",(function(t){return e._onImmediateClick(t)})),this._manipulator.events.on("immediate-double-click",(function(t){return e._onImmediateDoubleClick(t)}))]),(0,G.Ob)(this,(function(){var t=(0,d.Pt)(e.view.inputManager.latestPointerType,"mouse"),n=e._getSnappingContext(t);(0,d.pC)(e.snappingManager)&&e.updatingHandles.addPromise((0,v.R8)(e._snappingOperation.resnap(e.snappingManager,n)))}))}},{key:"destroy",value:function(){(0,d.SC)(this.segmentLabels),(0,d.SC)(this._snappingOperation),this._editGeometryOperations=(0,d.SC)(this._editGeometryOperations)}},{key:"_snappingEnabled",get:function(){return(0,d.pC)(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}},{key:"_requiresScenePoint",get:function(){var e=this._getEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==e}},{key:"canRedo",get:function(){return this._editGeometryOperations.canRedo}},{key:"canUndo",get:function(){return this._editGeometryOperations.canUndo}},{key:"committedVertices",get:function(){var e=this;return this._activeComponent.vertices.map((function(t){return e.coordinateHelper.vectorToArray(t.pos)}))}},{key:"drawingMode",set:function(e){this._set("drawingMode",null!==e&&void 0!==e?e:x)}},{key:"interactive",get:function(){return this._manipulator.interactive},set:function(e){this._manipulator.interactive=e}},{key:"isCompleted",get:function(){return this._createOperationCompleted}},{key:"numCommittedVertices",get:function(){return this._activeComponent.vertices.length}},{key:"numVertices",get:function(){return(0,d.pC)(this.stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}},{key:"snappingOptions",get:function(){return(0,d.pC)(this.snappingManager)?this.snappingManager.options:null}},{key:"stagedVertex",get:function(){return this._snappingOperation.stagedPoint},set:function(e){this._snappingOperation.stagedPoint=(0,h.d9)(e)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"vertices",get:function(){var e=this.committedVertices;return(0,d.pC)(this.stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this.stagedVertex)),e}},{key:"cancel",value:function(){this.complete({aborted:!0})}},{key:"commitStagedVertex",value:function(){if(this._snappingOperation.abort(),(0,d.pC)(this.stagedVertex)){var e=this.stagedVertex;this.stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}}},{key:"complete",value:function(e){var t=e&&e.aborted||!1;this._snappingOperation.abort(),(0,d.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),"segment"===this.geometryType||"point"===this.geometryType?this.commitStagedVertex():this.stagedVertex=null;var n="multipoint"===this.geometryType&&0===this.numVertices||"polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!n,(this.isCompleted||t)&&this.emit("complete",{vertices:this.vertices.map((function(e,t){return{componentIndex:0,vertexIndex:t,coordinates:e}})),aborted:t,type:"complete"})}},{key:"onInputEvent",value:function(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}},{key:"redo",value:function(){this._editGeometryOperations.redo()}},{key:"undo",value:function(){(0,d.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}},{key:"_closeOnClickVertexIndex",value:function(e){var t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(t.vertices[0].pos,e))return 0;if(this._vertexWithinPointerDistance(t.vertices[t.vertices.length-1].pos,e))return t.vertices.length-1}return null}},{key:"_createManipulatorDragPipeline",value:function(e){switch((0,d.Wg)(this.drawingMode)){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}},{key:"_createManipulatorDragPipelineClick",value:function(e){var t=this;return(0,Z.Xd)(e,(function(e,n,r,a){var o,s="touch"===a&&t._snappingEnabled;if(!t.isCompleted&&s){var l=(0,E.W)({predicate:function(){return s},snappingManager:t.snappingManager,snappingContext:new P.N({editGeometryOperations:t._editGeometryOperations,elevationInfo:t.elevationInfo,pointer:a,visualizer:t.snappingVisualizer}),updatingHandles:t.updatingHandles,useZ:!t._requiresScenePoint}),u=l.snappingStep,p=l.cancelSnapping;r=r.next((function(e){return s&&(0,d.pC)(t.snappingManager)&&t.snappingManager.doneSnapping(),e})).next(p),(o=n.next(t._screenToMapDragEventStep()).next((function(e){return"start"===e.action&&(t.stagedVertex=e.mapStart,("segment"===t.geometryType||s&&0===t.numVertices)&&t.commitStagedVertex()),e})).next((0,Z.BS)(t.view,t.elevationInfo))).next.apply(o,(0,i.Z)(u)).next((function(e){return s&&(t.stagedVertex=e.mapEnd,"end"===e.action&&t.commitStagedVertex()),e})).next((function(e){return"end"===e.action&&("segment"!==t.geometryType&&"point"!==t.geometryType||t.complete()),e}))}}))}},{key:"_createManipulatorDragPipelineFreehand",value:function(e){var t=this;return(0,Z.Xd)(e,(function(e,n){t.isCompleted||n.next(t._screenToMapDragEventStep()).next((function(e){return"start"===e.action&&((0,d.Wi)(t.stagedVertex)&&(t.stagedVertex=e.mapStart),"segment"===t.geometryType&&t.commitStagedVertex()),e})).next((function(e){switch(e.action){case"start":case"update":t.stagedVertex=e.mapEnd,"polygon"!==t.geometryType&&"polyline"!==t.geometryType||t.commitStagedVertex();break;case"end":t.complete()}return e}))}))}},{key:"_createManipulatorDragPipelineHybrid",value:function(e){var t=this;return(0,Z.Xd)(e,(function(e,n){t.isCompleted||n.next(t._screenToMapDragEventStep()).next((function(e){return"start"===e.action&&((0,d.Wi)(t.stagedVertex)&&(t.stagedVertex=e.mapStart),t.commitStagedVertex()),e})).next((function(e){switch(e.action){case"start":case"update":t.stagedVertex=e.mapEnd,"polygon"!==t.geometryType&&"polyline"!==t.geometryType||t.commitStagedVertex();break;case"end":"segment"!==t.geometryType&&"point"!==t.geometryType||t.complete()}return e}))}))}},{key:"_drawAtFixedElevation",get:function(){return("segment"===this.geometryType||"polygon"===this.geometryType)&&this.numCommittedVertices>0}},{key:"_getEffectiveDrawSurface",value:function(){if((0,d.Wi)(this.elevationDrawSurface))return this.drawSurface;if(!this.coordinateHelper.hasZ())return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;var e=this.defaultZ,t=!1;return(0,d.pC)(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(t=!0),(0,d.pC)(this.snapToSceneEnabled)&&(t=this.snapToSceneEnabled),(0,d.pC)(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(t=!1),this._drawAtFixedElevation&&(e=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),t=!1),t?this.drawSurface:(this.elevationDrawSurface.defaultZ=e,this.elevationDrawSurface)}},{key:"_mapToScreen",value:function(e){var t;return null===(t=this._getEffectiveDrawSurface())||void 0===t?void 0:t.mapToScreen(e)}},{key:"_onHold",value:function(e){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}},{key:"_onImmediateClick",value:function(e){if(!("mouse"===e.pointerType&&2===e.button||this._manipulator.dragging)){var t=this._activeComponent,n=this._closeOnClickVertexIndex(e.screenPoint);if((0,d.pC)(n))return e.stopPropagation(),void this.complete();var i=this._screenToMap(e.screenPoint);if((0,d.pC)(i))switch(this.drawingMode){case"freehand":"point"===this.geometryType&&((0,d.pC)(this.stagedVertex)?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(i)),this.complete());break;case"click":case"hybrid":this._snappingOperation.abort(),(0,d.pC)(this.stagedVertex)?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(i)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}e.stopPropagation()}}},{key:"_onImmediateDoubleClick",value:function(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}},{key:"_onPointerMove",value:function(e){var t,n=(0,y.vW)(e.x,e.y),i=this._snappingOperation;if(this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing||!this._manipulator.interactive)i.abort();else{e.stopPropagation();var r=this._closeOnClickVertexIndex(n);if((0,d.pC)(r))return this._closeOnVertex(r),void i.abort();var a=this._screenToMap(n),o=this._requiresScenePoint?null===(t=this.drawSurface)||void 0===t?void 0:t.screenToMap(n):null;if(this._manipulator.cursor=(0,d.pC)(a)?"crosshair":null,(0,d.Wi)(a))i.abort();else{var s=this.snappingManager;if((0,d.Wi)(s))return this.stagedVertex=a,void i.abort();var l=this._getSnappingContext(e.pointerType);this.updatingHandles.addPromise((0,v.R8)(i.snap({point:a,scenePoint:o},s,l)))}}}},{key:"_closeOnVertex",value:function(e){this.stagedVertex=null;var t={componentIndex:0,vertexIndex:e,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[e].pos)};this.emit("cursor-update",{updated:null,vertices:[t],operation:"apply",type:"vertex-update"})}},{key:"_screenToMap",value:function(e){var t;return null===(t=this._getEffectiveDrawSurface())||void 0===t?void 0:t.screenToMap(e)}},{key:"_screenToMapDragEventStep",value:function(){var e=this,t=null;return function(n){if("start"===n.action&&(t=e._screenToMap(n.screenStart)),(0,d.Wi)(t))return null;var i=e._screenToMap(n.screenEnd);return(0,d.pC)(i)?(0,r.Z)((0,r.Z)({},n),{},{mapStart:t,mapEnd:i}):null}}},{key:"_vertexWithinPointerDistance",value:function(e,t){var n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return!!(0,d.pC)(n)&&function(e,t,n){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r<=n}(n,t,25)}},{key:"_getSnappingContext",value:function(e){var t=this._drawAtFixedElevation?(0,d.yw)(this.elevationDrawSurface,(function(e){return e.defaultZ})):null;return new P.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,visualizer:this.snappingVisualizer,selfSnappingZ:(0,d.pC)(t)?{value:t,elevationInfo:this.elevationInfo}:null})}}]),n}(p.Z.EventedMixin(c.r));(0,u._)([(0,g.Cb)()],D.prototype,"_snappingEnabled",null),(0,u._)([(0,g.Cb)()],D.prototype,"defaultZ",void 0),(0,u._)([(0,g.Cb)()],D.prototype,"isDraped",void 0),(0,u._)([(0,g.Cb)({value:x})],D.prototype,"drawingMode",null),(0,u._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"elevationDrawSurface",void 0),(0,u._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"elevationInfo",void 0),(0,u._)([(0,g.Cb)({constructOnly:!0,type:T.Z})],D.prototype,"labelOptions",void 0),(0,u._)([(0,g.Cb)({constructOnly:!0,type:O.Z})],D.prototype,"tooltipOptions",void 0),(0,u._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"geometryType",void 0),(0,u._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"hasM",void 0),(0,u._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"hasZ",void 0),(0,u._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"manipulators",void 0),(0,u._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"drawSurface",void 0),(0,u._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"segmentLabels",void 0),(0,u._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"snappingManager",void 0),(0,u._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"snappingVisualizer",void 0),(0,u._)([(0,g.Cb)()],D.prototype,"snapToSceneEnabled",void 0),(0,u._)([(0,g.Cb)()],D.prototype,"_snappingOperation",void 0),(0,u._)([(0,g.Cb)()],D.prototype,"stagedVertex",null),(0,u._)([(0,g.Cb)()],D.prototype,"lastVertex",void 0),(0,u._)([(0,g.Cb)()],D.prototype,"updating",null),(0,u._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"view",void 0),D=(0,u._)([(0,m.j)("esri.views.draw.DrawOperation")],D)},46640:function(e,t,n){n.d(t,{aL:function(){return p},hP:function(){return h},iW:function(){return c}});var i=n(15671),r=n(43144),a=n(92026),o=n(17842),s=n(65618),l=n(37818),u=n(74509),p=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,i.Z)(this,e),this._elevationInfo=t,this.defaultZ=n,this._view=r,this._excludeGraphics=a}return(0,r.Z)(e,[{key:"screenToMap",value:function(e){if((0,a.pC)(this.defaultZ))return this._view.sceneIntersectionHelper.intersectElevationFromScreen((0,o.s1)(e.x,e.y),this._elevationInfo,this.defaultZ,this._excludeGraphics);var t=this._view.sceneIntersectionHelper.intersectElevationFromScreen((0,o.s1)(e.x,e.y),this._elevationInfo,0,this._excludeGraphics);return(0,a.pC)(t)&&(t.z=void 0),t}},{key:"mapToScreen",value:function(e){var t=(0,s.Tx)(e.x,e.y,(0,u.vQ)(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}},{key:"constrainZ",value:function(e){var t=this.defaultZ;return(0,a.pC)(t)&&e.z!==t&&((e=(0,l.WG)(e)).z=t),e}}]),e}(),c=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];(0,i.Z)(this,e),this.view=t,this.elevationInfo=n,this.exclude=r}return(0,r.Z)(e,[{key:"screenToMap",value:function(e){var t=this.view.toMap(e,{exclude:this.exclude});return(0,a.pC)(t)&&(t.z=(0,u.Ou)(t,this.view,this.elevationInfo)),t}},{key:"mapToScreen",value:function(e){var t=e;return(0,a.pC)(this.elevationInfo)&&(t=(0,s.Tx)(e.x,e.y,(0,u.vQ)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}},{key:"constrainZ",value:function(e){return e}}]),e}(),h=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,i.Z)(this,e),this.view=t,this.hasZ=n,this.defaultZ=r,this.mapToScreen=function(e){return t.toScreen(e)},this.screenToMap=n?function(e){var n=t.toMap(e);return n.z=r,n}:function(e){return t.toMap(e)}}return(0,r.Z)(e,[{key:"constrainZ",value:function(e){var t=this.defaultZ;return this.hasZ&&e.z!==t&&((e=(0,l.WG)(e)).z=t),e}}]),e}()},29919:function(e,t,n){n.d(t,{m:function(){return b}});var i,r,a=n(15671),o=n(43144),s=n(60136),l=n(29388),u=n(27366),p=n(85015),c=n(32718),h=n(92026),d=n(66978),v=n(49861),f=(n(25243),n(63780),n(69912)),y=n(99034),g=n(37762),m=n(40281);(r=i||(i={}))[r.WhenToolEditable=0]="WhenToolEditable",r[r.WhenToolNotEditable=1]="WhenToolNotEditable",r[r.Always=2]="Always";var _=function(){function e(){(0,a.Z)(this,e),this._isToolEditable=!0,this._manipulators=new m.Z,this._resourceContexts={manipulator3D:{}},this._attached=!1}return(0,o.Z)(e,[{key:"isToolEditable",set:function(e){this._isToolEditable=e}},{key:"length",get:function(){return this._manipulators.length}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.WhenToolEditable;this.addMany([e],t)}},{key:"addMany",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.WhenToolEditable,r=(0,g.Z)(e);try{for(r.s();!(t=r.n()).done;){var a={manipulator:t.value,visibilityPredicate:n,attached:!1};this._manipulators.add(a),this._attached&&this._updateManipulatorAttachment(a)}}catch(o){r.e(o)}finally{r.f()}}},{key:"remove",value:function(e){for(var t=0;t<this._manipulators.length;t++)if(this._manipulators.getItemAt(t).manipulator===e){var n=this._manipulators.splice(t,1)[0];this._detachManipulator(n);break}}},{key:"removeAll",value:function(){var e=this;this._manipulators.forEach((function(t){e._detachManipulator(t)})),this._manipulators.removeAll()}},{key:"attach",value:function(){var e=this;this._manipulators.forEach((function(t){e._updateManipulatorAttachment(t)})),this._attached=!0}},{key:"detach",value:function(){var e=this;this._manipulators.forEach((function(t){e._detachManipulator(t)})),this._attached=!1}},{key:"destroy",value:function(){this.detach(),this._manipulators.forEach((function(e){var t=e.manipulator;t.destroy&&t.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}},{key:"on",value:function(e,t){return this._manipulators.on(e,(function(e){t(e)}))}},{key:"forEach",value:function(e){var t,n=(0,g.Z)(this._manipulators.items);try{for(n.s();!(t=n.n()).done;){e(t.value)}}catch(i){n.e(i)}finally{n.f()}}},{key:"some",value:function(e){return this._manipulators.items.some(e)}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){return e.push(t.manipulator)})),e}},{key:"intersect",value:function(e,t){var n=null,i=Number.MAX_VALUE;return this._manipulators.forEach((function(r){var a=r.manipulator;if(r.attached&&a.interactive){var o=a.intersectionDistance(e,t);(0,h.pC)(o)&&o<i&&(i=o,n=a)}})),n}},{key:"_updateManipulatorAttachment",value:function(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}},{key:"_attachManipulator",value:function(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}},{key:"_detachManipulator",value:function(e){if(e.attached){var t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}}},{key:"_isManipulatorItemVisible",value:function(e){return e.visibilityPredicate===i.Always||(this._isToolEditable?e.visibilityPredicate===i.WhenToolEditable:e.visibilityPredicate===i.WhenToolNotEditable)}}]),e}(),b=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).manipulators=new _,i.automaticManipulatorSelection=!0,i.hasGrabbedManipulators=!1,i.hasHoveredManipulators=!1,i.firstGrabbedManipulator=null,i.created=!1,i.removeIncompleteOnCancel=!0,i._editableFlags=new Map([[y.bH.MANAGER,!0],[y.bH.USER,!0]]),i._creationFinishedResolver=(0,d.hh)(),i}return(0,o.Z)(n,[{key:"active",get:function(){return null!=this.view&&this.view.activeTool===this}},{key:"visible",set:function(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}},{key:"editable",get:function(){return this.getEditableFlag(y.bH.USER)},set:function(e){this.setEditableFlag(y.bH.USER,e)}},{key:"updating",get:function(){return!1}},{key:"cursor",get:function(){return null}},{key:"hasFocusedManipulators",get:function(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}},{key:"destroy",value:function(){this.manipulators.destroy(),this._set("view",null)}},{key:"onAdd",value:function(){this._syncVisible()}},{key:"activate",value:function(){(0,h.Wi)(this.view)?c.Z.getLogger(this.declaredClass).error("Can't activate tool if view is not defined."):(this.view.focus(),this.onActivate())}},{key:"deactivate",value:function(){this.onDeactivate()}},{key:"handleInputEvent",value:function(e){this.onInputEvent(e)}},{key:"handleInputEventAfter",value:function(e){this.onInputEventAfter(e)}},{key:"setEditableFlag",value:function(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===y.bH.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}},{key:"getEditableFlag",value:function(e){var t;return null!==(t=this._editableFlags.get(e))&&void 0!==t&&t}},{key:"whenCreated",value:function(){return this._creationFinishedResolver.promise}},{key:"onManipulatorSelectionChanged",value:function(){}},{key:"onActivate",value:function(){}},{key:"onDeactivate",value:function(){}},{key:"onShow",value:function(){}},{key:"onHide",value:function(){}},{key:"onEditableChange",value:function(){}},{key:"onInputEvent",value:function(e){}},{key:"onInputEventAfter",value:function(e){}},{key:"internallyEditable",get:function(){return this.getEditableFlag(y.bH.USER)&&this.getEditableFlag(y.bH.MANAGER)}},{key:"finishToolCreation",value:function(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}},{key:"_syncVisible",value:function(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}},{key:"_show",value:function(){this._updateManipulatorAttachment(),this.onShow()}},{key:"_hide",value:function(){this._updateManipulatorAttachment(),this.onHide()}},{key:"_updateManipulatorAttachment",value:function(){this.visible?this.manipulators.attach():this.manipulators.detach()}}]),n}(p.Z);(0,u._)([(0,v.Cb)({constructOnly:!0})],b.prototype,"view",void 0),(0,u._)([(0,v.Cb)({readOnly:!0})],b.prototype,"active",null),(0,u._)([(0,v.Cb)({value:!0})],b.prototype,"visible",null),(0,u._)([(0,v.Cb)({value:!0})],b.prototype,"editable",null),(0,u._)([(0,v.Cb)({readOnly:!0})],b.prototype,"manipulators",void 0),(0,u._)([(0,v.Cb)({readOnly:!0})],b.prototype,"updating",null),(0,u._)([(0,v.Cb)()],b.prototype,"cursor",null),(0,u._)([(0,v.Cb)({readOnly:!0})],b.prototype,"automaticManipulatorSelection",void 0),(0,u._)([(0,v.Cb)()],b.prototype,"hasFocusedManipulators",null),(0,u._)([(0,v.Cb)()],b.prototype,"hasGrabbedManipulators",void 0),(0,u._)([(0,v.Cb)()],b.prototype,"hasHoveredManipulators",void 0),(0,u._)([(0,v.Cb)()],b.prototype,"firstGrabbedManipulator",void 0),(0,u._)([(0,v.Cb)({readOnly:!0})],b.prototype,"created",void 0),(0,u._)([(0,v.Cb)({readOnly:!0})],b.prototype,"removeIncompleteOnCancel",void 0),b=(0,u._)([(0,f.j)("esri.views.interactive.InteractiveToolBase")],b)},74229:function(e,t,n){n.d(t,{AN:function(){return M},BS:function(){return E},Cf:function(){return x},M2:function(){return _},Mz:function(){return V},QY:function(){return Z},Xd:function(){return m},a9:function(){return b},bD:function(){return k},hM:function(){return P},kY:function(){return T},oq:function(){return w},zh:function(){return S}});var i=n(15671),r=n(43144),a=n(37762),o=n(1413),s=(n(59486),n(93169),n(84652)),l=n(16889),u=n(92026),p=n(17842),c=n(71353),h=n(79803),d=n(37818),v=n(74509),f=n(50951),y=n(20008),g=n(585);function m(e,t){return e.events.on("drag",function(e,t){var n=null,i=null;return function(r){if("cancel"!==r.action){var a={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};"start"===r.action&&(0,u.Wi)(n)&&(n=new P,i=new P,t(e,n,i,r.pointerType,a)),(0,u.pC)(n)&&n.execute(a),"end"===r.action&&(0,u.pC)(n)&&(n=null,i=null)}else(0,u.pC)(i)&&(i.execute({action:"cancel"}),n=null,i=null)}}(e,t))}function _(e,t){var n,i=[e.x,e.y,null!==(n=e.z)&&void 0!==n?n:0],r=t,a=[Math.cos(r),Math.sin(r)],s=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(0===s)return null;a[0]/=s,a[1]/=s;var l=function(e){var t=(e.x-i[0])*a[0]+(e.y-i[1])*a[1];e.x=i[0]+t*a[0],e.y=i[1]+t*a[1]};return function(e){return l(e.mapStart),l(e.mapEnd),(0,o.Z)((0,o.Z)({},e),{},{axis:a})}}function b(e,t){var n=null;return function(i){if("start"===i.action&&(n=function(e,t,n){var i=e.geometry,r=(0,d.D)(t);if((0,u.Wi)(i))return null;if("mesh"===i.type)return function(e,t,n,i){if((0,u.pC)(t.transform))return function(e,t,n,i){var r=C(n.getOriginPoint(t.spatialReference),i),a=t.spatialReference;return(0,u.Wi)(r)?null:{move:function(t,i,o){var s=(0,y.pB)(r.clone(),t,i,o);if(s.spatialReference.equals(a))n.origin=(0,c.f)(s.x,s.y,s.z);else{var l=(0,h.iV)(s,a);(0,u.pC)(l)&&(n.origin=(0,c.f)(l.x,l.y,l.z))}e.notifyMeshTransformChanged(),e.notifyGeometryChanged()}}}(e,t,t.transform,n);if(!t.spatialReference.equals(n))return null;var r=0,a=0,o=0;return{move:function(n,s,l){var u=n-r,p=s-a,c=l-o;if(u||p||c){var h=new g.Z(t.origin.x+u,t.origin.y+p,t.origin.z+c,t.origin.spatialReference);t.centerAt(h,{geographic:i===f.JY.Global}),e.notifyGeometryChanged(),r=n,a=s,o=l}}}}(e,i,r,n);var a=C(i,r),o=i.spatialReference;return(0,u.Wi)(a)?null:{move:function(t,n,i){var r=(0,y.pB)(a.clone(),t,n,i);r.spatialReference.equals(o)?e.geometry=r:e.geometry=(0,h.iV)(r,o)}}}(e,i.mapStart.spatialReference,t)),(0,u.Wi)(n))return null;var r=i.mapEnd.x-i.mapStart.x,a=i.mapEnd.y-i.mapStart.y,s=i.mapEnd.z-i.mapStart.z;return n.move(r,a,s),(0,o.Z)((0,o.Z)({},i),{},{translationX:r,translationY:a,translationZ:s})}}function C(e,t){return(0,u.Wi)(e)?null:e.spatialReference.equals(t)?e.clone():(0,h.iV)(e,t)}function x(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,r=null,a=!(0,u.pC)(n)||null!==(t=e.spatialReference)&&void 0!==t&&t.equals(n)?function(e){return e}:function(e){return(0,u.pC)(e)?(0,h.iV)(e,n):e},s=(0,o.Z)({exclude:[]},i);return function(t){if("start"===t.action&&(r=a(e.toMap(t.screenStart,s))),(0,u.Wi)(r))return null;var n=a(e.toMap(t.screenEnd,s));return(0,u.pC)(n)?(0,o.Z)((0,o.Z)({},t),{},{mapStart:r,mapEnd:n}):null}}function w(e,t){var n=e.map((function(e){return(0,u.Wg)(b(e,t))})).filter((function(e){return(0,u.pC)(e)}));return function(e){var t=e.mapEnd.x-e.mapStart.x,i=e.mapEnd.y-e.mapStart.y,r=e.mapEnd.z-e.mapStart.z;return n.forEach((function(t){return t(e)})),(0,o.Z)((0,o.Z)({},e),{},{translationX:t,translationY:i,translationZ:r})}}function k(e){return(0,u.pC)(e.geometry)&&"mesh"===e.geometry.type?function(e,t){var n=(0,u.pC)(t.transform)?t.transform.clone():null,i=t.vertexAttributes.clonePositional();return function(r){return t.transform=n,t.vertexAttributes=i,e.notifyGeometryChanged(),r}}(e,e.geometry):function(e,t){var n,i=new Map,r=(0,a.Z)(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;i.set(o,(0,s.d9)(e[o]))}}catch(l){r.e(l)}finally{r.f()}return function(t){return i.forEach((function(t,n){e[n]=t})),t}}(e,["geometry"])}function Z(e){var t=e.map((function(e){return(0,u.Wg)(k(e))})).filter((function(e){return(0,u.pC)(e)}));return function(e){return t.forEach((function(t){return t(e)})),e}}function M(){var e=0,t=0,n=0;return function(i){"start"===i.action&&(e=i.mapStart.x,t=i.mapStart.y,n=i.mapStart.z);var r=i.mapEnd.x-e,a=i.mapEnd.y-t,s=i.mapEnd.z-n;return e=i.mapEnd.x,t=i.mapEnd.y,n=i.mapEnd.z,(0,o.Z)((0,o.Z)({},i),{},{mapDeltaX:r,mapDeltaY:a,mapDeltaZ:s,mapDeltaSpatialReference:i.mapStart.spatialReference})}}function S(){var e=0,t=0;return function(n){"start"===n.action&&(e=n.screenStart.x,t=n.screenStart.y);var i=n.screenEnd.x-e,r=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,(0,o.Z)((0,o.Z)({},n),{},{screenDeltaX:i,screenDeltaY:r})}}function T(e,t){var n=null,i=0,r=0;return function(a){var o;if("start"===a.action&&(null!=(n=null===(o=e.toScreen)||void 0===o?void 0:o.call(e,t))&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(i=a.screenStart.x-n.x,r=a.screenStart.y-n.y))),null==n)return null;var s=(0,l.uZ)(a.screenEnd.x-i,0,e.width),u=(0,l.uZ)(a.screenEnd.y-r,0,e.height),c=(0,p.vW)(s,u);return a.screenStart=n,a.screenEnd=c,a}}var O=function(){},P=function(){function e(){(0,i.Z)(this,e),this.execute=O}return(0,r.Z)(e,[{key:"next",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;return(0,u.pC)(t)&&(this.execute=function(e){var i=t(e);(0,u.pC)(i)&&n.execute(i)}),n}}]),e}();function E(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if("2d"===e.type)return function(e){return e};var i=null;return function(r){"start"===r.action&&(i=e.toMap(r.screenStart,{exclude:n}),(0,u.pC)(i)&&(i.z=(0,v.Ou)(i,e,t)));var a=e.toMap(r.screenEnd,{exclude:n});(0,u.pC)(a)&&(a.z=(0,v.Ou)(a,e,t));var s=(0,u.pC)(i)&&(0,u.pC)(a)?{sceneStart:i,sceneEnd:a}:null;return(0,o.Z)((0,o.Z)({},r),{},{scenePoints:s})}}function I(e,t,n){var i,r,a=null!==(i=(0,u.WG)(t.elevationProvider.getElevation(e.x,e.y,null!==(r=e.z)&&void 0!==r?r:0,e.spatialReference,"scene")))&&void 0!==i?i:0,o=(0,d.WG)(e);return o.z=a,o.hasZ=!0,o.z=(0,v.Ou)(o,t,n),o}function V(e,t){if("2d"===e.type)return function(e){return e};var n=null;return function(i){"start"===i.action&&(n=I(i.mapStart,e,t));var r=I(i.mapEnd,e,t),a=(0,u.pC)(n)&&(0,u.pC)(r)?{sceneStart:n,sceneEnd:r}:null;return(0,o.Z)((0,o.Z)({},i),{},{scenePoints:a})}}},92583:function(e,t,n){n.d(t,{NI:function(){return b},lv:function(){return m},mO:function(){return y},nn:function(){return f},ny:function(){return _}});var i=n(92026),r=n(47898),a=n(88396),o=n(11186),s=n(71353),l=n(82218),u=n(11185),p=n(254),c=n(12225),h=n(29014),d=n(34778),v=n(59418);function f(e,t){return g(e,t,!1)}function y(e,t){return g(e,t,!0)}function g(e,t,n){if(e instanceof d.y){if(e.operation instanceof p.z)return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n?-1:1,r=(0,s.f)(i*e.dx,i*e.dy,i*e.dz);(0,o.a)(t.origin,t.origin,r)}(e.operation,t,n),!0;if(e.operation instanceof c.S)return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n?-e.angle:e.angle;(0,o.I)(t.basis1,t.basis1,s.Z,i),(0,o.I)(t.basis2,t.basis2,s.Z,i)}(e.operation,t,n),!0;if(e.operation instanceof h.q)return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n?1/e.factor1:e.factor1,r=n?1/e.factor2:e.factor2;(0,o.g)(t.basis1,t.basis1,i),(0,o.g)(t.basis2,t.basis2,r),(0,a.u)(t.origin,t.origin,e.origin,e.axis1,i),(0,a.u)(t.origin,t.origin,e.origin,e.axis2,r)}(e.operation,t,n),!0}return!1}function m(e,t,n,i){i||(i=(0,l.a)());var r=(0,a.s)(u.qW.get(),e[1],-e[0]),o=(0,a.s)(u.qW.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=(0,a.s)(u.qW.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),p=u.qW.get();t.components.forEach((function(t){return t.vertices.forEach((function(t){var n=t.pos;(0,a.s)(p,(0,a.h)(e,n),(0,a.h)(r,n)),(0,a.y)(o,o,p),(0,a.z)(s,s,p)}))}));var c=1e-6,h=(0,a.s)(u.qW.get(),s[0]-o[0]<c?n/2:0,s[1]-o[1]<c?n/2:0);return(0,a.a)(o,o,h),(0,a.j)(s,s,h),(0,a.b)(i.basis1,e,(s[0]-o[0])/2),(0,a.b)(i.basis2,r,(s[1]-o[1])/2),(0,a.s)(i.origin,o[0]*e[0]+o[1]*r[0],o[0]*e[1]+o[1]*r[1]),(0,a.j)(i.origin,i.origin,i.basis1),(0,a.j)(i.origin,i.origin,i.basis2),i}function _(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0;r||(r=(0,l.a)()),t.toRenderCoords(e.origin,n,r.origin);var a=u.WM.get();(0,o.a)(a,e.origin,e.basis1),(0,o.a)(a,a,e.basis2),t.toRenderCoords(a,n,a);var s=u.WM.get();(0,o.a)(s,e.origin,e.basis1),(0,o.b)(s,s,e.basis2),t.toRenderCoords(s,n,s);var p=u.WM.get();(0,o.b)(p,e.origin,e.basis1),(0,o.b)(p,p,e.basis2),t.toRenderCoords(p,n,p);var c=u.WM.get();(0,o.b)(c,e.origin,e.basis1),(0,o.a)(c,c,e.basis2),t.toRenderCoords(c,n,c);var h=(0,o.h)(u.WM.get(),a,s,.5);(0,o.b)(h,h,r.origin);var d=(0,o.h)(u.WM.get(),p,c,.5);(0,o.b)(d,r.origin,d),(0,o.h)(r.basis1,h,d,.5);var v=(0,o.h)(u.WM.get(),c,a,.5);(0,o.b)(v,v,r.origin);var f=(0,o.h)(u.WM.get(),s,p,.5);(0,o.b)(f,r.origin,f),(0,o.h)(r.basis2,v,f,.5);var y=(0,o.f)(u.WM.get(),r.basis1,r.basis2),g=(0,o.f)(y,y,r.basis1);return(0,o.n)(g,g),(0,o.g)(r.basis2,g,(0,o.e)(r.basis2,g)),(0,o.g)(r.basis1,r.basis1,1+i/(0,o.l)(r.basis1)),(0,o.g)(r.basis2,r.basis2,1+i/(0,o.l)(r.basis2)),(0,l.u)(r),r}function b(e,t,n,a){var s=u.WM.get();(0,o.b)(s,(0,o.b)(s,e.origin,e.basis1),e.basis2);var l=u.WM.get();(0,o.z)(l,s,e.basis1,2);var p=u.WM.get();(0,o.z)(p,l,e.basis2,2);var c=u.WM.get();(0,o.z)(c,s,e.basis2,2),s[2]=l[2]=p[2]=c[2]=t;var h=a?"on-the-ground":"absolute-height",d=(0,r.Fp)((0,v.bZ)(s,l,n,h),(0,v.bZ)(c,p,n,h)),f=(0,r.Fp)((0,v.bZ)(l,p,n,h),(0,v.bZ)(s,c,n,h));return(0,i.Wi)(f)||(0,i.Wi)(d)?null:[d,f]}},80151:function(e,t,n){n.d(t,{W:function(){return y}});var i=n(37762),r=n(29439),a=n(74165),o=n(15861),s=n(1413),l=n(92026),u=n(66978),p=n(94172),c=n(70178),h=n(37818),d=n(74229),v=n(34019),f=n(78307);function y(e){var t=e.predicate,n=void 0===t?function(){return!0}:t,r=e.snappingManager,h=e.snappingContext,y=e.updatingHandles,C=e.useZ,x=void 0===C||C,w=new d.hM;if((0,l.Wi)(r))return{snappingStep:[b,w],cancelSnapping:b};var k,Z,M,S,T=null,O=null,P=null,E=function(){T=(0,l.IM)(T),r.doneSnapping(),(0,l.pC)(O)&&O.frameTask.remove(),O=null,k=(0,l.hw)(k),P=null},I=(Z=r,M=x,S=w,(0,u.Ds)(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n){var i,r,o,s,u,p,h,d,v,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.frameTask,r=t.point,o=t.scenePoint,s=t.context,u=t.event,p=t.delta,h=t.getLastState,e.next=3,i.schedule((function(){return Z.snap({point:r,scenePoint:o,context:s,signal:n})}),n);case 3:if(!(d=e.sent).valid){e.next=10;break}return e.next=7,i.schedule((function(){return d.apply()}),n);case 7:v=e.sent,f=h(),(0,l.pC)(f.point)&&r!==f.point&&(v=Z.update({point:f.point,scenePoint:f.scenePoint,context:s})),!(0,l.Wi)(f.updatePoint)&&(0,c.k)(v,f.updatePoint)||(_(u.mapEnd,v,p,M),S.execute(u));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),V=null,W=null,R=null;return{snappingStep:[function(e){if(!n(e))return e;var t,a=e.action;if("start"===a){var o=e.info,c="3d"===(t=r.view).type?t.resourceController.scheduler.registerTask(f.T8.SNAPPING):f.sq;if(O=function(e,t,n){return{context:new v.N({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:(0,l.pC)(t.info)?t.info.handle:null,excludeFeature:e.excludeFeature,visualizer:e.visualizer}),originalPos:(0,l.pC)(t.snapOrigin)?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:(0,l.pC)(t.scenePoints)?t.scenePoints.sceneStart:null,frameTask:n}}(h,e,c),O.context.selfSnappingZ=null,!x&&(0,l.pC)(o)){var d=function(e,t){if(!e.hasZ())return null;var n,r=t.vertices,a=null,o=(0,i.Z)(r);try{for(o.s();!(n=o.n()).done;){var s=n.value,u=e.getZ(s.pos);if((0,l.pC)(a)&&(0,l.pC)(u)&&Math.abs(u-a)>1e-6)return null;(0,l.Wi)(a)&&(a=u)}}catch(p){o.e(p)}finally{o.f()}return a}(h.coordinateHelper,o.handle.component);(0,l.pC)(d)&&(O.context.selfSnappingZ={value:d,elevationInfo:h.elevationInfo})}}if((0,l.pC)(O)){var b=O,C=b.context,w=b.originalScenePos,Z=b.originalPos,M=e.mapEnd,S=e.mapStart,z=e.scenePoints,G=g(Z,m(M,S)),D=m(S,Z),A=(0,s.Z)((0,s.Z)({},e),{},{action:"update"}),F=O.context,H=function(e,t){return(0,l.Wi)(e)||(0,l.Wi)(t)?null:g(e,m(t.sceneEnd,t.sceneStart))}(w,z),U=r.update({point:G,scenePoint:H,context:C});if(R=U,_(M,U,D,x),V=G,W=H,"end"!==a){var L=O.frameTask;(0,l.Wi)(T)&&(T=new AbortController),P=function(e){y.addPromise((0,u.R8)(I({frameTask:L,event:A,context:F,point:G,scenePoint:H,delta:D,getLastState:function(){return{point:V,scenePoint:W,updatePoint:e.forceUpdate?null:R}}},(0,l.Wg)(T).signal)))},P({forceUpdate:!1}),(0,l.Wi)(k)&&(k=(0,p.YP)((function(){return r.options.effectiveEnabled}),(function(){var e;return null===(e=P)||void 0===e?void 0:e({forceUpdate:!0})})))}}return"end"===a&&E(),e},w],cancelSnapping:function(e){return E(),e}}}function g(e,t){var n=(0,r.Z)(t,3),i=n[0],a=n[1],o=n[2],s=(0,h.WG)(e);return s.x+=i,s.y+=a,s.hasZ&&(s.z+=o),s}function m(e,t){var n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function _(e,t,n,i){var a=(0,r.Z)(n,3),o=a[0],s=a[1],l=a[2];e.x=t.x+o,e.y=t.y+s,i&&e.hasZ&&t.hasZ&&(e.z=t.z+l)}function b(e){return e}}}]);
//# sourceMappingURL=3766.e451c310.chunk.js.map