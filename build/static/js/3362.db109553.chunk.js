"use strict";(self.webpackChunkcommonlands_web=self.webpackChunkcommonlands_web||[]).push([[3362],{83362:function(e,t,i){i.r(t),i.d(t,{default:function(){return se}});var r=i(74165),n=i(15861),o=i(1413),s=i(29439),a=i(37762),l=i(60136),h=i(29388),p=i(43144),c=i(15671),v=i(27366),u=(i(59486),i(52639)),d=i(14921),y=i(40281),_=i(10064),f=i(91505),m=i(100),g=i(32718),x=i(92026),b=i(47898),k=i(94172),G=i(17842),Z=i(49861),w=(i(25243),i(63780),i(69912)),V=i(69662),C=i(93655),M=i(16072),S=i(50951),E=i(85577),I=i(20008),T=i(53503),O=i(74982),R=i(83089),H=i(70040),A=i(1614),L=i(87888),F=i(87268),P=i(77560),U=i(34019),z=i(12494),D=i(40524),W=i(9856),j=i(59418),X=i(29909),Y=i(585),Q=(0,p.Z)((function e(t,i,r){(0,c.Z)(this,e),this.graphic=t,this.mover=i,this.selected=r,this.type="reshape-start"})),N=(0,p.Z)((function e(t,i,r){(0,c.Z)(this,e),this.graphic=t,this.mover=i,this.selected=r,this.type="reshape"})),$=(0,p.Z)((function e(t,i,r){(0,c.Z)(this,e),this.graphic=t,this.mover=i,this.selected=r,this.type="reshape-stop"})),J=(0,p.Z)((function e(t,i,r){(0,c.Z)(this,e),this.mover=t,this.dx=i,this.dy=r,this.type="move-start"})),K=(0,p.Z)((function e(t,i,r){(0,c.Z)(this,e),this.mover=t,this.dx=i,this.dy=r,this.type="move"})),q=(0,p.Z)((function e(t,i,r){(0,c.Z)(this,e),this.mover=t,this.dx=i,this.dy=r,this.type="move-stop"})),B=(0,p.Z)((function e(t){(0,c.Z)(this,e),this.added=t,this.type="vertex-select"})),ee=(0,p.Z)((function e(t){(0,c.Z)(this,e),this.removed=t,this.type="vertex-deselect"})),te=(0,p.Z)((function e(t,i,r,n){(0,c.Z)(this,e),this.added=t,this.graphic=i,this.oldGraphic=r,this.vertices=n,this.type="vertex-add"})),ie=(0,p.Z)((function e(t,i,r,n){(0,c.Z)(this,e),this.removed=t,this.graphic=i,this.oldGraphic=r,this.vertices=n,this.type="vertex-remove"})),re=H.X.reshapeGraphics,ne={vertices:{default:new M.Z({style:"circle",size:re.vertex.size,color:re.vertex.color,outline:{color:re.vertex.outlineColor,width:1}}),hover:new M.Z({style:"circle",size:re.vertex.hoverSize,color:re.vertex.hoverColor,outline:{color:re.vertex.hoverOutlineColor,width:1}}),selected:new M.Z({style:"circle",size:re.selected.size,color:re.selected.color,outline:{color:re.selected.outlineColor,width:1}})},midpoints:{default:new M.Z({style:"circle",size:re.midpoint.size,color:re.midpoint.color,outline:{color:re.midpoint.outlineColor,width:1}}),hover:new M.Z({style:"circle",size:re.midpoint.size,color:re.midpoint.color,outline:{color:re.midpoint.outlineColor,width:1}})}},oe=function(e){(0,l.Z)(i,e);var t=(0,h.Z)(i);function i(e){var r;return(0,c.Z)(this,i),(r=t.call(this,e))._activeOperationInfo=null,r._editGeometryOperations=null,r._handles=new m.Z,r._graphicAttributes={esriSketchTool:"box"},r._mover=null,r._snappingContext=null,r._snappingTask=null,r._stagedVertex=null,r._tooltip=null,r._viewHandles=new m.Z,r.callbacks={onReshapeStart:function(){},onReshape:function(){},onReshapeStop:function(){},onMoveStart:function(){},onMove:function(){},onMoveStop:function(){},onGraphicClick:function(){}},r.enableMidpoints=!0,r.enableMovement=!0,r.enableVertices=!0,r.graphic=null,r.layer=null,r.midpointGraphics=new y.Z,r.midpointSymbol=new M.Z({style:"circle",size:6,color:[200,200,200],outline:{color:[100,100,100],width:1}}),r.selectedVertices=[],r.snappingManager=null,r.tooltipOptions=new P.Z,r.type="reshape",r.vertexGraphics=new y.Z,r.view=null,r}return(0,p.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.view;this._highlightHelper=new O.Z({view:t}),this._setup(),this._handles.add([(0,k.gx)((function(){return null===t||void 0===t?void 0:t.ready}),(function(){var t=e.layer,i=e.view;(0,R.p)(i,t),e._viewHandles.add(i.on("key-down",(function(t){return e._keyDownHandler(t)}),A.f.TOOL))}),{once:!0,initial:!0}),(0,k.Wy)((function(){return e.graphic}),(function(){return e.refresh()})),(0,k.Wy)((function(){return e.layer}),(function(t,i){i&&(e._clearSelection(),e._resetGraphics(i)),e.refresh()})),(0,k.Wy)((function(){return e.enableMidpoints}),(function(){return e.refresh()})),(0,k.YP)((function(){return e.tooltipOptions.enabled}),(function(t){e._tooltip=t?new z.u({view:e.view}):(0,x.SC)(e._tooltip)}),k.tX)])}},{key:"destroy",value:function(){var e;this._reset(),null!==(e=this._mover)&&void 0!==e&&e.destroy(),this._mover=null,this._tooltip=(0,x.SC)(this._tooltip),this._handles=(0,x.SC)(this._handles),this._viewHandles=(0,x.SC)(this._viewHandles)}},{key:"highlightsEnabled",set:function(e){var t;null!==(t=this._highlightHelper)&&void 0!==t&&t.removeAll(),this._set("highlightsEnabled",e),this._setUpHighlights()}},{key:"state",get:function(){var e=!!this.get("view.ready"),t=!(!this.get("graphic")||!this.get("layer"));return e&&t?"active":e?"ready":"disabled"}},{key:"symbols",set:function(e){var t=e||{},i=t.midpoints,r=void 0===i?ne.midpoints:i,n=t.vertices,o=void 0===n?ne.vertices:n;this._set("symbols",{midpoints:r,vertices:o})}},{key:"isUIGraphic",value:function(e){var t=[];return this.graphic&&t.push(this.graphic),t.concat(this.vertexGraphics.items,this.midpointGraphics.items),t.length>0&&t.includes(e)}},{key:"refresh",value:function(){this._reset(),this._setup()}},{key:"reset",value:function(){this.graphic=null}},{key:"clearSelection",value:function(){this._clearSelection()}},{key:"removeSelectedVertices",value:function(){this.selectedVertices.length&&this._removeVertices(this.selectedVertices)}},{key:"_setup",value:function(){var e=this.graphic;if(this.layer&&e&&!(0,x.Wi)(e.geometry)){var t=e.geometry;"mesh"!==t.type&&"extent"!==t.type?("polygon"===t.type&&(0,V.pW)(t),this._setUpHighlights(),this._setupGraphics(),this._setupMover()):this._logGeometryTypeError()}}},{key:"_setUpHighlights",value:function(){this.highlightsEnabled&&this.graphic&&this._highlightHelper.add(this.graphic)}},{key:"_setUpGeometryHelper",value:function(){var e=this.graphic.geometry;if((0,x.Wi)(e)||"mesh"===e.type||"extent"===e.type)this._logGeometryTypeError();else{var t="multipoint"===e.type?new X.Z({paths:e.points,spatialReference:e.spatialReference}):e;this._editGeometryOperations=F.c.fromGeometry(t,S.JY.Local)}}},{key:"_saveSnappingContextForHandle",value:function(e,t){var i;this._snappingGraphicsLayer=new C.Z({listMode:"hide",internal:!0,title:"Reshape snapping layer"}),this.view.map.layers.add(this._snappingGraphicsLayer),this._snappingContext=new U.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:{mode:"on-the-ground",offset:0},pointer:(null===(i=t.viewEvent)||void 0===i?void 0:i.pointerType)||"mouse",excludeFeature:this.graphic,visualizer:new E.r(this._snappingGraphicsLayer),vertexHandle:this._getVertexFromEditGeometry(e)})}},{key:"_reset",value:function(){this._clearSelection(),this._highlightHelper.removeAll(),this._updateTooltip(),this._resetGraphics(),this._resetSnappingStateVars(),this._activeOperationInfo=null,this._mover&&this._mover.destroy(),this._mover=null,this.view.cursor="default"}},{key:"_resetSnappingStateVars",value:function(){var e;(0,x.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,x.pC)(this._snappingGraphicsLayer)&&(null!==(e=this.view)&&void 0!==e&&e.map&&this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy()),this._editGeometryOperations=(0,x.SC)(this._editGeometryOperations),this._snappingTask=(0,x.IM)(this._snappingTask),this._snappingTask=null,this._snappingContext=null,this._stagedVertex=null}},{key:"_resetGraphics",value:function(e){this._removeMidpointGraphics(e),this._removeVertexGraphics(e),this._set("selectedVertices",[])}},{key:"_removeMidpointGraphics",value:function(e){var t=e||this.layer;t&&t.removeMany(this.midpointGraphics.items),this.midpointGraphics.items.forEach((function(e){return e.destroy()})),this.midpointGraphics.removeAll()}},{key:"_removeVertexGraphics",value:function(e){var t=e||this.layer;t&&t.removeMany(this.vertexGraphics.items),this.vertexGraphics.items.forEach((function(e){return e.destroy()})),this.vertexGraphics.removeAll()}},{key:"_getCoordinatesForUI",value:function(e){var t=(0,V.nA)(e.clone());if("polygon"===e.type){var i,r=(0,a.Z)(t);try{for(r.s();!(i=r.n()).done;){var n=i.value,o=n[n.length-1];n[0][0]===o[0]&&n[0][1]===o[1]&&n.length>2&&n.pop()}}catch(s){r.e(s)}finally{r.f()}}return t}},{key:"_setupGraphics",value:function(){var e=this.graphic.geometry;if((0,x.pC)(e)&&("polyline"===e.type||"polygon"===e.type)){var t=this._getCoordinatesForUI(e);this.enableMidpoints&&this._setUpMidpointGraphics(t),this.enableVertices&&this._setUpVertexGraphics(t)}}},{key:"_setUpMidpointGraphics",value:function(e){this._removeMidpointGraphics();var t=this._createMidpointGraphics(e);this.midpointGraphics.addMany(t),this.layer.addMany(t)}},{key:"_setUpVertexGraphics",value:function(e){this._removeVertexGraphics();var t=this._createVertexGraphics(e);this.vertexGraphics.addMany(t),this._storeRelatedVertexIndices(),this.layer.addMany(t)}},{key:"_createVertexGraphics",value:function(e){var t=this._graphicAttributes,i=this.symbols,r=this.view.spatialReference,n=[];return null!==e&&void 0!==e&&e.forEach((function(e,a){e.forEach((function(e,l){var h,p=(0,s.Z)(e,2),c=p[0],v=p[1];n.push(new u.Z({geometry:new Y.Z({x:c,y:v,spatialReference:r}),symbol:null===i||void 0===i||null===(h=i.vertices)||void 0===h?void 0:h.default,attributes:(0,o.Z)((0,o.Z)({},t),{},{pathIndex:a,pointIndex:l})}))}))})),n}},{key:"_createMidpointGraphics",value:function(e){var t=this,i=this._graphicAttributes,r=this.symbols,n=this.view.spatialReference,a=[];return null!==e&&void 0!==e&&e.forEach((function(e,l){e.forEach((function(h,p){var c=(0,s.Z)(h,2),v=c[0],d=c[1],y=e[p+1]?p+1:0;if("polygon"===(0,x.U2)(t.graphic.geometry,"type")||0!==y){var _=(0,s.Z)(e[y],2),f=_[0],m=_[1],g=(0,V.Gi)([v,d],[f,m]),b=(0,s.Z)(g,2),k=b[0],G=b[1];a.push(new u.Z({geometry:new Y.Z({x:k,y:G,spatialReference:n}),symbol:r.midpoints.default,attributes:(0,o.Z)((0,o.Z)({},i),{},{pathIndex:l,pointIndexStart:p,pointIndexEnd:y})}))}}))})),a}},{key:"_storeRelatedVertexIndices",value:function(){var e=this.vertexGraphics.items;if(e)for(var t=e.map((function(e){var t=e.geometry;return{x:t.x,y:t.y}})),i=0;i<t.length;i++){for(var r=[],n=0;n<t.length;n++)if(i!==n){var o=t[i],s=t[n];o.x===s.x&&o.y===s.y&&r.push(n)}e[i].attributes.relatedGraphicIndices=r}}},{key:"_setupMover",value:function(){var e=this,t=this.enableMovement,i=this.graphic,r=this.midpointGraphics,n=this.vertexGraphics,o=this.view,s=n.concat(r).items;t&&s.push(i),this._mover=new T.default({enableMoveAllGraphics:!1,highlightsEnabled:!1,indicatorsEnabled:!1,graphics:s,view:o,callbacks:{onGraphicClick:function(t){return e._onGraphicClickCallback(t)},onGraphicMoveStart:function(t){return e._onGraphicMoveStartCallback(t)},onGraphicMove:function(t){return e._onGraphicMoveCallback(t)},onGraphicMoveStop:function(t){return e._onGraphicMoveStopCallback(t)},onGraphicPointerOver:function(t){return e._onGraphicPointerOverCallback(t)},onGraphicPointerOut:function(t){return e._onGraphicPointerOutCallback(t)}}})}},{key:"_onGraphicClickCallback",value:function(e){e.viewEvent.stopPropagation();var t=e.graphic;if(t===this.graphic)this.clearSelection(),this.emit("graphic-click",e),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(e);else if(this._isMidpoint(t)){if(2===e.viewEvent.button)return;var i=this.graphic.clone(),r=this._createVertexFromMidpoint(t);this.refresh(),this._emitVertexAddEvent([t],i,r)}else this._isVertex(t)&&(e.viewEvent.stopPropagation(),2===e.viewEvent.button?this._removeVertices(t):(e.viewEvent.native.shiftKey||this._clearSelection(),this.selectedVertices.includes(t)?this._removeFromSelection(t,!0):this._addToSelection(t)))}},{key:"_setUpOperation",value:function(e){var t=e.graphic,i=e.dx,r=e.dy,n=t===this.graphic;this._resetSnappingStateVars(),this._setUpGeometryHelper(),this._saveSnappingContextForHandle(t,e),this._activeOperationInfo={target:this.graphic,mover:t,operationType:n?"move":"reshape",totalDx:i,totalDy:r}}},{key:"_onGraphicMoveStartCallback",value:function(e){var t=this,i=e.dx,r=e.dy,n=e.graphic;if(n===this.graphic){var o=n.geometry;return this._setUpOperation(e),this._emitMoveStartEvent(i,r),void((0,x.pC)(o)&&"point"===o.type&&this._onHandleMove(n,i,r,e,(function(){t._updateTooltip(t.graphic,e.viewEvent),t._emitMoveEvent(i,r)})))}if(!this.selectedVertices.includes(n)){if(this._clearSelection(),this._isMidpoint(n)){var s=this.graphic.clone(),a=this._createVertexFromMidpoint(n);this._emitVertexAddEvent([n],s,a)}this._addToSelection(n)}this._setUpOperation(e),this._emitReshapeStartEvent(n),this._onHandleMove(n,i,r,e,(function(){t._updateTooltip(n,e.viewEvent),t._emitReshapeEvent(n)}))}},{key:"_onGraphicMoveCallback",value:function(e){var t=this,i=this._activeOperationInfo;if(i){var r=e.dx,n=e.dy,o=e.graphic;i.totalDx+=r,i.totalDy+=n;var s=i.operationType,a=o.geometry;if(!(0,x.Wi)(a))if("move"!==s)this._onHandleMove(o,r,n,e,(function(){t._updateTooltip(o,e.viewEvent),t._emitReshapeEvent(o)}));else if("point"===a.type)this._onHandleMove(o,r,n,e,(function(){t._updateTooltip(t.graphic,e.viewEvent),t._emitMoveEvent(r,n)}));else if("polyline"===a.type||"polygon"===a.type){var l=this._getCoordinatesForUI(a);this._updateVertexGraphicLocations(l),this._updateTooltip(this.graphic,e.viewEvent),this._emitMoveEvent(r,n)}}}},{key:"_onGraphicMoveStopCallback",value:function(e){var t=this,i=this._activeOperationInfo;if(i){var r=e.dx,n=e.dy,o=e.graphic,s=i.operationType;i.totalDx+=r,i.totalDy+=n,this._onHandleMove(o,r,n,e,(function(){return"move"===s?t._emitMoveStopEvent():t._emitReshapeStopEvent(o)})),this._isMidpoint(o)?this.refresh():(this._updateTooltip(this._isVertex(o)?o:null),this._resetSnappingStateVars(),this._activeOperationInfo=null)}}},{key:"_updateVertexGraphicLocations",value:function(e){var t,i=this.view.spatialReference,r=(0,a.Z)(this.vertexGraphics);try{for(r.s();!(t=r.n()).done;){var n=t.value,o=n.attributes,l=o.pathIndex,h=o.pointIndex,p=(0,s.Z)(e[l][h],2),c=p[0],v=p[1];n.geometry=new Y.Z({x:c,y:v,spatialReference:i})}}catch(u){r.e(u)}finally{r.f()}this._updateMidpointGraphicLocations(e)}},{key:"_updateMidpointGraphicLocations",value:function(e){var t,i=(0,a.Z)(this.midpointGraphics);try{for(i.s();!(t=i.n()).done;){var r=t.value,n=r.attributes,o=n.pathIndex,l=n.pointIndexStart,h=n.pointIndexEnd,p=(0,s.Z)(e[o][l],2),c=p[0],v=p[1],u=(0,s.Z)(e[o][h],2),d=u[0],y=u[1],_=(0,V.Gi)([c,v],[d,y]),f=(0,s.Z)(_,2),m=f[0],g=f[1];r.geometry=new Y.Z({x:m,y:g,spatialReference:this.view.spatialReference})}}catch(x){i.e(x)}finally{i.f()}}},{key:"_getIndicesForVertexGraphic",value:function(e){var t=e.attributes;return[(null===t||void 0===t?void 0:t.pathIndex)||0,(null===t||void 0===t?void 0:t.pointIndex)||0]}},{key:"_getVertexFromEditGeometry",value:function(e){var t=this._getIndicesForVertexGraphic(e),i=(0,s.Z)(t,2),r=i[0],n=i[1];return this._editGeometryOperations.data.components[r].vertices[n]}},{key:"_onHandleMove",value:function(e,t,i,o,s){var a=this;(0,x.IM)(this._snappingTask);var l=this._snappingContext;if(l){var h=e.geometry,p="graphic-move-stop"===o.type;if((0,x.pC)(this.snappingManager)&&this.selectedVertices.length<2&&!p){var c=this.snappingManager;this._stagedVertex=c.update({point:h,context:l}),this._syncGeometryAfterVertexMove(e,new Y.Z(this._stagedVertex),t,i,p),s(),this._snappingTask=(0,d.vr)(function(){var o=(0,n.Z)((0,r.Z)().mark((function n(o){var v;return(0,r.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,c.snap({point:h,context:l,signal:o});case 2:(v=r.sent).valid&&(a._stagedVertex=v.apply(),a._syncGeometryAfterVertexMove(e,new Y.Z(a._stagedVertex),t,i,p),s());case 4:case"end":return r.stop()}}),n)})));return function(e){return o.apply(this,arguments)}}())}else{var v=(0,x.pC)(this._stagedVertex)?new Y.Z(this._stagedVertex):h;this._syncGeometryAfterVertexMove(e,v,t,i,p),s()}}}},{key:"_syncGeometryAfterVertexMove",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t,i,n,o){var a,l,h,p,c,v,u,d,y,_,f,m,g,x=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=x.length>4&&void 0!==x[4]&&x[4],"point"===(l=this._editGeometryOperations.data.geometry).type?t.geometry=i:(h=i.x,p=i.y,c=this._getIndicesForVertexGraphic(t),v=(0,s.Z)(c,2),u=v[0],d=v[1],y=(0,V.nA)(l),_=y[u].length-1,y[u][d]=[h,p],"polygon"===l.type&&(0===d?y[u][_]=[h,p]:d===_&&(y[u][0]=[h,p])),this._isVertex(t)&&(y=this._moveRelatedCoordinates(y,t,h,p),y=this._moveSelectedHandleCoordinates(y,t,n,o,"polygon"===l.type),this._updateMidpointGraphicLocations(y)),this.graphic.geometry=l.clone(),f=this._getVertexFromEditGeometry(t),m=h-f.pos[0],g=p-f.pos[1],this._editGeometryOperations.moveVertices([f],m,g,0),a&&(this._mover?this._mover.updateGeometry(this._mover.graphics.indexOf(t),i):t.geometry=i));case 3:case"end":return e.stop()}}),e,this)})));return function(t,i,r,n){return e.apply(this,arguments)}}()},{key:"_moveRelatedCoordinates",value:function(e,t,i,r){var n,o=t.attributes.relatedGraphicIndices,s=(0,a.Z)(o);try{for(s.s();!(n=s.n()).done;){var l=n.value,h=this.vertexGraphics.getItemAt(l),p=h.attributes,c=p.pathIndex,v=p.pointIndex;e[c][v]=[i,r],h.geometry=t.geometry}}catch(u){s.e(u)}finally{s.f()}return e}},{key:"_moveSelectedHandleCoordinates",value:function(e,t,i,r,n){var o,s=(0,a.Z)(this.selectedVertices);try{for(s.s();!(o=s.n()).done;){var l=o.value;if(l!==t){var h=l.attributes,p=h.pathIndex,c=h.pointIndex,v=h.relatedGraphicIndices,u=(0,I.e7)(l.geometry,i,r,this.view),d=e[p].length-1;e[p][c]=[u.x,u.y],l.geometry=u,n&&(0===c?e[p][d]=[u.x,u.y]:c===d&&(e[p][0]=[u.x,u.y]));var y,_=(0,a.Z)(v);try{for(_.s();!(y=_.n()).done;){var f=y.value,m=this.vertexGraphics.getItemAt(f),g=m.attributes,x=g.pathIndex,b=g.pointIndex;e[x][b]=[u.x,u.y],m.geometry=u}}catch(k){_.e(k)}finally{_.f()}}}}catch(k){s.e(k)}finally{s.f()}return e}},{key:"_onGraphicPointerOverCallback",value:function(e){var t=e.graphic,i=this._isVertex(t);i&&!this._isSelected(t)&&(t.symbol=this.symbols.vertices.hover),this._updateTooltip(i?t:null),this._updateHoverCursor(t)}},{key:"_onGraphicPointerOutCallback",value:function(e){var t=e.graphic;this._isVertex(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.vertices.default),this.view.cursor="default",this._updateTooltip()}},{key:"_createVertexFromMidpoint",value:function(e){var t=this._graphicAttributes,i=this.graphic.geometry;if((0,x.Wi)(i)||"polygon"!==i.type&&"polyline"!==i.type)return[];var r=i.clone(),n=[],s=e.attributes,a=s.pathIndex,l=s.pointIndexStart,h=s.pointIndexEnd,p=e.geometry,c=p.x,v=p.y,u=0===h?l+1:h,d=(0,V.nA)(r);return d[a].splice(u,0,[c,v]),e.attributes=(0,o.Z)((0,o.Z)({},t),{},{pathIndex:a,pointIndex:u,relatedGraphicIndices:[]}),n.push({coordinates:d[a][u],componentIndex:a,vertexIndex:u}),this.graphic.geometry=r,n}},{key:"_addToSelection",value:function(e){e instanceof u.Z&&(e=[e]);var t,i=(0,a.Z)(e);try{for(i.s();!(t=i.n()).done;){t.value.symbol=this.symbols.vertices.selected}}catch(r){i.e(r)}finally{i.f()}this._set("selectedVertices",this.selectedVertices.concat(e)),this._emitSelectEvent(e)}},{key:"_removeFromSelection",value:function(e,t){var i=this.symbols.vertices,r=t?i.hover:i.default;e instanceof u.Z&&(e=[e]);var n,o=(0,a.Z)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;this.selectedVertices.splice(this.selectedVertices.indexOf(s),1),this._set("selectedVertices",this.selectedVertices),s.set("symbol",r)}}catch(l){o.e(l)}finally{o.f()}this._emitDeselectEvent(e)}},{key:"_clearSelection",value:function(){if(this.selectedVertices.length){var e,t=this.selectedVertices,i=(0,a.Z)(this.selectedVertices);try{for(i.s();!(e=i.n()).done;){e.value.set("symbol",this.symbols.vertices.default)}}catch(r){i.e(r)}finally{i.f()}this._set("selectedVertices",[]),this._emitDeselectEvent(t)}}},{key:"_keyDownHandler",value:function(e){L.j.delete.includes(e.key)&&!e.repeat&&this.selectedVertices.length&&this._removeVertices(this.selectedVertices)}},{key:"_removeVertices",value:function(e){var t=this.graphic.geometry;if(!((0,x.Wi)(t)||"polygon"!==t.type&&"polyline"!==t.type)&&!("polygon"===t.type&&this.vertexGraphics.length<4||this.vertexGraphics.length<3)){e instanceof u.Z&&(e=[e]);var i=this.graphic.clone(),r=t.clone(),n=(0,V.nA)(r),o=[];e instanceof u.Z&&(e=[e]);var l,h=(0,a.Z)(e);try{for(h.s();!(l=h.n()).done;)for(var p=l.value.geometry,c=p.x,v=p.y,d=0;d<n.length;d++)for(var y=n[d],_=0;_<y.length;_++){var f=(0,s.Z)(y[_],2),m=f[0],g=f[1];c===m&&v===g&&(o.push({coordinates:n[d][_],componentIndex:d,vertexIndex:_}),n[d].splice(Number(_),1))}}catch(Z){h.e(Z)}finally{h.f()}if("polygon"===r.type)n=n.filter((function(e){if(e.length<2)return!1;var t=(0,s.Z)(e[0],2),i=t[0],r=t[1],n=(0,s.Z)(e[e.length-1],2),o=n[0],a=n[1];return(2!==e.length||i!==o||r!==a)&&(i===o&&r===a||e.push(e[0]),!0)})),r.rings=n;else{var b,k=(0,a.Z)(n);try{for(k.s();!(b=k.n()).done;){var G=b.value;1===G.length&&n.splice(n.indexOf(G),1)}}catch(Z){k.e(Z)}finally{k.f()}r.paths=n}this.graphic.geometry=r,this.refresh(),this._emitVertexRemoveEvent(e,i,o)}}},{key:"_isVertex",value:function(e){return this.vertexGraphics.includes(e)}},{key:"_isSelected",value:function(e){return this._isVertex(e)&&this.selectedVertices.includes(e)}},{key:"_isMidpoint",value:function(e){return this.midpointGraphics.includes(e)}},{key:"_updateHoverCursor",value:function(e){this.view.cursor=this._isMidpoint(e)?"copy":"move"}},{key:"_updateTooltip",value:function(e,t){(0,x.Wi)(this._tooltip)||(e?e===this.graphic?this._updateMoveGraphicTooltip(t):this._updateMoveVertexTooltip(t):this._tooltip.clear())}},{key:"_updateMoveGraphicTooltip",value:function(e){var t=this._tooltip,i=this.tooltipOptions,r=this.view;if(!(0,x.Wi)(t)){var n=new D.$E({tooltipOptions:i});if(e){var o=e.origin,s=o.x,a=o.y,l=r.toMap(e),h=r.toMap((0,G.vW)(s,a)),p=(0,j.Qw)(h,l);n.distance=(0,x.pC)(p)?p:b.yP}t.info=n}}},{key:"_updateMoveVertexTooltip",value:function(e){var t=this._tooltip,i=this.graphic.geometry,r=this.tooltipOptions,n=this.view;if(!(0,x.Wi)(t)){var o=new D.nk({tooltipOptions:r});if((0,x.pC)(i)&&("polygon"===i.type?o.area=(0,W.f)(i):"polyline"===i.type&&(o.totalLength=(0,j.C_)(i))),e){var s=e.origin,a=s.x,l=s.y,h=n.toMap(e),p=n.toMap((0,G.vW)(a,l)),c=(0,j.Qw)(p,h);o.distance=(0,x.pC)(c)?c:b.yP}t.info=o}}},{key:"_emitMoveStartEvent",value:function(e,t){var i=new J(this.graphic,e,t);this.emit("move-start",i),this.callbacks.onMoveStart&&this.callbacks.onMoveStart(i)}},{key:"_emitMoveEvent",value:function(e,t){var i=new K(this.graphic,e,t);this.emit("move",i),this.callbacks.onMove&&this.callbacks.onMove(i)}},{key:"_emitMoveStopEvent",value:function(){var e=this._activeOperationInfo;if(e){var t=e.totalDx,i=e.totalDy,r=new q(this.graphic,t,i);this.emit("move-stop",r),this.callbacks.onMoveStop&&this.callbacks.onMoveStop(r)}}},{key:"_emitReshapeStartEvent",value:function(e){var t=new Q(this.graphic,e,this.selectedVertices);this.emit("reshape-start",t),this.callbacks.onReshapeStart&&this.callbacks.onReshapeStart(t)}},{key:"_emitReshapeEvent",value:function(e){var t=new N(this.graphic,e,this.selectedVertices);this.emit("reshape",t),this.callbacks.onReshape&&this.callbacks.onReshape(t)}},{key:"_emitReshapeStopEvent",value:function(e){var t=new $(this.graphic,e,this.selectedVertices);this.emit("reshape-stop",t),this.callbacks.onReshapeStop&&this.callbacks.onReshapeStop(t)}},{key:"_emitSelectEvent",value:function(e){var t=new B(e);this.emit("select",t),this.callbacks.onVertexSelect&&this.callbacks.onVertexSelect(t)}},{key:"_emitDeselectEvent",value:function(e){var t=new ee(e);this.emit("deselect",t),this.callbacks.onVertexDeselect&&this.callbacks.onVertexDeselect(t)}},{key:"_emitVertexAddEvent",value:function(e,t,i){var r=new te(e,this.graphic,t,i);this.emit("vertex-add",r),this.callbacks.onVertexAdd&&this.callbacks.onVertexAdd(r)}},{key:"_emitVertexRemoveEvent",value:function(e,t,i){var r=new ie(e,this.graphic,t,i);this.emit("vertex-remove",r),this.callbacks.onVertexRemove&&this.callbacks.onVertexRemove(r)}},{key:"_logGeometryTypeError",value:function(){g.Z.getLogger(this.declaredClass).error(new _.Z("reshape:invalid-geometry","Reshape operation not supported for the provided graphic. The geometry type is not supported."))}}]),i}(f.Z.EventedAccessor);(0,v._)([(0,Z.Cb)()],oe.prototype,"_tooltip",void 0),(0,v._)([(0,Z.Cb)()],oe.prototype,"callbacks",void 0),(0,v._)([(0,Z.Cb)()],oe.prototype,"enableMidpoints",void 0),(0,v._)([(0,Z.Cb)()],oe.prototype,"enableMovement",void 0),(0,v._)([(0,Z.Cb)()],oe.prototype,"enableVertices",void 0),(0,v._)([(0,Z.Cb)()],oe.prototype,"graphic",void 0),(0,v._)([(0,Z.Cb)({value:!0})],oe.prototype,"highlightsEnabled",null),(0,v._)([(0,Z.Cb)()],oe.prototype,"layer",void 0),(0,v._)([(0,Z.Cb)({readOnly:!0})],oe.prototype,"midpointGraphics",void 0),(0,v._)([(0,Z.Cb)()],oe.prototype,"midpointSymbol",void 0),(0,v._)([(0,Z.Cb)({readOnly:!0})],oe.prototype,"selectedVertices",void 0),(0,v._)([(0,Z.Cb)()],oe.prototype,"snappingManager",void 0),(0,v._)([(0,Z.Cb)({readOnly:!0})],oe.prototype,"state",null),(0,v._)([(0,Z.Cb)({value:ne})],oe.prototype,"symbols",null),(0,v._)([(0,Z.Cb)({type:P.Z})],oe.prototype,"tooltipOptions",void 0),(0,v._)([(0,Z.Cb)({readOnly:!0})],oe.prototype,"type",void 0),(0,v._)([(0,Z.Cb)({readOnly:!0})],oe.prototype,"vertexGraphics",void 0),(0,v._)([(0,Z.Cb)()],oe.prototype,"view",void 0);var se=oe=(0,v._)([(0,w.j)("esri.views.draw.support.Reshape")],oe)},40524:function(e,t,i){i.d(t,{$E:function(){return v},QW:function(){return u},c1:function(){return f},in:function(){return d},j:function(){return _},nk:function(){return y}});var r=i(43144),n=i(15671),o=i(60136),s=i(29388),a=i(27366),l=i(47898),h=i(49861),p=i(69912),c=i(4943),v=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).type="translate-graphic",r.distance=l.yP,r}return(0,r.Z)(i)}(c.h);(0,a._)([(0,h.Cb)()],v.prototype,"type",void 0),(0,a._)([(0,h.Cb)()],v.prototype,"distance",void 0),v=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],v);var u=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).type="translate-graphic-z",r.distance=l.yP,r}return(0,r.Z)(i)}(c.h);(0,a._)([(0,h.Cb)()],u.prototype,"type",void 0),(0,a._)([(0,h.Cb)()],u.prototype,"distance",void 0),u=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.TranslateGraphicZTooltipInfo")],u);var d=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).type="translate-graphic-xy",r.distance=l.yP,r}return(0,r.Z)(i)}(c.h);(0,a._)([(0,h.Cb)()],d.prototype,"type",void 0),(0,a._)([(0,h.Cb)()],d.prototype,"distance",void 0),d=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.TranslateGraphicXYTooltipInfo")],d);var y=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).type="translate-vertex",r.distance=l.yP,r.elevation=null,r.area=null,r.totalLength=null,r}return(0,r.Z)(i)}(c.h);(0,a._)([(0,h.Cb)()],y.prototype,"type",void 0),(0,a._)([(0,h.Cb)()],y.prototype,"distance",void 0),(0,a._)([(0,h.Cb)()],y.prototype,"elevation",void 0),(0,a._)([(0,h.Cb)()],y.prototype,"area",void 0),(0,a._)([(0,h.Cb)()],y.prototype,"totalLength",void 0),y=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],y);var _=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).type="translate-vertex-z",r.distance=l.yP,r.elevation=null,r}return(0,r.Z)(i)}(c.h);(0,a._)([(0,h.Cb)()],_.prototype,"type",void 0),(0,a._)([(0,h.Cb)()],_.prototype,"distance",void 0),(0,a._)([(0,h.Cb)()],_.prototype,"elevation",void 0),_=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.TranslateVertexZTooltipInfo")],_);var f=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).type="translate-vertex-xy",r.distance=l.yP,r.elevation=null,r.area=null,r.totalLength=null,r}return(0,r.Z)(i)}(c.h);(0,a._)([(0,h.Cb)()],f.prototype,"type",void 0),(0,a._)([(0,h.Cb)()],f.prototype,"distance",void 0),(0,a._)([(0,h.Cb)()],f.prototype,"elevation",void 0),(0,a._)([(0,h.Cb)()],f.prototype,"area",void 0),(0,a._)([(0,h.Cb)()],f.prototype,"totalLength",void 0),f=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.TranslateVertexXYTooltipInfo")],f)}}]);
//# sourceMappingURL=3362.db109553.chunk.js.map